import{s as C,u as we,a as De,c as xe,j as e,L as Ne}from"./index-B2BIVY61.js";import{d as _e,r as b}from"./vendor-react-BUTV5ZEl.js";import{z as Ee,P as se,m as le,q as re,aM as Se,h as Ae,R as ke,aj as Me,w as Le,c as Ce}from"./vendor-icons-CtZxSxcO.js";import"./vendor-supabase-6faYzd5A.js";const T={OUT_OF_OFFICE:"out_of_office",REMOTE:"remote",ON_SITE:"on_site"},O={FULL_DAY:"full_day",AM:"am",PM:"pm"},ie={[T.OUT_OF_OFFICE]:{label:"Out of Office",shortLabel:"OOO",color:"#EF4444",bgColor:"#FEE2E2",icon:"ðŸ”´"},[T.REMOTE]:{label:"Remote",shortLabel:"Remote",color:"#F59E0B",bgColor:"#FEF3C7",icon:"ðŸŸ¡"},[T.ON_SITE]:{label:"On Site",shortLabel:"On-Site",color:"#10B981",bgColor:"#D1FAE5",icon:"ðŸŸ¢"}},z={[O.FULL_DAY]:{label:"Full Day",shortLabel:"Full"},[O.AM]:{label:"Morning (AM)",shortLabel:"AM"},[O.PM]:{label:"Afternoon (PM)",shortLabel:"PM"}},B={MILESTONE:"milestone",DELIVERABLE:"deliverable"};class Te{async getAvailabilityByDateRange(t,a,l,s=null){try{let r=C.from("resource_availability").select(`
          id,
          project_id,
          user_id,
          date,
          status,
          period,
          notes,
          created_at,
          updated_at,
          user:profiles!resource_availability_user_id_fkey (
            id,
            full_name,
            email
          )
        `).eq("project_id",t).gte("date",a).lte("date",l).order("date",{ascending:!0});s&&(r=r.eq("user_id",s));const{data:u,error:h}=await r;if(h)throw h;return u||[]}catch(r){throw r}}async setAvailability(t,a,l,s,r=O.FULL_DAY,u=null){try{if(!Object.values(T).includes(s))throw new Error(`Invalid status: ${s}`);if(!Object.values(O).includes(r))throw new Error(`Invalid period: ${r}`);const{data:h,error:v}=await C.from("resource_availability").upsert({project_id:t,user_id:a,date:l,status:s,period:r,notes:u,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id,date",ignoreDuplicates:!1}).select();if(v)throw v;return h?.[0]||null}catch(h){throw h}}async clearAvailability(t,a,l){try{const{error:s}=await C.from("resource_availability").delete().eq("project_id",t).eq("user_id",a).eq("date",l);if(s)throw s;return!0}catch(s){throw s}}async getProjectMembers(t){try{const{data:a,error:l}=await C.from("user_projects").select(`
          user_id,
          role,
          user:profiles!user_projects_user_id_fkey (
            id,
            full_name,
            email
          )
        `).eq("project_id",t).order("role");if(l)throw l;return(a||[]).map(s=>({id:s.user_id,name:s.user?.full_name||s.user?.email||"Unknown",email:s.user?.email,role:s.role}))}catch(a){throw a}}async getMilestonesByDateRange(t,a,l){try{const{data:s,error:r}=await C.from("milestones").select(`
          id,
          project_id,
          milestone_ref,
          name,
          description,
          start_date,
          end_date,
          forecast_end_date,
          status,
          completion_percentage,
          billable
        `).eq("project_id",t).or("is_deleted.is.null,is_deleted.eq.false").order("forecast_end_date",{ascending:!0});if(r)throw r;return(s||[]).filter(h=>{const v=h.forecast_end_date||h.end_date;return v?v>=a&&v<=l:!1})}catch(s){throw s}}async getAllMilestones(t){try{const{data:a,error:l}=await C.from("milestones").select(`
          id,
          project_id,
          milestone_ref,
          name,
          description,
          start_date,
          end_date,
          forecast_end_date,
          status,
          completion_percentage,
          billable
        `).eq("project_id",t).or("is_deleted.is.null,is_deleted.eq.false").order("forecast_end_date",{ascending:!0});if(l)throw l;return a||[]}catch(a){throw a}}async getDeliverablesByDateRange(t,a,l){try{const{data:s,error:r}=await C.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).or("is_deleted.is.null,is_deleted.eq.false").gte("due_date",a).lte("due_date",l).order("due_date",{ascending:!0});if(r)throw r;return s||[]}catch(s){throw s}}async getAllDeliverables(t){try{const{data:a,error:l}=await C.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(l)throw l;return a||[]}catch(a){throw a}}async getAllEvents(t,a,l,s={}){try{const r={availability:[],milestones:[],deliverables:[]},{showAvailability:u=!0,showMilestones:h=!0,showDeliverables:v=!0,userId:E}=s,c=[];return u&&c.push(this.getAvailabilityByDateRange(t,a,l,E).then(D=>{r.availability=D})),h&&c.push(this.getMilestonesByDateRange(t,a,l).then(D=>{r.milestones=D})),v&&c.push(this.getDeliverablesByDateRange(t,a,l).then(D=>{r.deliverables=D})),await Promise.all(c),r}catch(r){throw r}}async getUpcomingDeliverables(t,a=4){try{const l=new Date,s=l.toISOString().split("T")[0],r=new Date(l);r.setDate(r.getDate()+a*7);const u=r.toISOString().split("T")[0];return this.getDeliverablesByDateRange(t,s,u)}catch(l){throw l}}async getUpcomingMilestones(t,a=4){try{const l=new Date,s=l.toISOString().split("T")[0],r=new Date(l);r.setDate(r.getDate()+a*7);const u=r.toISOString().split("T")[0];return this.getMilestonesByDateRange(t,s,u)}catch(l){throw l}}async getProjectDateRange(t){try{const{data:a}=await C.from("projects").select("start_date, end_date").eq("id",t).limit(1);if(a?.[0])return{start:a[0].start_date,end:a[0].end_date};const l=await this.getAllMilestones(t);if(l.length===0){const r=new Date().toISOString().split("T")[0];return{start:r,end:r}}const s=l.flatMap(r=>[r.start_date,r.end_date,r.forecast_end_date]).filter(Boolean).sort();return{start:s[0],end:s[s.length-1]}}catch(a){throw a}}}const F=new Te;function G(n,t,a){return n==="viewer"?!1:n==="admin"||n==="supplier_pm"?!0:t===a}const L={ALL_EVENTS:"all",AVAILABILITY:"availability",MILESTONES:"milestones",DELIVERABLES:"deliverables",MILESTONES_DELIVERABLES:"milestones_deliverables"},ae={[L.ALL_EVENTS]:{label:"All Events",icon:Se,showAvailability:!0,showMilestones:!0,showDeliverables:!0},[L.AVAILABILITY]:{label:"Team Availability",icon:re,showAvailability:!0,showMilestones:!1,showDeliverables:!1},[L.MILESTONES]:{label:"Milestones",icon:le,showAvailability:!1,showMilestones:!0,showDeliverables:!1},[L.DELIVERABLES]:{label:"Deliverables",icon:se,showAvailability:!1,showMilestones:!1,showDeliverables:!0},[L.MILESTONES_DELIVERABLES]:{label:"Milestones & Deliverables",icon:Ee,showAvailability:!1,showMilestones:!0,showDeliverables:!0}},i={formatDate:n=>new Date(n).toISOString().split("T")[0],getWeekStart:n=>{const t=new Date(n),a=t.getDay(),l=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(l))},getWeekEnd:n=>{const t=i.getWeekStart(n),a=new Date(t);return a.setDate(a.getDate()+6),a},getMonthStart:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth(),1)},getMonthEnd:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth()+1,0)},getWeekDates:n=>{const t=i.getWeekStart(n),a=[];for(let l=0;l<7;l++){const s=new Date(t);s.setDate(s.getDate()+l),a.push(s)}return a},getMonthWeeks:n=>{const t=i.getMonthStart(n),a=i.getMonthEnd(n),l=i.getWeekStart(t),s=[];let r=new Date(l);for(;r<=a||s.length<5;){const u=[];for(let h=0;h<7;h++)u.push(new Date(r)),r.setDate(r.getDate()+1);if(s.push(u),s.length>=6)break}return s},getWeeksAhead:n=>{const t=[],a=new Date;let l=i.getWeekStart(a);for(let s=0;s<n;s++){const r=new Date(l);r.setDate(r.getDate()+6),t.push({start:new Date(l),end:r,label:s===0?"This Week":`Week ${s+1}`}),l=new Date(l),l.setDate(l.getDate()+7)}return t},isToday:n=>{const t=new Date;return i.formatDate(n)===i.formatDate(t)},isWeekend:n=>{const t=new Date(n).getDay();return t===0||t===6},isPast:n=>{const t=new Date;return t.setHours(0,0,0,0),new Date(n)<t},formatDisplay:(n,t="short")=>{const a=new Date(n);if(t==="short")return a.toLocaleDateString("en-GB",{day:"numeric"});if(t==="day")return a.toLocaleDateString("en-GB",{weekday:"short"});if(t==="full")return a.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});if(t==="medium")return a.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});if(t==="month")return a.toLocaleDateString("en-GB",{month:"long",year:"numeric"});if(t==="week"){const l=i.getWeekEnd(n),s=a.toLocaleDateString("en-GB",{day:"numeric",month:"short"}),r=l.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return`${s} - ${r}`}if(t==="weekRange"){const l=new Date(n),s=new Date(n);return s.setDate(s.getDate()+6),`${l.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${s.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return a.toLocaleDateString("en-GB")}};function ne({status:n,period:t,size:a="normal"}){const l=ie[n];if(!l)return null;const s=n===T.OUT_OF_OFFICE?"ooo":n===T.REMOTE?"remote":"onsite",r=t&&t!==O.FULL_DAY;return a==="mini"?e.jsx("span",{className:`cal-mini-badge ${s}`,title:`${l.label}${r?` (${z[t]?.shortLabel})`:""}`}):e.jsxs("span",{className:`cal-status-badge ${s} ${r?"half-day":""}`,children:[l.shortLabel,r&&e.jsxs("span",{className:"cal-period-indicator",children:["(",z[t]?.shortLabel,")"]})]})}function W({type:n,reference:t,name:a,isOverdue:l,size:s="normal"}){const r=n===B.MILESTONE?"milestone":"deliverable";return s==="mini"?e.jsx("span",{className:`cal-mini-badge ${r}`,title:`${t}: ${a}`}):e.jsx("span",{className:`cal-event-badge ${r} ${l?"overdue":""}`,title:a,children:e.jsx("span",{className:"cal-event-ref",children:t})})}function Oe({isOpen:n,onClose:t,onSave:a,onClear:l,date:s,resource:r,currentEntry:u,isEditingOther:h}){const[v,E]=b.useState(u?.status||""),[c,D]=b.useState(u?.period||O.FULL_DAY),[j,f]=b.useState(u?.notes||""),[m,p]=b.useState(!1);if(b.useEffect(()=>{E(u?.status||""),D(u?.period||O.FULL_DAY),f(u?.notes||"")},[u,n]),!n)return null;const _=async()=>{if(v){p(!0);try{await a(v,c,j),t()}finally{p(!1)}}},g=async()=>{p(!0);try{await l(),t()}finally{p(!1)}};return e.jsx("div",{className:"cal-modal-overlay",onClick:t,children:e.jsxs("div",{className:"cal-modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"cal-modal-header",children:[e.jsx("h3",{children:h?"Edit Availability":"Set Availability"}),e.jsx("button",{className:"cal-modal-close",onClick:t,children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"cal-modal-body",children:[e.jsxs("div",{className:"cal-modal-info",children:[e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Date"}),e.jsx("span",{className:"cal-modal-info-value",children:i.formatDisplay(s,"full")})]}),e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Resource"}),e.jsxs("span",{className:"cal-modal-info-value",children:[r?.name,h&&e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.8em"},children:" (editing as manager)"})]})]})]}),e.jsx("div",{className:"cal-modal-section-title",children:"Status"}),e.jsx("div",{className:"cal-status-options",children:Object.entries(T).map(([x,N])=>{const k=ie[N],S=N===T.OUT_OF_OFFICE?"ooo":N===T.REMOTE?"remote":"onsite";return e.jsxs("div",{className:`cal-status-option ${v===N?"selected":""}`,onClick:()=>E(N),children:[e.jsx("span",{className:`cal-status-option-dot ${S}`}),e.jsx("span",{className:"cal-status-option-text",children:k.label})]},N)})}),e.jsx("div",{className:"cal-modal-section-title",children:"Duration"}),e.jsx("div",{className:"cal-period-options",children:Object.entries(O).map(([x,N])=>e.jsx("div",{className:`cal-period-option ${c===N?"selected":""}`,onClick:()=>D(N),children:z[N].label},N))}),e.jsx("div",{className:"cal-modal-section-title",children:"Notes (optional)"}),e.jsx("textarea",{className:"cal-notes-input",placeholder:"Add notes...",value:j,onChange:x=>f(x.target.value)})]}),e.jsxs("div",{className:"cal-modal-footer",children:[u&&e.jsx("button",{className:"cal-btn cal-btn-danger",onClick:g,disabled:m,children:"Clear"}),e.jsx("button",{className:"cal-btn cal-btn-secondary",onClick:t,children:"Cancel"}),e.jsx("button",{className:"cal-btn cal-btn-primary",onClick:_,disabled:!v||m,children:m?"Saving...":"Save"})]})]})})}function Ve(){const n=_e(),{user:t}=we(),{projectId:a,projectRole:l}=De(),{showSuccess:s,showError:r}=xe(),[u,h]=b.useState(L.ALL_EVENTS),[v,E]=b.useState("week"),[c,D]=b.useState(4),[j,f]=b.useState(new Date),[m,p]=b.useState("all"),[_,g]=b.useState([]),[x,N]=b.useState([]),[k,S]=b.useState([]),[R,oe]=b.useState([]),[ce,de]=b.useState(!0),[P,Y]=b.useState(!1),[H,he]=b.useState(null),[M,X]=b.useState({isOpen:!1,date:null,resource:null,entry:null}),w=ae[u],I=l||"viewer",V=b.useMemo(()=>{if(u===L.DELIVERABLES){const d=new Date,o=new Date(d);return o.setDate(o.getDate()+c*7),{start:i.formatDate(d),end:i.formatDate(o)}}if(v==="week")return{start:i.formatDate(i.getWeekStart(j)),end:i.formatDate(i.getWeekEnd(j))};{const d=i.getMonthStart(j),o=i.getMonthEnd(j);return{start:i.formatDate(i.getWeekStart(d)),end:i.formatDate(i.getWeekEnd(o))}}},[u,v,j,c]),$=b.useCallback(async(d=!1)=>{if(a){d&&Y(!0);try{const o=await F.getAllEvents(a,V.start,V.end,{showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,userId:m!=="all"?m:null});if(g(o.availability),N(o.milestones),S(o.deliverables),he(new Date),w.showAvailability){const y=await F.getProjectMembers(a);oe(y)}d&&s("Calendar refreshed")}catch{r("Failed to load calendar data")}finally{de(!1),Y(!1)}}},[a,V,w,m,r,s]);b.useEffect(()=>{$()},[$]);const me=()=>$(!0),J=d=>{const o=new Date(j);v==="week"?o.setDate(o.getDate()+d*7):o.setMonth(o.getMonth()+d),f(o)},ue=()=>f(new Date),U=(d,o)=>{const y=i.formatDate(o);return _.find(A=>A.user_id===d&&A.date===y)},K=d=>{const o=i.formatDate(d);return x.filter(y=>(y.forecast_end_date||y.end_date)===o)},Q=d=>{const o=i.formatDate(d);return k.filter(y=>y.due_date===o)},Z=(d,o)=>{if(!G(I,t?.id,o.id))return;const y=U(o.id,d);X({isOpen:!0,date:d,resource:o,entry:y})},ve=async(d,o,y)=>{const A=M.resource?.id;try{await F.setAvailability(a,A,i.formatDate(M.date),d,o,y);const q=A!==t?.id;s(q?`Availability updated for ${M.resource?.name}`:"Availability updated"),$()}catch(q){throw r("Failed to save availability"),q}},fe=async()=>{const d=M.resource?.id;try{await F.clearAvailability(a,d,i.formatDate(M.date));const o=d!==t?.id;s(o?`Availability cleared for ${M.resource?.name}`:"Availability cleared"),$()}catch(o){throw r("Failed to clear availability"),o}},ee=b.useMemo(()=>m==="all"?R:R.filter(d=>d.id===m),[R,m]),ge=b.useMemo(()=>i.getWeeksAhead(c).map(o=>({...o,items:k.filter(y=>{const A=new Date(y.due_date);return A>=o.start&&A<=o.end})})),[k,c]),be=b.useMemo(()=>i.getWeeksAhead(c).map(o=>({...o,items:x.filter(y=>{const A=new Date(y.forecast_end_date||y.end_date);return A>=o.start&&A<=o.end})})),[x,c]),pe=M.resource?.id!==t?.id;if(ce)return e.jsx(Ne,{message:"Loading calendar...",size:"large",fullPage:!0});const te=u!==L.DELIVERABLES,ye=u===L.DELIVERABLES,je=()=>I==="viewer"?"View only - contact a manager to update availability":I==="admin"||I==="supplier_pm"?"Click any row to edit availability":"Click your row to set availability";return e.jsxs("div",{className:"calendar-page",children:[e.jsx("header",{className:"cal-header",children:e.jsxs("div",{className:"cal-header-content",children:[e.jsxs("div",{className:"cal-header-left",children:[e.jsx("div",{className:"cal-header-icon",children:e.jsx(Ae,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Project Calendar"}),e.jsx("p",{children:"Team availability, milestones, and deliverables"})]})]}),e.jsxs("div",{className:"cal-header-actions",children:[e.jsxs("button",{className:"cal-btn cal-btn-secondary",onClick:me,disabled:P,children:[e.jsx(ke,{size:18,className:P?"spinning":""}),P?"Refreshing...":"Refresh"]}),H&&e.jsxs("span",{className:"cal-last-refresh",children:["Updated ",H.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsx("div",{className:"cal-controls",children:e.jsxs("div",{className:"cal-controls-inner",children:[e.jsx("div",{className:"cal-controls-left",children:e.jsx("div",{className:"cal-view-tabs",children:Object.entries(L).map(([d,o])=>{const y=ae[o],A=y.icon;return e.jsxs("button",{className:`cal-view-tab ${u===o?"active":""}`,onClick:()=>h(o),children:[e.jsx(A,{size:16,className:"cal-view-tab-icon"}),e.jsx("span",{children:y.label})]},o)})})}),e.jsx("div",{className:"cal-controls-center",children:ye?e.jsx("div",{className:"cal-range-select",children:[1,2,3,4].map(d=>e.jsxs("button",{className:`cal-range-btn ${c===d?"active":""}`,onClick:()=>D(d),children:[d,"W"]},d))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-nav",children:[e.jsx("button",{className:"cal-nav-btn",onClick:()=>J(-1),children:e.jsx(Me,{size:20})}),e.jsx("span",{className:"cal-period",children:v==="week"?i.formatDisplay(j,"week"):i.formatDisplay(j,"month")}),e.jsx("button",{className:"cal-nav-btn",onClick:()=>J(1),children:e.jsx(Le,{size:20})})]}),e.jsx("button",{className:"cal-today-btn",onClick:ue,children:"Today"})]})}),e.jsxs("div",{className:"cal-controls-right",children:[te&&e.jsxs("div",{className:"cal-period-toggle",children:[e.jsx("button",{className:`cal-period-btn ${v==="week"?"active":""}`,onClick:()=>E("week"),children:"Week"}),e.jsx("button",{className:`cal-period-btn ${v==="month"?"active":""}`,onClick:()=>E("month"),children:"Month"})]}),w.showAvailability&&e.jsxs("select",{className:"cal-filter-select",value:m,onChange:d=>p(d.target.value),children:[e.jsxs("option",{value:"all",children:["All Resources (",R.length,")"]}),R.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]})]})}),e.jsxs("div",{className:"cal-content",children:[e.jsxs("div",{className:"cal-legend",children:[w.showAvailability&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot ooo"}),e.jsx("span",{children:"Out of Office"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot remote"}),e.jsx("span",{children:"Remote"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot onsite"}),e.jsx("span",{children:"On Site"})]})]}),w.showMilestones&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot milestone"}),e.jsx("span",{children:"Milestone"})]}),w.showDeliverables&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot deliverable"}),e.jsx("span",{children:"Deliverable"})]}),w.showAvailability&&e.jsxs("div",{className:"cal-legend-hint",children:[e.jsx(re,{size:16}),e.jsx("span",{children:je()})]})]}),te?e.jsx("div",{className:"cal-calendar-card",children:v==="week"?e.jsx(Ie,{currentDate:j,members:w.showAvailability?ee:[],currentUserId:t?.id,userRole:I,showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,onCellClick:Z,getAvailabilityEntry:U,getMilestonesForDate:K,getDeliverablesForDate:Q}):e.jsx(Re,{currentDate:j,members:w.showAvailability?ee:[],currentUserId:t?.id,userRole:I,showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,onCellClick:Z,getAvailabilityEntry:U,getMilestonesForDate:K,getDeliverablesForDate:Q})}):e.jsx($e,{deliverablesByWeek:ge,milestonesByWeek:w.showMilestones?be:[],onDeliverableClick:()=>n("/deliverables"),onMilestoneClick:d=>n(`/milestones/${d.id}`)})]}),e.jsx(Oe,{isOpen:M.isOpen,onClose:()=>X({isOpen:!1,date:null,resource:null,entry:null}),onSave:ve,onClear:fe,date:M.date,resource:M.resource,currentEntry:M.entry,isEditingOther:pe})]})}function Ie({currentDate:n,members:t,currentUserId:a,userRole:l,showAvailability:s,showMilestones:r,showDeliverables:u,onCellClick:h,getAvailabilityEntry:v,getMilestonesForDate:E,getDeliverablesForDate:c}){const D=i.getWeekDates(n),j=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!s||t.length===0?e.jsxs("div",{className:"cal-week-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-week-header",children:D.map((f,m)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(f)?"today":""}`,children:[j[m],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(f,"short")})]},m))}),e.jsx("div",{className:"cal-week-row",children:D.map((f,m)=>{const p=E(f),_=c(f);return e.jsxs("div",{className:`cal-day-cell not-editable ${i.isWeekend(f)?"weekend":""} ${i.isToday(f)?"today":""}`,style:{minHeight:"120px"},children:[r&&p.map(g=>e.jsx(W,{type:B.MILESTONE,reference:g.milestone_ref,name:g.name,isOverdue:i.isPast(g.forecast_end_date||g.end_date)},g.id)),u&&_.map(g=>e.jsx(W,{type:B.DELIVERABLE,reference:g.deliverable_ref,name:g.name,isOverdue:i.isPast(g.due_date)&&g.status!=="Delivered"},g.id))]},m)})})]}):e.jsxs("div",{className:"cal-week-grid",children:[e.jsxs("div",{className:"cal-week-header",children:[e.jsx("div",{className:"cal-week-header-cell",children:"Resource"}),D.map((f,m)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(f)?"today":""}`,children:[j[m],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(f,"short")})]},m))]}),t.map(f=>{const m=G(l,a,f.id);return e.jsxs("div",{className:"cal-week-row",children:[e.jsxs("div",{className:"cal-resource-cell",children:[e.jsx("div",{className:"cal-resource-name",children:f.name}),e.jsx("div",{className:"cal-resource-role",children:f.role})]}),D.map((p,_)=>{const g=v(f.id,p);return e.jsx("div",{className:`cal-day-cell ${i.isWeekend(p)?"weekend":""} ${i.isToday(p)?"today":""} ${m?"":"not-editable"}`,onClick:()=>m&&h(p,f),style:{cursor:m?"pointer":"default"},title:m?"Click to edit availability":`${f.name}'s availability`,children:g&&e.jsx(ne,{status:g.status,period:g.period})},_)})]},f.id)})]})}function Re({currentDate:n,members:t,currentUserId:a,userRole:l,showAvailability:s,showMilestones:r,showDeliverables:u,onCellClick:h,getAvailabilityEntry:v,getMilestonesForDate:E,getDeliverablesForDate:c}){const D=i.getMonthWeeks(n),j=n.getMonth(),f=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!s||t.length===0?e.jsxs("div",{className:"cal-month-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-month-header",children:f.map((m,p)=>e.jsx("div",{className:"cal-month-header-cell",children:m},p))}),D.map((m,p)=>e.jsx("div",{className:"cal-month-row",children:m.map((_,g)=>{const x=_.getMonth()!==j,N=E(_),k=c(_);return e.jsxs("div",{className:`cal-month-cell not-editable ${i.isWeekend(_)?"weekend":""} ${i.isToday(_)?"today":""} ${x?"outside-month":""}`,style:{minHeight:"80px"},children:[e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(_,"short")}),r&&N.map(S=>e.jsx(W,{type:B.MILESTONE,reference:S.milestone_ref,name:S.name,size:"mini"},S.id)),u&&k.map(S=>e.jsx(W,{type:B.DELIVERABLE,reference:S.deliverable_ref,name:S.name,size:"mini"},S.id))]},g)})},p))]}):e.jsxs("div",{className:"cal-month-grid",children:[e.jsxs("div",{className:"cal-month-header",children:[e.jsx("div",{className:"cal-month-header-cell",children:"Resource"}),f.map((m,p)=>e.jsx("div",{className:"cal-month-header-cell",children:m},p))]}),t.map(m=>{const p=G(l,a,m.id);return D.map((_,g)=>e.jsxs("div",{className:"cal-month-row",children:[e.jsx("div",{className:"cal-resource-cell",children:g===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cal-resource-name",children:m.name}),e.jsx("div",{className:"cal-resource-role",children:m.role})]})}),_.map((x,N)=>{const k=v(m.id,x),S=x.getMonth()!==j;return e.jsxs("div",{className:`cal-month-cell ${i.isWeekend(x)?"weekend":""} ${i.isToday(x)?"today":""} ${S?"outside-month":""} ${p?"":"not-editable"}`,onClick:()=>!S&&p&&h(x,m),style:{cursor:p&&!S?"pointer":"default"},children:[(g===0||N===0)&&e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(x,"short")}),k&&e.jsx(ne,{status:k.status,period:k.period,size:"mini"})]},N)})]},`${m.id}-${g}`))})]})}function $e({deliverablesByWeek:n,milestonesByWeek:t,onDeliverableClick:a,onMilestoneClick:l}){const s=h=>({"Not Started":"not-started",Draft:"not-started","In Progress":"in-progress",Submitted:"submitted","Review Complete":"submitted",Delivered:"delivered",Completed:"delivered"})[h]||"not-started",r=n.map((h,v)=>({...h,milestones:t[v]?.items||[],deliverables:h.items||[]}));return r.some(h=>h.milestones.length>0||h.deliverables.length>0)?e.jsx("div",{className:"cal-deliverables-list",children:r.map((h,v)=>{const E=h.milestones.length+h.deliverables.length;return e.jsxs("div",{className:"cal-deliverables-week",children:[e.jsxs("div",{className:"cal-week-label",children:[e.jsx("span",{children:h.label}),e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:i.formatDisplay(h.start,"weekRange")}),E>0&&e.jsx("span",{className:"cal-week-count",children:E})]}),E===0?e.jsx("div",{className:"cal-empty-week",children:"No items due this week"}):e.jsxs(e.Fragment,{children:[h.milestones.map(c=>e.jsxs("div",{className:"cal-milestone-item",onClick:()=>l(c),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(c.forecast_end_date||c.end_date)&&c.status!=="Completed"?"overdue":""}`,children:i.formatDisplay(c.forecast_end_date||c.end_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-milestone-ref",children:c.milestone_ref}),e.jsx("span",{className:"cal-milestone-name",children:c.name})]}),e.jsxs("div",{className:"cal-milestone-progress",children:[e.jsx("div",{className:"cal-progress-bar",children:e.jsx("div",{className:"cal-progress-fill",style:{width:`${c.completion_percentage||0}%`}})}),e.jsxs("span",{className:"cal-progress-text",children:[c.completion_percentage||0,"%"]})]}),e.jsx("div",{className:`cal-deliverable-status ${s(c.status)}`,children:c.status})]},c.id)),h.deliverables.map(c=>e.jsxs("div",{className:"cal-deliverable-item",onClick:()=>a(c),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(c.due_date)&&c.status!=="Delivered"?"overdue":""}`,children:i.formatDisplay(c.due_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-deliverable-ref",children:c.deliverable_ref}),e.jsx("span",{className:"cal-deliverable-name",children:c.name})]}),e.jsxs("div",{className:"cal-deliverable-milestone",children:[e.jsx(le,{size:12}),c.milestones?.milestone_ref||"â€”"]}),e.jsx("div",{className:`cal-deliverable-status ${s(c.status)}`,children:c.status})]},c.id))]})]},v)})}):e.jsx("div",{className:"cal-deliverables-list",children:e.jsxs("div",{className:"cal-empty",children:[e.jsx(se,{size:48,className:"cal-empty-icon"}),e.jsx("p",{children:"No milestones or deliverables due in this period"})]})})}export{Ve as default};
