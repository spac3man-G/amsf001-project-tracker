import{s as T,u as we,a as De,c as xe,j as e,L as Ne}from"./index-CUID-B4N.js";import{d as _e,r as f}from"./vendor-react-BUTV5ZEl.js";import{z as Ee,P as ie,m as ne,q as oe,aM as Se,h as ke,R as Ae,aj as Me,w as Le,c as Ce}from"./vendor-icons-CtZxSxcO.js";import"./vendor-supabase-6faYzd5A.js";const $={OUT_OF_OFFICE:"out_of_office",REMOTE:"remote",ON_SITE:"on_site"},R={FULL_DAY:"full_day",AM:"am",PM:"pm"},ce={[$.OUT_OF_OFFICE]:{label:"Out of Office",shortLabel:"OOO",color:"#EF4444",bgColor:"#FEE2E2",icon:"ðŸ”´"},[$.REMOTE]:{label:"Remote",shortLabel:"Remote",color:"#F59E0B",bgColor:"#FEF3C7",icon:"ðŸŸ¡"},[$.ON_SITE]:{label:"On Site",shortLabel:"On-Site",color:"#10B981",bgColor:"#D1FAE5",icon:"ðŸŸ¢"}},H={[R.FULL_DAY]:{label:"Full Day",shortLabel:"Full"},[R.AM]:{label:"Morning (AM)",shortLabel:"AM"},[R.PM]:{label:"Afternoon (PM)",shortLabel:"PM"}},P={MILESTONE:"milestone",DELIVERABLE:"deliverable"};class Te{async getAvailabilityByDateRange(t,s,r,a=null){try{let l=T.from("resource_availability").select(`
          id,
          project_id,
          user_id,
          date,
          status,
          period,
          notes,
          created_at,
          updated_at
        `).eq("project_id",t).gte("date",s).lte("date",r).order("date",{ascending:!0});a&&(l=l.eq("user_id",a));const{data:u,error:c}=await l;if(c)throw c;return u||[]}catch(l){throw l}}async setAvailability(t,s,r,a,l=R.FULL_DAY,u=null){try{if(!Object.values($).includes(a))throw new Error(`Invalid status: ${a}`);if(!Object.values(R).includes(l))throw new Error(`Invalid period: ${l}`);const{data:c,error:d}=await T.from("resource_availability").upsert({project_id:t,user_id:s,date:r,status:a,period:l,notes:u,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id,date",ignoreDuplicates:!1}).select();if(d)throw d;return c?.[0]||null}catch(c){throw c}}async clearAvailability(t,s,r){try{const{error:a}=await T.from("resource_availability").delete().eq("project_id",t).eq("user_id",s).eq("date",r);if(a)throw a;return!0}catch(a){throw a}}async getProjectMembers(t){try{const{data:s,error:r}=await T.from("user_projects").select("user_id, role").eq("project_id",t).order("role");if(r)throw r;if(!s||s.length===0)return[];const a=s.map(d=>d.user_id),{data:l,error:u}=await T.from("profiles").select("id, full_name, email").in("id",a),c={};return(l||[]).forEach(d=>{c[d.id]=d}),s.map(d=>({id:d.user_id,name:c[d.user_id]?.full_name||c[d.user_id]?.email||"Unknown",email:c[d.user_id]?.email,role:d.role}))}catch(s){throw s}}async getMilestonesByDateRange(t,s,r){try{const{data:a,error:l}=await T.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(l)throw l;return(a||[]).filter(c=>c.is_deleted!==!0).filter(c=>{const d=c.forecast_end_date||c.end_date;return d?d>=s&&d<=r:!1})}catch(a){throw a}}async getAllMilestones(t){try{const{data:s,error:r}=await T.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(r)throw r;return(s||[]).filter(a=>a.is_deleted!==!0)}catch(s){throw s}}async getDeliverablesByDateRange(t,s,r){try{const{data:a,error:l}=await T.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).gte("due_date",s).lte("due_date",r).order("due_date",{ascending:!0});if(l)throw l;return(a||[]).filter(u=>u.is_deleted!==!0)}catch(a){throw a}}async getAllDeliverables(t){try{const{data:s,error:r}=await T.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).order("due_date",{ascending:!0});if(r)throw r;return(s||[]).filter(a=>a.is_deleted!==!0)}catch(s){throw s}}async getAllEvents(t,s,r,a={}){try{const l={availability:[],milestones:[],deliverables:[]},{showAvailability:u=!0,showMilestones:c=!0,showDeliverables:d=!0,userId:y}=a,h=[];return u&&h.push(this.getAvailabilityByDateRange(t,s,r,y).then(E=>{l.availability=E})),c&&h.push(this.getMilestonesByDateRange(t,s,r).then(E=>{l.milestones=E})),d&&h.push(this.getDeliverablesByDateRange(t,s,r).then(E=>{l.deliverables=E})),await Promise.all(h),l}catch(l){throw l}}async getUpcomingDeliverables(t,s=4){try{const r=new Date,a=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+s*7);const u=l.toISOString().split("T")[0];return this.getDeliverablesByDateRange(t,a,u)}catch(r){throw r}}async getUpcomingMilestones(t,s=4){try{const r=new Date,a=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+s*7);const u=l.toISOString().split("T")[0];return this.getMilestonesByDateRange(t,a,u)}catch(r){throw r}}async getProjectDateRange(t){try{const{data:s}=await T.from("projects").select("start_date, end_date").eq("id",t).limit(1);if(s?.[0])return{start:s[0].start_date,end:s[0].end_date};const r=await this.getAllMilestones(t);if(r.length===0){const l=new Date().toISOString().split("T")[0];return{start:l,end:l}}const a=r.flatMap(l=>[l.start_date,l.end_date,l.forecast_end_date]).filter(Boolean).sort();return{start:a[0],end:a[a.length-1]}}catch(s){throw s}}}const U=new Te;function X(i,t,s){return i==="viewer"?!1:i==="admin"||i==="supplier_pm"?!0:t===s}const O={ALL_EVENTS:"all",AVAILABILITY:"availability",MILESTONES:"milestones",DELIVERABLES:"deliverables",MILESTONES_DELIVERABLES:"milestones_deliverables"},re={[O.ALL_EVENTS]:{label:"All Events",icon:Se,showAvailability:!0,showMilestones:!0,showDeliverables:!0},[O.AVAILABILITY]:{label:"Team Availability",icon:oe,showAvailability:!0,showMilestones:!1,showDeliverables:!1},[O.MILESTONES]:{label:"Milestones",icon:ne,showAvailability:!1,showMilestones:!0,showDeliverables:!1},[O.DELIVERABLES]:{label:"Deliverables",icon:ie,showAvailability:!1,showMilestones:!1,showDeliverables:!0},[O.MILESTONES_DELIVERABLES]:{label:"Milestones & Deliverables",icon:Ee,showAvailability:!1,showMilestones:!0,showDeliverables:!0}},n={formatDate:i=>new Date(i).toISOString().split("T")[0],getWeekStart:i=>{const t=new Date(i),s=t.getDay(),r=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(r))},getWeekEnd:i=>{const t=n.getWeekStart(i),s=new Date(t);return s.setDate(s.getDate()+6),s},getMonthStart:i=>{const t=new Date(i);return new Date(t.getFullYear(),t.getMonth(),1)},getMonthEnd:i=>{const t=new Date(i);return new Date(t.getFullYear(),t.getMonth()+1,0)},getWeekDates:i=>{const t=n.getWeekStart(i),s=[];for(let r=0;r<7;r++){const a=new Date(t);a.setDate(a.getDate()+r),s.push(a)}return s},getMonthWeeks:i=>{const t=n.getMonthStart(i),s=n.getMonthEnd(i),r=n.getWeekStart(t),a=[];let l=new Date(r);for(;l<=s||a.length<5;){const u=[];for(let c=0;c<7;c++)u.push(new Date(l)),l.setDate(l.getDate()+1);if(a.push(u),a.length>=6)break}return a},getWeeksAhead:i=>{const t=[],s=new Date;let r=n.getWeekStart(s);for(let a=0;a<i;a++){const l=new Date(r);l.setDate(l.getDate()+6),t.push({start:new Date(r),end:l,label:a===0?"This Week":`Week ${a+1}`}),r=new Date(r),r.setDate(r.getDate()+7)}return t},isToday:i=>{const t=new Date;return n.formatDate(i)===n.formatDate(t)},isWeekend:i=>{const t=new Date(i).getDay();return t===0||t===6},isPast:i=>{const t=new Date;return t.setHours(0,0,0,0),new Date(i)<t},formatDisplay:(i,t="short")=>{const s=new Date(i);if(t==="short")return s.toLocaleDateString("en-GB",{day:"numeric"});if(t==="day")return s.toLocaleDateString("en-GB",{weekday:"short"});if(t==="full")return s.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});if(t==="medium")return s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});if(t==="month")return s.toLocaleDateString("en-GB",{month:"long",year:"numeric"});if(t==="week"){const r=n.getWeekEnd(i),a=s.toLocaleDateString("en-GB",{day:"numeric",month:"short"}),l=r.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return`${a} - ${l}`}if(t==="weekRange"){const r=new Date(i),a=new Date(i);return a.setDate(a.getDate()+6),`${r.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${a.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return s.toLocaleDateString("en-GB")}};function de({status:i,period:t,size:s="normal"}){const r=ce[i];if(!r)return null;const a=i===$.OUT_OF_OFFICE?"ooo":i===$.REMOTE?"remote":"onsite",l=t&&t!==R.FULL_DAY;return s==="mini"?e.jsx("span",{className:`cal-mini-badge ${a}`,title:`${r.label}${l?` (${H[t]?.shortLabel})`:""}`}):e.jsxs("span",{className:`cal-status-badge ${a} ${l?"half-day":""}`,children:[r.shortLabel,l&&e.jsxs("span",{className:"cal-period-indicator",children:["(",H[t]?.shortLabel,")"]})]})}function z({type:i,item:t,isOverdue:s,size:r="normal",onClick:a,onMouseEnter:l,onMouseLeave:u}){const c=i===P.MILESTONE?"milestone":"deliverable",d=i===P.MILESTONE?t.milestone_ref:t.deliverable_ref,y=t.name;return r==="mini"?e.jsx("span",{className:`cal-mini-badge ${c} clickable`,title:`${d}: ${y}`,onClick:a,onMouseEnter:l,onMouseLeave:u}):e.jsx("span",{className:`cal-event-badge ${c} ${s?"overdue":""} clickable`,title:y,onClick:a,onMouseEnter:l,onMouseLeave:u,children:e.jsx("span",{className:"cal-event-ref",children:d})})}function Oe({isOpen:i,onClose:t,onSave:s,onClear:r,date:a,resource:l,currentEntry:u,isEditingOther:c}){const[d,y]=f.useState(u?.status||""),[h,E]=f.useState(u?.period||R.FULL_DAY),[x,k]=f.useState(u?.notes||""),[N,g]=f.useState(!1);if(f.useEffect(()=>{y(u?.status||""),E(u?.period||R.FULL_DAY),k(u?.notes||"")},[u,i]),!i)return null;const w=async()=>{if(d){g(!0);try{await s(d,h,x),t()}finally{g(!1)}}},p=async()=>{g(!0);try{await r(),t()}finally{g(!1)}};return e.jsx("div",{className:"cal-modal-overlay",onClick:t,children:e.jsxs("div",{className:"cal-modal",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"cal-modal-header",children:[e.jsx("h3",{children:c?"Edit Availability":"Set Availability"}),e.jsx("button",{className:"cal-modal-close",onClick:t,children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"cal-modal-body",children:[e.jsxs("div",{className:"cal-modal-info",children:[e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Date"}),e.jsx("span",{className:"cal-modal-info-value",children:n.formatDisplay(a,"full")})]}),e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Resource"}),e.jsxs("span",{className:"cal-modal-info-value",children:[l?.name,c&&e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.8em"},children:" (editing as manager)"})]})]})]}),e.jsx("div",{className:"cal-modal-section-title",children:"Status"}),e.jsx("div",{className:"cal-status-options",children:Object.entries($).map(([b,v])=>{const _=ce[v],S=v===$.OUT_OF_OFFICE?"ooo":v===$.REMOTE?"remote":"onsite";return e.jsxs("div",{className:`cal-status-option ${d===v?"selected":""}`,onClick:()=>y(v),children:[e.jsx("span",{className:`cal-status-option-dot ${S}`}),e.jsx("span",{className:"cal-status-option-text",children:_.label})]},v)})}),e.jsx("div",{className:"cal-modal-section-title",children:"Duration"}),e.jsx("div",{className:"cal-period-options",children:Object.entries(R).map(([b,v])=>e.jsx("div",{className:`cal-period-option ${h===v?"selected":""}`,onClick:()=>E(v),children:H[v].label},v))}),e.jsx("div",{className:"cal-modal-section-title",children:"Notes (optional)"}),e.jsx("textarea",{className:"cal-notes-input",placeholder:"Add notes...",value:x,onChange:b=>k(b.target.value)})]}),e.jsxs("div",{className:"cal-modal-footer",children:[u&&e.jsx("button",{className:"cal-btn cal-btn-danger",onClick:p,disabled:N,children:"Clear"}),e.jsx("button",{className:"cal-btn cal-btn-secondary",onClick:t,children:"Cancel"}),e.jsx("button",{className:"cal-btn cal-btn-primary",onClick:w,disabled:!d||N,children:N?"Saving...":"Save"})]})]})})}function Ve(){const i=_e(),{user:t}=we(),{projectId:s,projectRole:r}=De(),{showSuccess:a,showError:l}=xe(),[u,c]=f.useState(O.ALL_EVENTS),[d,y]=f.useState("week"),[h,E]=f.useState(4),[x,k]=f.useState(new Date),[N,g]=f.useState("all"),[w,p]=f.useState([]),[b,v]=f.useState([]),[_,S]=f.useState([]),[M,B]=f.useState([]),[C,I]=f.useState(!0),[F,J]=f.useState(!1),[K,he]=f.useState(null),[L,Q]=f.useState({isOpen:!1,date:null,resource:null,entry:null}),D=re[u],W=r||"viewer",G=f.useMemo(()=>{if(u===O.DELIVERABLES){const o=new Date,m=new Date(o);return m.setDate(m.getDate()+h*7),{start:n.formatDate(o),end:n.formatDate(m)}}if(d==="week")return{start:n.formatDate(n.getWeekStart(x)),end:n.formatDate(n.getWeekEnd(x))};{const o=n.getMonthStart(x),m=n.getMonthEnd(x);return{start:n.formatDate(n.getWeekStart(o)),end:n.formatDate(n.getWeekEnd(m))}}},[u,d,x,h]),V=f.useCallback(async(o=!1)=>{if(s){o&&J(!0);try{const m=await U.getAllEvents(s,G.start,G.end,{showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,userId:N!=="all"?N:null});if(p(m.availability),v(m.milestones),S(m.deliverables),he(new Date),D.showAvailability){const j=await U.getProjectMembers(s);B(j)}o&&a("Calendar refreshed")}catch{l("Failed to load calendar data")}finally{I(!1),J(!1)}}},[s,G,D,N,l,a]);f.useEffect(()=>{V()},[V]);const me=()=>V(!0),Z=o=>{const m=new Date(x);d==="week"?m.setDate(m.getDate()+o*7):m.setMonth(m.getMonth()+o),k(m)},ue=()=>k(new Date),Y=(o,m)=>{const j=n.formatDate(m);return w.find(A=>A.user_id===o&&A.date===j)},ee=o=>{const m=n.formatDate(o);return b.filter(j=>(j.forecast_end_date||j.end_date)===m)},te=o=>{const m=n.formatDate(o);return _.filter(j=>j.due_date===m)},se=(o,m)=>{if(!X(W,t?.id,m.id))return;const j=Y(m.id,o);Q({isOpen:!0,date:o,resource:m,entry:j})},ve=async(o,m,j)=>{const A=L.resource?.id;try{await U.setAvailability(s,A,n.formatDate(L.date),o,m,j);const q=A!==t?.id;a(q?`Availability updated for ${L.resource?.name}`:"Availability updated"),V()}catch(q){throw l("Failed to save availability"),q}},ge=async()=>{const o=L.resource?.id;try{await U.clearAvailability(s,o,n.formatDate(L.date));const m=o!==t?.id;a(m?`Availability cleared for ${L.resource?.name}`:"Availability cleared"),V()}catch(m){throw l("Failed to clear availability"),m}},ae=f.useMemo(()=>N==="all"?M:M.filter(o=>o.id===N),[M,N]),fe=f.useMemo(()=>n.getWeeksAhead(h).map(m=>({...m,items:_.filter(j=>{const A=new Date(j.due_date);return A>=m.start&&A<=m.end})})),[_,h]),pe=f.useMemo(()=>n.getWeeksAhead(h).map(m=>({...m,items:b.filter(j=>{const A=new Date(j.forecast_end_date||j.end_date);return A>=m.start&&A<=m.end})})),[b,h]),be=L.resource?.id!==t?.id;if(C)return e.jsx(Ne,{message:"Loading calendar...",size:"large",fullPage:!0});const le=u!==O.DELIVERABLES,ye=u===O.DELIVERABLES,je=()=>W==="viewer"?"View only - contact a manager to update availability":W==="admin"||W==="supplier_pm"?"Click any row to edit availability":"Click your row to set availability";return e.jsxs("div",{className:"calendar-page",children:[e.jsx("header",{className:"cal-header",children:e.jsxs("div",{className:"cal-header-content",children:[e.jsxs("div",{className:"cal-header-left",children:[e.jsx("div",{className:"cal-header-icon",children:e.jsx(ke,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Project Calendar"}),e.jsx("p",{children:"Team availability, milestones, and deliverables"})]})]}),e.jsxs("div",{className:"cal-header-actions",children:[e.jsxs("button",{className:"cal-btn cal-btn-secondary",onClick:me,disabled:F,children:[e.jsx(Ae,{size:18,className:F?"spinning":""}),F?"Refreshing...":"Refresh"]}),K&&e.jsxs("span",{className:"cal-last-refresh",children:["Updated ",K.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsx("div",{className:"cal-controls",children:e.jsxs("div",{className:"cal-controls-inner",children:[e.jsx("div",{className:"cal-controls-left",children:e.jsx("div",{className:"cal-view-tabs",children:Object.entries(O).map(([o,m])=>{const j=re[m],A=j.icon;return e.jsxs("button",{className:`cal-view-tab ${u===m?"active":""}`,onClick:()=>c(m),children:[e.jsx(A,{size:16,className:"cal-view-tab-icon"}),e.jsx("span",{children:j.label})]},m)})})}),e.jsx("div",{className:"cal-controls-center",children:ye?e.jsx("div",{className:"cal-range-select",children:[1,2,3,4].map(o=>e.jsxs("button",{className:`cal-range-btn ${h===o?"active":""}`,onClick:()=>E(o),children:[o,"W"]},o))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-nav",children:[e.jsx("button",{className:"cal-nav-btn",onClick:()=>Z(-1),children:e.jsx(Me,{size:20})}),e.jsx("span",{className:"cal-period",children:d==="week"?n.formatDisplay(x,"week"):n.formatDisplay(x,"month")}),e.jsx("button",{className:"cal-nav-btn",onClick:()=>Z(1),children:e.jsx(Le,{size:20})})]}),e.jsx("button",{className:"cal-today-btn",onClick:ue,children:"Today"})]})}),e.jsxs("div",{className:"cal-controls-right",children:[le&&e.jsxs("div",{className:"cal-period-toggle",children:[e.jsx("button",{className:`cal-period-btn ${d==="week"?"active":""}`,onClick:()=>y("week"),children:"Week"}),e.jsx("button",{className:`cal-period-btn ${d==="month"?"active":""}`,onClick:()=>y("month"),children:"Month"})]}),D.showAvailability&&e.jsxs("select",{className:"cal-filter-select",value:N,onChange:o=>g(o.target.value),children:[e.jsxs("option",{value:"all",children:["All Resources (",M.length,")"]}),M.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})]})}),e.jsxs("div",{className:"cal-content",children:[e.jsxs("div",{className:"cal-legend",children:[D.showAvailability&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot ooo"}),e.jsx("span",{children:"Out of Office"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot remote"}),e.jsx("span",{children:"Remote"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot onsite"}),e.jsx("span",{children:"On Site"})]})]}),D.showMilestones&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot milestone"}),e.jsx("span",{children:"Milestone"})]}),D.showDeliverables&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot deliverable"}),e.jsx("span",{children:"Deliverable"})]}),D.showAvailability&&e.jsxs("div",{className:"cal-legend-hint",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:je()})]})]}),le?e.jsx("div",{className:"cal-calendar-card",children:d==="week"?e.jsx(Ie,{currentDate:x,members:D.showAvailability?ae:[],currentUserId:t?.id,userRole:W,showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,onCellClick:se,onMilestoneClick:o=>i(`/milestones/${o.id}`),onDeliverableClick:o=>i(`/milestones/${o.milestone_id}`),getAvailabilityEntry:Y,getMilestonesForDate:ee,getDeliverablesForDate:te}):e.jsx($e,{currentDate:x,members:D.showAvailability?ae:[],currentUserId:t?.id,userRole:W,showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,onCellClick:se,onMilestoneClick:o=>i(`/milestones/${o.id}`),onDeliverableClick:o=>i(`/milestones/${o.milestone_id}`),onDateClick:o=>{k(o),y("week")},getAvailabilityEntry:Y,getMilestonesForDate:ee,getDeliverablesForDate:te})}):e.jsx(Re,{deliverablesByWeek:fe,milestonesByWeek:D.showMilestones?pe:[],onDeliverableClick:()=>i("/deliverables"),onMilestoneClick:o=>i(`/milestones/${o.id}`)})]}),e.jsx(Oe,{isOpen:L.isOpen,onClose:()=>Q({isOpen:!1,date:null,resource:null,entry:null}),onSave:ve,onClear:ge,date:L.date,resource:L.resource,currentEntry:L.entry,isEditingOther:be})]})}function Ie({currentDate:i,members:t,currentUserId:s,userRole:r,showAvailability:a,showMilestones:l,showDeliverables:u,onCellClick:c,onMilestoneClick:d,onDeliverableClick:y,getAvailabilityEntry:h,getMilestonesForDate:E,getDeliverablesForDate:x}){const k=n.getWeekDates(i),N=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!a||t.length===0?e.jsxs("div",{className:"cal-week-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-week-header",children:k.map((g,w)=>e.jsxs("div",{className:`cal-week-header-cell ${n.isToday(g)?"today":""}`,children:[N[w],e.jsx("span",{className:"cal-week-header-date",children:n.formatDisplay(g,"short")})]},w))}),e.jsx("div",{className:"cal-week-row",children:k.map((g,w)=>{const p=E(g),b=x(g);return e.jsxs("div",{className:`cal-day-cell not-editable ${n.isWeekend(g)?"weekend":""} ${n.isToday(g)?"today":""}`,style:{minHeight:"120px"},children:[l&&p.map(v=>e.jsx(z,{type:P.MILESTONE,item:v,isOverdue:n.isPast(v.forecast_end_date||v.end_date),onClick:_=>{_.stopPropagation(),d&&d(v)}},v.id)),u&&b.map(v=>e.jsx(z,{type:P.DELIVERABLE,item:v,isOverdue:n.isPast(v.due_date)&&v.status!=="Delivered",onClick:_=>{_.stopPropagation(),y&&y(v)}},v.id))]},w)})})]}):e.jsxs("div",{className:"cal-week-grid",children:[e.jsxs("div",{className:"cal-week-header",children:[e.jsx("div",{className:"cal-week-header-cell",children:"Resource"}),k.map((g,w)=>e.jsxs("div",{className:`cal-week-header-cell ${n.isToday(g)?"today":""}`,children:[N[w],e.jsx("span",{className:"cal-week-header-date",children:n.formatDisplay(g,"short")})]},w))]}),t.map(g=>{const w=X(r,s,g.id);return e.jsxs("div",{className:"cal-week-row",children:[e.jsxs("div",{className:"cal-resource-cell",children:[e.jsx("div",{className:"cal-resource-name",children:g.name}),e.jsx("div",{className:"cal-resource-role",children:g.role})]}),k.map((p,b)=>{const v=h(g.id,p);return e.jsx("div",{className:`cal-day-cell ${n.isWeekend(p)?"weekend":""} ${n.isToday(p)?"today":""} ${w?"":"not-editable"}`,onClick:()=>w&&c(p,g),style:{cursor:w?"pointer":"default"},title:w?"Click to edit availability":`${g.name}'s availability`,children:v&&e.jsx(de,{status:v.status,period:v.period})},b)})]},g.id)})]})}function $e({currentDate:i,members:t,currentUserId:s,userRole:r,showAvailability:a,showMilestones:l,showDeliverables:u,onCellClick:c,onMilestoneClick:d,onDeliverableClick:y,onDateClick:h,getAvailabilityEntry:E,getMilestonesForDate:x,getDeliverablesForDate:k}){const N=n.getMonthWeeks(i),g=i.getMonth(),w=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!a||t.length===0?e.jsxs("div",{className:"cal-month-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-month-header",children:w.map((p,b)=>e.jsx("div",{className:"cal-month-header-cell",children:p},b))}),N.map((p,b)=>e.jsx("div",{className:"cal-month-row",children:p.map((v,_)=>{const S=v.getMonth()!==g,M=x(v),B=k(v),C=M.length>0||B.length>0;return e.jsxs("div",{className:`cal-month-cell ${C?"has-items":""} ${n.isWeekend(v)?"weekend":""} ${n.isToday(v)?"today":""} ${S?"outside-month":""}`,style:{minHeight:"80px",cursor:C&&!S?"pointer":"default"},onClick:()=>C&&!S&&h&&h(v),title:C?"Click to see week view":"",children:[e.jsx("span",{className:"cal-month-date",children:n.formatDisplay(v,"short")}),l&&M.map(I=>e.jsx(z,{type:P.MILESTONE,item:I,size:"mini",onClick:F=>{F.stopPropagation(),d&&d(I)}},I.id)),u&&B.map(I=>e.jsx(z,{type:P.DELIVERABLE,item:I,size:"mini",onClick:F=>{F.stopPropagation(),y&&y(I)}},I.id))]},_)})},b))]}):e.jsxs("div",{className:"cal-month-grid",children:[e.jsxs("div",{className:"cal-month-header",children:[e.jsx("div",{className:"cal-month-header-cell",children:"Resource"}),w.map((p,b)=>e.jsx("div",{className:"cal-month-header-cell",children:p},b))]}),t.map(p=>{const b=X(r,s,p.id);return N.map((v,_)=>e.jsxs("div",{className:"cal-month-row",children:[e.jsx("div",{className:"cal-resource-cell",children:_===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cal-resource-name",children:p.name}),e.jsx("div",{className:"cal-resource-role",children:p.role})]})}),v.map((S,M)=>{const B=E(p.id,S),C=S.getMonth()!==g;return e.jsxs("div",{className:`cal-month-cell ${n.isWeekend(S)?"weekend":""} ${n.isToday(S)?"today":""} ${C?"outside-month":""} ${b?"":"not-editable"}`,onClick:()=>!C&&b&&c(S,p),style:{cursor:b&&!C?"pointer":"default"},children:[(_===0||M===0)&&e.jsx("span",{className:"cal-month-date",children:n.formatDisplay(S,"short")}),B&&e.jsx(de,{status:B.status,period:B.period,size:"mini"})]},M)})]},`${p.id}-${_}`))})]})}function Re({deliverablesByWeek:i,milestonesByWeek:t,onDeliverableClick:s,onMilestoneClick:r}){const a=c=>({"Not Started":"not-started",Draft:"not-started","In Progress":"in-progress",Submitted:"submitted","Review Complete":"submitted",Delivered:"delivered",Completed:"delivered"})[c]||"not-started",l=i.map((c,d)=>({...c,milestones:t[d]?.items||[],deliverables:c.items||[]}));return l.some(c=>c.milestones.length>0||c.deliverables.length>0)?e.jsx("div",{className:"cal-deliverables-list",children:l.map((c,d)=>{const y=c.milestones.length+c.deliverables.length;return e.jsxs("div",{className:"cal-deliverables-week",children:[e.jsxs("div",{className:"cal-week-label",children:[e.jsx("span",{children:c.label}),e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:n.formatDisplay(c.start,"weekRange")}),y>0&&e.jsx("span",{className:"cal-week-count",children:y})]}),y===0?e.jsx("div",{className:"cal-empty-week",children:"No items due this week"}):e.jsxs(e.Fragment,{children:[c.milestones.map(h=>e.jsxs("div",{className:"cal-milestone-item",onClick:()=>r(h),children:[e.jsx("div",{className:`cal-deliverable-date ${n.isPast(h.forecast_end_date||h.end_date)&&h.status!=="Completed"?"overdue":""}`,children:n.formatDisplay(h.forecast_end_date||h.end_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-milestone-ref",children:h.milestone_ref}),e.jsx("span",{className:"cal-milestone-name",children:h.name})]}),e.jsxs("div",{className:"cal-milestone-progress",children:[e.jsx("div",{className:"cal-progress-bar",children:e.jsx("div",{className:"cal-progress-fill",style:{width:`${h.completion_percentage||0}%`}})}),e.jsxs("span",{className:"cal-progress-text",children:[h.completion_percentage||0,"%"]})]}),e.jsx("div",{className:`cal-deliverable-status ${a(h.status)}`,children:h.status})]},h.id)),c.deliverables.map(h=>e.jsxs("div",{className:"cal-deliverable-item",onClick:()=>s(h),children:[e.jsx("div",{className:`cal-deliverable-date ${n.isPast(h.due_date)&&h.status!=="Delivered"?"overdue":""}`,children:n.formatDisplay(h.due_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-deliverable-ref",children:h.deliverable_ref}),e.jsx("span",{className:"cal-deliverable-name",children:h.name})]}),e.jsxs("div",{className:"cal-deliverable-milestone",children:[e.jsx(ne,{size:12}),h.milestones?.milestone_ref||"â€”"]}),e.jsx("div",{className:`cal-deliverable-status ${a(h.status)}`,children:h.status})]},h.id))]})]},d)})}):e.jsx("div",{className:"cal-deliverables-list",children:e.jsxs("div",{className:"cal-empty",children:[e.jsx(ie,{size:48,className:"cal-empty-icon"}),e.jsx("p",{children:"No milestones or deliverables due in this period"})]})})}export{Ve as default};
