import{s as L,u as we,a as De,c as xe,j as e,L as Ne}from"./index-CADyJjeh.js";import{d as _e,r as b}from"./vendor-react-BUTV5ZEl.js";import{z as Ee,P as se,m as le,q as re,aM as Se,h as Ae,R as ke,aj as Me,w as Le,c as Ce}from"./vendor-icons-CtZxSxcO.js";import"./vendor-supabase-6faYzd5A.js";const T={OUT_OF_OFFICE:"out_of_office",REMOTE:"remote",ON_SITE:"on_site"},O={FULL_DAY:"full_day",AM:"am",PM:"pm"},ie={[T.OUT_OF_OFFICE]:{label:"Out of Office",shortLabel:"OOO",color:"#EF4444",bgColor:"#FEE2E2",icon:"ðŸ”´"},[T.REMOTE]:{label:"Remote",shortLabel:"Remote",color:"#F59E0B",bgColor:"#FEF3C7",icon:"ðŸŸ¡"},[T.ON_SITE]:{label:"On Site",shortLabel:"On-Site",color:"#10B981",bgColor:"#D1FAE5",icon:"ðŸŸ¢"}},G={[O.FULL_DAY]:{label:"Full Day",shortLabel:"Full"},[O.AM]:{label:"Morning (AM)",shortLabel:"AM"},[O.PM]:{label:"Afternoon (PM)",shortLabel:"PM"}},R={MILESTONE:"milestone",DELIVERABLE:"deliverable"};class Te{async getAvailabilityByDateRange(t,a,r,s=null){try{let l=L.from("resource_availability").select(`
          id,
          project_id,
          user_id,
          date,
          status,
          period,
          notes,
          created_at,
          updated_at
        `).eq("project_id",t).gte("date",a).lte("date",r).order("date",{ascending:!0});s&&(l=l.eq("user_id",s));const{data:u,error:o}=await l;if(o)throw o;return u||[]}catch(l){throw l}}async setAvailability(t,a,r,s,l=O.FULL_DAY,u=null){try{if(!Object.values(T).includes(s))throw new Error(`Invalid status: ${s}`);if(!Object.values(O).includes(l))throw new Error(`Invalid period: ${l}`);const{data:o,error:d}=await L.from("resource_availability").upsert({project_id:t,user_id:a,date:r,status:s,period:l,notes:u,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id,date",ignoreDuplicates:!1}).select();if(d)throw d;return o?.[0]||null}catch(o){throw o}}async clearAvailability(t,a,r){try{const{error:s}=await L.from("resource_availability").delete().eq("project_id",t).eq("user_id",a).eq("date",r);if(s)throw s;return!0}catch(s){throw s}}async getProjectMembers(t){try{const{data:a,error:r}=await L.from("user_projects").select("user_id, role").eq("project_id",t).order("role");if(r)throw r;if(!a||a.length===0)return[];const s=a.map(d=>d.user_id),{data:l,error:u}=await L.from("profiles").select("id, full_name, email").in("id",s),o={};return(l||[]).forEach(d=>{o[d.id]=d}),a.map(d=>({id:d.user_id,name:o[d.user_id]?.full_name||o[d.user_id]?.email||"Unknown",email:o[d.user_id]?.email,role:d.role}))}catch(a){throw a}}async getMilestonesByDateRange(t,a,r){try{const{data:s,error:l}=await L.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(l)throw l;return(s||[]).filter(o=>o.is_deleted!==!0).filter(o=>{const d=o.forecast_end_date||o.end_date;return d?d>=a&&d<=r:!1})}catch(s){throw s}}async getAllMilestones(t){try{const{data:a,error:r}=await L.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(r)throw r;return(a||[]).filter(s=>s.is_deleted!==!0)}catch(a){throw a}}async getDeliverablesByDateRange(t,a,r){try{const{data:s,error:l}=await L.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).gte("due_date",a).lte("due_date",r).order("due_date",{ascending:!0});if(l)throw l;return(s||[]).filter(u=>u.is_deleted!==!0)}catch(s){throw s}}async getAllDeliverables(t){try{const{data:a,error:r}=await L.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).order("due_date",{ascending:!0});if(r)throw r;return(a||[]).filter(s=>s.is_deleted!==!0)}catch(a){throw a}}async getAllEvents(t,a,r,s={}){try{const l={availability:[],milestones:[],deliverables:[]},{showAvailability:u=!0,showMilestones:o=!0,showDeliverables:d=!0,userId:D}=s,h=[];return u&&h.push(this.getAvailabilityByDateRange(t,a,r,D).then(x=>{l.availability=x})),o&&h.push(this.getMilestonesByDateRange(t,a,r).then(x=>{l.milestones=x})),d&&h.push(this.getDeliverablesByDateRange(t,a,r).then(x=>{l.deliverables=x})),await Promise.all(h),l}catch(l){throw l}}async getUpcomingDeliverables(t,a=4){try{const r=new Date,s=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+a*7);const u=l.toISOString().split("T")[0];return this.getDeliverablesByDateRange(t,s,u)}catch(r){throw r}}async getUpcomingMilestones(t,a=4){try{const r=new Date,s=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+a*7);const u=l.toISOString().split("T")[0];return this.getMilestonesByDateRange(t,s,u)}catch(r){throw r}}async getProjectDateRange(t){try{const{data:a}=await L.from("projects").select("start_date, end_date").eq("id",t).limit(1);if(a?.[0])return{start:a[0].start_date,end:a[0].end_date};const r=await this.getAllMilestones(t);if(r.length===0){const l=new Date().toISOString().split("T")[0];return{start:l,end:l}}const s=r.flatMap(l=>[l.start_date,l.end_date,l.forecast_end_date]).filter(Boolean).sort();return{start:s[0],end:s[s.length-1]}}catch(a){throw a}}}const F=new Te;function Y(n,t,a){return n==="viewer"?!1:n==="admin"||n==="supplier_pm"?!0:t===a}const C={ALL_EVENTS:"all",AVAILABILITY:"availability",MILESTONES:"milestones",DELIVERABLES:"deliverables",MILESTONES_DELIVERABLES:"milestones_deliverables"},ae={[C.ALL_EVENTS]:{label:"All Events",icon:Se,showAvailability:!0,showMilestones:!0,showDeliverables:!0},[C.AVAILABILITY]:{label:"Team Availability",icon:re,showAvailability:!0,showMilestones:!1,showDeliverables:!1},[C.MILESTONES]:{label:"Milestones",icon:le,showAvailability:!1,showMilestones:!0,showDeliverables:!1},[C.DELIVERABLES]:{label:"Deliverables",icon:se,showAvailability:!1,showMilestones:!1,showDeliverables:!0},[C.MILESTONES_DELIVERABLES]:{label:"Milestones & Deliverables",icon:Ee,showAvailability:!1,showMilestones:!0,showDeliverables:!0}},i={formatDate:n=>new Date(n).toISOString().split("T")[0],getWeekStart:n=>{const t=new Date(n),a=t.getDay(),r=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(r))},getWeekEnd:n=>{const t=i.getWeekStart(n),a=new Date(t);return a.setDate(a.getDate()+6),a},getMonthStart:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth(),1)},getMonthEnd:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth()+1,0)},getWeekDates:n=>{const t=i.getWeekStart(n),a=[];for(let r=0;r<7;r++){const s=new Date(t);s.setDate(s.getDate()+r),a.push(s)}return a},getMonthWeeks:n=>{const t=i.getMonthStart(n),a=i.getMonthEnd(n),r=i.getWeekStart(t),s=[];let l=new Date(r);for(;l<=a||s.length<5;){const u=[];for(let o=0;o<7;o++)u.push(new Date(l)),l.setDate(l.getDate()+1);if(s.push(u),s.length>=6)break}return s},getWeeksAhead:n=>{const t=[],a=new Date;let r=i.getWeekStart(a);for(let s=0;s<n;s++){const l=new Date(r);l.setDate(l.getDate()+6),t.push({start:new Date(r),end:l,label:s===0?"This Week":`Week ${s+1}`}),r=new Date(r),r.setDate(r.getDate()+7)}return t},isToday:n=>{const t=new Date;return i.formatDate(n)===i.formatDate(t)},isWeekend:n=>{const t=new Date(n).getDay();return t===0||t===6},isPast:n=>{const t=new Date;return t.setHours(0,0,0,0),new Date(n)<t},formatDisplay:(n,t="short")=>{const a=new Date(n);if(t==="short")return a.toLocaleDateString("en-GB",{day:"numeric"});if(t==="day")return a.toLocaleDateString("en-GB",{weekday:"short"});if(t==="full")return a.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});if(t==="medium")return a.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});if(t==="month")return a.toLocaleDateString("en-GB",{month:"long",year:"numeric"});if(t==="week"){const r=i.getWeekEnd(n),s=a.toLocaleDateString("en-GB",{day:"numeric",month:"short"}),l=r.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return`${s} - ${l}`}if(t==="weekRange"){const r=new Date(n),s=new Date(n);return s.setDate(s.getDate()+6),`${r.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${s.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return a.toLocaleDateString("en-GB")}};function ne({status:n,period:t,size:a="normal"}){const r=ie[n];if(!r)return null;const s=n===T.OUT_OF_OFFICE?"ooo":n===T.REMOTE?"remote":"onsite",l=t&&t!==O.FULL_DAY;return a==="mini"?e.jsx("span",{className:`cal-mini-badge ${s}`,title:`${r.label}${l?` (${G[t]?.shortLabel})`:""}`}):e.jsxs("span",{className:`cal-status-badge ${s} ${l?"half-day":""}`,children:[r.shortLabel,l&&e.jsxs("span",{className:"cal-period-indicator",children:["(",G[t]?.shortLabel,")"]})]})}function W({type:n,item:t,isOverdue:a,size:r="normal",onClick:s,onMouseEnter:l,onMouseLeave:u}){const o=n===R.MILESTONE?"milestone":"deliverable",d=n===R.MILESTONE?t.milestone_ref:t.deliverable_ref,D=t.name;return r==="mini"?e.jsx("span",{className:`cal-mini-badge ${o} clickable`,title:`${d}: ${D}`,onClick:s,onMouseEnter:l,onMouseLeave:u}):e.jsx("span",{className:`cal-event-badge ${o} ${a?"overdue":""} clickable`,title:D,onClick:s,onMouseEnter:l,onMouseLeave:u,children:e.jsx("span",{className:"cal-event-ref",children:d})})}function Oe({isOpen:n,onClose:t,onSave:a,onClear:r,date:s,resource:l,currentEntry:u,isEditingOther:o}){const[d,D]=b.useState(u?.status||""),[h,x]=b.useState(u?.period||O.FULL_DAY),[j,f]=b.useState(u?.notes||""),[v,y]=b.useState(!1);if(b.useEffect(()=>{D(u?.status||""),x(u?.period||O.FULL_DAY),f(u?.notes||"")},[u,n]),!n)return null;const E=async()=>{if(d){y(!0);try{await a(d,h,j),t()}finally{y(!1)}}},g=async()=>{y(!0);try{await r(),t()}finally{y(!1)}};return e.jsx("div",{className:"cal-modal-overlay",onClick:t,children:e.jsxs("div",{className:"cal-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"cal-modal-header",children:[e.jsx("h3",{children:o?"Edit Availability":"Set Availability"}),e.jsx("button",{className:"cal-modal-close",onClick:t,children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"cal-modal-body",children:[e.jsxs("div",{className:"cal-modal-info",children:[e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Date"}),e.jsx("span",{className:"cal-modal-info-value",children:i.formatDisplay(s,"full")})]}),e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Resource"}),e.jsxs("span",{className:"cal-modal-info-value",children:[l?.name,o&&e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.8em"},children:" (editing as manager)"})]})]})]}),e.jsx("div",{className:"cal-modal-section-title",children:"Status"}),e.jsx("div",{className:"cal-status-options",children:Object.entries(T).map(([N,_])=>{const k=ie[_],S=_===T.OUT_OF_OFFICE?"ooo":_===T.REMOTE?"remote":"onsite";return e.jsxs("div",{className:`cal-status-option ${d===_?"selected":""}`,onClick:()=>D(_),children:[e.jsx("span",{className:`cal-status-option-dot ${S}`}),e.jsx("span",{className:"cal-status-option-text",children:k.label})]},_)})}),e.jsx("div",{className:"cal-modal-section-title",children:"Duration"}),e.jsx("div",{className:"cal-period-options",children:Object.entries(O).map(([N,_])=>e.jsx("div",{className:`cal-period-option ${h===_?"selected":""}`,onClick:()=>x(_),children:G[_].label},_))}),e.jsx("div",{className:"cal-modal-section-title",children:"Notes (optional)"}),e.jsx("textarea",{className:"cal-notes-input",placeholder:"Add notes...",value:j,onChange:N=>f(N.target.value)})]}),e.jsxs("div",{className:"cal-modal-footer",children:[u&&e.jsx("button",{className:"cal-btn cal-btn-danger",onClick:g,disabled:v,children:"Clear"}),e.jsx("button",{className:"cal-btn cal-btn-secondary",onClick:t,children:"Cancel"}),e.jsx("button",{className:"cal-btn cal-btn-primary",onClick:E,disabled:!d||v,children:v?"Saving...":"Save"})]})]})})}function Ve(){const n=_e(),{user:t}=we(),{projectId:a,projectRole:r}=De(),{showSuccess:s,showError:l}=xe(),[u,o]=b.useState(C.ALL_EVENTS),[d,D]=b.useState("week"),[h,x]=b.useState(4),[j,f]=b.useState(new Date),[v,y]=b.useState("all"),[E,g]=b.useState([]),[N,_]=b.useState([]),[k,S]=b.useState([]),[$,oe]=b.useState([]),[ce,de]=b.useState(!0),[P,q]=b.useState(!1),[H,he]=b.useState(null),[M,X]=b.useState({isOpen:!1,date:null,resource:null,entry:null}),w=ae[u],I=r||"viewer",V=b.useMemo(()=>{if(u===C.DELIVERABLES){const m=new Date,c=new Date(m);return c.setDate(c.getDate()+h*7),{start:i.formatDate(m),end:i.formatDate(c)}}if(d==="week")return{start:i.formatDate(i.getWeekStart(j)),end:i.formatDate(i.getWeekEnd(j))};{const m=i.getMonthStart(j),c=i.getMonthEnd(j);return{start:i.formatDate(i.getWeekStart(m)),end:i.formatDate(i.getWeekEnd(c))}}},[u,d,j,h]),B=b.useCallback(async(m=!1)=>{if(a){m&&q(!0);try{const c=await F.getAllEvents(a,V.start,V.end,{showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,userId:v!=="all"?v:null});if(g(c.availability),_(c.milestones),S(c.deliverables),he(new Date),w.showAvailability){const p=await F.getProjectMembers(a);oe(p)}m&&s("Calendar refreshed")}catch{l("Failed to load calendar data")}finally{de(!1),q(!1)}}},[a,V,w,v,l,s]);b.useEffect(()=>{B()},[B]);const me=()=>B(!0),J=m=>{const c=new Date(j);d==="week"?c.setDate(c.getDate()+m*7):c.setMonth(c.getMonth()+m),f(c)},ue=()=>f(new Date),U=(m,c)=>{const p=i.formatDate(c);return E.find(A=>A.user_id===m&&A.date===p)},K=m=>{const c=i.formatDate(m);return N.filter(p=>(p.forecast_end_date||p.end_date)===c)},Q=m=>{const c=i.formatDate(m);return k.filter(p=>p.due_date===c)},Z=(m,c)=>{if(!Y(I,t?.id,c.id))return;const p=U(c.id,m);X({isOpen:!0,date:m,resource:c,entry:p})},ve=async(m,c,p)=>{const A=M.resource?.id;try{await F.setAvailability(a,A,i.formatDate(M.date),m,c,p);const z=A!==t?.id;s(z?`Availability updated for ${M.resource?.name}`:"Availability updated"),B()}catch(z){throw l("Failed to save availability"),z}},fe=async()=>{const m=M.resource?.id;try{await F.clearAvailability(a,m,i.formatDate(M.date));const c=m!==t?.id;s(c?`Availability cleared for ${M.resource?.name}`:"Availability cleared"),B()}catch(c){throw l("Failed to clear availability"),c}},ee=b.useMemo(()=>v==="all"?$:$.filter(m=>m.id===v),[$,v]),ge=b.useMemo(()=>i.getWeeksAhead(h).map(c=>({...c,items:k.filter(p=>{const A=new Date(p.due_date);return A>=c.start&&A<=c.end})})),[k,h]),be=b.useMemo(()=>i.getWeeksAhead(h).map(c=>({...c,items:N.filter(p=>{const A=new Date(p.forecast_end_date||p.end_date);return A>=c.start&&A<=c.end})})),[N,h]),ye=M.resource?.id!==t?.id;if(ce)return e.jsx(Ne,{message:"Loading calendar...",size:"large",fullPage:!0});const te=u!==C.DELIVERABLES,pe=u===C.DELIVERABLES,je=()=>I==="viewer"?"View only - contact a manager to update availability":I==="admin"||I==="supplier_pm"?"Click any row to edit availability":"Click your row to set availability";return e.jsxs("div",{className:"calendar-page",children:[e.jsx("header",{className:"cal-header",children:e.jsxs("div",{className:"cal-header-content",children:[e.jsxs("div",{className:"cal-header-left",children:[e.jsx("div",{className:"cal-header-icon",children:e.jsx(Ae,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Project Calendar"}),e.jsx("p",{children:"Team availability, milestones, and deliverables"})]})]}),e.jsxs("div",{className:"cal-header-actions",children:[e.jsxs("button",{className:"cal-btn cal-btn-secondary",onClick:me,disabled:P,children:[e.jsx(ke,{size:18,className:P?"spinning":""}),P?"Refreshing...":"Refresh"]}),H&&e.jsxs("span",{className:"cal-last-refresh",children:["Updated ",H.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsx("div",{className:"cal-controls",children:e.jsxs("div",{className:"cal-controls-inner",children:[e.jsx("div",{className:"cal-controls-left",children:e.jsx("div",{className:"cal-view-tabs",children:Object.entries(C).map(([m,c])=>{const p=ae[c],A=p.icon;return e.jsxs("button",{className:`cal-view-tab ${u===c?"active":""}`,onClick:()=>o(c),children:[e.jsx(A,{size:16,className:"cal-view-tab-icon"}),e.jsx("span",{children:p.label})]},c)})})}),e.jsx("div",{className:"cal-controls-center",children:pe?e.jsx("div",{className:"cal-range-select",children:[1,2,3,4].map(m=>e.jsxs("button",{className:`cal-range-btn ${h===m?"active":""}`,onClick:()=>x(m),children:[m,"W"]},m))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-nav",children:[e.jsx("button",{className:"cal-nav-btn",onClick:()=>J(-1),children:e.jsx(Me,{size:20})}),e.jsx("span",{className:"cal-period",children:d==="week"?i.formatDisplay(j,"week"):i.formatDisplay(j,"month")}),e.jsx("button",{className:"cal-nav-btn",onClick:()=>J(1),children:e.jsx(Le,{size:20})})]}),e.jsx("button",{className:"cal-today-btn",onClick:ue,children:"Today"})]})}),e.jsxs("div",{className:"cal-controls-right",children:[te&&e.jsxs("div",{className:"cal-period-toggle",children:[e.jsx("button",{className:`cal-period-btn ${d==="week"?"active":""}`,onClick:()=>D("week"),children:"Week"}),e.jsx("button",{className:`cal-period-btn ${d==="month"?"active":""}`,onClick:()=>D("month"),children:"Month"})]}),w.showAvailability&&e.jsxs("select",{className:"cal-filter-select",value:v,onChange:m=>y(m.target.value),children:[e.jsxs("option",{value:"all",children:["All Resources (",$.length,")"]}),$.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]})]})}),e.jsxs("div",{className:"cal-content",children:[e.jsxs("div",{className:"cal-legend",children:[w.showAvailability&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot ooo"}),e.jsx("span",{children:"Out of Office"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot remote"}),e.jsx("span",{children:"Remote"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot onsite"}),e.jsx("span",{children:"On Site"})]})]}),w.showMilestones&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot milestone"}),e.jsx("span",{children:"Milestone"})]}),w.showDeliverables&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot deliverable"}),e.jsx("span",{children:"Deliverable"})]}),w.showAvailability&&e.jsxs("div",{className:"cal-legend-hint",children:[e.jsx(re,{size:16}),e.jsx("span",{children:je()})]})]}),te?e.jsx("div",{className:"cal-calendar-card",children:d==="week"?e.jsx(Ie,{currentDate:j,members:w.showAvailability?ee:[],currentUserId:t?.id,userRole:I,showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,onCellClick:Z,getAvailabilityEntry:U,getMilestonesForDate:K,getDeliverablesForDate:Q}):e.jsx(Re,{currentDate:j,members:w.showAvailability?ee:[],currentUserId:t?.id,userRole:I,showAvailability:w.showAvailability,showMilestones:w.showMilestones,showDeliverables:w.showDeliverables,onCellClick:Z,getAvailabilityEntry:U,getMilestonesForDate:K,getDeliverablesForDate:Q})}):e.jsx($e,{deliverablesByWeek:ge,milestonesByWeek:w.showMilestones?be:[],onDeliverableClick:()=>n("/deliverables"),onMilestoneClick:m=>n(`/milestones/${m.id}`)})]}),e.jsx(Oe,{isOpen:M.isOpen,onClose:()=>X({isOpen:!1,date:null,resource:null,entry:null}),onSave:ve,onClear:fe,date:M.date,resource:M.resource,currentEntry:M.entry,isEditingOther:ye})]})}function Ie({currentDate:n,members:t,currentUserId:a,userRole:r,showAvailability:s,showMilestones:l,showDeliverables:u,onCellClick:o,getAvailabilityEntry:d,getMilestonesForDate:D,getDeliverablesForDate:h}){const x=i.getWeekDates(n),j=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!s||t.length===0?e.jsxs("div",{className:"cal-week-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-week-header",children:x.map((f,v)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(f)?"today":""}`,children:[j[v],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(f,"short")})]},v))}),e.jsx("div",{className:"cal-week-row",children:x.map((f,v)=>{const y=D(f),E=h(f);return e.jsxs("div",{className:`cal-day-cell not-editable ${i.isWeekend(f)?"weekend":""} ${i.isToday(f)?"today":""}`,style:{minHeight:"120px"},children:[l&&y.map(g=>e.jsx(W,{type:R.MILESTONE,reference:g.milestone_ref,name:g.name,isOverdue:i.isPast(g.forecast_end_date||g.end_date)},g.id)),u&&E.map(g=>e.jsx(W,{type:R.DELIVERABLE,reference:g.deliverable_ref,name:g.name,isOverdue:i.isPast(g.due_date)&&g.status!=="Delivered"},g.id))]},v)})})]}):e.jsxs("div",{className:"cal-week-grid",children:[e.jsxs("div",{className:"cal-week-header",children:[e.jsx("div",{className:"cal-week-header-cell",children:"Resource"}),x.map((f,v)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(f)?"today":""}`,children:[j[v],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(f,"short")})]},v))]}),t.map(f=>{const v=Y(r,a,f.id);return e.jsxs("div",{className:"cal-week-row",children:[e.jsxs("div",{className:"cal-resource-cell",children:[e.jsx("div",{className:"cal-resource-name",children:f.name}),e.jsx("div",{className:"cal-resource-role",children:f.role})]}),x.map((y,E)=>{const g=d(f.id,y);return e.jsx("div",{className:`cal-day-cell ${i.isWeekend(y)?"weekend":""} ${i.isToday(y)?"today":""} ${v?"":"not-editable"}`,onClick:()=>v&&o(y,f),style:{cursor:v?"pointer":"default"},title:v?"Click to edit availability":`${f.name}'s availability`,children:g&&e.jsx(ne,{status:g.status,period:g.period})},E)})]},f.id)})]})}function Re({currentDate:n,members:t,currentUserId:a,userRole:r,showAvailability:s,showMilestones:l,showDeliverables:u,onCellClick:o,getAvailabilityEntry:d,getMilestonesForDate:D,getDeliverablesForDate:h}){const x=i.getMonthWeeks(n),j=n.getMonth(),f=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!s||t.length===0?e.jsxs("div",{className:"cal-month-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-month-header",children:f.map((v,y)=>e.jsx("div",{className:"cal-month-header-cell",children:v},y))}),x.map((v,y)=>e.jsx("div",{className:"cal-month-row",children:v.map((E,g)=>{const N=E.getMonth()!==j,_=D(E),k=h(E);return e.jsxs("div",{className:`cal-month-cell not-editable ${i.isWeekend(E)?"weekend":""} ${i.isToday(E)?"today":""} ${N?"outside-month":""}`,style:{minHeight:"80px"},children:[e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(E,"short")}),l&&_.map(S=>e.jsx(W,{type:R.MILESTONE,reference:S.milestone_ref,name:S.name,size:"mini"},S.id)),u&&k.map(S=>e.jsx(W,{type:R.DELIVERABLE,reference:S.deliverable_ref,name:S.name,size:"mini"},S.id))]},g)})},y))]}):e.jsxs("div",{className:"cal-month-grid",children:[e.jsxs("div",{className:"cal-month-header",children:[e.jsx("div",{className:"cal-month-header-cell",children:"Resource"}),f.map((v,y)=>e.jsx("div",{className:"cal-month-header-cell",children:v},y))]}),t.map(v=>{const y=Y(r,a,v.id);return x.map((E,g)=>e.jsxs("div",{className:"cal-month-row",children:[e.jsx("div",{className:"cal-resource-cell",children:g===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cal-resource-name",children:v.name}),e.jsx("div",{className:"cal-resource-role",children:v.role})]})}),E.map((N,_)=>{const k=d(v.id,N),S=N.getMonth()!==j;return e.jsxs("div",{className:`cal-month-cell ${i.isWeekend(N)?"weekend":""} ${i.isToday(N)?"today":""} ${S?"outside-month":""} ${y?"":"not-editable"}`,onClick:()=>!S&&y&&o(N,v),style:{cursor:y&&!S?"pointer":"default"},children:[(g===0||_===0)&&e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(N,"short")}),k&&e.jsx(ne,{status:k.status,period:k.period,size:"mini"})]},_)})]},`${v.id}-${g}`))})]})}function $e({deliverablesByWeek:n,milestonesByWeek:t,onDeliverableClick:a,onMilestoneClick:r}){const s=o=>({"Not Started":"not-started",Draft:"not-started","In Progress":"in-progress",Submitted:"submitted","Review Complete":"submitted",Delivered:"delivered",Completed:"delivered"})[o]||"not-started",l=n.map((o,d)=>({...o,milestones:t[d]?.items||[],deliverables:o.items||[]}));return l.some(o=>o.milestones.length>0||o.deliverables.length>0)?e.jsx("div",{className:"cal-deliverables-list",children:l.map((o,d)=>{const D=o.milestones.length+o.deliverables.length;return e.jsxs("div",{className:"cal-deliverables-week",children:[e.jsxs("div",{className:"cal-week-label",children:[e.jsx("span",{children:o.label}),e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:i.formatDisplay(o.start,"weekRange")}),D>0&&e.jsx("span",{className:"cal-week-count",children:D})]}),D===0?e.jsx("div",{className:"cal-empty-week",children:"No items due this week"}):e.jsxs(e.Fragment,{children:[o.milestones.map(h=>e.jsxs("div",{className:"cal-milestone-item",onClick:()=>r(h),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(h.forecast_end_date||h.end_date)&&h.status!=="Completed"?"overdue":""}`,children:i.formatDisplay(h.forecast_end_date||h.end_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-milestone-ref",children:h.milestone_ref}),e.jsx("span",{className:"cal-milestone-name",children:h.name})]}),e.jsxs("div",{className:"cal-milestone-progress",children:[e.jsx("div",{className:"cal-progress-bar",children:e.jsx("div",{className:"cal-progress-fill",style:{width:`${h.completion_percentage||0}%`}})}),e.jsxs("span",{className:"cal-progress-text",children:[h.completion_percentage||0,"%"]})]}),e.jsx("div",{className:`cal-deliverable-status ${s(h.status)}`,children:h.status})]},h.id)),o.deliverables.map(h=>e.jsxs("div",{className:"cal-deliverable-item",onClick:()=>a(h),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(h.due_date)&&h.status!=="Delivered"?"overdue":""}`,children:i.formatDisplay(h.due_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-deliverable-ref",children:h.deliverable_ref}),e.jsx("span",{className:"cal-deliverable-name",children:h.name})]}),e.jsxs("div",{className:"cal-deliverable-milestone",children:[e.jsx(le,{size:12}),h.milestones?.milestone_ref||"â€”"]}),e.jsx("div",{className:`cal-deliverable-status ${s(h.status)}`,children:h.status})]},h.id))]})]},d)})}):e.jsx("div",{className:"cal-deliverables-list",children:e.jsxs("div",{className:"cal-empty",children:[e.jsx(se,{size:48,className:"cal-empty-icon"}),e.jsx("p",{children:"No milestones or deliverables due in this period"})]})})}export{Ve as default};
