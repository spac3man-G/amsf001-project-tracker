import{s as O,u as we,a as xe,c as De,j as e,L as Ne}from"./index-Y3jZQyWZ.js";import{d as _e,r as y}from"./vendor-react-BUTV5ZEl.js";import{z as Ee,P as ie,m as ne,q as oe,aN as Se,h as ke,R as Ae,al as Le,w as Me,c as Ce}from"./vendor-icons-Hb5rh3SC.js";import"./vendor-supabase-6faYzd5A.js";const $={OUT_OF_OFFICE:"out_of_office",REMOTE:"remote",ON_SITE:"on_site"},R={FULL_DAY:"full_day",AM:"am",PM:"pm"},ce={[$.OUT_OF_OFFICE]:{label:"Out of Office",shortLabel:"OOO",color:"#EF4444",bgColor:"#FEE2E2",icon:"ðŸ”´"},[$.REMOTE]:{label:"Remote",shortLabel:"Remote",color:"#F59E0B",bgColor:"#FEF3C7",icon:"ðŸŸ¡"},[$.ON_SITE]:{label:"On Site",shortLabel:"On-Site",color:"#10B981",bgColor:"#D1FAE5",icon:"ðŸŸ¢"}},H={[R.FULL_DAY]:{label:"Full Day",shortLabel:"Full"},[R.AM]:{label:"Morning (AM)",shortLabel:"AM"},[R.PM]:{label:"Afternoon (PM)",shortLabel:"PM"}},F={MILESTONE:"milestone",DELIVERABLE:"deliverable"};class Oe{async getAvailabilityByDateRange(t,s,r,a=null){try{let l=O.from("resource_availability").select(`
          id,
          project_id,
          user_id,
          date,
          status,
          period,
          notes,
          created_at,
          updated_at
        `).eq("project_id",t).gte("date",s).lte("date",r).order("date",{ascending:!0});a&&(l=l.eq("user_id",a));const{data:v,error:d}=await l;if(d)throw d;return v||[]}catch(l){throw l}}async setAvailability(t,s,r,a,l=R.FULL_DAY,v=null){try{if(!Object.values($).includes(a))throw new Error(`Invalid status: ${a}`);if(!Object.values(R).includes(l))throw new Error(`Invalid period: ${l}`);const{data:d,error:h}=await O.from("resource_availability").upsert({project_id:t,user_id:s,date:r,status:a,period:l,notes:v,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id,date",ignoreDuplicates:!1}).select();if(h)throw h;return d?.[0]||null}catch(d){throw d}}async clearAvailability(t,s,r){try{const{error:a}=await O.from("resource_availability").delete().eq("project_id",t).eq("user_id",s).eq("date",r);if(a)throw a;return!0}catch(a){throw a}}async getProjectMembers(t){try{const{data:s,error:r}=await O.from("user_projects").select("user_id, role").eq("project_id",t).order("role");if(r)throw r;if(!s||s.length===0)return[];const a=s.map(h=>h.user_id),{data:l,error:v}=await O.from("profiles").select("id, full_name, email").in("id",a),d={};return(l||[]).forEach(h=>{d[h.id]=h}),s.map(h=>({id:h.user_id,name:d[h.user_id]?.full_name||d[h.user_id]?.email||"Unknown",email:d[h.user_id]?.email,role:h.role}))}catch(s){throw s}}async getMilestonesByDateRange(t,s,r){try{const{data:a,error:l}=await O.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(l)throw l;return(a||[]).filter(d=>d.is_deleted!==!0).filter(d=>{const h=d.forecast_end_date||d.end_date;return h?h>=s&&h<=r:!1})}catch(a){throw a}}async getAllMilestones(t){try{const{data:s,error:r}=await O.from("milestones").select("*").eq("project_id",t).order("end_date",{ascending:!0});if(r)throw r;return(s||[]).filter(a=>a.is_deleted!==!0)}catch(s){throw s}}async getDeliverablesByDateRange(t,s,r){try{const{data:a,error:l}=await O.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).gte("due_date",s).lte("due_date",r).order("due_date",{ascending:!0});if(l)throw l;return(a||[]).filter(v=>v.is_deleted!==!0)}catch(a){throw a}}async getAllDeliverables(t){try{const{data:s,error:r}=await O.from("deliverables").select(`
          id,
          project_id,
          milestone_id,
          deliverable_ref,
          name,
          description,
          due_date,
          status,
          progress,
          is_deleted,
          milestones (
            milestone_ref,
            name,
            forecast_end_date
          )
        `).eq("project_id",t).order("due_date",{ascending:!0});if(r)throw r;return(s||[]).filter(a=>a.is_deleted!==!0)}catch(s){throw s}}async getAllEvents(t,s,r,a={}){try{const l={availability:[],milestones:[],deliverables:[]},{showAvailability:v=!0,showMilestones:d=!0,showDeliverables:h=!0,userId:b}=a,m=[];return v&&m.push(this.getAvailabilityByDateRange(t,s,r,b).then(E=>{l.availability=E})),d&&m.push(this.getMilestonesByDateRange(t,s,r).then(E=>{l.milestones=E})),h&&m.push(this.getDeliverablesByDateRange(t,s,r).then(E=>{l.deliverables=E})),await Promise.all(m),l}catch(l){throw l}}async getUpcomingDeliverables(t,s=4){try{const r=new Date,a=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+s*7);const v=l.toISOString().split("T")[0];return this.getDeliverablesByDateRange(t,a,v)}catch(r){throw r}}async getUpcomingMilestones(t,s=4){try{const r=new Date,a=r.toISOString().split("T")[0],l=new Date(r);l.setDate(l.getDate()+s*7);const v=l.toISOString().split("T")[0];return this.getMilestonesByDateRange(t,a,v)}catch(r){throw r}}async getProjectDateRange(t){try{const{data:s}=await O.from("projects").select("start_date, end_date").eq("id",t).limit(1);if(s?.[0])return{start:s[0].start_date,end:s[0].end_date};const r=await this.getAllMilestones(t);if(r.length===0){const l=new Date().toISOString().split("T")[0];return{start:l,end:l}}const a=r.flatMap(l=>[l.start_date,l.end_date,l.forecast_end_date]).filter(Boolean).sort();return{start:a[0],end:a[a.length-1]}}catch(s){throw s}}}const z=new Oe;function X(n,t,s){return n==="viewer"?!1:n==="admin"||n==="supplier_pm"?!0:t===s}const T={ALL_EVENTS:"all",AVAILABILITY:"availability",MILESTONES:"milestones",DELIVERABLES:"deliverables",MILESTONES_DELIVERABLES:"milestones_deliverables"},re={[T.ALL_EVENTS]:{label:"All Events",icon:Se,showAvailability:!0,showMilestones:!0,showDeliverables:!0},[T.AVAILABILITY]:{label:"Team Availability",icon:oe,showAvailability:!0,showMilestones:!1,showDeliverables:!1},[T.MILESTONES]:{label:"Milestones",icon:ne,showAvailability:!1,showMilestones:!0,showDeliverables:!1},[T.DELIVERABLES]:{label:"Deliverables",icon:ie,showAvailability:!1,showMilestones:!1,showDeliverables:!0},[T.MILESTONES_DELIVERABLES]:{label:"Milestones & Deliverables",icon:Ee,showAvailability:!1,showMilestones:!0,showDeliverables:!0}},i={formatDate:n=>new Date(n).toISOString().split("T")[0],getWeekStart:n=>{const t=new Date(n),s=t.getDay(),r=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(r))},getWeekEnd:n=>{const t=i.getWeekStart(n),s=new Date(t);return s.setDate(s.getDate()+6),s},getMonthStart:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth(),1)},getMonthEnd:n=>{const t=new Date(n);return new Date(t.getFullYear(),t.getMonth()+1,0)},getWeekDates:n=>{const t=i.getWeekStart(n),s=[];for(let r=0;r<7;r++){const a=new Date(t);a.setDate(a.getDate()+r),s.push(a)}return s},getMonthWeeks:n=>{const t=i.getMonthStart(n),s=i.getMonthEnd(n),r=i.getWeekStart(t),a=[];let l=new Date(r);for(;l<=s||a.length<5;){const v=[];for(let d=0;d<7;d++)v.push(new Date(l)),l.setDate(l.getDate()+1);if(a.push(v),a.length>=6)break}return a},getWeeksAhead:n=>{const t=[],s=new Date;let r=i.getWeekStart(s);for(let a=0;a<n;a++){const l=new Date(r);l.setDate(l.getDate()+6),t.push({start:new Date(r),end:l,label:a===0?"This Week":`Week ${a+1}`}),r=new Date(r),r.setDate(r.getDate()+7)}return t},isToday:n=>{const t=new Date;return i.formatDate(n)===i.formatDate(t)},isWeekend:n=>{const t=new Date(n).getDay();return t===0||t===6},isPast:n=>{const t=new Date;return t.setHours(0,0,0,0),new Date(n)<t},formatDisplay:(n,t="short")=>{const s=new Date(n);if(t==="short")return s.toLocaleDateString("en-GB",{day:"numeric"});if(t==="day")return s.toLocaleDateString("en-GB",{weekday:"short"});if(t==="full")return s.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});if(t==="medium")return s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});if(t==="month")return s.toLocaleDateString("en-GB",{month:"long",year:"numeric"});if(t==="week"){const r=i.getWeekEnd(n),a=s.toLocaleDateString("en-GB",{day:"numeric",month:"short"}),l=r.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return`${a} - ${l}`}if(t==="weekRange"){const r=new Date(n),a=new Date(n);return a.setDate(a.getDate()+6),`${r.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${a.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}`}return s.toLocaleDateString("en-GB")}};function de({status:n,period:t,size:s="normal"}){const r=ce[n];if(!r)return null;const a=n===$.OUT_OF_OFFICE?"ooo":n===$.REMOTE?"remote":"onsite",l=t&&t!==R.FULL_DAY;return s==="mini"?e.jsx("span",{className:`cal-mini-badge ${a}`,title:`${r.label}${l?` (${H[t]?.shortLabel})`:""}`}):e.jsxs("span",{className:`cal-status-badge ${a} ${l?"half-day":""}`,children:[r.shortLabel,l&&e.jsxs("span",{className:"cal-period-indicator",children:["(",H[t]?.shortLabel,")"]})]})}function V({type:n,item:t,isOverdue:s,size:r="normal",onClick:a,onMouseEnter:l,onMouseLeave:v}){if(!t)return null;const d=n===F.MILESTONE?"milestone":"deliverable",h=n===F.MILESTONE?t.milestone_ref:t.deliverable_ref,b=t.name||"";return r==="mini"?e.jsx("span",{className:`cal-mini-badge ${d} clickable`,title:`${h}: ${b}`,onClick:a,onMouseEnter:l,onMouseLeave:v}):e.jsx("span",{className:`cal-event-badge ${d} ${s?"overdue":""} clickable`,title:b,onClick:a,onMouseEnter:l,onMouseLeave:v,children:e.jsx("span",{className:"cal-event-ref",children:h})})}function Te({isOpen:n,onClose:t,onSave:s,onClear:r,date:a,resource:l,currentEntry:v,isEditingOther:d}){const[h,b]=y.useState(v?.status||""),[m,E]=y.useState(v?.period||R.FULL_DAY),[N,S]=y.useState(v?.notes||""),[_,g]=y.useState(!1);if(y.useEffect(()=>{b(v?.status||""),E(v?.period||R.FULL_DAY),S(v?.notes||"")},[v,n]),!n)return null;const j=async()=>{if(h){g(!0);try{await s(h,m,N),t()}finally{g(!1)}}},f=async()=>{g(!0);try{await r(),t()}finally{g(!1)}};return e.jsx("div",{className:"cal-modal-overlay",onClick:t,children:e.jsxs("div",{className:"cal-modal",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"cal-modal-header",children:[e.jsx("h3",{children:d?"Edit Availability":"Set Availability"}),e.jsx("button",{className:"cal-modal-close",onClick:t,children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"cal-modal-body",children:[e.jsxs("div",{className:"cal-modal-info",children:[e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Date"}),e.jsx("span",{className:"cal-modal-info-value",children:i.formatDisplay(a,"full")})]}),e.jsxs("div",{className:"cal-modal-info-row",children:[e.jsx("span",{className:"cal-modal-info-label",children:"Resource"}),e.jsxs("span",{className:"cal-modal-info-value",children:[l?.name,d&&e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.8em"},children:" (editing as manager)"})]})]})]}),e.jsx("div",{className:"cal-modal-section-title",children:"Status"}),e.jsx("div",{className:"cal-status-options",children:Object.entries($).map(([p,c])=>{const x=ce[c],k=c===$.OUT_OF_OFFICE?"ooo":c===$.REMOTE?"remote":"onsite";return e.jsxs("div",{className:`cal-status-option ${h===c?"selected":""}`,onClick:()=>b(c),children:[e.jsx("span",{className:`cal-status-option-dot ${k}`}),e.jsx("span",{className:"cal-status-option-text",children:x.label})]},c)})}),e.jsx("div",{className:"cal-modal-section-title",children:"Duration"}),e.jsx("div",{className:"cal-period-options",children:Object.entries(R).map(([p,c])=>e.jsx("div",{className:`cal-period-option ${m===c?"selected":""}`,onClick:()=>E(c),children:H[c].label},c))}),e.jsx("div",{className:"cal-modal-section-title",children:"Notes (optional)"}),e.jsx("textarea",{className:"cal-notes-input",placeholder:"Add notes...",value:N,onChange:p=>S(p.target.value)})]}),e.jsxs("div",{className:"cal-modal-footer",children:[v&&e.jsx("button",{className:"cal-btn cal-btn-danger",onClick:f,disabled:_,children:"Clear"}),e.jsx("button",{className:"cal-btn cal-btn-secondary",onClick:t,children:"Cancel"}),e.jsx("button",{className:"cal-btn cal-btn-primary",onClick:j,disabled:!h||_,children:_?"Saving...":"Save"})]})]})})}function Ve(){const n=_e(),{user:t}=we(),{projectId:s,projectRole:r}=xe(),{showSuccess:a,showError:l}=De(),[v,d]=y.useState(T.ALL_EVENTS),[h,b]=y.useState("week"),[m,E]=y.useState(4),[N,S]=y.useState(new Date),[_,g]=y.useState("all"),[j,f]=y.useState([]),[p,c]=y.useState([]),[x,k]=y.useState([]),[L,B]=y.useState([]),[C,I]=y.useState(!0),[W,J]=y.useState(!1),[K,he]=y.useState(null),[M,Q]=y.useState({isOpen:!1,date:null,resource:null,entry:null}),D=re[v],P=r||"viewer",G=y.useMemo(()=>{if(v===T.DELIVERABLES){const o=new Date,u=new Date(o);return u.setDate(u.getDate()+m*7),{start:i.formatDate(o),end:i.formatDate(u)}}if(h==="week")return{start:i.formatDate(i.getWeekStart(N)),end:i.formatDate(i.getWeekEnd(N))};{const o=i.getMonthStart(N),u=i.getMonthEnd(N);return{start:i.formatDate(i.getWeekStart(o)),end:i.formatDate(i.getWeekEnd(u))}}},[v,h,N,m]),U=y.useCallback(async(o=!1)=>{if(s){o&&J(!0);try{const u=await z.getAllEvents(s,G.start,G.end,{showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,userId:_!=="all"?_:null});if(f(u.availability),c(u.milestones),k(u.deliverables),he(new Date),D.showAvailability){const w=await z.getProjectMembers(s);B(w)}o&&a("Calendar refreshed")}catch{l("Failed to load calendar data")}finally{I(!1),J(!1)}}},[s,G,D,_,l,a]);y.useEffect(()=>{U()},[U]);const me=()=>U(!0),Z=o=>{const u=new Date(N);h==="week"?u.setDate(u.getDate()+o*7):u.setMonth(u.getMonth()+o),S(u)},ue=()=>S(new Date),Y=(o,u)=>{const w=i.formatDate(u);return j.find(A=>A.user_id===o&&A.date===w)},ee=o=>{const u=i.formatDate(o);return p.filter(w=>(w.forecast_end_date||w.end_date)===u)},te=o=>{const u=i.formatDate(o);return x.filter(w=>w.due_date===u)},se=(o,u)=>{if(!X(P,t?.id,u.id))return;const w=Y(u.id,o);Q({isOpen:!0,date:o,resource:u,entry:w})},ve=async(o,u,w)=>{const A=M.resource?.id;try{await z.setAvailability(s,A,i.formatDate(M.date),o,u,w);const q=A!==t?.id;a(q?`Availability updated for ${M.resource?.name}`:"Availability updated"),U()}catch(q){throw l("Failed to save availability"),q}},ge=async()=>{const o=M.resource?.id;try{await z.clearAvailability(s,o,i.formatDate(M.date));const u=o!==t?.id;a(u?`Availability cleared for ${M.resource?.name}`:"Availability cleared"),U()}catch(u){throw l("Failed to clear availability"),u}},ae=y.useMemo(()=>_==="all"?L:L.filter(o=>o.id===_),[L,_]),fe=y.useMemo(()=>i.getWeeksAhead(m).map(u=>({...u,items:x.filter(w=>{const A=new Date(w.due_date);return A>=u.start&&A<=u.end})})),[x,m]),pe=y.useMemo(()=>i.getWeeksAhead(m).map(u=>({...u,items:p.filter(w=>{const A=new Date(w.forecast_end_date||w.end_date);return A>=u.start&&A<=u.end})})),[p,m]),ye=M.resource?.id!==t?.id;if(C)return e.jsx(Ne,{message:"Loading calendar...",size:"large",fullPage:!0});const le=v!==T.DELIVERABLES,be=v===T.DELIVERABLES,je=()=>P==="viewer"?"View only - contact a manager to update availability":P==="admin"||P==="supplier_pm"?"Click any row to edit availability":"Click your row to set availability";return e.jsxs("div",{className:"calendar-page",children:[e.jsx("header",{className:"cal-header",children:e.jsxs("div",{className:"cal-header-content",children:[e.jsxs("div",{className:"cal-header-left",children:[e.jsx("div",{className:"cal-header-icon",children:e.jsx(ke,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Project Calendar"}),e.jsx("p",{children:"Team availability, milestones, and deliverables"})]})]}),e.jsxs("div",{className:"cal-header-actions",children:[e.jsxs("button",{className:"cal-btn cal-btn-secondary",onClick:me,disabled:W,children:[e.jsx(Ae,{size:18,className:W?"spinning":""}),W?"Refreshing...":"Refresh"]}),K&&e.jsxs("span",{className:"cal-last-refresh",children:["Updated ",K.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsx("div",{className:"cal-controls",children:e.jsxs("div",{className:"cal-controls-inner",children:[e.jsx("div",{className:"cal-controls-left",children:e.jsx("div",{className:"cal-view-tabs",children:Object.entries(T).map(([o,u])=>{const w=re[u],A=w.icon;return e.jsxs("button",{className:`cal-view-tab ${v===u?"active":""}`,onClick:()=>d(u),children:[e.jsx(A,{size:16,className:"cal-view-tab-icon"}),e.jsx("span",{children:w.label})]},u)})})}),e.jsx("div",{className:"cal-controls-center",children:be?e.jsx("div",{className:"cal-range-select",children:[1,2,3,4].map(o=>e.jsxs("button",{className:`cal-range-btn ${m===o?"active":""}`,onClick:()=>E(o),children:[o,"W"]},o))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-nav",children:[e.jsx("button",{className:"cal-nav-btn",onClick:()=>Z(-1),children:e.jsx(Le,{size:20})}),e.jsx("span",{className:"cal-period",children:h==="week"?i.formatDisplay(N,"week"):i.formatDisplay(N,"month")}),e.jsx("button",{className:"cal-nav-btn",onClick:()=>Z(1),children:e.jsx(Me,{size:20})})]}),e.jsx("button",{className:"cal-today-btn",onClick:ue,children:"Today"})]})}),e.jsxs("div",{className:"cal-controls-right",children:[le&&e.jsxs("div",{className:"cal-period-toggle",children:[e.jsx("button",{className:`cal-period-btn ${h==="week"?"active":""}`,onClick:()=>b("week"),children:"Week"}),e.jsx("button",{className:`cal-period-btn ${h==="month"?"active":""}`,onClick:()=>b("month"),children:"Month"})]}),D.showAvailability&&e.jsxs("select",{className:"cal-filter-select",value:_,onChange:o=>g(o.target.value),children:[e.jsxs("option",{value:"all",children:["All Resources (",L.length,")"]}),L.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})]})}),e.jsxs("div",{className:"cal-content",children:[e.jsxs("div",{className:"cal-legend",children:[D.showAvailability&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot ooo"}),e.jsx("span",{children:"Out of Office"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot remote"}),e.jsx("span",{children:"Remote"})]}),e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot onsite"}),e.jsx("span",{children:"On Site"})]})]}),D.showMilestones&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot milestone"}),e.jsx("span",{children:"Milestone"})]}),D.showDeliverables&&e.jsxs("div",{className:"cal-legend-item",children:[e.jsx("span",{className:"cal-legend-dot deliverable"}),e.jsx("span",{children:"Deliverable"})]}),D.showAvailability&&e.jsxs("div",{className:"cal-legend-hint",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:je()})]})]}),le?e.jsx("div",{className:"cal-calendar-card",children:h==="week"?e.jsx(Ie,{currentDate:N,members:D.showAvailability?ae:[],currentUserId:t?.id,userRole:P,showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,onCellClick:se,onMilestoneClick:o=>n(`/milestones/${o.id}`),onDeliverableClick:o=>n(`/milestones/${o.milestone_id}`),getAvailabilityEntry:Y,getMilestonesForDate:ee,getDeliverablesForDate:te}):e.jsx($e,{currentDate:N,members:D.showAvailability?ae:[],currentUserId:t?.id,userRole:P,showAvailability:D.showAvailability,showMilestones:D.showMilestones,showDeliverables:D.showDeliverables,onCellClick:se,onMilestoneClick:o=>n(`/milestones/${o.id}`),onDeliverableClick:o=>n(`/milestones/${o.milestone_id}`),onDateClick:o=>{S(o),b("week")},getAvailabilityEntry:Y,getMilestonesForDate:ee,getDeliverablesForDate:te})}):e.jsx(Re,{deliverablesByWeek:fe,milestonesByWeek:D.showMilestones?pe:[],onDeliverableClick:()=>n("/deliverables"),onMilestoneClick:o=>n(`/milestones/${o.id}`)})]}),e.jsx(Te,{isOpen:M.isOpen,onClose:()=>Q({isOpen:!1,date:null,resource:null,entry:null}),onSave:ve,onClear:ge,date:M.date,resource:M.resource,currentEntry:M.entry,isEditingOther:ye})]})}function Ie({currentDate:n,members:t,currentUserId:s,userRole:r,showAvailability:a,showMilestones:l,showDeliverables:v,onCellClick:d,onMilestoneClick:h,onDeliverableClick:b,getAvailabilityEntry:m,getMilestonesForDate:E,getDeliverablesForDate:N}){const S=i.getWeekDates(n),_=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!a||t.length===0?e.jsxs("div",{className:"cal-week-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-week-header",children:S.map((g,j)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(g)?"today":""}`,children:[_[j],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(g,"short")})]},j))}),e.jsx("div",{className:"cal-week-row",children:S.map((g,j)=>{const f=E(g),p=N(g);return e.jsxs("div",{className:`cal-day-cell not-editable ${i.isWeekend(g)?"weekend":""} ${i.isToday(g)?"today":""}`,style:{minHeight:"120px"},children:[l&&f.map(c=>e.jsx(V,{type:F.MILESTONE,item:c,isOverdue:i.isPast(c.forecast_end_date||c.end_date),onClick:x=>{x.stopPropagation(),h&&h(c)}},c.id)),v&&p.map(c=>e.jsx(V,{type:F.DELIVERABLE,item:c,isOverdue:i.isPast(c.due_date)&&c.status!=="Delivered",onClick:x=>{x.stopPropagation(),b&&b(c)}},c.id))]},j)})})]}):e.jsxs("div",{className:"cal-week-grid",children:[e.jsxs("div",{className:"cal-week-header",children:[e.jsx("div",{className:"cal-week-header-cell",children:"Resource"}),S.map((g,j)=>e.jsxs("div",{className:`cal-week-header-cell ${i.isToday(g)?"today":""}`,children:[_[j],e.jsx("span",{className:"cal-week-header-date",children:i.formatDisplay(g,"short")})]},j))]}),(l||v)&&e.jsxs("div",{className:"cal-week-row cal-events-row",children:[e.jsxs("div",{className:"cal-resource-cell",children:[e.jsx("div",{className:"cal-resource-name",children:"Events"}),e.jsx("div",{className:"cal-resource-role",children:"Milestones & Deliverables"})]}),S.map((g,j)=>{const f=E(g),p=N(g);return e.jsxs("div",{className:`cal-day-cell not-editable ${i.isWeekend(g)?"weekend":""} ${i.isToday(g)?"today":""}`,style:{minHeight:"60px"},children:[l&&f.map(c=>e.jsx(V,{type:F.MILESTONE,item:c,isOverdue:i.isPast(c.forecast_end_date||c.end_date),onClick:x=>{x.stopPropagation(),h&&h(c)}},c.id)),v&&p.map(c=>e.jsx(V,{type:F.DELIVERABLE,item:c,isOverdue:i.isPast(c.due_date)&&c.status!=="Delivered",onClick:x=>{x.stopPropagation(),b&&b(c)}},c.id))]},j)})]}),t.map(g=>{const j=X(r,s,g.id);return e.jsxs("div",{className:"cal-week-row",children:[e.jsxs("div",{className:"cal-resource-cell",children:[e.jsx("div",{className:"cal-resource-name",children:g.name}),e.jsx("div",{className:"cal-resource-role",children:g.role})]}),S.map((f,p)=>{const c=m(g.id,f);return e.jsx("div",{className:`cal-day-cell ${i.isWeekend(f)?"weekend":""} ${i.isToday(f)?"today":""} ${j?"":"not-editable"}`,onClick:()=>j&&d(f,g),style:{cursor:j?"pointer":"default"},title:j?"Click to edit availability":`${g.name}'s availability`,children:c&&e.jsx(de,{status:c.status,period:c.period})},p)})]},g.id)})]})}function $e({currentDate:n,members:t,currentUserId:s,userRole:r,showAvailability:a,showMilestones:l,showDeliverables:v,onCellClick:d,onMilestoneClick:h,onDeliverableClick:b,onDateClick:m,getAvailabilityEntry:E,getMilestonesForDate:N,getDeliverablesForDate:S}){const _=i.getMonthWeeks(n),g=n.getMonth(),j=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return!a||t.length===0?e.jsxs("div",{className:"cal-month-grid",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[e.jsx("div",{className:"cal-month-header",children:j.map((f,p)=>e.jsx("div",{className:"cal-month-header-cell",children:f},p))}),_.map((f,p)=>e.jsx("div",{className:"cal-month-row",children:f.map((c,x)=>{const k=c.getMonth()!==g,L=N(c),B=S(c),C=L.length>0||B.length>0;return e.jsxs("div",{className:`cal-month-cell ${C?"has-items":""} ${i.isWeekend(c)?"weekend":""} ${i.isToday(c)?"today":""} ${k?"outside-month":""}`,style:{minHeight:"80px",cursor:C&&!k?"pointer":"default"},onClick:()=>C&&!k&&m&&m(c),title:C?"Click to see week view":"",children:[e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(c,"short")}),l&&L.map(I=>e.jsx(V,{type:F.MILESTONE,item:I,size:"mini",onClick:W=>{W.stopPropagation(),h&&h(I)}},I.id)),v&&B.map(I=>e.jsx(V,{type:F.DELIVERABLE,item:I,size:"mini",onClick:W=>{W.stopPropagation(),b&&b(I)}},I.id))]},x)})},p))]}):e.jsxs("div",{className:"cal-month-grid",children:[e.jsxs("div",{className:"cal-month-header",children:[e.jsx("div",{className:"cal-month-header-cell",children:"Resource"}),j.map((f,p)=>e.jsx("div",{className:"cal-month-header-cell",children:f},p))]}),t.map(f=>{const p=X(r,s,f.id);return _.map((c,x)=>e.jsxs("div",{className:"cal-month-row",children:[e.jsx("div",{className:"cal-resource-cell",children:x===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cal-resource-name",children:f.name}),e.jsx("div",{className:"cal-resource-role",children:f.role})]})}),c.map((k,L)=>{const B=E(f.id,k),C=k.getMonth()!==g;return e.jsxs("div",{className:`cal-month-cell ${i.isWeekend(k)?"weekend":""} ${i.isToday(k)?"today":""} ${C?"outside-month":""} ${p?"":"not-editable"}`,onClick:()=>!C&&p&&d(k,f),style:{cursor:p&&!C?"pointer":"default"},children:[(x===0||L===0)&&e.jsx("span",{className:"cal-month-date",children:i.formatDisplay(k,"short")}),B&&e.jsx(de,{status:B.status,period:B.period,size:"mini"})]},L)})]},`${f.id}-${x}`))})]})}function Re({deliverablesByWeek:n,milestonesByWeek:t,onDeliverableClick:s,onMilestoneClick:r}){const a=d=>({"Not Started":"not-started",Draft:"not-started","In Progress":"in-progress",Submitted:"submitted","Review Complete":"submitted",Delivered:"delivered",Completed:"delivered"})[d]||"not-started",l=n.map((d,h)=>({...d,milestones:t[h]?.items||[],deliverables:d.items||[]}));return l.some(d=>d.milestones.length>0||d.deliverables.length>0)?e.jsx("div",{className:"cal-deliverables-list",children:l.map((d,h)=>{const b=d.milestones.length+d.deliverables.length;return e.jsxs("div",{className:"cal-deliverables-week",children:[e.jsxs("div",{className:"cal-week-label",children:[e.jsx("span",{children:d.label}),e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--color-text-secondary)"},children:i.formatDisplay(d.start,"weekRange")}),b>0&&e.jsx("span",{className:"cal-week-count",children:b})]}),b===0?e.jsx("div",{className:"cal-empty-week",children:"No items due this week"}):e.jsxs(e.Fragment,{children:[d.milestones.map(m=>e.jsxs("div",{className:"cal-milestone-item",onClick:()=>r(m),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(m.forecast_end_date||m.end_date)&&m.status!=="Completed"?"overdue":""}`,children:i.formatDisplay(m.forecast_end_date||m.end_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-milestone-ref",children:m.milestone_ref}),e.jsx("span",{className:"cal-milestone-name",children:m.name})]}),e.jsxs("div",{className:"cal-milestone-progress",children:[e.jsx("div",{className:"cal-progress-bar",children:e.jsx("div",{className:"cal-progress-fill",style:{width:`${m.completion_percentage||0}%`}})}),e.jsxs("span",{className:"cal-progress-text",children:[m.completion_percentage||0,"%"]})]}),e.jsx("div",{className:`cal-deliverable-status ${a(m.status)}`,children:m.status})]},m.id)),d.deliverables.map(m=>e.jsxs("div",{className:"cal-deliverable-item",onClick:()=>s(m),children:[e.jsx("div",{className:`cal-deliverable-date ${i.isPast(m.due_date)&&m.status!=="Delivered"?"overdue":""}`,children:i.formatDisplay(m.due_date,"medium")}),e.jsxs("div",{className:"cal-deliverable-info",children:[e.jsx("span",{className:"cal-deliverable-ref",children:m.deliverable_ref}),e.jsx("span",{className:"cal-deliverable-name",children:m.name})]}),e.jsxs("div",{className:"cal-deliverable-milestone",children:[e.jsx(ne,{size:12}),m.milestones?.milestone_ref||"â€”"]}),e.jsx("div",{className:`cal-deliverable-status ${a(m.status)}`,children:m.status})]},m.id))]})]},h)})}):e.jsx("div",{className:"cal-deliverables-list",children:e.jsxs("div",{className:"cal-empty",children:[e.jsx(ie,{size:48,className:"cal-empty-icon"}),e.jsx("p",{children:"No milestones or deliverables due in this period"})]})})}export{Ve as default};
