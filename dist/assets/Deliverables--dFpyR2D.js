import{u as de,c as oe,j as e,a as Re,b as Ae,e as Te,f as ze,m as Me,k as Ie,q as Pe,d as j,L as qe}from"./index-CvAw8Dc4.js";import{r as c,L as Ee}from"./vendor-react-JFEV0ROX.js";import{i as ce,b as Le,c as me,d as ue,e as J,g as Fe,h as Oe,D as Y,j as Ue,f as ne,k as Ke,l as le,m as Qe}from"./deliverableCalculations-DJdE_OlJ.js";import{S as Be}from"./SignatureBox-jS0o8n1y.js";import{s as pe,a as he,F as We,U as $e,V as Ve,k as H,ac as Ye,i as He,T as Ge,a2 as xe,e as Z,y as fe,O as ge,C as G,a1 as Xe,R as Je,a0 as Ze,E as es}from"./vendor-icons-yzeFIsqS.js";import"./vendor-supabase-DgEUAXvv.js";function ss(n=null){const{user:a,role:r,profile:g}=de(),{canCreateDeliverable:d,canEditDeliverable:p,canDeleteDeliverable:v,canReviewDeliverable:T,canSubmitDeliverable:$,canSignAsSupplier:U,canSignAsCustomer:K}=oe(),b=r==="admin",z=r==="supplier_pm",S=r==="customer_pm",h=r==="contributor",m=a?.id||null,x=g?.full_name||a?.email||"Unknown",k=n?ce(n):!1,C=n?Le(n):!0,w=!0,Q=d,_=k||!C?!1:!!(b||z||h&&n?.assigned_to===x),M=k?!1:v,D=!n||!me(n)?!1:!!(b||z||h&&n?.assigned_to===x),N=!n||!ue(n)?!1:T,E=N,B=N,L=!n||!J(n)?!1:b||S,u=!U||!n?!1:Fe(n),W=!K||!n?!1:Oe(n),f=n?n.supplier_pm_signed_at&&n.customer_pm_signed_at:!1,R=!n||!J(n)?!1:b||S;return{currentUserId:m,currentUserName:x,userRole:r,isAdmin:b,isSupplierPM:z,isCustomerPM:S,isContributor:h,canView:w,canCreate:Q,canEdit:_,canDelete:M,canSubmit:D,canSubmitForReview:D,canReview:N,canAcceptReview:E,canRejectReview:B,canInitiateSignOff:L,canSignAsSupplier:u,canSignAsCustomer:W,isFullySigned:f,canAssessKPIsAndQS:R,isComplete:k,isEditable:C}}function as({isOpen:n,deliverable:a,milestones:r,kpis:g,qualityStandards:d,canEdit:p,canReview:v,canDelete:T,onClose:$,onSave:U,onStatusChange:K,onDelete:b,onOpenCompletion:z}){const[S,h]=c.useState(!1),[m,x]=c.useState({}),[k,C]=c.useState(!1);if(ss(a),c.useEffect(()=>{a&&(x({name:a.name||"",description:a.description||"",milestone_id:a.milestone_id||"",status:a.status||Y.NOT_STARTED,progress:a.progress||0,assigned_to:a.assigned_to||"",kpi_ids:a.deliverable_kpis?.map(i=>i.kpi_id)||[],qs_ids:a.deliverable_quality_standards?.map(i=>i.quality_standard_id)||[]}),h(!1))},[a]),!n||!a)return null;const w=Ue(a.status),Q=w.icon,_=r?.find(i=>i.id===a.milestone_id),M=a.deliverable_kpis||[],D=a.deliverable_quality_standards||[],N=ce(a),E=p&&me(a),B=v&&ue(a),L=v&&J(a),u=_?.forecast_end_date||_?.end_date;async function W(){C(!0);try{await U(a.id,m),h(!1)}finally{C(!1)}}function f(){h(!1),$()}function R(i){K(a,i),f()}function I(i){const A={progress:i},F=Qe(m.status,i);F&&(A.status=F),x({...m,...A})}return e.jsx("div",{className:"deliverable-modal-overlay",onClick:f,children:e.jsxs("div",{className:"deliverable-modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"deliverable-modal-header",children:[e.jsxs("div",{className:"deliverable-modal-header-left",children:[e.jsx("div",{className:"deliverable-modal-icon",style:{backgroundColor:w.bg,color:w.color},children:e.jsx(pe,{size:20})}),e.jsxs("div",{className:"deliverable-modal-titles",children:[e.jsx("h2",{children:a.deliverable_ref}),e.jsx("span",{className:"subtitle",children:a.name})]})]}),e.jsxs("div",{className:"deliverable-modal-header-right",children:[e.jsxs("span",{className:"status-badge",style:{backgroundColor:w.bg,color:w.color},children:[e.jsx(Q,{size:14}),a.status]}),e.jsx("button",{className:"close-button",onClick:f,children:e.jsx(he,{size:24})})]})]}),e.jsx("div",{className:"deliverable-modal-content",children:S?e.jsxs("div",{className:"deliverable-edit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",className:"form-input",value:m.name,onChange:i=>x({...m,name:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:m.description,onChange:i=>x({...m,description:i.target.value})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{className:"form-input",value:m.milestone_id,onChange:i=>x({...m,milestone_id:i.target.value}),children:[e.jsx("option",{value:"",children:"-- Select milestone --"}),r?.map(i=>e.jsxs("option",{value:i.id,children:[i.milestone_ref," - ",i.name]},i.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"form-input readonly",children:(()=>{const i=r?.find(F=>F.id===m.milestone_id),A=i?.forecast_end_date||i?.end_date;return A?ne(A):"Set by milestone"})()}),e.jsx("span",{className:"hint",children:"Derived from milestone forecast date"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",className:"form-input",value:m.assigned_to,onChange:i=>x({...m,assigned_to:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Progress: ",m.progress,"%"]}),e.jsx("div",{className:"progress-slider",children:e.jsx("input",{type:"range",min:"0",max:"100",value:m.progress,onChange:i=>I(parseInt(i.target.value)),disabled:Ke(m.status)})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"deliverable-key-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(We,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Milestone"}),e.jsx("div",{className:"detail-item-value",children:_?e.jsxs(Ee,{to:`/milestones/${_.id}`,children:[_.milestone_ref," - ",_.name]}):"Not assigned"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx($e,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Assigned To"}),e.jsx("div",{className:"detail-item-value",children:a.assigned_to||"Unassigned"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(Ve,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Due Date"}),e.jsx("div",{className:"detail-item-value",children:u?ne(u):"Not set"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(H,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Progress"}),e.jsxs("div",{className:"progress-display",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-bar-fill ${N?"complete":"in-progress"}`,style:{width:`${a.progress||0}%`}})}),e.jsxs("span",{className:"progress-value",children:[a.progress||0,"%"]})]})]})]})]}),e.jsxs("div",{className:"deliverable-description",children:[e.jsx("div",{className:"section-label",children:"Description"}),e.jsx("div",{className:`description-text ${a.description?"":"empty"}`,children:a.description||"No description provided"})]}),M.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(Ye,{size:14}),"Linked KPIs (",M.length,")"]}),e.jsx("div",{className:"linked-items-list",children:M.map(i=>e.jsxs("span",{className:"linked-item-badge kpi",children:[i.kpis?.kpi_ref||"KPI"," - ",i.kpis?.name||"Unknown"]},i.kpi_id))})]}),D.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(He,{size:14}),"Linked Quality Standards (",D.length,")"]}),e.jsx("div",{className:"linked-items-list",children:D.map(i=>e.jsxs("span",{className:"linked-item-badge quality-standard",children:[i.quality_standards?.qs_ref||"QS"," - ",i.quality_standards?.name||"Unknown"]},i.quality_standard_id))})]}),N&&e.jsx("div",{className:"sign-off-section",children:e.jsx(Be,{message:"Deliverable accepted and delivered"})}),e.jsxs("div",{className:"deliverable-timestamps",children:[e.jsxs("div",{className:"timestamp-item",children:[e.jsx(H,{size:14}),"Created: ",a.created_at?le(a.created_at):"Unknown"]}),a.updated_at&&a.updated_at!==a.created_at&&e.jsxs("div",{className:"timestamp-item",children:[e.jsx(H,{size:14}),"Updated: ",le(a.updated_at)]})]})]})}),e.jsxs("div",{className:"deliverable-modal-footer",children:[e.jsx("div",{className:"footer-left",children:T&&!S&&!N&&e.jsxs("button",{className:"btn btn-danger",onClick:()=>{b(a.id),f()},children:[e.jsx(Ge,{size:16})," Delete"]})}),e.jsx("div",{className:"footer-right",children:S?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(!1),disabled:k,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:W,disabled:k,children:[e.jsx(xe,{size:16})," ",k?"Saving...":"Save Changes"]})]}):e.jsxs(e.Fragment,{children:[E&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>R(Y.SUBMITTED_FOR_REVIEW),children:[e.jsx(Z,{size:16})," Submit for Review"]}),B&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:()=>R(Y.RETURNED_FOR_MORE_WORK),children:[e.jsx(fe,{size:16})," Return for More Work"]}),e.jsxs("button",{className:"btn btn-success",onClick:()=>R(Y.REVIEW_COMPLETE),children:[e.jsx(ge,{size:16})," Accept Review"]})]}),L&&e.jsxs("button",{className:"btn btn-success",onClick:()=>{z(a),f()},children:[e.jsx(G,{size:16})," Mark as Delivered"]}),p&&!N&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>h(!0),children:[e.jsx(Xe,{size:16})," Edit"]})]})})]})]})})}const ts=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],re={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:G},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:ge},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:Z},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:H},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:fe},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:es}};function is({kpis:n,selectedIds:a,onChange:r,label:g="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:g}),a.length>0&&e.jsx("button",{type:"button",onClick:()=>r([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:n.map(d=>{const p=a.includes(d.id);return e.jsxs("div",{onClick:()=>r(p?a.filter(v=>v!==d.id):[...a,d.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#dbeafe":"#f8fafc",border:p?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:d.kpi_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:d.name})]})]},d.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[a.length," selected"]})]})}function ns({qualityStandards:n,selectedIds:a,onChange:r,label:g="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:g}),a.length>0&&e.jsx("button",{type:"button",onClick:()=>r([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:n.map(d=>{const p=a.includes(d.id);return e.jsxs("div",{onClick:()=>r(p?a.filter(v=>v!==d.id):[...a,d.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#f3e8ff":"#f8fafc",border:p?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:d.qs_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:d.name})]})]},d.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[a.length," selected"]})]})}function us(){const{user:n,role:a}=de(),{projectId:r}=Re(),{showSuccess:g,showError:d,showWarning:p}=Ae(),{showTestUsers:v}=Te(),T=n?.id||null,{canEditDeliverable:$,canReviewDeliverable:U,canDeleteDeliverable:K}=oe(),{refreshMetrics:b}=ze(),[z,S]=c.useState([]),[h,m]=c.useState([]),[x,k]=c.useState([]),[C,w]=c.useState([]),[Q,_]=c.useState(!0),[M,D]=c.useState(!1),[N,E]=c.useState(!1),[B,L]=c.useState(!1),[u,W]=c.useState(null),[f,R]=c.useState({}),[I,i]=c.useState({}),[A,F]=c.useState(""),[X,ee]=c.useState(""),[V,je]=c.useState(!1),[se,ae]=c.useState({isOpen:!1,deliverable:null}),[o,P]=c.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",kpi_ids:[],qs_ids:[]}),q=c.useCallback(async()=>{if(r){_(!0);try{const s=await Me.getAll(r,{orderBy:{column:"milestone_ref",ascending:!0}});m(s);const t=await Ie.getAll(r,{orderBy:{column:"kpi_ref",ascending:!0}});k(t);const l=await Pe.getAll(r,{orderBy:{column:"qs_ref",ascending:!0}});w(l);const O=await j.getAllWithRelations(r,v);S(O||[])}catch{d("Failed to load deliverables")}finally{_(!1),D(!1)}}},[r,v,d]);c.useEffect(()=>{q()},[q]);async function ve(){D(!0),await q()}async function be(s){s.preventDefault();try{const t=await j.create({project_id:r,deliverable_ref:o.deliverable_ref,name:o.name,description:o.description,milestone_id:o.milestone_id||null,status:o.status,progress:parseInt(o.progress)||0,assigned_to:o.assigned_to,created_by:T});await j.syncKPILinks(t.id,o.kpi_ids),await j.syncQSLinks(t.id,o.qs_ids),P({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",kpi_ids:[],qs_ids:[]}),E(!1),q(),b(),g("Deliverable added!")}catch(t){d("Failed: "+t.message)}}async function _e(s,t){try{await j.update(s,{name:t.name,description:t.description,milestone_id:t.milestone_id||null,status:t.status,progress:parseInt(t.progress)||0,assigned_to:t.assigned_to}),t.kpi_ids&&await j.syncKPILinks(s,t.kpi_ids),t.qs_ids&&await j.syncQSLinks(s,t.qs_ids),q(),b(),g("Deliverable updated!")}catch(l){d("Failed: "+l.message)}}async function Ne(s,t){try{let l=s.progress;t==="Not Started"?l=0:["Submitted for Review","Review Complete","Delivered"].includes(t)?l=100:t==="Returned for More Work"&&(l=50),await j.update(s.id,{status:t,progress:l}),q(),b(),g(`Status changed to ${t}`)}catch(l){d("Failed: "+l.message)}}function ye(s){W(s),R({}),i({}),L(!0)}async function Se(){if(!u)return;const s=u.deliverable_kpis||[],t=u.deliverable_quality_standards||[];if(s.length>0&&!s.every(l=>f[l.kpi_id]!==void 0)){p("Please assess all linked KPIs.");return}if(t.length>0&&!t.every(l=>I[l.quality_standard_id]!==void 0)){p("Please assess all linked Quality Standards.");return}try{if(await j.update(u.id,{status:"Delivered",progress:100}),s.length>0){const l=s.map(O=>({kpiId:O.kpi_id,criteriaMet:f[O.kpi_id]}));await j.upsertKPIAssessments(u.id,l,T)}if(t.length>0){const l=t.map(O=>({qsId:O.quality_standard_id,criteriaMet:I[O.quality_standard_id]}));await j.upsertQSAssessments(u.id,l,T)}g("Deliverable marked as delivered!"),L(!1),q()}catch(l){d("Failed: "+l.message)}}async function ke(s){if(confirm("Delete this deliverable?"))try{await j.delete(s,T),q(),g("Deleted")}catch(t){d("Failed: "+t.message)}}function Ce(s){ae({isOpen:!0,deliverable:s})}let y=z;A&&(y=y.filter(s=>s.milestone_id===A)),X&&(y=y.filter(s=>s.status===X)),V&&(y=y.filter(s=>s.status==="Submitted for Review"));const te=z.filter(s=>s.status==="Submitted for Review").length,ie=$,we=U,De=K;return Q?e.jsx(qe,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"deliverables-page",children:[e.jsx("header",{className:"del-header",children:e.jsxs("div",{className:"del-header-content",children:[e.jsxs("div",{className:"del-header-left",children:[e.jsx("div",{className:"del-header-icon",children:e.jsx(pe,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Deliverables"}),e.jsx("p",{children:"Track project deliverables with review workflow"})]})]}),e.jsxs("div",{className:"del-header-actions",children:[e.jsxs("button",{className:"del-btn del-btn-secondary",onClick:ve,disabled:M,children:[e.jsx(Je,{size:18,className:M?"spinning":""})," Refresh"]}),ie&&e.jsxs("button",{className:"del-btn del-btn-primary",onClick:()=>E(!N),children:[e.jsx(Ze,{size:18})," Add Deliverable"]})]})]})}),e.jsxs("div",{className:"del-content",children:[e.jsxs("div",{className:"del-filters",children:[e.jsxs("select",{value:A,onChange:s=>F(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Milestones"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:X,onChange:s=>ee(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Statuses"}),ts.map(s=>e.jsx("option",{value:s,children:s},s))]}),te>0&&e.jsxs("button",{onClick:()=>{je(!V),V||(F(""),ee(""))},className:`del-filter-badge ${V?"active":""}`,children:[e.jsx(Z,{size:16})," ",te," Awaiting Review"]})]}),N&&e.jsxs("div",{className:"del-add-form",children:[e.jsx("h3",{className:"del-add-form-title",children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:be,children:[e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Ref *"}),e.jsx("input",{type:"text",value:o.deliverable_ref,onChange:s=>P({...o,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{className:"del-form-group",style:{flex:2},children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:s=>P({...o,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:o.description,onChange:s=>P({...o,description:s.target.value})})]}),e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:o.milestone_id,onChange:s=>P({...o,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),h.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:o.assigned_to,onChange:s=>P({...o,assigned_to:s.target.value})})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"del-form-readonly",children:(()=>{const s=h.find(t=>t.id===o.milestone_id);return s?.forecast_end_date?new Date(s.forecast_end_date).toLocaleDateString("en-GB"):"Select milestone"})()})]})]}),e.jsx(is,{kpis:x,selectedIds:o.kpi_ids,onChange:s=>P({...o,kpi_ids:s})}),e.jsx(ns,{qualityStandards:C,selectedIds:o.qs_ids,onChange:s=>P({...o,qs_ids:s})}),e.jsxs("div",{className:"del-form-actions",children:[e.jsxs("button",{type:"submit",className:"del-btn del-btn-primary",children:[e.jsx(xe,{size:16})," Save"]}),e.jsxs("button",{type:"button",className:"del-btn del-btn-secondary",onClick:()=>E(!1),children:[e.jsx(he,{size:16})," Cancel"]})]})]})]}),e.jsxs("div",{className:"del-table-card",children:[e.jsxs("div",{className:"del-table-header",children:[e.jsx("h2",{className:"del-table-title",children:"Project Deliverables"}),e.jsxs("span",{className:"del-table-count",children:[y.length," deliverable",y.length!==1?"s":""]})]}),e.jsxs("table",{className:"del-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"del-empty-cell",children:"No deliverables found"})}):y.map(s=>{const t=re[s.status]||re["Not Started"],l=t.icon;return e.jsxs("tr",{onClick:()=>Ce(s),children:[e.jsx("td",{children:e.jsx("span",{className:"del-ref",children:s.deliverable_ref})}),e.jsx("td",{children:e.jsx("span",{className:"del-name",children:s.name})}),e.jsx("td",{children:s.milestones?e.jsx("span",{className:"del-milestone-link",children:s.milestones.milestone_ref}):"—"}),e.jsx("td",{children:e.jsxs("span",{className:"del-status-badge",style:{backgroundColor:t.bg,color:t.color},children:[e.jsx(l,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{className:"del-progress",children:[e.jsx("div",{className:"del-progress-bar",children:e.jsx("div",{className:"del-progress-fill",style:{width:`${s.progress||0}%`,backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{className:"del-progress-text",children:[s.progress||0,"%"]})]})})]},s.id)})})]})]})]}),e.jsx(as,{isOpen:se.isOpen,deliverable:se.deliverable,milestones:h,kpis:x,qualityStandards:C,canEdit:ie,canReview:we,canDelete:De,onClose:()=>ae({isOpen:!1,deliverable:null}),onSave:_e,onStatusChange:Ne,onDelete:ke,onOpenCompletion:ye}),B&&u&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal modal-lg",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h3",{className:"modal-title",children:[e.jsx(G,{size:20,style:{color:"var(--color-success)"}})," Mark as Delivered"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"var(--space-lg)"},children:[u.deliverable_ref," - ",u.name]}),u.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-warning-light)",borderLeft:"4px solid var(--color-warning)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)"},children:e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"})}),u.deliverable_kpis.map(s=>{const t=x.find(l=>l.id===s.kpi_id);return t?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-info",children:t.kpi_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:t.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>R({...f,[s.kpi_id]:!0}),className:`btn btn-sm ${f[s.kpi_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>R({...f,[s.kpi_id]:!1}),className:`btn btn-sm ${f[s.kpi_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.kpi_id):null})]}),u.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-purple-light)",borderLeft:"4px solid var(--color-purple)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)",marginTop:"var(--space-lg)"},children:e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment"})}),u.deliverable_quality_standards.map(s=>{const t=C.find(l=>l.id===s.quality_standard_id);return t?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-purple",children:t.qs_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:t.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>i({...I,[s.quality_standard_id]:!0}),className:`btn btn-sm ${I[s.quality_standard_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>i({...I,[s.quality_standard_id]:!1}),className:`btn btn-sm ${I[s.quality_standard_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.quality_standard_id):null})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>L(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:Se,children:[e.jsx(G,{size:16})," Mark Delivered"]})]})]})})]})}export{us as default};
