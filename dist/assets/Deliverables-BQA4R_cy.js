import{u as ye,a as ke,b as Ce,c as Se,m as we,k as Re,q as qe,s as f,j as e,L as De,P as Ne,d as C}from"./index-Dgce6IQC.js";import{r as d,L as Te}from"./vendor-react-JFEV0ROX.js";import{u as Ie}from"./usePermissions-B6r9lugc.js";import{P as ze,H as Ae,b as L,N as Y,a as Pe,u as We,s as Z,h as Me,a1 as ee,C as q,J as $,T as Fe}from"./vendor-icons-Bd7vp13O.js";import"./vendor-supabase-DgEUAXvv.js";const G=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],J={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:q},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:ee},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:L},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:Me},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:Z},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:We}};function X({kpis:y,selectedIds:c,onChange:n,label:h="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h}),c.length>0&&e.jsx("button",{type:"button",onClick:()=>n([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:y.map(a=>{const u=c.includes(a.id);return e.jsxs("div",{onClick:()=>n(u?c.filter(_=>_!==a.id):[...c,a.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:u?"#dbeafe":"#f8fafc",border:u?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.kpi_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:a.name})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[c.length," selected"]})]})}function V({qualityStandards:y,selectedIds:c,onChange:n,label:h="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h}),c.length>0&&e.jsx("button",{type:"button",onClick:()=>n([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:y.map(a=>{const u=c.includes(a.id);return e.jsxs("div",{onClick:()=>n(u?c.filter(_=>_!==a.id):[...c,a.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:u?"#f3e8ff":"#f8fafc",border:u?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.qs_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:a.name})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[c.length," selected"]})]})}function He(){const{user:y,role:c}=ye(),{projectId:n}=ke(),{showSuccess:h,showError:a,showWarning:u}=Ce(),{showTestUsers:_}=Se(),S=y?.id||null,{canEditDeliverable:se,canReviewDeliverable:ie}=Ie(),[k,re]=d.useState([]),[D,te]=d.useState([]),[N,le]=d.useState([]),[T,ae]=d.useState([]),[de,K]=d.useState(!0),[Q,I]=d.useState(!1),[ne,z]=d.useState(!1),[oe,A]=d.useState(!1),[o,ce]=d.useState(null),[g,P]=d.useState({}),[b,W]=d.useState({}),[M,H]=d.useState(""),[F,O]=d.useState(""),[w,ue]=d.useState(!1),[l,m]=d.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),[i,p]=d.useState({id:"",deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),j=d.useCallback(async()=>{if(n){K(!0);try{const s=await we.getAll(n,{orderBy:{column:"milestone_ref",ascending:!0}});te(s);const r=await Re.getAll(n,{orderBy:{column:"kpi_ref",ascending:!0}});le(r);const t=await qe.getAll(n,{orderBy:{column:"qs_ref",ascending:!0}});ae(t);let x=f.from("deliverables").select("*, milestones(milestone_ref, name), deliverable_kpis(kpi_id, kpis(kpi_ref, name)), deliverable_quality_standards(quality_standard_id, quality_standards(qs_ref, name))").eq("project_id",n).or("is_deleted.is.null,is_deleted.eq.false").order("deliverable_ref");_||(x=x.or("is_test_content.is.null,is_test_content.eq.false"));const{data:_e}=await x;re(_e||[])}catch{a("Failed to load deliverables")}finally{K(!1)}}},[n,_,a]);d.useEffect(()=>{j()},[j]);async function pe(s){s.preventDefault();try{const r=await C.create({project_id:n,deliverable_ref:l.deliverable_ref,name:l.name,description:l.description,milestone_id:l.milestone_id||null,status:l.status,progress:parseInt(l.progress)||0,assigned_to:l.assigned_to,due_date:l.due_date||null,created_by:S});l.kpi_ids.length>0&&await f.from("deliverable_kpis").insert(l.kpi_ids.map(t=>({deliverable_id:r.id,kpi_id:t}))),l.qs_ids.length>0&&await f.from("deliverable_quality_standards").insert(l.qs_ids.map(t=>({deliverable_id:r.id,quality_standard_id:t}))),m({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),I(!1),j(),h("Deliverable added!")}catch(r){a("Failed: "+r.message)}}function me(s){p({id:s.id,deliverable_ref:s.deliverable_ref,name:s.name,description:s.description||"",milestone_id:s.milestone_id||"",status:s.status,progress:s.progress||0,assigned_to:s.assigned_to||"",due_date:s.due_date||"",kpi_ids:s.deliverable_kpis?.map(r=>r.kpi_id)||[],qs_ids:s.deliverable_quality_standards?.map(r=>r.quality_standard_id)||[]}),z(!0)}async function xe(){try{await C.update(i.id,{name:i.name,description:i.description,milestone_id:i.milestone_id||null,status:i.status,progress:parseInt(i.progress)||0,assigned_to:i.assigned_to,due_date:i.due_date||null}),await f.from("deliverable_kpis").delete().eq("deliverable_id",i.id),i.kpi_ids.length>0&&await f.from("deliverable_kpis").insert(i.kpi_ids.map(s=>({deliverable_id:i.id,kpi_id:s}))),await f.from("deliverable_quality_standards").delete().eq("deliverable_id",i.id),i.qs_ids.length>0&&await f.from("deliverable_quality_standards").insert(i.qs_ids.map(s=>({deliverable_id:i.id,quality_standard_id:s}))),z(!1),j(),h("Deliverable updated!")}catch(s){a("Failed: "+s.message)}}async function E(s,r){try{let t=s.progress;r==="Not Started"?t=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?t=100:r==="Returned for More Work"&&(t=50),await C.update(s.id,{status:r,progress:t}),j()}catch(t){a("Failed: "+t.message)}}function fe(s){ce(s),P({}),W({}),A(!0)}async function he(){if(!o)return;const s=o.deliverable_kpis||[],r=o.deliverable_quality_standards||[];if(s.length>0&&!s.every(t=>g[t.kpi_id]!==void 0)){u("Please assess all linked KPIs.");return}if(r.length>0&&!r.every(t=>b[t.quality_standard_id]!==void 0)){u("Please assess all linked Quality Standards.");return}try{await C.update(o.id,{status:"Delivered",progress:100});for(const t of s)await f.from("deliverable_kpi_assessments").upsert({deliverable_id:o.id,kpi_id:t.kpi_id,criteria_met:g[t.kpi_id],assessed_at:new Date().toISOString(),assessed_by:S},{onConflict:"deliverable_id,kpi_id"});for(const t of r)await f.from("deliverable_qs_assessments").upsert({deliverable_id:o.id,quality_standard_id:t.quality_standard_id,criteria_met:b[t.quality_standard_id],assessed_at:new Date().toISOString(),assessed_by:S},{onConflict:"deliverable_id,quality_standard_id"});h("Deliverable marked as delivered!"),A(!1),j()}catch(t){a("Failed: "+t.message)}}async function ge(s){if(confirm("Delete this deliverable?"))try{await C.delete(s,S),j(),h("Deleted")}catch(r){a("Failed: "+r.message)}}let v=k;M&&(v=v.filter(s=>s.milestone_id===M)),F&&(v=v.filter(s=>s.status===F)),w&&(v=v.filter(s=>s.status==="Submitted for Review"));const be=k.length,B=k.filter(s=>s.status==="Submitted for Review").length,ve=k.filter(s=>s.status==="In Progress").length,je=k.filter(s=>s.status==="Delivered").length,R=se,U=ie;return de?e.jsx(De,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(Ne,{icon:ze,title:"Deliverables",subtitle:"Track project deliverables with review workflow",children:R&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>I(!Q),children:[e.jsx(Ae,{size:18})," Add Deliverable"]})}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Total"}),e.jsx("div",{className:"stat-value",children:be})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#d97706"},children:"For Review"}),e.jsx("div",{className:"stat-value",style:{color:"#d97706"},children:B})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#4f46e5"},children:"In Progress"}),e.jsx("div",{className:"stat-value",style:{color:"#4f46e5"},children:ve})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#16a34a"},children:"Delivered"}),e.jsx("div",{className:"stat-value",style:{color:"#16a34a"},children:je})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap"},children:[e.jsxs("select",{value:M,onChange:s=>H(s.target.value),style:{minWidth:"200px"},children:[e.jsx("option",{value:"",children:"All Milestones"}),D.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:F,onChange:s=>O(s.target.value),style:{minWidth:"150px"},children:[e.jsx("option",{value:"",children:"All Statuses"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]}),B>0&&e.jsxs("button",{onClick:()=>{ue(!w),w||(H(""),O(""))},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:w?"#fef3c7":"#fffbeb",border:"1px solid #fbbf24",borderRadius:"6px",color:"#92400e",cursor:"pointer",fontWeight:"500"},children:[e.jsx(L,{size:16})," ",B," Awaiting Review"]})]}),Q&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Ref *"}),e.jsx("input",{type:"text",value:l.deliverable_ref,onChange:s=>m({...l,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>m({...l,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:s=>m({...l,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>m({...l,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),D.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:l.assigned_to,onChange:s=>m({...l,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:l.due_date,onChange:s=>m({...l,due_date:s.target.value})})]})]}),e.jsx(X,{kpis:N,selectedIds:l.kpi_ids,onChange:s=>m({...l,kpi_ids:s})}),e.jsx(V,{qualityStandards:T,selectedIds:l.qs_ids,onChange:s=>m({...l,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",children:[e.jsx(Y,{size:16})," Save"]}),e.jsxs("button",{type:"button",className:"btn-secondary",onClick:()=>I(!1),children:[e.jsx(Pe,{size:16})," Cancel"]})]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"KPIs"}),e.jsx("th",{children:"QS"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No deliverables found"})}):v.map(s=>{const r=J[s.status]||J["Not Started"],t=r.icon;return e.jsxs("tr",{children:[e.jsx("td",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverable_ref}),e.jsx("td",{style:{fontWeight:"500"},children:s.name}),e.jsx("td",{children:s.milestones?e.jsx(Te,{to:`/milestones/${s.milestone_id}`,style:{color:"#3b82f6"},children:s.milestones.milestone_ref}):"-"}),e.jsx("td",{children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem",backgroundColor:r.bg,color:r.color},children:[e.jsx(t,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${s.progress||0}%`,height:"100%",backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{style:{fontSize:"0.85rem"},children:[s.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:s.deliverable_kpis?.map(x=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#dbeafe",color:"#2563eb",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:x.kpis?.kpi_ref},x.kpi_id))})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:s.deliverable_quality_standards?.map(x=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f3e8ff",color:"#7c3aed",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:x.quality_standards?.qs_ref},x.quality_standard_id))})}),e.jsx("td",{children:s.due_date?new Date(s.due_date).toLocaleDateString("en-GB"):"-"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[R&&e.jsx("button",{onClick:()=>me(s),title:"Edit",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#64748b"},children:e.jsx($,{size:16})}),R&&["In Progress","Returned for More Work"].includes(s.status)&&e.jsx("button",{onClick:()=>E(s,"Submitted for Review"),title:"Submit",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#d97706"},children:e.jsx(L,{size:16})}),U&&s.status==="Submitted for Review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(s,"Review Complete"),title:"Accept",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#2563eb"},children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>E(s,"Returned for More Work"),title:"Return",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(Z,{size:16})})]}),U&&s.status==="Review Complete"&&e.jsx("button",{onClick:()=>fe(s),title:"Deliver",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#16a34a"},children:e.jsx(q,{size:16})}),R&&e.jsx("button",{onClick:()=>ge(s.id),title:"Delete",style:{padding:"0.25rem",background:"none",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(Fe,{size:16})})]})})]},s.id)})})]})}),ne&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{children:[e.jsx($,{size:20})," Edit ",i.deliverable_ref]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Ref"}),e.jsx("input",{type:"text",value:i.deliverable_ref,disabled:!0,style:{backgroundColor:"#f1f5f9"}})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:s=>p({...i,name:s.target.value})})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>p({...i,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:i.milestone_id,onChange:s=>p({...i,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),D.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:i.assigned_to,onChange:s=>p({...i,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:i.due_date,onChange:s=>p({...i,due_date:s.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Status"}),e.jsx("select",{value:i.status,onChange:s=>{const r=s.target.value;let t=i.progress;r==="Not Started"?t=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?t=100:r==="Returned for More Work"&&(t=50),p({...i,status:r,progress:t})},children:G.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{children:["Progress: ",i.progress,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:i.progress,onChange:s=>p({...i,progress:parseInt(s.target.value)}),style:{width:"100%"},disabled:["Delivered","Submitted for Review","Review Complete"].includes(i.status)})]})]}),e.jsx(X,{kpis:N,selectedIds:i.kpi_ids,onChange:s=>p({...i,kpi_ids:s})}),e.jsx(V,{qualityStandards:T,selectedIds:i.qs_ids,onChange:s=>p({...i,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>z(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:xe,children:[e.jsx(Y,{size:16})," Save"]})]})]})}),oe&&o&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"700px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{children:[e.jsx(q,{size:20,style:{color:"#16a34a"}})," Mark as Delivered"]}),e.jsxs("p",{style:{color:"#64748b"},children:[o.deliverable_ref," - ",o.name]}),o.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderLeft:"4px solid #f59e0b",borderRadius:"4px",marginBottom:"1rem"},children:e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"})}),o.deliverable_kpis.map(s=>{const r=N.find(t=>t.id===s.kpi_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",marginRight:"0.5rem"},children:r.kpi_ref}),e.jsx("strong",{children:r.name})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>P({...g,[s.kpi_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:g[s.kpi_id]===!0?"#16a34a":"#f1f5f9",color:g[s.kpi_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>P({...g,[s.kpi_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:g[s.kpi_id]===!1?"#dc2626":"#f1f5f9",color:g[s.kpi_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]},s.kpi_id):null})]}),o.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#f3e8ff",borderLeft:"4px solid #8b5cf6",borderRadius:"4px",marginBottom:"1rem",marginTop:"1rem"},children:e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment"})}),o.deliverable_quality_standards.map(s=>{const r=T.find(t=>t.id===s.quality_standard_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",marginRight:"0.5rem"},children:r.qs_ref}),e.jsx("strong",{children:r.name})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>W({...b,[s.quality_standard_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:b[s.quality_standard_id]===!0?"#16a34a":"#f1f5f9",color:b[s.quality_standard_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>W({...b,[s.quality_standard_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:b[s.quality_standard_id]===!1?"#dc2626":"#f1f5f9",color:b[s.quality_standard_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]},s.quality_standard_id):null})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:he,style:{backgroundColor:"#16a34a"},children:[e.jsx(q,{size:16})," Mark Delivered"]})]})]})})]})}export{He as default};
