import{c as Ce,r as n,a as we,b as Se,d as Re,n as qe,s as d,j as e,L as De,P as Te,l as ze,o as K,X as Ie,A as Ne,p as ie,k as Pe,C as T,e as Ae,T as We,I as Me}from"./index-bXTId5SU.js";import{u as Fe}from"./usePermissions-BVDnOyEP.js";import{P as Le}from"./plus-D7oGuyuR.js";import{S as J}from"./save-CZ-sDznj.js";import{P as V}from"./pen-DT4Lwjy-.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Ce("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]),ee=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],se={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:T},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:le},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:K},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:Pe},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:ie},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:Ne}};function re({kpis:h,selectedIds:o,onChange:u,label:k="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[k," (select all that apply)"]}),o.length>0&&e.jsx("button",{type:"button",onClick:()=>u([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear all"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:h.map(a=>{const m=o.includes(a.id);return e.jsxs("div",{onClick:()=>{u(m?o.filter(y=>y!==a.id):[...o,a.id])},style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:m?"#dbeafe":"#f8fafc",border:m?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{marginTop:"3px",width:"18px",height:"18px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.kpi_ref}),e.jsx("span",{style:{fontWeight:"600"},children:a.name})]}),a.description&&e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"#64748b",lineHeight:"1.4"},children:[a.description.substring(0,100),"..."]}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#16a34a",fontWeight:"500"},children:["Target: ",a.target,"%"]})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[o.length," KPI",o.length!==1?"s":""," selected"]})]})}function te({qualityStandards:h,selectedIds:o,onChange:u,label:k="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[k," (select all that apply)"]}),o.length>0&&e.jsx("button",{type:"button",onClick:()=>u([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear all"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:h.map(a=>{const m=o.includes(a.id);return e.jsxs("div",{onClick:()=>{u(m?o.filter(y=>y!==a.id):[...o,a.id])},style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:m?"#f3e8ff":"#f8fafc",border:m?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{marginTop:"3px",width:"18px",height:"18px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.qs_ref}),e.jsx("span",{style:{fontWeight:"600"},children:a.name})]}),a.description&&e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"#64748b",lineHeight:"1.4"},children:[a.description.substring(0,100),"..."]}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#16a34a",fontWeight:"500"},children:["Target: ",a.target,"%"]})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[o.length," Quality Standard",o.length!==1?"s":""," selected"]})]})}function Oe(){var X,Z;const[h,o]=n.useState([]),[u,k]=n.useState([]),[a,m]=n.useState([]),[y,ae]=n.useState([]),[ne,de]=n.useState(!0),[B,z]=n.useState(!1),[oe,I]=n.useState(!1),[ce,N]=n.useState(!1),[p,pe]=n.useState(null),[j,P]=n.useState({}),[v,A]=n.useState({}),[W,H]=n.useState(""),[M,U]=n.useState(""),[R,ue]=n.useState(!1),{user:F,role:Ee}=we(),{projectId:g}=Se(),{showSuccess:me,showError:C,showWarning:O}=Re(),L=(F==null?void 0:F.id)||null,{canEditDeliverable:fe,canReviewDeliverable:he}=Fe(),{showTestUsers:Y}=qe(),[l,x]=n.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),[t,f]=n.useState({id:"",deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]});n.useEffect(()=>{g&&_()},[g]),n.useEffect(()=>{g&&_()},[Y]);async function _(){if(g)try{const{data:s}=await d.from("milestones").select("*").eq("project_id",g).order("milestone_ref");k(s||[]);const{data:r}=await d.from("kpis").select("*").eq("project_id",g).order("kpi_ref");m(r||[]);const{data:i}=await d.from("quality_standards").select("*").eq("project_id",g).order("qs_ref");ae(i||[]);let c=d.from("deliverables").select("*, milestones(milestone_ref, name), deliverable_kpis(kpi_id, kpis(kpi_ref, name)), deliverable_quality_standards(quality_standard_id, quality_standards(qs_ref, name))").eq("project_id",g).order("deliverable_ref");Y||(c=c.or("is_test_content.is.null,is_test_content.eq.false"));const{data:D}=await c;o(D||[])}catch(s){console.error("Error:",s)}finally{de(!1)}}async function ge(s){s.preventDefault();try{const{data:r,error:i}=await d.from("deliverables").insert({project_id:g,deliverable_ref:l.deliverable_ref,name:l.name,description:l.description,milestone_id:l.milestone_id||null,status:l.status,progress:parseInt(l.progress)||0,assigned_to:l.assigned_to,due_date:l.due_date||null,created_by:L}).select().single();if(i)throw i;l.kpi_ids.length>0&&await d.from("deliverable_kpis").insert(l.kpi_ids.map(c=>({deliverable_id:r.id,kpi_id:c}))),l.qs_ids.length>0&&await d.from("deliverable_quality_standards").insert(l.qs_ids.map(c=>({deliverable_id:r.id,quality_standard_id:c}))),x({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),z(!1),_()}catch(r){C("Failed: "+r.message)}}function xe(s){var r,i;f({id:s.id,deliverable_ref:s.deliverable_ref,name:s.name,description:s.description||"",milestone_id:s.milestone_id||"",status:s.status,progress:s.progress||0,assigned_to:s.assigned_to||"",due_date:s.due_date||"",kpi_ids:((r=s.deliverable_kpis)==null?void 0:r.map(c=>c.kpi_id))||[],qs_ids:((i=s.deliverable_quality_standards)==null?void 0:i.map(c=>c.quality_standard_id))||[]}),I(!0)}async function be(){try{await d.from("deliverables").update({name:t.name,description:t.description,milestone_id:t.milestone_id||null,status:t.status,progress:parseInt(t.progress)||0,assigned_to:t.assigned_to,due_date:t.due_date||null}).eq("id",t.id),await d.from("deliverable_kpis").delete().eq("deliverable_id",t.id),t.kpi_ids.length>0&&await d.from("deliverable_kpis").insert(t.kpi_ids.map(s=>({deliverable_id:t.id,kpi_id:s}))),await d.from("deliverable_quality_standards").delete().eq("deliverable_id",t.id),t.qs_ids.length>0&&await d.from("deliverable_quality_standards").insert(t.qs_ids.map(s=>({deliverable_id:t.id,quality_standard_id:s}))),I(!1),_()}catch(s){C("Failed: "+s.message)}}async function E(s,r){try{let i=s.progress;r==="Not Started"?i=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?i=100:r==="Returned for More Work"&&(i=50),await d.from("deliverables").update({status:r,progress:i}).eq("id",s.id),_()}catch(i){C("Failed: "+i.message)}}function je(s){pe(s),P({}),A({}),N(!0)}async function ve(){if(!p)return;const s=p.deliverable_kpis||[],r=p.deliverable_quality_standards||[];if(s.length>0&&!s.every(i=>j[i.kpi_id]!==void 0)){O("Please assess all linked KPIs.");return}if(r.length>0&&!r.every(i=>v[i.quality_standard_id]!==void 0)){O("Please assess all linked Quality Standards.");return}try{await d.from("deliverables").update({status:"Delivered",progress:100}).eq("id",p.id);for(const i of s)await d.from("deliverable_kpi_assessments").upsert({deliverable_id:p.id,kpi_id:i.kpi_id,criteria_met:j[i.kpi_id],assessed_at:new Date().toISOString(),assessed_by:L},{onConflict:"deliverable_id,kpi_id"});for(const i of r)await d.from("deliverable_qs_assessments").upsert({deliverable_id:p.id,quality_standard_id:i.quality_standard_id,criteria_met:v[i.quality_standard_id],assessed_at:new Date().toISOString(),assessed_by:L},{onConflict:"deliverable_id,quality_standard_id"});me("Deliverable marked as delivered and assessments saved!"),N(!1),_()}catch(i){C("Failed: "+i.message)}}async function ye(s){if(confirm("Delete this deliverable?"))try{await d.from("deliverables").delete().eq("id",s),_()}catch(r){C("Failed: "+r.message)}}let b=h;W&&(b=b.filter(s=>s.milestone_id===W)),M&&(b=b.filter(s=>s.status===M)),R&&(b=b.filter(s=>s.status==="Submitted for Review"));const $=h.length,Q=h.filter(s=>s.status==="Submitted for Review").length,_e=h.filter(s=>s.status==="In Progress").length,ke=h.filter(s=>s.status==="Delivered").length,q=fe,G=he;return ne?e.jsx(De,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(Te,{icon:ze,title:"Deliverables",subtitle:"Track project deliverables with review workflow",children:q&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>z(!B),children:[e.jsx(Le,{size:18})," Add Deliverable"]})}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Total Deliverables"}),e.jsx("div",{className:"stat-value",children:$})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#d97706"},children:"Submitted for Review"}),e.jsx("div",{className:"stat-value",style:{color:"#d97706"},children:Q})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#4f46e5"},children:"In Progress"}),e.jsx("div",{className:"stat-value",style:{color:"#4f46e5"},children:_e})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#16a34a"},children:"Delivered"}),e.jsx("div",{className:"stat-value",style:{color:"#16a34a"},children:ke})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#64748b"},children:"Filter by:"}),e.jsxs("select",{value:W,onChange:s=>H(s.target.value),style:{minWidth:"200px"},children:[e.jsx("option",{value:"",children:"All Milestones"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:M,onChange:s=>U(s.target.value),style:{minWidth:"150px"},children:[e.jsx("option",{value:"",children:"All Statuses"}),ee.map(s=>e.jsx("option",{value:s,children:s},s))]}),Q>0&&e.jsxs("button",{onClick:()=>{ue(!R),R||(H(""),U(""))},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:R?"#fef3c7":"#fffbeb",border:"1px solid #fbbf24",borderRadius:"6px",color:"#92400e",cursor:"pointer",fontWeight:"500"},children:[e.jsx(K,{size:16})," ",Q," Awaiting Review"]}),e.jsxs("span",{style:{color:"#64748b",marginLeft:"auto"},children:["Showing ",b.length," of ",$]})]}),B&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Reference *"}),e.jsx("input",{type:"text",value:l.deliverable_ref,onChange:s=>x({...l,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>x({...l,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:s=>x({...l,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>x({...l,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:l.assigned_to,onChange:s=>x({...l,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:l.due_date,onChange:s=>x({...l,due_date:s.target.value})})]})]}),e.jsx(re,{kpis:a,selectedIds:l.kpi_ids,onChange:s=>x({...l,kpi_ids:s})}),e.jsx(te,{qualityStandards:y,selectedIds:l.qs_ids,onChange:s=>x({...l,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",children:[e.jsx(J,{size:16})," Save Deliverable"]}),e.jsxs("button",{type:"button",className:"btn-secondary",onClick:()=>z(!1),children:[e.jsx(Ie,{size:16})," Cancel"]})]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"KPIs"}),e.jsx("th",{children:"Quality"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No deliverables found"})}):b.map(s=>{var c,D;const r=se[s.status]||se["Not Started"],i=r.icon;return e.jsxs("tr",{style:{backgroundColor:s.status==="Submitted for Review"?"#fffbeb":void 0},children:[e.jsx("td",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverable_ref}),e.jsx("td",{style:{fontWeight:"500"},children:s.name}),e.jsx("td",{children:s.milestones?e.jsx(Ae,{to:`/milestones/${s.milestone_id}`,style:{color:"#3b82f6",textDecoration:"none"},children:s.milestones.milestone_ref}):"-"}),e.jsx("td",{children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem",backgroundColor:r.bg,color:r.color},children:[e.jsx(i,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${s.progress||0}%`,height:"100%",backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:[s.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:(c=s.deliverable_kpis)==null?void 0:c.map(w=>{var S;return e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#dbeafe",color:"#2563eb",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:(S=w.kpis)==null?void 0:S.kpi_ref},w.kpi_id)})})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:(D=s.deliverable_quality_standards)==null?void 0:D.map(w=>{var S;return e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f3e8ff",color:"#7c3aed",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:(S=w.quality_standards)==null?void 0:S.qs_ref},w.quality_standard_id)})})}),e.jsx("td",{children:s.due_date?new Date(s.due_date).toLocaleDateString("en-GB"):"-"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[q&&e.jsx("button",{onClick:()=>xe(s),title:"Edit",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#64748b"},children:e.jsx(V,{size:16})}),q&&["In Progress","Returned for More Work"].includes(s.status)&&e.jsx("button",{onClick:()=>E(s,"Submitted for Review"),title:"Submit for Review",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#d97706"},children:e.jsx(K,{size:16})}),G&&s.status==="Submitted for Review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(s,"Review Complete"),title:"Accept",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563eb"},children:e.jsx(le,{size:16})}),e.jsx("button",{onClick:()=>E(s,"Returned for More Work"),title:"Return for More Work",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(ie,{size:16})})]}),G&&s.status==="Review Complete"&&e.jsx("button",{onClick:()=>je(s),title:"Mark Delivered",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#16a34a"},children:e.jsx(T,{size:16})}),q&&e.jsx("button",{onClick:()=>ye(s.id),title:"Delete",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(We,{size:16})})]})})]},s.id)})})]})}),oe&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:0},children:[e.jsx(V,{size:20})," Edit Deliverable - ",t.deliverable_ref]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:t.deliverable_ref,disabled:!0,style:{backgroundColor:"#f1f5f9"}})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>f({...t,name:s.target.value})})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>f({...t,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:t.milestone_id,onChange:s=>f({...t,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),u.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:t.assigned_to,onChange:s=>f({...t,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:t.due_date,onChange:s=>f({...t,due_date:s.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Status"}),e.jsx("select",{value:t.status,onChange:s=>{const r=s.target.value;let i=t.progress;r==="Not Started"?i=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?i=100:r==="Returned for More Work"&&(i=50),f({...t,status:r,progress:i})},children:ee.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{children:["Progress: ",t.progress,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.progress,onChange:s=>{const r=parseInt(s.target.value);let i=t.status;r===0&&t.status!=="Returned for More Work"?i="Not Started":r>0&&r<100&&t.status==="Not Started"&&(i="In Progress"),f({...t,progress:r,status:i})},style:{width:"100%"},disabled:["Delivered","Submitted for Review","Review Complete"].includes(t.status)})]})]}),e.jsx(re,{kpis:a,selectedIds:t.kpi_ids,onChange:s=>f({...t,kpi_ids:s})}),e.jsx(te,{qualityStandards:y,selectedIds:t.qs_ids,onChange:s=>f({...t,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>I(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:be,children:[e.jsx(J,{size:16})," Save Changes"]})]})]})}),ce&&p&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"700px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:0},children:[e.jsx(T,{size:20,style:{color:"#16a34a"}})," Mark as Delivered"]}),e.jsxs("p",{style:{color:"#64748b"},children:[p.deliverable_ref," - ",p.name]}),((X=p.deliverable_kpis)==null?void 0:X.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderLeft:"4px solid #f59e0b",borderRadius:"4px",marginBottom:"1rem"},children:[e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#92400e",fontSize:"0.9rem"},children:"Assess whether each KPI criteria was met."})]}),p.deliverable_kpis.map(s=>{const r=a.find(i=>i.id===s.kpi_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700",marginRight:"0.5rem"},children:r.kpi_ref}),e.jsx("strong",{children:r.name}),e.jsxs("p",{style:{fontSize:"0.85rem",color:"#16a34a",margin:"0.25rem 0"},children:["Target: ",r.target,"%"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>P({...j,[s.kpi_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:j[s.kpi_id]===!0?"#16a34a":"#f1f5f9",color:j[s.kpi_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>P({...j,[s.kpi_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:j[s.kpi_id]===!1?"#dc2626":"#f1f5f9",color:j[s.kpi_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]}),r.description&&e.jsxs("p",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",borderRadius:"4px",fontSize:"0.85rem",color:"#64748b"},children:[e.jsx("strong",{children:"Criteria:"})," ",r.description]})]},s.kpi_id):null})]}),((Z=p.deliverable_quality_standards)==null?void 0:Z.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#f3e8ff",borderLeft:"4px solid #8b5cf6",borderRadius:"4px",marginBottom:"1rem",marginTop:"1rem"},children:[e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment Required"}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#6b21a8",fontSize:"0.9rem"},children:"Assess whether each Quality Standard was met."})]}),p.deliverable_quality_standards.map(s=>{const r=y.find(i=>i.id===s.quality_standard_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700",marginRight:"0.5rem"},children:r.qs_ref}),e.jsx("strong",{children:r.name}),e.jsxs("p",{style:{fontSize:"0.85rem",color:"#16a34a",margin:"0.25rem 0"},children:["Target: ",r.target,"%"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>A({...v,[s.quality_standard_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:v[s.quality_standard_id]===!0?"#16a34a":"#f1f5f9",color:v[s.quality_standard_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>A({...v,[s.quality_standard_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:v[s.quality_standard_id]===!1?"#dc2626":"#f1f5f9",color:v[s.quality_standard_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]}),r.description&&e.jsxs("p",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",borderRadius:"4px",fontSize:"0.85rem",color:"#64748b"},children:[e.jsx("strong",{children:"Criteria:"})," ",r.description]}),r.measurement_criteria&&e.jsxs("p",{style:{marginTop:"0.25rem",padding:"0.5rem",backgroundColor:"#fefce8",borderRadius:"4px",fontSize:"0.85rem",color:"#a16207"},children:[e.jsx("strong",{children:"Measurement:"})," ",r.measurement_criteria]})]},s.quality_standard_id):null})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:ve,style:{backgroundColor:"#16a34a"},children:[e.jsx(T,{size:16})," Mark as Delivered"]})]})]})}),e.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0fdf4",borderLeft:"4px solid #16a34a",borderRadius:"4px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx(Me,{size:20,style:{color:"#16a34a",marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"Deliverable Workflow"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",color:"#166534",fontSize:"0.9rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"In Progress:"})," Contributor working on deliverable (can update progress %)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Submit for Review:"})," Contributor completes work and submits (sets progress to 100%)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Review:"})," Admin/Customer PM approves or returns for more work"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mark as Delivered:"})," After approval, assess KPIs and Quality Standards, then mark as delivered"]})]})]})]})})]})}export{Oe as default};
