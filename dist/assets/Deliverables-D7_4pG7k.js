import{j as e,u as _e,a as ke,b as Se,f as Ce,g as we,m as Ne,k as Re,q as De,d as g,L as Ie}from"./index-DZjyoUhu.js";import{r as d,L as ze}from"./vendor-react-JFEV0ROX.js";import{u as Te}from"./usePermissions-CeYhrlnU.js";import{P as We}from"./PageHeader-BxUOSgWa.js";import{y as ae,w as J,k as B,e as Q,J as X,C as L,P as ne,a as le,F as Pe,U as Ae,a1 as qe,a0 as Me,i as Be,T as Le,Z as de,Y as Fe,W as Ke}from"./vendor-icons-CiBQmrAI.js";import"./vendor-supabase-DgEUAXvv.js";const ie={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:L},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:X},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:Q},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:B},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:J},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:ae}};function Qe({isOpen:k,deliverable:t,milestones:c,kpis:f,qualityStandards:l,canEdit:p,canReview:y,canDelete:I,onClose:U,onSave:O,onStatusChange:E,onDelete:W,onOpenCompletion:S}){const[P,j]=d.useState(!1),[o,x]=d.useState({});if(d.useEffect(()=>{t&&(x({name:t.name||"",description:t.description||"",milestone_id:t.milestone_id||"",status:t.status||"Not Started",progress:t.progress||0,assigned_to:t.assigned_to||"",due_date:t.due_date||"",kpi_ids:t.deliverable_kpis?.map(r=>r.kpi_id)||[],qs_ids:t.deliverable_quality_standards?.map(r=>r.quality_standard_id)||[]}),j(!1))},[t]),!k||!t)return null;const C=ie[t.status]||ie["Not Started"],A=C.icon,z=c?.find(r=>r.id===t.milestone_id),q=t.deliverable_kpis||[],T=t.deliverable_quality_standards||[],F=p&&["In Progress","Returned for More Work"].includes(t.status),M=y&&t.status==="Submitted for Review",$=y&&t.status==="Review Complete",w=t.status==="Delivered";async function m(){await O(t.id,o),j(!1)}function N(){j(!1),U()}function h(r){E(t,r),N()}return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:N,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"700px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 1.5rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"8px",backgroundColor:C.bg,color:C.color},children:e.jsx(ne,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:t.deliverable_ref}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:t.name})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:C.bg,color:C.color},children:[e.jsx(A,{size:14}),t.status]}),e.jsx("button",{onClick:N,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b"},children:e.jsx(le,{size:24})})]})]}),e.jsx("div",{style:{padding:"1.5rem"},children:P?e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Name *"}),e.jsx("input",{type:"text",className:"form-input",value:o.name,onChange:r=>x({...o,name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:o.description,onChange:r=>x({...o,description:r.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Milestone"}),e.jsxs("select",{className:"form-input",value:o.milestone_id,onChange:r=>x({...o,milestone_id:r.target.value}),children:[e.jsx("option",{value:"",children:"-- Select milestone --"}),c?.map(r=>e.jsxs("option",{value:r.id,children:[r.milestone_ref," - ",r.name]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Due Date"}),e.jsx("input",{type:"date",className:"form-input",value:o.due_date,onChange:r=>x({...o,due_date:r.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Assigned To"}),e.jsx("input",{type:"text",className:"form-input",value:o.assigned_to,onChange:r=>x({...o,assigned_to:r.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:["Progress: ",o.progress,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:o.progress,onChange:r=>{const b=parseInt(r.target.value),R={progress:b};b>0&&o.status==="Not Started"?R.status="In Progress":b===0&&o.status==="In Progress"&&(R.status="Not Started"),x({...o,...R})},style:{width:"100%"},disabled:["Delivered","Submitted for Review","Review Complete"].includes(o.status)})]})]})]}):e.jsxs("div",{style:{display:"grid",gap:"1.25rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Pe,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Milestone"}),e.jsx("div",{style:{fontWeight:"500"},children:z?e.jsxs(ze,{to:`/milestones/${z.id}`,style:{color:"#3b82f6"},children:[z.milestone_ref," - ",z.name]}):"Not assigned"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Ae,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Assigned To"}),e.jsx("div",{style:{fontWeight:"500"},children:t.assigned_to||"Unassigned"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(qe,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Due Date"}),e.jsx("div",{style:{fontWeight:"500"},children:t.due_date?new Date(t.due_date).toLocaleDateString("en-GB"):"Not set"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(B,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Progress"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"80px",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.progress||0}%`,height:"100%",backgroundColor:w?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{style:{fontWeight:"600"},children:[t.progress||0,"%"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.375rem"},children:"Description"}),e.jsx("div",{style:{fontSize:"0.9375rem"},children:t.description||"No description provided"})]}),q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.5rem"},children:[e.jsx(Me,{size:14}),"Linked KPIs (",q.length,")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:q.map(r=>e.jsxs("span",{style:{padding:"0.25rem 0.625rem",backgroundColor:"#dbeafe",color:"#2563eb",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"500"},children:[r.kpis?.kpi_ref||"KPI"," - ",r.kpis?.name||"Unknown"]},r.kpi_id))})]}),T.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.5rem"},children:[e.jsx(Be,{size:14}),"Linked Quality Standards (",T.length,")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:T.map(r=>e.jsxs("span",{style:{padding:"0.25rem 0.625rem",backgroundColor:"#f3e8ff",color:"#7c3aed",borderRadius:"4px",fontSize:"0.8rem",fontWeight:"500"},children:[r.quality_standards?.qs_ref||"QS"," - ",r.quality_standards?.name||"Unknown"]},r.quality_standard_id))})]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.8125rem",color:"#64748b",paddingTop:"0.75rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(B,{size:14}),"Created: ",t.created_at?new Date(t.created_at).toLocaleString("en-GB"):"Unknown"]}),t.updated_at&&t.updated_at!==t.created_at&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(B,{size:14}),"Updated: ",new Date(t.updated_at).toLocaleString("en-GB")]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsx("div",{children:I&&!P&&!w&&e.jsxs("button",{onClick:()=>{W(t.id),N()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Le,{size:16})," Delete"]})}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:P?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:m,className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(de,{size:16})," Save Changes"]})]}):e.jsxs(e.Fragment,{children:[F&&e.jsxs("button",{onClick:()=>h("Submitted for Review"),className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Q,{size:16})," Submit for Review"]}),M&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h("Returned for More Work"),className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(J,{size:16})," Return for More Work"]}),e.jsxs("button",{onClick:()=>h("Review Complete"),className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(X,{size:16})," Accept Review"]})]}),$&&e.jsxs("button",{onClick:()=>{S(t),N()},className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(L,{size:16})," Mark as Delivered"]}),p&&!w&&e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Fe,{size:16})," Edit"]})]})})]})]})})}const Ue=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],re={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:L},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:X},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:Q},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:B},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:J},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:ae}};function Oe({kpis:k,selectedIds:t,onChange:c,label:f="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:f}),t.length>0&&e.jsx("button",{type:"button",onClick:()=>c([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:k.map(l=>{const p=t.includes(l.id);return e.jsxs("div",{onClick:()=>c(p?t.filter(y=>y!==l.id):[...t,l.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#dbeafe":"#f8fafc",border:p?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:l.kpi_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:l.name})]})]},l.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[t.length," selected"]})]})}function Ee({qualityStandards:k,selectedIds:t,onChange:c,label:f="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:f}),t.length>0&&e.jsx("button",{type:"button",onClick:()=>c([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:k.map(l=>{const p=t.includes(l.id);return e.jsxs("div",{onClick:()=>c(p?t.filter(y=>y!==l.id):[...t,l.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#f3e8ff":"#f8fafc",border:p?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:l.qs_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:l.name})]})]},l.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[t.length," selected"]})]})}function Ze(){const{user:k,role:t}=_e(),{projectId:c}=ke(),{showSuccess:f,showError:l,showWarning:p}=Se(),{showTestUsers:y}=Ce(),I=k?.id||null,{canEditDeliverable:U,canReviewDeliverable:O,canDeleteDeliverable:E}=Te(),{refreshMetrics:W}=we(),[S,P]=d.useState([]),[j,o]=d.useState([]),[x,C]=d.useState([]),[A,z]=d.useState([]),[q,T]=d.useState(!0),[F,M]=d.useState(!1),[$,w]=d.useState(!1),[m,N]=d.useState(null),[h,r]=d.useState({}),[b,R]=d.useState({}),[Y,Z]=d.useState(""),[G,V]=d.useState(""),[K,oe]=d.useState(!1),[ee,se]=d.useState({isOpen:!1,deliverable:null}),[a,v]=d.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),D=d.useCallback(async()=>{if(c){T(!0);try{const s=await Ne.getAll(c,{orderBy:{column:"milestone_ref",ascending:!0}});o(s);const i=await Re.getAll(c,{orderBy:{column:"kpi_ref",ascending:!0}});C(i);const n=await De.getAll(c,{orderBy:{column:"qs_ref",ascending:!0}});z(n);const u=await g.getAllWithRelations(c,y);P(u||[])}catch{l("Failed to load deliverables")}finally{T(!1)}}},[c,y,l]);d.useEffect(()=>{D()},[D]);async function ce(s){s.preventDefault();try{const i=await g.create({project_id:c,deliverable_ref:a.deliverable_ref,name:a.name,description:a.description,milestone_id:a.milestone_id||null,status:a.status,progress:parseInt(a.progress)||0,assigned_to:a.assigned_to,due_date:a.due_date||null,created_by:I});await g.syncKPILinks(i.id,a.kpi_ids),await g.syncQSLinks(i.id,a.qs_ids),v({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),M(!1),D(),W(),f("Deliverable added!")}catch(i){l("Failed: "+i.message)}}async function pe(s,i){try{await g.update(s,{name:i.name,description:i.description,milestone_id:i.milestone_id||null,status:i.status,progress:parseInt(i.progress)||0,assigned_to:i.assigned_to,due_date:i.due_date||null}),i.kpi_ids&&await g.syncKPILinks(s,i.kpi_ids),i.qs_ids&&await g.syncQSLinks(s,i.qs_ids),D(),W(),f("Deliverable updated!")}catch(n){l("Failed: "+n.message)}}async function me(s,i){try{let n=s.progress;i==="Not Started"?n=0:["Submitted for Review","Review Complete","Delivered"].includes(i)?n=100:i==="Returned for More Work"&&(n=50),await g.update(s.id,{status:i,progress:n}),D(),W(),f(`Status changed to ${i}`)}catch(n){l("Failed: "+n.message)}}function ue(s){N(s),r({}),R({}),w(!0)}async function ge(){if(!m)return;const s=m.deliverable_kpis||[],i=m.deliverable_quality_standards||[];if(s.length>0&&!s.every(n=>h[n.kpi_id]!==void 0)){p("Please assess all linked KPIs.");return}if(i.length>0&&!i.every(n=>b[n.quality_standard_id]!==void 0)){p("Please assess all linked Quality Standards.");return}try{if(await g.update(m.id,{status:"Delivered",progress:100}),s.length>0){const n=s.map(u=>({kpiId:u.kpi_id,criteriaMet:h[u.kpi_id]}));await g.upsertKPIAssessments(m.id,n,I)}if(i.length>0){const n=i.map(u=>({qsId:u.quality_standard_id,criteriaMet:b[u.quality_standard_id]}));await g.upsertQSAssessments(m.id,n,I)}f("Deliverable marked as delivered!"),w(!1),D()}catch(n){l("Failed: "+n.message)}}async function xe(s){if(confirm("Delete this deliverable?"))try{await g.delete(s,I),D(),f("Deleted")}catch(i){l("Failed: "+i.message)}}function fe(s){se({isOpen:!0,deliverable:s})}let _=S;Y&&(_=_.filter(s=>s.milestone_id===Y)),G&&(_=_.filter(s=>s.status===G)),K&&(_=_.filter(s=>s.status==="Submitted for Review"));const he=S.length,H=S.filter(s=>s.status==="Submitted for Review").length,be=S.filter(s=>s.status==="In Progress").length,ye=S.filter(s=>s.status==="Delivered").length,te=U,je=O,ve=E;return q?e.jsx(Ie,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(We,{icon:ne,title:"Deliverables",subtitle:"Track project deliverables with review workflow",children:te&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>M(!F),children:[e.jsx(Ke,{size:18})," Add Deliverable"]})}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Total"}),e.jsx("div",{className:"stat-value",children:he})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#d97706"},children:"For Review"}),e.jsx("div",{className:"stat-value",style:{color:"#d97706"},children:H})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#4f46e5"},children:"In Progress"}),e.jsx("div",{className:"stat-value",style:{color:"#4f46e5"},children:be})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#16a34a"},children:"Delivered"}),e.jsx("div",{className:"stat-value",style:{color:"#16a34a"},children:ye})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap"},children:[e.jsxs("select",{value:Y,onChange:s=>Z(s.target.value),style:{minWidth:"200px"},children:[e.jsx("option",{value:"",children:"All Milestones"}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:G,onChange:s=>V(s.target.value),style:{minWidth:"150px"},children:[e.jsx("option",{value:"",children:"All Statuses"}),Ue.map(s=>e.jsx("option",{value:s,children:s},s))]}),H>0&&e.jsxs("button",{onClick:()=>{oe(!K),K||(Z(""),V(""))},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:K?"#fef3c7":"#fffbeb",border:"1px solid #fbbf24",borderRadius:"6px",color:"#92400e",cursor:"pointer",fontWeight:"500"},children:[e.jsx(Q,{size:16})," ",H," Awaiting Review"]})]}),F&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:ce,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Ref *"}),e.jsx("input",{type:"text",value:a.deliverable_ref,onChange:s=>v({...a,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>v({...a,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>v({...a,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:a.milestone_id,onChange:s=>v({...a,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),j.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:a.assigned_to,onChange:s=>v({...a,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:a.due_date,onChange:s=>v({...a,due_date:s.target.value})})]})]}),e.jsx(Oe,{kpis:x,selectedIds:a.kpi_ids,onChange:s=>v({...a,kpi_ids:s})}),e.jsx(Ee,{qualityStandards:A,selectedIds:a.qs_ids,onChange:s=>v({...a,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",children:[e.jsx(de,{size:16})," Save"]}),e.jsxs("button",{type:"button",className:"btn-secondary",onClick:()=>M(!1),children:[e.jsx(le,{size:16})," Cancel"]})]})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"KPIs"}),e.jsx("th",{children:"QS"}),e.jsx("th",{children:"Due"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No deliverables found"})}):_.map(s=>{const i=re[s.status]||re["Not Started"],n=i.icon;return e.jsxs("tr",{onClick:()=>fe(s),style:{cursor:"pointer"},className:"table-row-clickable",children:[e.jsx("td",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverable_ref}),e.jsx("td",{style:{fontWeight:"500"},children:s.name}),e.jsx("td",{children:s.milestones?e.jsx("span",{style:{color:"#3b82f6"},children:s.milestones.milestone_ref}):"-"}),e.jsx("td",{children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem",backgroundColor:i.bg,color:i.color},children:[e.jsx(n,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${s.progress||0}%`,height:"100%",backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{style:{fontSize:"0.85rem"},children:[s.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:[s.deliverable_kpis?.slice(0,3).map(u=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#dbeafe",color:"#2563eb",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:u.kpis?.kpi_ref},u.kpi_id)),s.deliverable_kpis?.length>3&&e.jsxs("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontSize:"0.75rem"},children:["+",s.deliverable_kpis.length-3]})]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:[s.deliverable_quality_standards?.slice(0,3).map(u=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f3e8ff",color:"#7c3aed",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:u.quality_standards?.qs_ref},u.quality_standard_id)),s.deliverable_quality_standards?.length>3&&e.jsxs("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontSize:"0.75rem"},children:["+",s.deliverable_quality_standards.length-3]})]})}),e.jsx("td",{children:s.due_date?new Date(s.due_date).toLocaleDateString("en-GB"):"-"})]},s.id)})})]})}),e.jsx(Qe,{isOpen:ee.isOpen,deliverable:ee.deliverable,milestones:j,kpis:x,qualityStandards:A,canEdit:te,canReview:je,canDelete:ve,onClose:()=>se({isOpen:!1,deliverable:null}),onSave:pe,onStatusChange:me,onDelete:xe,onOpenCompletion:ue}),$&&m&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal modal-lg",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h3",{className:"modal-title",children:[e.jsx(L,{size:20,style:{color:"var(--color-success)"}})," Mark as Delivered"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"var(--space-lg)"},children:[m.deliverable_ref," - ",m.name]}),m.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-warning-light)",borderLeft:"4px solid var(--color-warning)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)"},children:e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"})}),m.deliverable_kpis.map(s=>{const i=x.find(n=>n.id===s.kpi_id);return i?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-info",children:i.kpi_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:i.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>r({...h,[s.kpi_id]:!0}),className:`btn btn-sm ${h[s.kpi_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>r({...h,[s.kpi_id]:!1}),className:`btn btn-sm ${h[s.kpi_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.kpi_id):null})]}),m.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-purple-light)",borderLeft:"4px solid var(--color-purple)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)",marginTop:"var(--space-lg)"},children:e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment"})}),m.deliverable_quality_standards.map(s=>{const i=A.find(n=>n.id===s.quality_standard_id);return i?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-purple",children:i.qs_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:i.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>R({...b,[s.quality_standard_id]:!0}),className:`btn btn-sm ${b[s.quality_standard_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>R({...b,[s.quality_standard_id]:!1}),className:`btn btn-sm ${b[s.quality_standard_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.quality_standard_id):null})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>w(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:ge,children:[e.jsx(L,{size:16})," Mark Delivered"]})]})]})})]})}export{Ze as default};
