import{u as oe,c as me,j as e,a as Te,b as Pe,e as Me,f as Ie,m as Ee,k as ze,q as qe,d as f,L as Oe}from"./index-Jc8UWcdf.js";import{r as m,L as Le}from"./vendor-react-JFEV0ROX.js";import{i as ue,b as Ue,c as pe,d as he,e as te,g as Fe,h as Be,D as X,j as We,k as Ke,f as le,l as Qe,S as ae,m as de,n as $e}from"./deliverableCalculations-ClxacTU9.js";import{S as Ve,D as Ge}from"./SignatureBox-BGMeI_fO.js";import{s as fe,a as xe,F as Ye,U as He,V as Xe,k as ee,ac as Je,i as Ze,$ as es,T as ss,a2 as ge,e as ie,y as je,O as ve,C as se,a1 as as,R as ts,a0 as is,E as ns}from"./vendor-icons-yzeFIsqS.js";import"./vendor-supabase-DgEUAXvv.js";function rs(n=null){const{user:a,role:l,profile:h}=oe(),{canCreateDeliverable:d,canEditDeliverable:p,canDeleteDeliverable:_,canReviewDeliverable:D,canSubmitDeliverable:J,canSignAsSupplier:V,canSignAsCustomer:G}=me(),x=l==="admin",M=l==="supplier_pm",S=l==="customer_pm",g=l==="contributor",R=a?.id||null,o=h?.full_name||a?.email||"Unknown",j=n?ue(n):!1,N=n?Ue(n):!0,I=!0,K=d,y=j||!N?!1:!!(x||M||g&&n?.assigned_to===o),Q=j?!1:_,v=!n||!pe(n)?!1:!!(x||M||g&&n?.assigned_to===o),k=!n||!he(n)?!1:D,A=k,C=k,L=!n||!te(n)?!1:x||S,u=!V||!n?!1:Fe(n),Y=!G||!n?!1:Be(n),b=n?n.supplier_pm_signed_at&&n.customer_pm_signed_at:!1,T=!n||!te(n)?!1:x||S;return{currentUserId:R,currentUserName:o,userRole:l,isAdmin:x,isSupplierPM:M,isCustomerPM:S,isContributor:g,canView:I,canCreate:K,canEdit:y,canDelete:Q,canSubmit:v,canSubmitForReview:v,canReview:k,canAcceptReview:A,canRejectReview:C,canInitiateSignOff:L,canSignAsSupplier:u,canSignAsCustomer:Y,isFullySigned:b,canAssessKPIsAndQS:T,isComplete:j,isEditable:N}}function ls({isOpen:n,deliverable:a,milestones:l,kpis:h,qualityStandards:d,canEdit:p,canReview:_,canDelete:D,onClose:J,onSave:V,onStatusChange:G,onDelete:x,onOpenCompletion:M,onSign:S}){const[g,R]=m.useState(!1),[o,j]=m.useState({}),[N,I]=m.useState(!1),K=rs(a);if(m.useEffect(()=>{a&&(j({name:a.name||"",description:a.description||"",milestone_id:a.milestone_id||"",status:a.status||X.NOT_STARTED,progress:a.progress||0,assigned_to:a.assigned_to||"",kpi_ids:a.deliverable_kpis?.map(i=>i.kpi_id)||[],qs_ids:a.deliverable_quality_standards?.map(i=>i.quality_standard_id)||[]}),R(!1))},[a]),!n||!a)return null;const y=We(a.status),Q=y.icon,v=l?.find(i=>i.id===a.milestone_id),k=a.deliverable_kpis||[],A=a.deliverable_quality_standards||[],C=ue(a),L=p&&pe(a),u=_&&he(a),Y=_&&te(a),b=Ke(a),T=a.supplier_pm_signed_at||a.customer_pm_signed_at,E=a.status===X.REVIEW_COMPLETE||T||C,$=v?.forecast_end_date||v?.end_date;async function H(){I(!0);try{await V(a.id,o),R(!1)}finally{I(!1)}}function z(){R(!1),J()}function U(i){G(a,i),z()}function Z(i){const q={progress:i},B=$e(o.status,i);B&&(q.status=B),j({...o,...q})}async function F(i){if(S){I(!0);try{await S(a.id,i)}finally{I(!1)}}}return e.jsx("div",{className:"deliverable-modal-overlay",onClick:z,children:e.jsxs("div",{className:"deliverable-modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"deliverable-modal-header",children:[e.jsxs("div",{className:"deliverable-modal-header-left",children:[e.jsx("div",{className:"deliverable-modal-icon",style:{backgroundColor:y.bg,color:y.color},children:e.jsx(fe,{size:20})}),e.jsxs("div",{className:"deliverable-modal-titles",children:[e.jsx("h2",{children:a.deliverable_ref}),e.jsx("span",{className:"subtitle",children:a.name})]})]}),e.jsxs("div",{className:"deliverable-modal-header-right",children:[e.jsxs("span",{className:"status-badge",style:{backgroundColor:y.bg,color:y.color},children:[e.jsx(Q,{size:14}),a.status]}),e.jsx("button",{className:"close-button",onClick:z,children:e.jsx(xe,{size:24})})]})]}),e.jsx("div",{className:"deliverable-modal-content",children:g?e.jsxs("div",{className:"deliverable-edit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",className:"form-input",value:o.name,onChange:i=>j({...o,name:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:o.description,onChange:i=>j({...o,description:i.target.value})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{className:"form-input",value:o.milestone_id,onChange:i=>j({...o,milestone_id:i.target.value}),children:[e.jsx("option",{value:"",children:"-- Select milestone --"}),l?.map(i=>e.jsxs("option",{value:i.id,children:[i.milestone_ref," - ",i.name]},i.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"form-input readonly",children:(()=>{const i=l?.find(B=>B.id===o.milestone_id),q=i?.forecast_end_date||i?.end_date;return q?le(q):"Set by milestone"})()}),e.jsx("span",{className:"hint",children:"Derived from milestone forecast date"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",className:"form-input",value:o.assigned_to,onChange:i=>j({...o,assigned_to:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Progress: ",o.progress,"%"]}),e.jsx("div",{className:"progress-slider",children:e.jsx("input",{type:"range",min:"0",max:"100",value:o.progress,onChange:i=>Z(parseInt(i.target.value)),disabled:Qe(o.status)})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"deliverable-key-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(Ye,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Milestone"}),e.jsx("div",{className:"detail-item-value",children:v?e.jsxs(Le,{to:`/milestones/${v.id}`,children:[v.milestone_ref," - ",v.name]}):"Not assigned"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(He,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Assigned To"}),e.jsx("div",{className:"detail-item-value",children:a.assigned_to||"Unassigned"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(Xe,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Due Date"}),e.jsx("div",{className:"detail-item-value",children:$?le($):"Not set"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(ee,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Progress"}),e.jsxs("div",{className:"progress-display",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-bar-fill ${C?"complete":"in-progress"}`,style:{width:`${a.progress||0}%`}})}),e.jsxs("span",{className:"progress-value",children:[a.progress||0,"%"]})]})]})]})]}),e.jsxs("div",{className:"deliverable-description",children:[e.jsx("div",{className:"section-label",children:"Description"}),e.jsx("div",{className:`description-text ${a.description?"":"empty"}`,children:a.description||"No description provided"})]}),k.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(Je,{size:14}),"Linked KPIs (",k.length,")"]}),e.jsx("div",{className:"linked-items-list",children:k.map(i=>e.jsxs("span",{className:"linked-item-badge kpi",children:[i.kpis?.kpi_ref||"KPI"," - ",i.kpis?.name||"Unknown"]},i.kpi_id))})]}),A.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(Ze,{size:14}),"Linked Quality Standards (",A.length,")"]}),e.jsx("div",{className:"linked-items-list",children:A.map(i=>e.jsxs("span",{className:"linked-item-badge quality-standard",children:[i.quality_standards?.qs_ref||"QS"," - ",i.quality_standards?.name||"Unknown"]},i.quality_standard_id))})]}),E&&e.jsxs("div",{className:"sign-off-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(es,{size:14}),"Delivery Sign-off"]}),C&&b===ae.SIGNED?e.jsx(Ve,{message:"Deliverable accepted and delivered"}):e.jsx(Ge,{supplier:{signedBy:a.supplier_pm_name,signedAt:a.supplier_pm_signed_at,canSign:K.canSignAsSupplier&&S,onSign:()=>F("supplier")},customer:{signedBy:a.customer_pm_name,signedAt:a.customer_pm_signed_at,canSign:K.canSignAsCustomer&&S,onSign:()=>F("customer")},saving:N,supplierButtonText:"Sign as Supplier PM",customerButtonText:"Sign as Customer PM"}),!C&&T&&e.jsxs("div",{className:"sign-off-status-indicator",children:[b===ae.AWAITING_CUSTOMER&&e.jsx("span",{className:"awaiting-badge customer",children:"Awaiting Customer PM signature"}),b===ae.AWAITING_SUPPLIER&&e.jsx("span",{className:"awaiting-badge supplier",children:"Awaiting Supplier PM signature"})]})]}),e.jsxs("div",{className:"deliverable-timestamps",children:[e.jsxs("div",{className:"timestamp-item",children:[e.jsx(ee,{size:14}),"Created: ",a.created_at?de(a.created_at):"Unknown"]}),a.updated_at&&a.updated_at!==a.created_at&&e.jsxs("div",{className:"timestamp-item",children:[e.jsx(ee,{size:14}),"Updated: ",de(a.updated_at)]})]})]})}),e.jsxs("div",{className:"deliverable-modal-footer",children:[e.jsx("div",{className:"footer-left",children:D&&!g&&!C&&e.jsxs("button",{className:"btn btn-danger",onClick:()=>{x(a.id),z()},children:[e.jsx(ss,{size:16})," Delete"]})}),e.jsx("div",{className:"footer-right",children:g?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>R(!1),disabled:N,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:H,disabled:N,children:[e.jsx(ge,{size:16})," ",N?"Saving...":"Save Changes"]})]}):e.jsxs(e.Fragment,{children:[L&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>U(X.SUBMITTED_FOR_REVIEW),children:[e.jsx(ie,{size:16})," Submit for Review"]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:()=>U(X.RETURNED_FOR_MORE_WORK),children:[e.jsx(je,{size:16})," Return for More Work"]}),e.jsxs("button",{className:"btn btn-success",onClick:()=>U(X.REVIEW_COMPLETE),children:[e.jsx(ve,{size:16})," Accept Review"]})]}),Y&&!T&&e.jsxs("button",{className:"btn btn-success",onClick:()=>{M(a),z()},children:[e.jsx(se,{size:16})," Assess & Sign Off"]}),p&&!C&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>R(!0),children:[e.jsx(as,{size:16})," Edit"]})]})})]})]})})}const ds=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],ce={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:se},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:ve},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:ie},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:ee},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:je},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:ns}};function cs({kpis:n,selectedIds:a,onChange:l,label:h="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h}),a.length>0&&e.jsx("button",{type:"button",onClick:()=>l([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:n.map(d=>{const p=a.includes(d.id);return e.jsxs("div",{onClick:()=>l(p?a.filter(_=>_!==d.id):[...a,d.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#dbeafe":"#f8fafc",border:p?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:d.kpi_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:d.name})]})]},d.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[a.length," selected"]})]})}function os({qualityStandards:n,selectedIds:a,onChange:l,label:h="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h}),a.length>0&&e.jsx("button",{type:"button",onClick:()=>l([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:n.map(d=>{const p=a.includes(d.id);return e.jsxs("div",{onClick:()=>l(p?a.filter(_=>_!==d.id):[...a,d.id]),style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:p?"#f3e8ff":"#f8fafc",border:p?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{marginTop:"3px"}}),e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:d.qs_ref})," ",e.jsx("span",{style:{fontWeight:"600"},children:d.name})]})]},d.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[a.length," selected"]})]})}function gs(){const{user:n,role:a}=oe(),{projectId:l}=Te(),{showSuccess:h,showError:d,showWarning:p}=Pe(),{showTestUsers:_}=Me(),D=n?.id||null,{canEditDeliverable:J,canReviewDeliverable:V,canDeleteDeliverable:G}=me(),{refreshMetrics:x}=Ie(),[M,S]=m.useState([]),[g,R]=m.useState([]),[o,j]=m.useState([]),[N,I]=m.useState([]),[K,y]=m.useState(!0),[Q,v]=m.useState(!1),[k,A]=m.useState(!1),[C,L]=m.useState(!1),[u,Y]=m.useState(null),[b,T]=m.useState({}),[E,$]=m.useState({}),[H,z]=m.useState(""),[U,Z]=m.useState(""),[F,i]=m.useState(!1),[q,B]=m.useState({isOpen:!1,deliverable:null}),[c,O]=m.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",kpi_ids:[],qs_ids:[]}),P=m.useCallback(async()=>{if(l){y(!0);try{const s=await Ee.getAll(l,{orderBy:{column:"milestone_ref",ascending:!0}});R(s);const t=await ze.getAll(l,{orderBy:{column:"kpi_ref",ascending:!0}});j(t);const r=await qe.getAll(l,{orderBy:{column:"qs_ref",ascending:!0}});I(r);const W=await f.getAllWithRelations(l,_);S(W||[])}catch{d("Failed to load deliverables")}finally{y(!1),v(!1)}}},[l,_,d]);m.useEffect(()=>{P()},[P]);async function be(){v(!0),await P()}async function _e(s){s.preventDefault();try{const t=await f.create({project_id:l,deliverable_ref:c.deliverable_ref,name:c.name,description:c.description,milestone_id:c.milestone_id||null,status:c.status,progress:parseInt(c.progress)||0,assigned_to:c.assigned_to,created_by:D});await f.syncKPILinks(t.id,c.kpi_ids),await f.syncQSLinks(t.id,c.qs_ids),O({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",kpi_ids:[],qs_ids:[]}),A(!1),P(),x(),h("Deliverable added!")}catch(t){d("Failed: "+t.message)}}async function Ne(s,t){try{await f.update(s,{name:t.name,description:t.description,milestone_id:t.milestone_id||null,status:t.status,progress:parseInt(t.progress)||0,assigned_to:t.assigned_to}),t.kpi_ids&&await f.syncKPILinks(s,t.kpi_ids),t.qs_ids&&await f.syncQSLinks(s,t.qs_ids),P(),x(),h("Deliverable updated!")}catch(r){d("Failed: "+r.message)}}async function Se(s,t){try{let r=s.progress;t==="Not Started"?r=0:["Submitted for Review","Review Complete","Delivered"].includes(t)?r=100:t==="Returned for More Work"&&(r=50),await f.update(s.id,{status:t,progress:r}),P(),x(),h(`Status changed to ${t}`)}catch(r){d("Failed: "+r.message)}}function ye(s){Y(s),T({}),$({}),L(!0)}async function ke(){if(!u)return;const s=u.deliverable_kpis||[],t=u.deliverable_quality_standards||[];if(s.length>0&&!s.every(r=>b[r.kpi_id]!==void 0)){p("Please assess all linked KPIs.");return}if(t.length>0&&!t.every(r=>E[r.quality_standard_id]!==void 0)){p("Please assess all linked Quality Standards.");return}try{if(await f.update(u.id,{status:"Delivered",progress:100}),s.length>0){const r=s.map(W=>({kpiId:W.kpi_id,criteriaMet:b[W.kpi_id]}));await f.upsertKPIAssessments(u.id,r,D)}if(t.length>0){const r=t.map(W=>({qsId:W.quality_standard_id,criteriaMet:E[W.quality_standard_id]}));await f.upsertQSAssessments(u.id,r,D)}h("Deliverable marked as delivered!"),L(!1),P()}catch(r){d("Failed: "+r.message)}}async function Ce(s){if(confirm("Delete this deliverable?"))try{await f.delete(s,D),P(),h("Deleted")}catch(t){d("Failed: "+t.message)}}async function we(s,t){try{const r=n?.user_metadata?.name||n?.email||"Unknown User";await f.signDeliverable(s,t,D,r),P(),x(),h(`Signed as ${t==="supplier"?"Supplier PM":"Customer PM"}`)}catch(r){d("Failed to sign: "+r.message)}}function De(s){B({isOpen:!0,deliverable:s})}let w=M;H&&(w=w.filter(s=>s.milestone_id===H)),U&&(w=w.filter(s=>s.status===U)),F&&(w=w.filter(s=>s.status==="Submitted for Review"));const ne=M.filter(s=>s.status==="Submitted for Review").length,re=J,Re=V,Ae=G;return K?e.jsx(Oe,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"deliverables-page",children:[e.jsx("header",{className:"del-header",children:e.jsxs("div",{className:"del-header-content",children:[e.jsxs("div",{className:"del-header-left",children:[e.jsx("div",{className:"del-header-icon",children:e.jsx(fe,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Deliverables"}),e.jsx("p",{children:"Track project deliverables with review workflow"})]})]}),e.jsxs("div",{className:"del-header-actions",children:[e.jsxs("button",{className:"del-btn del-btn-secondary",onClick:be,disabled:Q,children:[e.jsx(ts,{size:18,className:Q?"spinning":""})," Refresh"]}),re&&e.jsxs("button",{className:"del-btn del-btn-primary",onClick:()=>A(!k),children:[e.jsx(is,{size:18})," Add Deliverable"]})]})]})}),e.jsxs("div",{className:"del-content",children:[e.jsxs("div",{className:"del-filters",children:[e.jsxs("select",{value:H,onChange:s=>z(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Milestones"}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:U,onChange:s=>Z(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Statuses"}),ds.map(s=>e.jsx("option",{value:s,children:s},s))]}),ne>0&&e.jsxs("button",{onClick:()=>{i(!F),F||(z(""),Z(""))},className:`del-filter-badge ${F?"active":""}`,children:[e.jsx(ie,{size:16})," ",ne," Awaiting Review"]})]}),k&&e.jsxs("div",{className:"del-add-form",children:[e.jsx("h3",{className:"del-add-form-title",children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:_e,children:[e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Ref *"}),e.jsx("input",{type:"text",value:c.deliverable_ref,onChange:s=>O({...c,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{className:"del-form-group",style:{flex:2},children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:c.name,onChange:s=>O({...c,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:c.description,onChange:s=>O({...c,description:s.target.value})})]}),e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:c.milestone_id,onChange:s=>O({...c,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),g.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:c.assigned_to,onChange:s=>O({...c,assigned_to:s.target.value})})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"del-form-readonly",children:(()=>{const s=g.find(t=>t.id===c.milestone_id);return s?.forecast_end_date?new Date(s.forecast_end_date).toLocaleDateString("en-GB"):"Select milestone"})()})]})]}),e.jsx(cs,{kpis:o,selectedIds:c.kpi_ids,onChange:s=>O({...c,kpi_ids:s})}),e.jsx(os,{qualityStandards:N,selectedIds:c.qs_ids,onChange:s=>O({...c,qs_ids:s})}),e.jsxs("div",{className:"del-form-actions",children:[e.jsxs("button",{type:"submit",className:"del-btn del-btn-primary",children:[e.jsx(ge,{size:16})," Save"]}),e.jsxs("button",{type:"button",className:"del-btn del-btn-secondary",onClick:()=>A(!1),children:[e.jsx(xe,{size:16})," Cancel"]})]})]})]}),e.jsxs("div",{className:"del-table-card",children:[e.jsxs("div",{className:"del-table-header",children:[e.jsx("h2",{className:"del-table-title",children:"Project Deliverables"}),e.jsxs("span",{className:"del-table-count",children:[w.length," deliverable",w.length!==1?"s":""]})]}),e.jsxs("table",{className:"del-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"})]})}),e.jsx("tbody",{children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"del-empty-cell",children:"No deliverables found"})}):w.map(s=>{const t=ce[s.status]||ce["Not Started"],r=t.icon;return e.jsxs("tr",{onClick:()=>De(s),children:[e.jsx("td",{children:e.jsx("span",{className:"del-ref",children:s.deliverable_ref})}),e.jsx("td",{children:e.jsx("span",{className:"del-name",children:s.name})}),e.jsx("td",{children:s.milestones?e.jsx("span",{className:"del-milestone-link",children:s.milestones.milestone_ref}):"—"}),e.jsx("td",{children:e.jsxs("span",{className:"del-status-badge",style:{backgroundColor:t.bg,color:t.color},children:[e.jsx(r,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{className:"del-progress",children:[e.jsx("div",{className:"del-progress-bar",children:e.jsx("div",{className:"del-progress-fill",style:{width:`${s.progress||0}%`,backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{className:"del-progress-text",children:[s.progress||0,"%"]})]})})]},s.id)})})]})]})]}),e.jsx(ls,{isOpen:q.isOpen,deliverable:q.deliverable,milestones:g,kpis:o,qualityStandards:N,canEdit:re,canReview:Re,canDelete:Ae,onClose:()=>B({isOpen:!1,deliverable:null}),onSave:Ne,onStatusChange:Se,onDelete:Ce,onOpenCompletion:ye,onSign:we}),C&&u&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal modal-lg",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h3",{className:"modal-title",children:[e.jsx(se,{size:20,style:{color:"var(--color-success)"}})," Mark as Delivered"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"var(--space-lg)"},children:[u.deliverable_ref," - ",u.name]}),u.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-warning-light)",borderLeft:"4px solid var(--color-warning)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)"},children:e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"})}),u.deliverable_kpis.map(s=>{const t=o.find(r=>r.id===s.kpi_id);return t?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-info",children:t.kpi_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:t.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>T({...b,[s.kpi_id]:!0}),className:`btn btn-sm ${b[s.kpi_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>T({...b,[s.kpi_id]:!1}),className:`btn btn-sm ${b[s.kpi_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.kpi_id):null})]}),u.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-purple-light)",borderLeft:"4px solid var(--color-purple)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)",marginTop:"var(--space-lg)"},children:e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment"})}),u.deliverable_quality_standards.map(s=>{const t=N.find(r=>r.id===s.quality_standard_id);return t?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-purple",children:t.qs_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:t.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>$({...E,[s.quality_standard_id]:!0}),className:`btn btn-sm ${E[s.quality_standard_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>$({...E,[s.quality_standard_id]:!1}),className:`btn btn-sm ${E[s.quality_standard_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.quality_standard_id):null})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>L(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:ke,children:[e.jsx(se,{size:16})," Mark Delivered"]})]})]})})]})}export{gs as default};
