import{j as e,u as he,d as xe,a as Ie,c as Oe,f as Le,g as ze,m as qe,k as Fe,q as Ue,e as y,L as Ke}from"./index-BUEpl-Qo.js";import{r as m,L as Qe}from"./vendor-react-BUTV5ZEl.js";import{i as je,a as $e,c as fe,b as ge,d as te,e as Be,f as We,D as f,g as Ve,h as Ge,j as Ye,S as ae,k as He,l as Xe,m as me}from"./deliverableCalculations-D-qG4O_w.js";import{C as Je}from"./ConfirmDialog-COdaGTmI.js";import{f as ne,b as ue}from"./formatters-BTbCMDgc.js";import{S as Ze,D as es}from"./SignatureBox-DxnT3lnM.js";import{P as ve,c as be,F as ss,h as as,p as ie,m as le,l as re,ai as is,T as ts,al as Ne,i as _e,y as ns,ae as ls,b as ce,ak as rs,R as cs,aj as ds}from"./vendor-icons-CWM4So-G.js";import"./vendor-supabase-6faYzd5A.js";function pe({items:t=[],selectedIds:a=[],onChange:r,renderItem:o,getItemId:c=E=>E.id,label:x="Select items",emptyMessage:N="No items available",variant:D="blue",maxHeight:G=200}){const E=p=>{const g=c(p),j=a.includes(g);r(j?a.filter(v=>v!==g):[...a,g])},F=()=>{r([])};return e.jsxs("div",{className:"multi-select-list",children:[e.jsxs("label",{className:"multi-select-label",children:[e.jsx("span",{children:x}),a.length>0&&e.jsx("button",{type:"button",onClick:F,className:"multi-select-clear",children:"Clear"})]}),e.jsx("div",{className:"multi-select-container",style:{maxHeight:`${G}px`},children:t.length===0?e.jsx("div",{className:"multi-select-empty",children:N}):t.map(p=>{const g=c(p),j=a.includes(g);return e.jsxs("div",{onClick:()=>E(p),className:`multi-select-item multi-select-item--${D} ${j?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:j,onChange:()=>{},className:"multi-select-checkbox"}),e.jsx("div",{className:"multi-select-content",children:o(p,j)})]},g)})}),e.jsxs("div",{className:"multi-select-count",children:[a.length," selected"]})]})}function os(t=null){const{user:a,role:r,profile:o}=he(),{canCreateDeliverable:c,canEditDeliverable:x,canDeleteDeliverable:N,canReviewDeliverable:D,canSubmitDeliverable:G,canSignAsSupplier:E,canSignAsCustomer:F}=xe(),p=r==="admin",g=r==="supplier_pm",j=r==="customer_pm",v=r==="contributor",A=a?.id||null,d=o?.full_name||a?.email||"Unknown",_=t?je(t):!1,w=t?$e(t):!0,T=!0,h=c,U=_||!w?!1:!!(p||g||v&&t?.assigned_to===d),K=_?!1:N,I=!t||!fe(t)?!1:!!(p||g||v&&t?.assigned_to===d),P=!t||!ge(t)?!1:D,O=P,M=P,Q=!t||!te(t)?!1:p||j,u=!E||!t?!1:Be(t),$=!F||!t?!1:We(t),k=t?t.supplier_pm_signed_at&&t.customer_pm_signed_at:!1,C=!t||!te(t)?!1:p||j;return{currentUserId:A,currentUserName:d,userRole:r,isAdmin:p,isSupplierPM:g,isCustomerPM:j,isContributor:v,canView:T,canCreate:h,canEdit:U,canDelete:K,canSubmit:I,canSubmitForReview:I,canReview:P,canAcceptReview:O,canRejectReview:M,canInitiateSignOff:Q,canSignAsSupplier:u,canSignAsCustomer:$,isFullySigned:k,canAssessKPIsAndQS:C,isComplete:_,isEditable:w}}function ms({kpis:t,selectedIds:a,onChange:r,disabled:o}){return!t||t.length===0?e.jsxs("div",{className:"linked-items-section edit-mode",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(le,{size:14}),"Link to KPIs"]}),e.jsx("div",{className:"no-items-message",children:"No KPIs available to link"})]}):e.jsxs("div",{className:"linked-items-section edit-mode",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(le,{size:14}),"Link to KPIs",a.length>0&&!o&&e.jsx("button",{type:"button",onClick:()=>r([]),className:"clear-button",children:"Clear all"})]}),e.jsx("div",{className:"selector-list",children:t.map(c=>{const x=a.includes(c.id);return e.jsxs("div",{onClick:()=>{o||r(x?a.filter(N=>N!==c.id):[...a,c.id])},className:`selector-item ${x?"selected":""} ${o?"disabled":""}`,children:[e.jsx("input",{type:"checkbox",checked:x,onChange:()=>{},disabled:o}),e.jsxs("div",{className:"selector-item-content",children:[e.jsx("span",{className:"item-badge kpi",children:c.kpi_ref}),e.jsx("span",{className:"item-name",children:c.name})]})]},c.id)})}),e.jsxs("div",{className:"selector-count",children:[a.length," selected"]}),o&&e.jsx("span",{className:"hint",children:"Only Supplier PM can edit KPI links"})]})}function us({qualityStandards:t,selectedIds:a,onChange:r,disabled:o}){return!t||t.length===0?e.jsxs("div",{className:"linked-items-section edit-mode",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(re,{size:14}),"Link to Quality Standards"]}),e.jsx("div",{className:"no-items-message",children:"No Quality Standards available to link"})]}):e.jsxs("div",{className:"linked-items-section edit-mode",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(re,{size:14}),"Link to Quality Standards",a.length>0&&!o&&e.jsx("button",{type:"button",onClick:()=>r([]),className:"clear-button",children:"Clear all"})]}),e.jsx("div",{className:"selector-list",children:t.map(c=>{const x=a.includes(c.id);return e.jsxs("div",{onClick:()=>{o||r(x?a.filter(N=>N!==c.id):[...a,c.id])},className:`selector-item ${x?"selected":""} ${o?"disabled":""}`,children:[e.jsx("input",{type:"checkbox",checked:x,onChange:()=>{},disabled:o}),e.jsxs("div",{className:"selector-item-content",children:[e.jsx("span",{className:"item-badge quality-standard",children:c.qs_ref}),e.jsx("span",{className:"item-name",children:c.name})]})]},c.id)})}),e.jsxs("div",{className:"selector-count",children:[a.length," selected"]}),o&&e.jsx("span",{className:"hint",children:"Only Supplier PM can edit Quality Standard links"})]})}function ps({isOpen:t,deliverable:a,milestones:r,kpis:o,qualityStandards:c,canEdit:x,canReview:N,canDelete:D,onClose:G,onSave:E,onStatusChange:F,onDelete:p,onOpenCompletion:g,onSign:j}){const[v,A]=m.useState(!1),[d,_]=m.useState({}),[w,T]=m.useState(!1),h=os(a),U=h.isSupplierPM||h.isAdmin,K=h.isSupplierPM||h.isAdmin,I=h.isSupplierPM||h.isAdmin||h.isContributor,P=h.isSupplierPM||h.isAdmin||h.isContributor,O=h.isSupplierPM||h.isAdmin;if(m.useEffect(()=>{a&&(_({name:a.name||"",description:a.description||"",milestone_id:a.milestone_id||"",status:a.status||f.NOT_STARTED,progress:a.progress||0,kpi_ids:a.deliverable_kpis?.map(i=>i.kpi_id)||[],qs_ids:a.deliverable_quality_standards?.map(i=>i.quality_standard_id)||[]}),A(!1))},[a]),!t||!a)return null;const M=Ve(a.status),Q=M.icon,u=r?.find(i=>i.id===a.milestone_id),$=a.deliverable_kpis||[],k=a.deliverable_quality_standards||[],C=je(a),L=x&&fe(a),J=N&&ge(a),Z=N&&te(a),Y=Ge(a),B=a.supplier_pm_signed_at||a.customer_pm_signed_at,ee=a.status===f.REVIEW_COMPLETE||B||C,W=u?.forecast_end_date||u?.end_date;async function se(){T(!0);try{await E(a.id,d),A(!1)}finally{T(!1)}}function z(){A(!1),G()}function H(i){F(a,i),z()}function q(i){const S={progress:i},b=He(d.status,i);b&&(S.status=b),_({...d,...S})}async function X(i){if(j){T(!0);try{await j(a.id,i)}finally{T(!1)}}}return e.jsx("div",{className:"deliverable-modal-overlay",onClick:z,children:e.jsxs("div",{className:"deliverable-modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"deliverable-modal-header",children:[e.jsxs("div",{className:"deliverable-modal-header-left",children:[e.jsx("div",{className:"deliverable-modal-icon",style:{backgroundColor:M.bg,color:M.color},children:e.jsx(ve,{size:20})}),e.jsxs("div",{className:"deliverable-modal-titles",children:[e.jsx("h2",{children:a.deliverable_ref}),e.jsx("span",{className:"subtitle",children:a.name})]})]}),e.jsxs("div",{className:"deliverable-modal-header-right",children:[e.jsxs("span",{className:"status-badge",style:{backgroundColor:M.bg,color:M.color},children:[e.jsx(Q,{size:14}),a.status]}),e.jsx("button",{className:"close-button",onClick:z,children:e.jsx(be,{size:24})})]})]}),e.jsx("div",{className:"deliverable-modal-content",children:v?e.jsxs("div",{className:"deliverable-edit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",className:"form-input",value:d.name,onChange:i=>_({...d,name:i.target.value}),disabled:!U}),!U&&e.jsx("span",{className:"hint",children:"Only Supplier PM can edit name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:d.description,onChange:i=>_({...d,description:i.target.value}),disabled:!I}),!I&&e.jsx("span",{className:"hint",children:"Only Supplier PM or Contributor can edit description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{className:"form-input",value:d.milestone_id,onChange:i=>_({...d,milestone_id:i.target.value}),disabled:!K,children:[e.jsx("option",{value:"",children:"-- Select milestone --"}),r?.map(i=>e.jsxs("option",{value:i.id,children:[i.milestone_ref," - ",i.name]},i.id))]}),!K&&e.jsx("span",{className:"hint",children:"Only Supplier PM can edit milestone"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"form-input readonly",children:(()=>{const i=r?.find(b=>b.id===d.milestone_id),S=i?.forecast_end_date||i?.end_date;return S?ne(S):"Set by milestone"})()}),e.jsx("span",{className:"hint",children:"Derived from milestone forecast date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Progress: ",d.progress,"%"]}),e.jsx("div",{className:"progress-slider",children:e.jsx("input",{type:"range",min:"0",max:"100",value:d.progress,onChange:i=>q(parseInt(i.target.value)),disabled:!P||Ye(d.status)})}),!P&&e.jsx("span",{className:"hint",children:"Only Supplier PM or Contributor can edit progress"})]}),e.jsx(ms,{kpis:o,selectedIds:d.kpi_ids,onChange:i=>_({...d,kpi_ids:i}),disabled:!O}),e.jsx(us,{qualityStandards:c,selectedIds:d.qs_ids,onChange:i=>_({...d,qs_ids:i}),disabled:!O})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"deliverable-key-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx(ss,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Milestone"}),e.jsx("div",{className:"detail-item-value",children:u?e.jsxs(Qe,{to:`/milestones/${u.id}`,children:[u.milestone_ref," - ",u.name]}):"Not assigned"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(as,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Due Date"}),e.jsx("div",{className:"detail-item-value",children:W?ne(W):"Not set"})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx(ie,{size:18,className:"detail-item-icon"}),e.jsxs("div",{className:"detail-item-content",children:[e.jsx("div",{className:"detail-item-label",children:"Progress"}),e.jsxs("div",{className:"progress-display",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-bar-fill ${C?"complete":"in-progress"}`,style:{width:`${a.progress||0}%`}})}),e.jsxs("span",{className:"progress-value",children:[a.progress||0,"%"]})]})]})]})]}),e.jsxs("div",{className:"deliverable-description",children:[e.jsx("div",{className:"section-label",children:"Description"}),e.jsx("div",{className:`description-text ${a.description?"":"empty"}`,children:a.description||"No description provided"})]}),$.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(le,{size:14}),"Linked KPIs (",$.length,")"]}),e.jsx("div",{className:"linked-items-list",children:$.map(i=>e.jsxs("span",{className:"linked-item-badge kpi",children:[i.kpis?.kpi_ref||"KPI"," - ",i.kpis?.name||"Unknown"]},i.kpi_id))})]}),k.length>0&&e.jsxs("div",{className:"linked-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(re,{size:14}),"Linked Quality Standards (",k.length,")"]}),e.jsx("div",{className:"linked-items-list",children:k.map(i=>e.jsxs("span",{className:"linked-item-badge quality-standard",children:[i.quality_standards?.qs_ref||"QS"," - ",i.quality_standards?.name||"Unknown"]},i.quality_standard_id))})]}),ee&&e.jsxs("div",{className:"sign-off-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(is,{size:14}),"Delivery Sign-off"]}),C&&Y===ae.SIGNED?e.jsx(Ze,{message:"Deliverable accepted and delivered"}):e.jsx(es,{supplier:{signedBy:a.supplier_pm_name,signedAt:a.supplier_pm_signed_at,canSign:h.canSignAsSupplier&&j,onSign:()=>X("supplier")},customer:{signedBy:a.customer_pm_name,signedAt:a.customer_pm_signed_at,canSign:h.canSignAsCustomer&&j,onSign:()=>X("customer")},saving:w,supplierButtonText:"Sign as Supplier PM",customerButtonText:"Sign as Customer PM"}),!C&&B&&e.jsxs("div",{className:"sign-off-status-indicator",children:[Y===ae.AWAITING_CUSTOMER&&e.jsx("span",{className:"awaiting-badge customer",children:"Awaiting Customer PM signature"}),Y===ae.AWAITING_SUPPLIER&&e.jsx("span",{className:"awaiting-badge supplier",children:"Awaiting Supplier PM signature"})]})]}),e.jsxs("div",{className:"deliverable-timestamps",children:[e.jsxs("div",{className:"timestamp-item",children:[e.jsx(ie,{size:14}),"Created: ",a.created_at?ue(a.created_at):"Unknown"]}),a.updated_at&&a.updated_at!==a.created_at&&e.jsxs("div",{className:"timestamp-item",children:[e.jsx(ie,{size:14}),"Updated: ",ue(a.updated_at)]})]})]})}),e.jsxs("div",{className:"deliverable-modal-footer",children:[e.jsx("div",{className:"footer-left",children:D&&!v&&!C&&e.jsxs("button",{className:"btn btn-danger",onClick:()=>{p(a),z()},children:[e.jsx(ts,{size:16})," Delete"]})}),e.jsx("div",{className:"footer-right",children:v?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(!1),disabled:w,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:se,disabled:w,children:[e.jsx(Ne,{size:16})," ",w?"Saving...":"Save Changes"]})]}):e.jsxs(e.Fragment,{children:[L&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>H(f.SUBMITTED_FOR_REVIEW),children:[e.jsx(_e,{size:16})," Submit for Review"]}),J&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:()=>H(f.RETURNED_FOR_MORE_WORK),children:[e.jsx(ns,{size:16})," Return for More Work"]}),e.jsxs("button",{className:"btn btn-success",onClick:()=>H(f.REVIEW_COMPLETE),children:[e.jsx(ls,{size:16})," Accept Review"]})]}),Z&&!B&&e.jsxs("button",{className:"btn btn-success",onClick:()=>{g(a),z()},children:[e.jsx(ce,{size:16})," Assess & Sign Off"]}),x&&!C&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>A(!0),children:[e.jsx(rs,{size:16})," Edit"]})]})})]})]})})}const hs=t=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"multi-select-badge multi-select-badge--blue",children:t.kpi_ref}),e.jsx("span",{className:"multi-select-item-name",children:t.name})]}),xs=t=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"multi-select-badge multi-select-badge--purple",children:t.qs_ref}),e.jsx("span",{className:"multi-select-item-name",children:t.name})]});function ys(){const{user:t,role:a}=he(),{projectId:r}=Ie(),{showSuccess:o,showError:c,showWarning:x}=Oe(),{showTestUsers:N}=Le(),D=t?.id||null,{canEditDeliverable:G,canReviewDeliverable:E,canDeleteDeliverable:F}=xe(),{refreshMetrics:p}=ze(),[g,j]=m.useState([]),[v,A]=m.useState([]),[d,_]=m.useState([]),[w,T]=m.useState([]),[h,U]=m.useState(!0),[K,I]=m.useState(!1),[P,O]=m.useState(!1),[M,Q]=m.useState(!1),[u,$]=m.useState(null),[k,C]=m.useState({}),[L,J]=m.useState({}),[Z,Y]=m.useState(""),[B,ee]=m.useState(""),[W,se]=m.useState(!1),[z,H]=m.useState({isOpen:!1,deliverable:null}),[q,X]=m.useState({isOpen:!1,deliverable:null}),[i,S]=m.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:f.NOT_STARTED,progress:0,kpi_ids:[],qs_ids:[]}),b=m.useCallback(async()=>{if(r){U(!0);try{const s=await qe.getAll(r,{orderBy:{column:"milestone_ref",ascending:!0}});A(s);const n=await Fe.getAll(r,{orderBy:{column:"kpi_ref",ascending:!0}});_(n);const l=await Ue.getAll(r,{orderBy:{column:"qs_ref",ascending:!0}});T(l);const V=await y.getAllWithRelations(r,N);j(V||[])}catch{c("Failed to load deliverables")}finally{U(!1),I(!1)}}},[r,N,c]);m.useEffect(()=>{b()},[b]);async function Se(){I(!0),await b()}async function ye(s){s.preventDefault();try{const n=await y.create({project_id:r,deliverable_ref:i.deliverable_ref,name:i.name,description:i.description,milestone_id:i.milestone_id||null,status:i.status,progress:parseInt(i.progress)||0,created_by:D});await y.syncKPILinks(n.id,i.kpi_ids),await y.syncQSLinks(n.id,i.qs_ids),S({deliverable_ref:"",name:"",description:"",milestone_id:"",status:f.NOT_STARTED,progress:0,kpi_ids:[],qs_ids:[]}),O(!1),b(),p(),o("Deliverable added!")}catch(n){c("Failed: "+n.message)}}async function ke(s,n){try{await y.update(s,{name:n.name,description:n.description,milestone_id:n.milestone_id||null,status:n.status,progress:parseInt(n.progress)||0});const l=a==="admin"||a==="supplier_pm";l&&n.kpi_ids!==void 0&&await y.syncKPILinks(s,n.kpi_ids),l&&n.qs_ids!==void 0&&await y.syncQSLinks(s,n.qs_ids),b(),p(),o("Deliverable updated!")}catch(l){c("Failed: "+l.message)}}async function Ce(s,n){try{let l=s.progress;n===f.NOT_STARTED?l=0:[f.SUBMITTED_FOR_REVIEW,f.REVIEW_COMPLETE,f.DELIVERED].includes(n)?l=100:n===f.RETURNED_FOR_MORE_WORK&&(l=50),await y.update(s.id,{status:n,progress:l}),b(),p(),o(`Status changed to ${n}`)}catch(l){c("Failed: "+l.message)}}function De(s){$(s),C({}),J({}),Q(!0)}async function we(){if(!u)return;const s=u.deliverable_kpis||[],n=u.deliverable_quality_standards||[];if(s.length>0&&!s.every(l=>k[l.kpi_id]!==void 0)){x("Please assess all linked KPIs.");return}if(n.length>0&&!n.every(l=>L[l.quality_standard_id]!==void 0)){x("Please assess all linked Quality Standards.");return}try{if(await y.update(u.id,{status:f.DELIVERED,progress:100}),s.length>0){const l=s.map(V=>({kpiId:V.kpi_id,criteriaMet:k[V.kpi_id]}));await y.upsertKPIAssessments(u.id,l,D)}if(n.length>0){const l=n.map(V=>({qsId:V.quality_standard_id,criteriaMet:L[V.quality_standard_id]}));await y.upsertQSAssessments(u.id,l,D)}o("Deliverable marked as delivered!"),Q(!1),b()}catch(l){c("Failed: "+l.message)}}function Re(s){X({isOpen:!0,deliverable:s})}async function Ee(){if(q.deliverable)try{await y.delete(q.deliverable.id,D),X({isOpen:!1,deliverable:null}),b(),o("Deliverable deleted")}catch(s){c("Failed: "+s.message)}}async function Ae(s,n){try{const l=t?.user_metadata?.name||t?.email||"Unknown User";await y.signDeliverable(s,n,D,l),b(),p(),o(`Signed as ${n==="supplier"?"Supplier PM":"Customer PM"}`)}catch(l){c("Failed to sign: "+l.message)}}function Pe(s){H({isOpen:!0,deliverable:s})}let R=g;Z&&(R=R.filter(s=>s.milestone_id===Z)),B&&(R=R.filter(s=>s.status===B)),W&&(R=R.filter(s=>s.status===f.SUBMITTED_FOR_REVIEW));const de=g.filter(s=>s.status===f.SUBMITTED_FOR_REVIEW).length,oe=G,Me=E,Te=F;return h?e.jsx(Ke,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"deliverables-page",children:[e.jsx("header",{className:"del-header",children:e.jsxs("div",{className:"del-header-content",children:[e.jsxs("div",{className:"del-header-left",children:[e.jsx("div",{className:"del-header-icon",children:e.jsx(ve,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Deliverables"}),e.jsx("p",{children:"Track project deliverables with review workflow"})]})]}),e.jsxs("div",{className:"del-header-actions",children:[e.jsxs("button",{className:"del-btn del-btn-secondary",onClick:Se,disabled:K,children:[e.jsx(cs,{size:18,className:K?"spinning":""})," Refresh"]}),oe&&e.jsxs("button",{className:"del-btn del-btn-primary",onClick:()=>O(!P),children:[e.jsx(ds,{size:18})," Add Deliverable"]})]})]})}),e.jsxs("div",{className:"del-content",children:[e.jsxs("div",{className:"del-filters",children:[e.jsxs("select",{value:Z,onChange:s=>Y(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Milestones"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:B,onChange:s=>ee(s.target.value),className:"del-filter-select",children:[e.jsx("option",{value:"",children:"All Statuses"}),Xe().map(s=>e.jsx("option",{value:s,children:s},s))]}),de>0&&e.jsxs("button",{onClick:()=>{se(!W),W||(Y(""),ee(""))},className:`del-filter-badge ${W?"active":""}`,children:[e.jsx(_e,{size:16})," ",de," Awaiting Review"]})]}),P&&e.jsxs("div",{className:"del-add-form",children:[e.jsx("h3",{className:"del-add-form-title",children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:ye,children:[e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Ref *"}),e.jsx("input",{type:"text",value:i.deliverable_ref,onChange:s=>S({...i,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{className:"del-form-group",style:{flex:2},children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:s=>S({...i,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>S({...i,description:s.target.value})})]}),e.jsxs("div",{className:"del-form-row",children:[e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:i.milestone_id,onChange:s=>S({...i,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),v.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{className:"del-form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("div",{className:"del-form-readonly",children:(()=>{const s=v.find(n=>n.id===i.milestone_id);return s?.forecast_end_date?ne(s.forecast_end_date):"Select milestone"})()})]})]}),e.jsx(pe,{items:d,selectedIds:i.kpi_ids,onChange:s=>S({...i,kpi_ids:s}),renderItem:hs,label:"Link to KPIs",emptyMessage:"No KPIs available",variant:"blue"}),e.jsx(pe,{items:w,selectedIds:i.qs_ids,onChange:s=>S({...i,qs_ids:s}),renderItem:xs,label:"Link to Quality Standards",emptyMessage:"No Quality Standards available",variant:"purple"}),e.jsxs("div",{className:"del-form-actions",children:[e.jsxs("button",{type:"submit",className:"del-btn del-btn-primary",children:[e.jsx(Ne,{size:16})," Save"]}),e.jsxs("button",{type:"button",className:"del-btn del-btn-secondary",onClick:()=>O(!1),children:[e.jsx(be,{size:16})," Cancel"]})]})]})]}),e.jsxs("div",{className:"del-table-card",children:[e.jsxs("div",{className:"del-table-header",children:[e.jsx("h2",{className:"del-table-title",children:"Project Deliverables"}),e.jsxs("span",{className:"del-table-count",children:[R.length," deliverable",R.length!==1?"s":""]})]}),e.jsxs("table",{className:"del-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"})]})}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"del-empty-cell",children:"No deliverables found"})}):R.map(s=>{const n=me[s.status]||me[f.NOT_STARTED],l=n.icon;return e.jsxs("tr",{onClick:()=>Pe(s),children:[e.jsx("td",{children:e.jsx("span",{className:"del-ref",children:s.deliverable_ref})}),e.jsx("td",{children:e.jsx("span",{className:"del-name",children:s.name})}),e.jsx("td",{children:s.milestones?e.jsx("span",{className:"del-milestone-link",children:s.milestones.milestone_ref}):"—"}),e.jsx("td",{children:e.jsxs("span",{className:"del-status-badge",style:{backgroundColor:n.bg,color:n.color},children:[e.jsx(l,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{className:"del-progress",children:[e.jsx("div",{className:"del-progress-bar",children:e.jsx("div",{className:"del-progress-fill",style:{width:`${s.progress||0}%`,backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{className:"del-progress-text",children:[s.progress||0,"%"]})]})})]},s.id)})})]})]})]}),e.jsx(ps,{isOpen:z.isOpen,deliverable:z.deliverable,milestones:v,kpis:d,qualityStandards:w,canEdit:oe,canReview:Me,canDelete:Te,onClose:()=>H({isOpen:!1,deliverable:null}),onSave:ke,onStatusChange:Ce,onDelete:Re,onOpenCompletion:De,onSign:Ae}),M&&u&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal modal-lg",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h3",{className:"modal-title",children:[e.jsx(ce,{size:20,style:{color:"var(--color-success)"}})," Mark as Delivered"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{style:{color:"var(--color-text-secondary)",marginBottom:"var(--space-lg)"},children:[u.deliverable_ref," - ",u.name]}),u.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-warning-light)",borderLeft:"4px solid var(--color-warning)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)"},children:e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"})}),u.deliverable_kpis.map(s=>{const n=d.find(l=>l.id===s.kpi_id);return n?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-info",children:n.kpi_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:n.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>C({...k,[s.kpi_id]:!0}),className:`btn btn-sm ${k[s.kpi_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>C({...k,[s.kpi_id]:!1}),className:`btn btn-sm ${k[s.kpi_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.kpi_id):null})]}),u.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"var(--space-md)",backgroundColor:"var(--color-purple-light)",borderLeft:"4px solid var(--color-purple)",borderRadius:"var(--radius)",marginBottom:"var(--space-md)",marginTop:"var(--space-lg)"},children:e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment"})}),u.deliverable_quality_standards.map(s=>{const n=w.find(l=>l.id===s.quality_standard_id);return n?e.jsxs("div",{style:{padding:"var(--space-md)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",marginBottom:"var(--space-sm)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge badge-purple",children:n.qs_ref})," ",e.jsx("strong",{style:{marginLeft:"var(--space-sm)"},children:n.name})]}),e.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[e.jsx("button",{onClick:()=>J({...L,[s.quality_standard_id]:!0}),className:`btn btn-sm ${L[s.quality_standard_id]===!0?"btn-success":"btn-secondary"}`,children:"✓ Yes"}),e.jsx("button",{onClick:()=>J({...L,[s.quality_standard_id]:!1}),className:`btn btn-sm ${L[s.quality_standard_id]===!1?"btn-danger":"btn-secondary"}`,children:"✗ No"})]})]},s.quality_standard_id):null})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>Q(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:we,children:[e.jsx(ce,{size:16})," Mark Delivered"]})]})]})}),e.jsx(Je,{isOpen:q.isOpen,onClose:()=>X({isOpen:!1,deliverable:null}),onConfirm:Ee,title:"Delete Deliverable",message:q.deliverable?e.jsxs(e.Fragment,{children:["Are you sure you want to delete ",e.jsx("strong",{children:q.deliverable.deliverable_ref})," - ",q.deliverable.name,"?",e.jsx("br",{}),e.jsx("br",{}),"This action cannot be undone."]}):"",confirmText:"Delete",cancelText:"Cancel",type:"danger"})]})}export{ys as default};
