import{u as ve,a as ye,b as _e,c as ke,s as d,j as e,L as Ce,P as we}from"./index-DjXTtB8m.js";import{r as n,L as Se}from"./vendor-react-JFEV0ROX.js";import{u as Re}from"./usePermissions-BN-cu4kW.js";import{P as qe,H as De,b as F,N as U,a as Te,u as ze,s as V,h as Ne,a1 as Z,C as R,J as Y,T as Ie,I as Pe}from"./vendor-icons-Bd7vp13O.js";import"./vendor-supabase-DgEUAXvv.js";const $=["Not Started","In Progress","Submitted for Review","Returned for More Work","Review Complete","Delivered"],G={Delivered:{bg:"#dcfce7",color:"#16a34a",icon:R},"Review Complete":{bg:"#dbeafe",color:"#2563eb",icon:Z},"Submitted for Review":{bg:"#fef3c7",color:"#d97706",icon:F},"In Progress":{bg:"#e0e7ff",color:"#4f46e5",icon:Ne},"Returned for More Work":{bg:"#fee2e2",color:"#dc2626",icon:V},"Not Started":{bg:"#f1f5f9",color:"#64748b",icon:ze}};function J({kpis:g,selectedIds:o,onChange:u,label:k="Link to KPIs"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[k," (select all that apply)"]}),o.length>0&&e.jsx("button",{type:"button",onClick:()=>u([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear all"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:g.map(a=>{const m=o.includes(a.id);return e.jsxs("div",{onClick:()=>{u(m?o.filter(y=>y!==a.id):[...o,a.id])},style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:m?"#dbeafe":"#f8fafc",border:m?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{marginTop:"3px",width:"18px",height:"18px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.kpi_ref}),e.jsx("span",{style:{fontWeight:"600"},children:a.name})]}),a.description&&e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"#64748b",lineHeight:"1.4"},children:[a.description.substring(0,100),"..."]}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#16a34a",fontWeight:"500"},children:["Target: ",a.target,"%"]})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[o.length," KPI",o.length!==1?"s":""," selected"]})]})}function X({qualityStandards:g,selectedIds:o,onChange:u,label:k="Link to Quality Standards"}){return e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[k," (select all that apply)"]}),o.length>0&&e.jsx("button",{type:"button",onClick:()=>u([]),style:{fontSize:"0.8rem",color:"#dc2626",background:"none",border:"none",cursor:"pointer"},children:"Clear all"})]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:g.map(a=>{const m=o.includes(a.id);return e.jsxs("div",{onClick:()=>{u(m?o.filter(y=>y!==a.id):[...o,a.id])},style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",padding:"0.75rem",marginBottom:"0.5rem",backgroundColor:m?"#f3e8ff":"#f8fafc",border:m?"2px solid #8b5cf6":"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{marginTop:"3px",width:"18px",height:"18px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700"},children:a.qs_ref}),e.jsx("span",{style:{fontWeight:"600"},children:a.name})]}),a.description&&e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"#64748b",lineHeight:"1.4"},children:[a.description.substring(0,100),"..."]}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#16a34a",fontWeight:"500"},children:["Target: ",a.target,"%"]})]})]},a.id)})}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"#64748b"},children:[o.length," Quality Standard",o.length!==1?"s":""," selected"]})]})}function Qe(){const[g,o]=n.useState([]),[u,k]=n.useState([]),[a,m]=n.useState([]),[y,ee]=n.useState([]),[se,re]=n.useState(!0),[L,q]=n.useState(!1),[ie,D]=n.useState(!1),[te,T]=n.useState(!1),[c,le]=n.useState(null),[j,z]=n.useState({}),[v,N]=n.useState({}),[I,E]=n.useState(""),[P,Q]=n.useState(""),[w,ae]=n.useState(!1),{user:ne,role:We}=ve(),{projectId:h}=ye(),{showSuccess:de,showError:C,showWarning:K}=_e(),W=ne?.id||null,{canEditDeliverable:oe,canReviewDeliverable:ce}=Re(),{showTestUsers:B}=ke(),[l,x]=n.useState({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),[i,f]=n.useState({id:"",deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]});n.useEffect(()=>{h&&_()},[h]),n.useEffect(()=>{h&&_()},[B]);async function _(){if(h)try{const{data:s}=await d.from("milestones").select("*").eq("project_id",h).order("milestone_ref");k(s||[]);const{data:r}=await d.from("kpis").select("*").eq("project_id",h).order("kpi_ref");m(r||[]);const{data:t}=await d.from("quality_standards").select("*").eq("project_id",h).order("qs_ref");ee(t||[]);let p=d.from("deliverables").select("*, milestones(milestone_ref, name), deliverable_kpis(kpi_id, kpis(kpi_ref, name)), deliverable_quality_standards(quality_standard_id, quality_standards(qs_ref, name))").eq("project_id",h).order("deliverable_ref");B||(p=p.or("is_test_content.is.null,is_test_content.eq.false"));const{data:je}=await p;o(je||[])}catch{}finally{re(!1)}}async function pe(s){s.preventDefault();try{const{data:r,error:t}=await d.from("deliverables").insert({project_id:h,deliverable_ref:l.deliverable_ref,name:l.name,description:l.description,milestone_id:l.milestone_id||null,status:l.status,progress:parseInt(l.progress)||0,assigned_to:l.assigned_to,due_date:l.due_date||null,created_by:W}).select().single();if(t)throw t;l.kpi_ids.length>0&&await d.from("deliverable_kpis").insert(l.kpi_ids.map(p=>({deliverable_id:r.id,kpi_id:p}))),l.qs_ids.length>0&&await d.from("deliverable_quality_standards").insert(l.qs_ids.map(p=>({deliverable_id:r.id,quality_standard_id:p}))),x({deliverable_ref:"",name:"",description:"",milestone_id:"",status:"Not Started",progress:0,assigned_to:"",due_date:"",kpi_ids:[],qs_ids:[]}),q(!1),_()}catch(r){C("Failed: "+r.message)}}function ue(s){f({id:s.id,deliverable_ref:s.deliverable_ref,name:s.name,description:s.description||"",milestone_id:s.milestone_id||"",status:s.status,progress:s.progress||0,assigned_to:s.assigned_to||"",due_date:s.due_date||"",kpi_ids:s.deliverable_kpis?.map(r=>r.kpi_id)||[],qs_ids:s.deliverable_quality_standards?.map(r=>r.quality_standard_id)||[]}),D(!0)}async function me(){try{await d.from("deliverables").update({name:i.name,description:i.description,milestone_id:i.milestone_id||null,status:i.status,progress:parseInt(i.progress)||0,assigned_to:i.assigned_to,due_date:i.due_date||null}).eq("id",i.id),await d.from("deliverable_kpis").delete().eq("deliverable_id",i.id),i.kpi_ids.length>0&&await d.from("deliverable_kpis").insert(i.kpi_ids.map(s=>({deliverable_id:i.id,kpi_id:s}))),await d.from("deliverable_quality_standards").delete().eq("deliverable_id",i.id),i.qs_ids.length>0&&await d.from("deliverable_quality_standards").insert(i.qs_ids.map(s=>({deliverable_id:i.id,quality_standard_id:s}))),D(!1),_()}catch(s){C("Failed: "+s.message)}}async function A(s,r){try{let t=s.progress;r==="Not Started"?t=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?t=100:r==="Returned for More Work"&&(t=50),await d.from("deliverables").update({status:r,progress:t}).eq("id",s.id),_()}catch(t){C("Failed: "+t.message)}}function fe(s){le(s),z({}),N({}),T(!0)}async function ge(){if(!c)return;const s=c.deliverable_kpis||[],r=c.deliverable_quality_standards||[];if(s.length>0&&!s.every(t=>j[t.kpi_id]!==void 0)){K("Please assess all linked KPIs.");return}if(r.length>0&&!r.every(t=>v[t.quality_standard_id]!==void 0)){K("Please assess all linked Quality Standards.");return}try{await d.from("deliverables").update({status:"Delivered",progress:100}).eq("id",c.id);for(const t of s)await d.from("deliverable_kpi_assessments").upsert({deliverable_id:c.id,kpi_id:t.kpi_id,criteria_met:j[t.kpi_id],assessed_at:new Date().toISOString(),assessed_by:W},{onConflict:"deliverable_id,kpi_id"});for(const t of r)await d.from("deliverable_qs_assessments").upsert({deliverable_id:c.id,quality_standard_id:t.quality_standard_id,criteria_met:v[t.quality_standard_id],assessed_at:new Date().toISOString(),assessed_by:W},{onConflict:"deliverable_id,quality_standard_id"});de("Deliverable marked as delivered and assessments saved!"),T(!1),_()}catch(t){C("Failed: "+t.message)}}async function he(s){if(confirm("Delete this deliverable?"))try{await d.from("deliverables").delete().eq("id",s),_()}catch(r){C("Failed: "+r.message)}}let b=g;I&&(b=b.filter(s=>s.milestone_id===I)),P&&(b=b.filter(s=>s.status===P)),w&&(b=b.filter(s=>s.status==="Submitted for Review"));const H=g.length,M=g.filter(s=>s.status==="Submitted for Review").length,xe=g.filter(s=>s.status==="In Progress").length,be=g.filter(s=>s.status==="Delivered").length,S=oe,O=ce;return se?e.jsx(Ce,{message:"Loading deliverables...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(we,{icon:qe,title:"Deliverables",subtitle:"Track project deliverables with review workflow",children:S&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>q(!L),children:[e.jsx(De,{size:18})," Add Deliverable"]})}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Total Deliverables"}),e.jsx("div",{className:"stat-value",children:H})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#d97706"},children:"Submitted for Review"}),e.jsx("div",{className:"stat-value",style:{color:"#d97706"},children:M})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#4f46e5"},children:"In Progress"}),e.jsx("div",{className:"stat-value",style:{color:"#4f46e5"},children:xe})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",style:{color:"#16a34a"},children:"Delivered"}),e.jsx("div",{className:"stat-value",style:{color:"#16a34a"},children:be})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#64748b"},children:"Filter by:"}),e.jsxs("select",{value:I,onChange:s=>E(s.target.value),style:{minWidth:"200px"},children:[e.jsx("option",{value:"",children:"All Milestones"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]}),e.jsxs("select",{value:P,onChange:s=>Q(s.target.value),style:{minWidth:"150px"},children:[e.jsx("option",{value:"",children:"All Statuses"}),$.map(s=>e.jsx("option",{value:s,children:s},s))]}),M>0&&e.jsxs("button",{onClick:()=>{ae(!w),w||(E(""),Q(""))},style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:w?"#fef3c7":"#fffbeb",border:"1px solid #fbbf24",borderRadius:"6px",color:"#92400e",cursor:"pointer",fontWeight:"500"},children:[e.jsx(F,{size:16})," ",M," Awaiting Review"]}),e.jsxs("span",{style:{color:"#64748b",marginLeft:"auto"},children:["Showing ",b.length," of ",H]})]}),L&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{children:"Add New Deliverable"}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Reference *"}),e.jsx("input",{type:"text",value:l.deliverable_ref,onChange:s=>x({...l,deliverable_ref:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>x({...l,name:s.target.value}),required:!0})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:s=>x({...l,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone *"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>x({...l,milestone_id:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:l.assigned_to,onChange:s=>x({...l,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:l.due_date,onChange:s=>x({...l,due_date:s.target.value})})]})]}),e.jsx(J,{kpis:a,selectedIds:l.kpi_ids,onChange:s=>x({...l,kpi_ids:s})}),e.jsx(X,{qualityStandards:y,selectedIds:l.qs_ids,onChange:s=>x({...l,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",children:[e.jsx(U,{size:16})," Save Deliverable"]}),e.jsxs("button",{type:"button",className:"btn-secondary",onClick:()=>q(!1),children:[e.jsx(Te,{size:16})," Cancel"]})]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"KPIs"}),e.jsx("th",{children:"Quality"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No deliverables found"})}):b.map(s=>{const r=G[s.status]||G["Not Started"],t=r.icon;return e.jsxs("tr",{style:{backgroundColor:s.status==="Submitted for Review"?"#fffbeb":void 0},children:[e.jsx("td",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverable_ref}),e.jsx("td",{style:{fontWeight:"500"},children:s.name}),e.jsx("td",{children:s.milestones?e.jsx(Se,{to:`/milestones/${s.milestone_id}`,style:{color:"#3b82f6",textDecoration:"none"},children:s.milestones.milestone_ref}):"-"}),e.jsx("td",{children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem",backgroundColor:r.bg,color:r.color},children:[e.jsx(t,{size:14}),s.status]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${s.progress||0}%`,height:"100%",backgroundColor:s.status==="Delivered"?"#16a34a":"#4f46e5"}})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:[s.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:s.deliverable_kpis?.map(p=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#dbeafe",color:"#2563eb",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:p.kpis?.kpi_ref},p.kpi_id))})}),e.jsx("td",{children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:s.deliverable_quality_standards?.map(p=>e.jsx("span",{style:{padding:"0.125rem 0.375rem",backgroundColor:"#f3e8ff",color:"#7c3aed",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600"},children:p.quality_standards?.qs_ref},p.quality_standard_id))})}),e.jsx("td",{children:s.due_date?new Date(s.due_date).toLocaleDateString("en-GB"):"-"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[S&&e.jsx("button",{onClick:()=>ue(s),title:"Edit",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#64748b"},children:e.jsx(Y,{size:16})}),S&&["In Progress","Returned for More Work"].includes(s.status)&&e.jsx("button",{onClick:()=>A(s,"Submitted for Review"),title:"Submit for Review",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#d97706"},children:e.jsx(F,{size:16})}),O&&s.status==="Submitted for Review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>A(s,"Review Complete"),title:"Accept",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563eb"},children:e.jsx(Z,{size:16})}),e.jsx("button",{onClick:()=>A(s,"Returned for More Work"),title:"Return for More Work",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(V,{size:16})})]}),O&&s.status==="Review Complete"&&e.jsx("button",{onClick:()=>fe(s),title:"Mark Delivered",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#16a34a"},children:e.jsx(R,{size:16})}),S&&e.jsx("button",{onClick:()=>he(s.id),title:"Delete",style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#dc2626"},children:e.jsx(Ie,{size:16})})]})})]},s.id)})})]})}),ie&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:0},children:[e.jsx(Y,{size:20})," Edit Deliverable - ",i.deliverable_ref]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:i.deliverable_ref,disabled:!0,style:{backgroundColor:"#f1f5f9"}})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Name *"}),e.jsx("input",{type:"text",value:i.name,onChange:s=>f({...i,name:s.target.value})})]})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>f({...i,description:s.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:i.milestone_id,onChange:s=>f({...i,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),u.map(s=>e.jsx("option",{value:s.id,children:s.milestone_ref},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assigned To"}),e.jsx("input",{type:"text",value:i.assigned_to,onChange:s=>f({...i,assigned_to:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",value:i.due_date,onChange:s=>f({...i,due_date:s.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Status"}),e.jsx("select",{value:i.status,onChange:s=>{const r=s.target.value;let t=i.progress;r==="Not Started"?t=0:["Submitted for Review","Review Complete","Delivered"].includes(r)?t=100:r==="Returned for More Work"&&(t=50),f({...i,status:r,progress:t})},children:$.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{children:["Progress: ",i.progress,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:i.progress,onChange:s=>{const r=parseInt(s.target.value);let t=i.status;r===0&&i.status!=="Returned for More Work"?t="Not Started":r>0&&r<100&&i.status==="Not Started"&&(t="In Progress"),f({...i,progress:r,status:t})},style:{width:"100%"},disabled:["Delivered","Submitted for Review","Review Complete"].includes(i.status)})]})]}),e.jsx(J,{kpis:a,selectedIds:i.kpi_ids,onChange:s=>f({...i,kpi_ids:s})}),e.jsx(X,{qualityStandards:y,selectedIds:i.qs_ids,onChange:s=>f({...i,qs_ids:s})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>D(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:me,children:[e.jsx(U,{size:16})," Save Changes"]})]})]})}),te&&c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"700px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:0},children:[e.jsx(R,{size:20,style:{color:"#16a34a"}})," Mark as Delivered"]}),e.jsxs("p",{style:{color:"#64748b"},children:[c.deliverable_ref," - ",c.name]}),c.deliverable_kpis?.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderLeft:"4px solid #f59e0b",borderRadius:"4px",marginBottom:"1rem"},children:[e.jsx("strong",{style:{color:"#92400e"},children:"KPI Assessment Required"}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#92400e",fontSize:"0.9rem"},children:"Assess whether each KPI criteria was met."})]}),c.deliverable_kpis.map(s=>{const r=a.find(t=>t.id===s.kpi_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700",marginRight:"0.5rem"},children:r.kpi_ref}),e.jsx("strong",{children:r.name}),e.jsxs("p",{style:{fontSize:"0.85rem",color:"#16a34a",margin:"0.25rem 0"},children:["Target: ",r.target,"%"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>z({...j,[s.kpi_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:j[s.kpi_id]===!0?"#16a34a":"#f1f5f9",color:j[s.kpi_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>z({...j,[s.kpi_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:j[s.kpi_id]===!1?"#dc2626":"#f1f5f9",color:j[s.kpi_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]}),r.description&&e.jsxs("p",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",borderRadius:"4px",fontSize:"0.85rem",color:"#64748b"},children:[e.jsx("strong",{children:"Criteria:"})," ",r.description]})]},s.kpi_id):null})]}),c.deliverable_quality_standards?.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#f3e8ff",borderLeft:"4px solid #8b5cf6",borderRadius:"4px",marginBottom:"1rem",marginTop:"1rem"},children:[e.jsx("strong",{style:{color:"#6b21a8"},children:"Quality Standards Assessment Required"}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#6b21a8",fontSize:"0.9rem"},children:"Assess whether each Quality Standard was met."})]}),c.deliverable_quality_standards.map(s=>{const r=y.find(t=>t.id===s.quality_standard_id);return r?e.jsxs("div",{style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{backgroundColor:"#8b5cf6",color:"white",padding:"0.125rem 0.375rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"700",marginRight:"0.5rem"},children:r.qs_ref}),e.jsx("strong",{children:r.name}),e.jsxs("p",{style:{fontSize:"0.85rem",color:"#16a34a",margin:"0.25rem 0"},children:["Target: ",r.target,"%"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>N({...v,[s.quality_standard_id]:!0}),style:{padding:"0.5rem 1rem",backgroundColor:v[s.quality_standard_id]===!0?"#16a34a":"#f1f5f9",color:v[s.quality_standard_id]===!0?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✓ Yes"}),e.jsx("button",{onClick:()=>N({...v,[s.quality_standard_id]:!1}),style:{padding:"0.5rem 1rem",backgroundColor:v[s.quality_standard_id]===!1?"#dc2626":"#f1f5f9",color:v[s.quality_standard_id]===!1?"white":"#374151",border:"none",borderRadius:"6px",cursor:"pointer"},children:"✗ No"})]})]}),r.description&&e.jsxs("p",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",borderRadius:"4px",fontSize:"0.85rem",color:"#64748b"},children:[e.jsx("strong",{children:"Criteria:"})," ",r.description]}),r.measurement_criteria&&e.jsxs("p",{style:{marginTop:"0.25rem",padding:"0.5rem",backgroundColor:"#fefce8",borderRadius:"4px",fontSize:"0.85rem",color:"#a16207"},children:[e.jsx("strong",{children:"Measurement:"})," ",r.measurement_criteria]})]},s.quality_standard_id):null})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsxs("button",{className:"btn-primary",onClick:ge,style:{backgroundColor:"#16a34a"},children:[e.jsx(R,{size:16})," Mark as Delivered"]})]})]})}),e.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0fdf4",borderLeft:"4px solid #16a34a",borderRadius:"4px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx(Pe,{size:20,style:{color:"#16a34a",marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"Deliverable Workflow"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",color:"#166534",fontSize:"0.9rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"In Progress:"})," Contributor working on deliverable (can update progress %)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Submit for Review:"})," Contributor completes work and submits (sets progress to 100%)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Review:"})," Admin/Customer PM approves or returns for more work"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mark as Delivered:"})," After approval, assess KPIs and Quality Standards, then mark as delivered"]})]})]})]})})]})}export{Qe as default};
