import{c as g,r as d,a as J,s as w,j as e,L as K,e as v,m as Q,I as ee}from"./index-CspTly-R.js";import{u as te}from"./usePermissions-dxQSMTTA.js";import{C as se}from"./calendar-T5LAqPnk.js";import{E as ne}from"./eye-B_u6uLs8.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=g("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=g("GripHorizontal",[["circle",{cx:"12",cy:"9",r:"1",key:"124mty"}],["circle",{cx:"19",cy:"9",r:"1",key:"1ruzo2"}],["circle",{cx:"5",cy:"9",r:"1",key:"1a8b28"}],["circle",{cx:"12",cy:"15",r:"1",key:"1e56xg"}],["circle",{cx:"19",cy:"15",r:"1",key:"1a92ep"}],["circle",{cx:"5",cy:"15",r:"1",key:"5r1jwy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=g("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=g("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=g("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=g("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function ue(){const[u,D]=d.useState([]),[W,P]=d.useState(!0),[X,G]=d.useState(null),[h,S]=d.useState(null),[p,k]=d.useState(null),[b,V]=d.useState(.1),[o,z]=d.useState(null),[q,A]=d.useState(0),[x,F]=d.useState({}),T=d.useRef(null),{role:de}=J(),{canUseGantt:Z}=te(),y=Z;d.useEffect(()=>{O()},[]),d.useEffect(()=>{u.length>0&&H()},[u]);async function O(){try{const{data:t}=await w.from("projects").select("id").eq("reference","AMSF001").single();t&&(G(t.id),await I(t.id))}catch(t){console.error("Error:",t)}finally{P(!1)}}async function I(t){const s=t||X;try{const{data:n,error:a}=await w.from("milestones").select("*").eq("project_id",s).order("milestone_ref");if(a)throw a;D(n||[])}catch(n){console.error("Error fetching milestones:",n)}}function H(){let t=new Date,s=new Date;u.forEach(n=>{[n.baseline_start_date,n.baseline_end_date,n.actual_start_date,n.forecast_end_date,n.start_date,n.end_date].filter(Boolean).map(i=>new Date(i)).forEach(i=>{i<t&&(t=i),i>s&&(s=i)})}),t.setDate(t.getDate()-14),s.setDate(s.getDate()+14),S(t),k(s)}function m(t){return!h||!t?0:(new Date(t)-h)/(1e3*60*60*24)/b}function l(t){return t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"2-digit"}):"-"}function j(t){return t.toISOString().split("T")[0]}function _(t,s,n){y&&(t.preventDefault(),z({milestoneId:s.id,type:n}),A(t.clientX),F({actual_start_date:s.actual_start_date,forecast_end_date:s.forecast_end_date}),document.addEventListener("mousemove",C),document.addEventListener("mouseup",E))}function C(t){if(!o)return;const s=t.clientX-q,n=Math.round(s*b);D(a=>a.map(i=>{if(i.id!==o.milestoneId)return i;const f={...i};if(o.type==="move"){if(x.actual_start_date){const r=new Date(x.actual_start_date);r.setDate(r.getDate()+n),f.actual_start_date=j(r)}if(x.forecast_end_date){const r=new Date(x.forecast_end_date);r.setDate(r.getDate()+n),f.forecast_end_date=j(r)}}else if(o.type==="start"){if(x.actual_start_date){const r=new Date(x.actual_start_date);r.setDate(r.getDate()+n),f.actual_start_date=j(r)}}else if(o.type==="end"&&x.forecast_end_date){const r=new Date(x.forecast_end_date);r.setDate(r.getDate()+n),f.forecast_end_date=j(r)}return f}))}async function E(){if(document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",E),!o)return;const t=u.find(s=>s.id===o.milestoneId);if(t)try{const{error:s}=await w.from("milestones").update({actual_start_date:t.actual_start_date,forecast_end_date:t.forecast_end_date}).eq("id",t.id);if(s)throw s}catch(s){console.error("Error updating milestone:",s),alert("Failed to update milestone dates"),await I()}z(null)}function U(){if(!h||!p)return[];const t=[],s=new Date(h);for(;s<=p;)t.push({date:new Date(s),x:m(s),isMonthStart:s.getDate()===1,isWeekStart:s.getDay()===1}),s.setDate(s.getDate()+7);return t}function M(t){V(s=>t==="in"?Math.max(.02,s*.8):Math.min(.5,s*1.25))}function L(t){const s=t==="left"?-30:30;S(n=>{const a=new Date(n);return a.setDate(a.getDate()+s),a}),k(n=>{const a=new Date(n);return a.setDate(a.getDate()+s),a})}const Y=U(),B=h&&p?(p-h)/(1e3*60*60*24)/b:1e3;return W?e.jsx(K,{message:"Loading Gantt chart...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx(se,{size:28}),e.jsxs("div",{children:[e.jsx("h1",{children:"Project Gantt Chart"}),e.jsx("p",{children:"Visual timeline of milestone schedules"})]})]}),e.jsx(v,{to:"/milestones",className:"btn btn-secondary",children:"â† Back to Milestones"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>L("left"),style:{padding:"0.5rem"},children:e.jsx(ae,{size:20})}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>L("right"),style:{padding:"0.5rem"},children:e.jsx(Q,{size:20})}),e.jsxs("span",{style:{marginLeft:"0.5rem",fontSize:"0.9rem",color:"#64748b"},children:[h&&l(h)," - ",p&&l(p)]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>M("out"),style:{padding:"0.5rem"},title:"Zoom Out",children:e.jsx(le,{size:20})}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>M("in"),style:{padding:"0.5rem"},title:"Zoom In",children:e.jsx(oe,{size:20})})]})]}),e.jsx("div",{className:"card",style:{marginBottom:"1rem",padding:"0.75rem 1rem"},children:e.jsxs("div",{style:{display:"flex",gap:"2rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"24px",height:"12px",backgroundColor:"#94a3b8",borderRadius:"2px",opacity:.6}}),e.jsx("span",{style:{fontSize:"0.85rem"},children:"Baseline (fixed)"}),e.jsx(N,{size:14,style:{color:"#64748b"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"24px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),e.jsx("span",{style:{fontSize:"0.85rem"},children:"Actual/Forecast"}),y&&e.jsx(ie,{size:14,style:{color:"#3b82f6"}})]}),y?e.jsxs("div",{style:{marginLeft:"auto",fontSize:"0.85rem",color:"#16a34a",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(re,{size:14}),"Drag blue bars to adjust dates"]}):e.jsxs("div",{style:{marginLeft:"auto",fontSize:"0.85rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f1f5f9",padding:"0.375rem 0.75rem",borderRadius:"6px"},children:[e.jsx(ne,{size:14}),"View only mode"]})]})}),e.jsx("div",{className:"card",style:{overflow:"hidden"},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{minWidth:"200px",borderRight:"1px solid #e2e8f0",backgroundColor:"#f8fafc",flexShrink:0},children:[e.jsx("div",{style:{padding:"0.75rem",fontWeight:"600",borderBottom:"1px solid #e2e8f0",height:"40px",display:"flex",alignItems:"center"},children:"Milestone"}),u.map(t=>{var s,n;return e.jsxs("div",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #f1f5f9",height:"80px",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(v,{to:`/milestones/${t.id}`,style:{fontWeight:"600",color:"#3b82f6",textDecoration:"none",fontSize:"0.9rem"},children:t.milestone_ref}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#64748b",marginTop:"0.25rem"},children:[(s=t.name)==null?void 0:s.substring(0,25),((n=t.name)==null?void 0:n.length)>25?"...":""]})]},t.id)})]}),e.jsx("div",{ref:T,style:{flex:1,overflowX:"auto",overflowY:"hidden"},children:e.jsxs("div",{style:{minWidth:`${B}px`,position:"relative"},children:[e.jsx("div",{style:{height:"40px",borderBottom:"1px solid #e2e8f0",position:"relative",backgroundColor:"#f8fafc"},children:Y.map((t,s)=>e.jsx("div",{style:{position:"absolute",left:`${t.x}px`,top:0,height:"100%",borderLeft:t.isMonthStart?"2px solid #cbd5e1":"1px solid #e2e8f0",paddingLeft:"4px",fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center"},children:t.date.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})},s))}),u.map(t=>{const s=t.baseline_start_date||t.start_date,n=t.baseline_end_date||t.end_date,a=t.actual_start_date||t.start_date,i=t.forecast_end_date||t.end_date,f=m(s),r=Math.max(20,m(n)-f),R=m(a),$=Math.max(20,m(i)-R);return e.jsxs("div",{style:{height:"80px",borderBottom:"1px solid #f1f5f9",position:"relative"},children:[s&&n&&e.jsxs("div",{style:{position:"absolute",left:`${f}px`,top:"12px",width:`${r}px`,height:"20px",backgroundColor:"#94a3b8",opacity:.5,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",color:"white",overflow:"hidden",whiteSpace:"nowrap"},title:`Baseline: ${l(s)} - ${l(n)}`,children:[e.jsx(N,{size:10,style:{marginRight:"2px"}}),"Baseline"]}),a&&i&&e.jsxs("div",{style:{position:"absolute",left:`${R}px`,top:"40px",width:`${$}px`,height:"24px",backgroundColor:(o==null?void 0:o.milestoneId)===t.id?"#2563eb":"#3b82f6",borderRadius:"4px",display:"flex",alignItems:"center",cursor:y?"move":"default",boxShadow:(o==null?void 0:o.milestoneId)===t.id?"0 4px 12px rgba(59, 130, 246, 0.4)":"none",transition:o?"none":"box-shadow 0.2s"},title:`Actual/Forecast: ${l(a)} - ${l(i)}`,onMouseDown:c=>_(c,t,"move"),children:[y&&e.jsx("div",{style:{position:"absolute",left:0,top:0,width:"8px",height:"100%",cursor:"ew-resize",backgroundColor:"rgba(255,255,255,0.3)",borderRadius:"4px 0 0 4px"},onMouseDown:c=>{c.stopPropagation(),_(c,t,"start")}}),e.jsx("div",{style:{flex:1,textAlign:"center",fontSize:"0.75rem",color:"white",fontWeight:"500",overflow:"hidden",whiteSpace:"nowrap",padding:"0 10px"},children:$>100?`${l(a)} - ${l(i)}`:""}),y&&e.jsx("div",{style:{position:"absolute",right:0,top:0,width:"8px",height:"100%",cursor:"ew-resize",backgroundColor:"rgba(255,255,255,0.3)",borderRadius:"0 4px 4px 0"},onMouseDown:c=>{c.stopPropagation(),_(c,t,"end")}})]}),(()=>{const c=m(new Date);return c>0&&c<B?e.jsx("div",{style:{position:"absolute",left:`${c}px`,top:0,bottom:0,width:"2px",backgroundColor:"#ef4444",opacity:.6,zIndex:5}}):null})()]},t.id)})]})})]})}),e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Milestone Date Summary"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Baseline Start"}),e.jsx("th",{children:"Baseline End"}),e.jsx("th",{children:"Actual Start"}),e.jsx("th",{children:"Forecast End"}),e.jsx("th",{children:"Variance (days)"})]})}),e.jsx("tbody",{children:u.map(t=>{const s=t.baseline_end_date||t.end_date,n=t.forecast_end_date||t.end_date;let a=0;return s&&n&&(a=Math.round((new Date(n)-new Date(s))/(1e3*60*60*24))),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(v,{to:`/milestones/${t.id}`,style:{fontFamily:"monospace",fontWeight:"600",color:"#3b82f6"},children:t.milestone_ref})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:l(t.baseline_start_date||t.start_date)}),e.jsx("td",{children:l(t.baseline_end_date||t.end_date)}),e.jsx("td",{children:l(t.actual_start_date||t.start_date)}),e.jsx("td",{children:l(t.forecast_end_date||t.end_date)}),e.jsxs("td",{style:{fontWeight:"600",color:a>0?"#dc2626":a<0?"#16a34a":"#64748b"},children:[a>0?`+${a}`:a," days"]})]},t.id)})})]})]}),e.jsx("div",{className:"card",style:{marginTop:"1.5rem",backgroundColor:"#eff6ff",borderLeft:"4px solid #3b82f6"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[e.jsx(ee,{size:20,style:{color:"#3b82f6",marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#1e40af"},children:"Using the Gantt Chart"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",color:"#1e40af",fontSize:"0.9rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Baseline bars (grey):"})," Fixed dates representing the original plan - cannot be moved"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Actual/Forecast bars (blue):"})," Current schedule - drag to adjust dates"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Drag the whole bar:"})," Move both start and end dates together"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Drag the edges:"})," Adjust start or end date independently"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Red line:"})," Today's date"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Variance:"})," Positive = behind schedule, Negative = ahead of schedule"]}),e.jsx("li",{children:"Changes are saved automatically when you release the mouse"})]})]})]})})]})}export{ue as default};
