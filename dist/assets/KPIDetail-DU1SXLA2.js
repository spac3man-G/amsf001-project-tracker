import{a as B,u as z,k as j,j as e,L as K}from"./index-BOr3szbO.js";import{f as q,u as F,r as n}from"./vendor-react-JFEV0ROX.js";import{u as T}from"./usePermissions-CQB5ABO2.js";import{A as v,$ as b,q as A,Z as w,R as D,_ as R,a as W,I as N,J as E,F as L}from"./vendor-icons-BZZethZ5.js";import"./vendor-supabase-DgEUAXvv.js";function X(){const{id:c}=q(),g=F(),{project:M}=B(),{role:H}=z(),{canManageKPIs:C}=T(),[s,h]=n.useState(null),[_,d]=n.useState(!0),[o,f]=n.useState(!1),[r,m]=n.useState(!1),[a,l]=n.useState({});n.useEffect(()=>{p()},[c]);async function p(){try{d(!0);const t=await j.getById(c);if(!t){h(null),d(!1);return}h(t),l({name:t.name||"",category:t.category||"",target:t.target||"",current_value:t.current_value||"",description:t.description||"",measurement_method:t.measurement_method||"",frequency:t.frequency||"",data_source:t.data_source||"",calculation:t.calculation||"",remediation:t.remediation||"",notes:t.notes||""})}catch{}finally{d(!1)}}async function P(){f(!0);try{const t={name:a.name,category:a.category,target:parseFloat(a.target)||null,current_value:parseFloat(a.current_value)||null,description:a.description,measurement_method:a.measurement_method,frequency:a.frequency,data_source:a.data_source,calculation:a.calculation,remediation:a.remediation,notes:a.notes};await j.update(c,t),await p(),m(!1),alert("KPI updated successfully!")}catch(t){alert("Failed to update KPI: "+t.message)}finally{f(!1)}}function S(t,k){const y=parseFloat(t)||0,I=parseFloat(k)||100,u=y/I*100;return y===0?{status:"Not Started",color:"#64748b",bg:"#f1f5f9"}:u>=100?{status:"Achieved",color:"#10b981",bg:"#f0fdf4"}:u>=80?{status:"On Track",color:"#3b82f6",bg:"#eff6ff"}:u>=60?{status:"At Risk",color:"#f59e0b",bg:"#fffbeb"}:{status:"Critical",color:"#ef4444",bg:"#fef2f2"}}if(_)return e.jsx(K,{message:"Loading KPI details...",size:"large",fullPage:!0});if(!s)return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx(v,{size:48,style:{color:"#f59e0b",marginBottom:"1rem"}}),e.jsx("h2",{children:"KPI Not Found"}),e.jsx("p",{style:{color:"#64748b"},children:"The requested KPI could not be found."}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>g("/kpis"),style:{marginTop:"1rem"},children:[e.jsx(b,{size:16})," Back to KPIs"]})]})});const i=S(s.current_value,s.target),x=C;return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("button",{onClick:()=>g("/kpis"),style:{background:"none",border:"none",cursor:"pointer",marginRight:"0.5rem"},children:e.jsx(b,{size:24})}),e.jsx(A,{size:28}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h1",{children:s.kpi_ref}),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:i.bg,color:i.color},children:i.status})]}),e.jsx("p",{children:s.name})]})]}),x&&!r&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>m(!0),children:[e.jsx(w,{size:18})," Edit KPI Details"]}),r&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-primary",onClick:P,disabled:o,children:[o?e.jsx(D,{size:18,className:"spin"}):e.jsx(R,{size:18}),o?"Saving...":"Save Changes"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>{m(!1),l({name:s.name||"",category:s.category||"",target:s.target||"",current_value:s.current_value||"",description:s.description||"",measurement_method:s.measurement_method||"",frequency:s.frequency||"",data_source:s.data_source||"",calculation:s.calculation||"",remediation:s.remediation||"",notes:s.notes||""})},disabled:o,children:[e.jsx(W,{size:18})," Cancel"]})]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Target"}),e.jsxs("div",{className:"stat-value",style:{color:"#3b82f6"},children:[s.target||"-","%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Current"}),e.jsxs("div",{className:"stat-value",style:{color:i.color},children:[s.current_value||"0","%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Category"}),e.jsx("div",{className:"stat-value",style:{fontSize:"1rem"},children:s.category})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-label",children:"Status"}),e.jsx("div",{className:"stat-value",style:{color:i.color,fontSize:"1rem"},children:i.status})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx(N,{size:20})," Description"]}),r?e.jsx("textarea",{className:"form-input",rows:4,value:a.description,onChange:t=>l({...a,description:t.target.value}),placeholder:"Enter KPI description..."}):e.jsx("p",{style:{color:"#374151",lineHeight:"1.6"},children:s.description||"No description available."})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx(E,{size:20})," Measurement Method"]}),r?e.jsx("textarea",{className:"form-input",rows:3,value:a.measurement_method,onChange:t=>l({...a,measurement_method:t.target.value}),placeholder:"How is this KPI measured?"}):e.jsx("p",{style:{color:"#374151",lineHeight:"1.6"},children:s.measurement_method||"Not specified."})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx(L,{size:20})," Calculation Formula"]}),r?e.jsx("textarea",{className:"form-input",rows:2,value:a.calculation,onChange:t=>l({...a,calculation:t.target.value}),placeholder:"Formula or method for calculating this KPI..."}):e.jsx("p",{style:{color:"#374151",fontFamily:"monospace",backgroundColor:"#f1f5f9",padding:"0.75rem",borderRadius:"4px"},children:s.calculation||"Not specified."})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",backgroundColor:"#fffbeb",borderLeft:"4px solid #f59e0b"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",color:"#92400e"},children:[e.jsx(v,{size:20})," Remediation Actions"]}),r?e.jsx("textarea",{className:"form-input",rows:3,value:a.remediation,onChange:t=>l({...a,remediation:t.target.value}),placeholder:"What actions are required if target is not met?"}):e.jsx("p",{style:{color:"#92400e",lineHeight:"1.6"},children:s.remediation||"Not specified."})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Details"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"Category"}),r?e.jsxs("select",{className:"form-input",value:a.category,onChange:t=>l({...a,category:t.target.value}),children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Time Performance",children:"Time Performance"}),e.jsx("option",{value:"Quality of Collaboration",children:"Quality of Collaboration"}),e.jsx("option",{value:"Delivery Performance",children:"Delivery Performance"})]}):e.jsx("div",{style:{fontWeight:"500"},children:s.category||"Not specified"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"Frequency"}),r?e.jsxs("select",{className:"form-input",value:a.frequency,onChange:t=>l({...a,frequency:t.target.value}),children:[e.jsx("option",{value:"",children:"Select frequency"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Quarterly",children:"Quarterly"}),e.jsx("option",{value:"Per Deliverable",children:"Per Deliverable"}),e.jsx("option",{value:"Annually",children:"Annually"})]}):e.jsx("div",{style:{fontWeight:"500"},children:s.frequency||"Not specified"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"Data Source"}),r?e.jsx("input",{type:"text",className:"form-input",value:a.data_source,onChange:t=>l({...a,data_source:t.target.value}),placeholder:"Where does the data come from?"}):e.jsx("div",{style:{fontWeight:"500"},children:s.data_source||"Not specified"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"Target Value"}),r?e.jsx("input",{type:"number",className:"form-input",value:a.target,onChange:t=>l({...a,target:t.target.value}),placeholder:"Target %",min:"0",max:"100"}):e.jsxs("div",{style:{fontWeight:"500"},children:[s.target||"-","%"]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"Current Value"}),r?e.jsx("input",{type:"number",className:"form-input",value:a.current_value,onChange:t=>l({...a,current_value:t.target.value}),placeholder:"Current %",min:"0",max:"100"}):e.jsxs("div",{style:{fontWeight:"500",color:i.color},children:[s.current_value||"0","%"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Notes"}),r?e.jsx("textarea",{className:"form-input",rows:4,value:a.notes,onChange:t=>l({...a,notes:t.target.value}),placeholder:"Additional notes about this KPI..."}):e.jsx("p",{style:{color:s.notes?"#374151":"#9ca3af",lineHeight:"1.6"},children:s.notes||"No additional notes."})]}),!x&&e.jsx("div",{className:"card",style:{marginTop:"1rem",backgroundColor:"#f1f5f9",borderLeft:"4px solid #64748b"},children:e.jsxs("p",{style:{fontSize:"0.85rem",color:"#64748b",margin:0},children:[e.jsx(N,{size:14,style:{display:"inline",marginRight:"0.5rem",verticalAlign:"middle"}}),"Only Supplier PM and Admin can edit KPIs."]})})]})]})]})}export{X as default};
