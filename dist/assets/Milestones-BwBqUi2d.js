import{j as e,u as me,a as ue,c as he,d as ge,m as f,e as xe,L as pe,s as fe}from"./index-DBy7juAg.js";import{d as be,r as m}from"./vendor-react-BUTV5ZEl.js";import{C as je}from"./ConfirmDialog-C4qxA-j9.js";import{f as ye,a as ve}from"./formatters-BTbCMDgc.js";import{l as H,b as _e,ai as G,aj as q,ak as Ce,c as Se,al as Ne,R as we,Y as Me,am as Be,I as ke}from"./vendor-icons-L8EmaAR6.js";import{c as Ae,a as ze,g as De,b as Pe}from"./milestoneCalculations-DrXGKoUD.js";import"./vendor-supabase-6faYzd5A.js";import"./deliverableCalculations-DFwkFn9z.js";function Re(t){switch(t){case"Signed":return{bg:"#dcfce7",color:"#16a34a"};case"Pending Supplier Signature":return{bg:"#fef3c7",color:"#d97706"};case"Pending Customer Signature":return{bg:"#dbeafe",color:"#2563eb"};case"Draft":return{bg:"#f1f5f9",color:"#64748b"};default:return{bg:"#f1f5f9",color:"#64748b"}}}function We({certificate:t,onClose:i,onSign:g,canSignSupplier:x,canSignCustomer:l}){if(!t)return null;const a=Re(t.status);return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"12px",maxWidth:"700px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{textAlign:"center",borderBottom:"2px solid #10b981",paddingBottom:"1rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(H,{size:32,style:{color:"#10b981"}}),e.jsx("h2",{style:{margin:0,color:"#166534"},children:"Milestone Acceptance Certificate"})]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#64748b"},children:["Certificate No: ",e.jsx("strong",{children:t.certificate_number})]}),e.jsx("div",{style:{display:"inline-block",marginTop:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"999px",fontSize:"0.85rem",fontWeight:"600",backgroundColor:a.bg,color:a.color},children:t.status})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.75rem 0",color:"#1e293b"},children:"Milestone Details"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",backgroundColor:"#f8fafc",padding:"1rem",borderRadius:"8px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Reference"}),e.jsx("div",{style:{fontWeight:"600"},children:t.milestone_ref})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Name"}),e.jsx("div",{style:{fontWeight:"600"},children:t.milestone_name})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Payment Milestone Associated"}),e.jsxs("div",{style:{fontWeight:"700",fontSize:"1.25rem",color:"#10b981"},children:["Â£",(t.payment_milestone_value||0).toLocaleString()]})]})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.75rem 0",color:"#1e293b"},children:"Deliverables Accepted"}),e.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:"8px",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Ref"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Name"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Status"})]})}),e.jsx("tbody",{children:(t.deliverables_snapshot||[]).map((u,h)=>e.jsxs("tr",{style:{borderTop:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.5rem",fontFamily:"monospace",fontWeight:"600"},children:u.deliverable_ref}),e.jsx("td",{style:{padding:"0.5rem"},children:u.name}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",color:"#16a34a"},children:[e.jsx(_e,{size:14})," Accepted"]})})]},h))})]})})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.75rem 0",color:"#1e293b"},children:"Signatures"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsx(U,{label:"Supplier PM",signedBy:t.supplier_pm_name,signedAt:t.supplier_pm_signed_at,canSign:x&&t.status!=="Signed",onSign:()=>g("supplier"),buttonText:"Sign as Supplier PM",buttonColor:"#10b981"}),e.jsx(U,{label:"Customer PM",signedBy:t.customer_pm_name,signedAt:t.customer_pm_signed_at,canSign:l&&t.status!=="Signed",onSign:()=>g("customer"),buttonText:"Sign as Customer PM",buttonColor:"#3b82f6"})]})]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#64748b",textAlign:"center",marginBottom:"1rem"},children:["Generated: ",new Date(t.generated_at).toLocaleString("en-GB")]}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{onClick:i,style:{padding:"0.75rem 2rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500"},children:"Close"})})]})})}function U({label:t,signedBy:i,signedAt:g,canSign:x,onSign:l,buttonText:a,buttonColor:u}){const h=!!g;return e.jsxs("div",{style:{padding:"1rem",border:"2px solid",borderColor:h?"#10b981":"#e2e8f0",borderRadius:"8px",backgroundColor:h?"#f0fdf4":"#f8fafc"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:t}),h?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontWeight:"600",color:"#166534"},children:[e.jsx(G,{size:16}),i]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b",marginTop:"0.25rem"},children:new Date(g).toLocaleString("en-GB")})]}):x?e.jsxs("button",{onClick:l,style:{width:"100%",padding:"0.5rem",backgroundColor:u,color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:"500"},children:[e.jsx(G,{size:16})," ",a]}):e.jsx("div",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Awaiting signature"})]})}function Ie({form:t,onFormChange:i,onSubmit:g,onCancel:x}){return e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",border:"2px solid #10b981"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Add New Milestone"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Milestone Reference *"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"M01",value:t.milestone_ref,onChange:l=>i({...t,milestone_ref:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Name *"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Milestone name",value:t.name,onChange:l=>i({...t,name:l.target.value})})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-input",rows:2,placeholder:"Description",value:t.description,onChange:l=>i({...t,description:l.target.value})})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#64748b"},children:"Baseline Schedule (Original Plan)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Baseline Start Date"}),e.jsx("input",{type:"date",className:"form-input",value:t.baseline_start_date||t.start_date,onChange:l=>i({...t,baseline_start_date:l.target.value,start_date:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Baseline End Date"}),e.jsx("input",{type:"date",className:"form-input",value:t.baseline_end_date||t.end_date,onChange:l=>i({...t,baseline_end_date:l.target.value,end_date:l.target.value})})]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#64748b"},children:"Current Schedule"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Actual Start Date"}),e.jsx("input",{type:"date",className:"form-input",value:t.actual_start_date||t.start_date,onChange:l=>i({...t,actual_start_date:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Forecast End Date"}),e.jsx("input",{type:"date",className:"form-input",value:t.forecast_end_date||t.end_date,onChange:l=>i({...t,forecast_end_date:l.target.value})})]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{className:"form-label",children:"Billable Amount (Â£)"}),e.jsx("input",{type:"number",className:"form-input",placeholder:"0",style:{maxWidth:"200px"},value:t.billable,onChange:l=>i({...t,billable:l.target.value})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",margin:"0.25rem 0 0 0"},children:"The amount that can be invoiced when this milestone is completed (not a budget for doing the work)"})]}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#eff6ff",borderRadius:"6px",marginBottom:"1rem",fontSize:"0.9rem",color:"#1e40af"},children:[e.jsx("strong",{children:"Note:"})," Milestone status and progress will be automatically calculated from associated deliverables."]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-primary",onClick:g,children:[e.jsx(q,{size:16})," Add Milestone"]}),e.jsx("button",{className:"btn btn-secondary",onClick:x,children:"Cancel"})]})]})}function Te({form:t,onFormChange:i,onSave:g,onClose:x}){const l={width:"100%",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px"};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"12px",maxWidth:"600px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:0},children:[e.jsx(Ce,{size:20}),"Edit Milestone - ",t.milestone_ref]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Reference *"}),e.jsx("input",{type:"text",value:t.milestone_ref,onChange:a=>i({...t,milestone_ref:a.target.value}),style:l})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Name *"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>i({...t,name:a.target.value}),style:l})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Description"}),e.jsx("textarea",{value:t.description,onChange:a=>i({...t,description:a.target.value}),rows:3,style:l})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"0.85rem",color:"#64748b"},children:"Baseline Schedule (Original Plan)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Baseline Start"}),e.jsx("input",{type:"date",value:t.baseline_start_date,onChange:a=>i({...t,baseline_start_date:a.target.value}),style:l})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Baseline End"}),e.jsx("input",{type:"date",value:t.baseline_end_date,onChange:a=>i({...t,baseline_end_date:a.target.value}),style:l})]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"0.85rem",color:"#64748b"},children:"Current Schedule"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Actual Start"}),e.jsx("input",{type:"date",value:t.actual_start_date,onChange:a=>i({...t,actual_start_date:a.target.value}),style:l})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Forecast End"}),e.jsx("input",{type:"date",value:t.forecast_end_date,onChange:a=>i({...t,forecast_end_date:a.target.value}),style:l})]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontWeight:"500",marginBottom:"0.25rem"},children:"Billable Amount (Â£)"}),e.jsx("input",{type:"number",value:t.billable,onChange:a=>i({...t,billable:a.target.value}),style:{...l,width:"200px"}}),e.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",margin:"0.25rem 0 0 0"},children:"Amount invoiced when milestone is completed (not a budget for doing the work)"})]}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#eff6ff",borderRadius:"6px",marginBottom:"1rem",fontSize:"0.9rem",color:"#1e40af"},children:[e.jsx("strong",{children:"ðŸ’¡ Note:"})," Status and progress are ",e.jsx("strong",{children:"automatically calculated"})," from associated deliverables and cannot be manually edited.",e.jsxs("ul",{style:{margin:"0.5rem 0 0 1rem",paddingLeft:"0.5rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Not Started"})," â€” No deliverables have begun"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"In Progress"})," â€” At least one deliverable is in progress"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Completed"})," â€” All deliverables are delivered"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem"},children:[e.jsxs("button",{onClick:x,style:{padding:"0.5rem 1rem",backgroundColor:"#f1f5f9",color:"#64748b",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(Se,{size:16})," Cancel"]}),e.jsxs("button",{onClick:g,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(Ne,{size:16})," Save Changes"]})]})]})})}function Xe(){const t=be(),{user:i,role:g,profile:x}=me(),{projectId:l}=ue(),{showSuccess:a,showError:u,showWarning:h}=he(),w=i?.id||null,V=x?.full_name||i?.email||"Unknown",{canCreateMilestone:Ee,canEditMilestone:X,canDeleteMilestone:Le,canSignAsSupplier:D,canSignAsCustomer:P}=ge(),[C,Y]=m.useState([]),[y,J]=m.useState({}),[M,K]=m.useState({}),[Q,Z]=m.useState(!0),[R,W]=m.useState(!1),[I,B]=m.useState(!1),[ee,T]=m.useState(!1),[te,E]=m.useState(!1),[b,L]=m.useState(null),[v,O]=m.useState({isOpen:!1,milestone:null}),[se,$]=m.useState(!1),k={milestone_ref:"",name:"",description:"",baseline_start_date:"",baseline_end_date:"",actual_start_date:"",forecast_end_date:"",start_date:"",end_date:"",billable:""},[n,F]=m.useState(k),[o,le]=m.useState({id:"",...k});m.useEffect(()=>{l&&(_(l),S(l))},[l]);async function S(s){try{const r=await f.getCertificates(s||l),c={};r.forEach(d=>{c[d.milestone_id]=d}),K(c)}catch{}}async function _(s){const r=s||l;try{const c=await f.getAll(r,{orderBy:{column:"milestone_ref",ascending:!0}});if(Y(c||[]),c&&c.length>0){const d=c.map(p=>p.id),j=await xe.getAll(r,{filters:[{column:"milestone_id",operator:"in",value:d}],select:"id, milestone_id, status, progress"});if(j){const p={};j.forEach(N=>{p[N.milestone_id]||(p[N.milestone_id]=[]),p[N.milestone_id].push(N)}),J(p)}}}catch{u("Failed to load milestones")}finally{Z(!1),W(!1)}}async function ae(){W(!0),await _(),await S()}async function ie(){if(!n.milestone_ref||!n.name){h("Please fill in at least Milestone Reference and Name");return}try{await f.create({project_id:l,milestone_ref:n.milestone_ref,name:n.name,description:n.description,start_date:n.start_date||n.baseline_start_date||null,end_date:n.end_date||n.baseline_end_date||null,baseline_start_date:n.baseline_start_date||n.start_date||null,baseline_end_date:n.baseline_end_date||n.end_date||null,actual_start_date:n.actual_start_date||n.start_date||null,forecast_end_date:n.forecast_end_date||n.end_date||null,billable:parseFloat(n.billable)||0,progress:0,status:"Not Started",created_by:w}),await _(),B(!1),F(k),a("Milestone added successfully!")}catch(s){u("Failed to add milestone: "+s.message)}}async function ne(){const s=v.milestone;if(s){$(!0);try{await f.delete(s.id),await _(),O({isOpen:!1,milestone:null}),a("Milestone deleted successfully!")}catch(r){u("Failed to delete milestone: "+r.message)}finally{$(!1)}}}async function re(){if(!o.milestone_ref||!o.name){h("Please fill in at least Milestone Reference and Name");return}try{await f.update(o.id,{milestone_ref:o.milestone_ref,name:o.name,description:o.description,start_date:o.start_date||o.baseline_start_date||null,end_date:o.end_date||o.baseline_end_date||null,baseline_start_date:o.baseline_start_date||null,baseline_end_date:o.baseline_end_date||null,actual_start_date:o.actual_start_date||null,forecast_end_date:o.forecast_end_date||null,billable:parseFloat(o.billable)||0}),await _(),T(!1),a("Milestone updated successfully!")}catch(s){u("Failed to update milestone: "+s.message)}}async function de(s){const r=y[s.id]||[];if(!(r.length>0&&r.every(d=>d.status==="Delivered"))){h("Cannot generate certificate: All deliverables must be delivered first.");return}if(M[s.id]){A(s);return}try{const{data:d}=await fe.from("deliverables").select("deliverable_ref, name, status, progress").eq("milestone_id",s.id).eq("status","Delivered"),j=`CERT-${s.milestone_ref}-${Date.now().toString(36).toUpperCase()}`;await f.createCertificate({project_id:l,milestone_id:s.id,certificate_number:j,milestone_ref:s.milestone_ref,milestone_name:s.name,payment_milestone_value:s.billable||0,status:"Draft",deliverables_snapshot:d||[],generated_by:w}),await S(),A(s),a("Certificate generated successfully!")}catch(d){u("Failed to generate certificate: "+d.message)}}function A(s){const r=M[s.id];L({...r,milestone:s,deliverables:y[s.id]||[]}),E(!0)}async function oe(s){if(!b)return;const r=s==="supplier",c=s==="customer";if(r&&!D){h("Only Admin or Supplier PM can sign as supplier.");return}if(c&&!P){h("Only Customer PM can sign as customer.");return}try{await f.signCertificate(b.id,s,w,V),await S();const d=await f.getCertificateByMilestoneId(b.milestone.id);d&&L({...d,milestone:b.milestone,deliverables:b.deliverables}),a("Certificate signed successfully!")}catch(d){u("Failed to sign certificate: "+d.message)}}const z=X;if(Q)return e.jsx(pe,{message:"Loading milestones...",size:"large",fullPage:!0});const ce=C.map(s=>({...s,computedStatus:ze(y[s.id]),computedProgress:Ae(y[s.id])}));return e.jsxs("div",{className:"milestones-page",children:[e.jsx("header",{className:"ms-header",children:e.jsxs("div",{className:"ms-header-content",children:[e.jsxs("div",{className:"ms-header-left",children:[e.jsx("h1",{children:"Milestones"}),e.jsx("p",{children:"Track project milestones and deliverables"})]}),e.jsxs("div",{className:"ms-header-actions",children:[e.jsxs("button",{className:"ms-btn ms-btn-secondary",onClick:ae,disabled:R,children:[e.jsx(we,{size:18,className:R?"spinning":""}),"Refresh"]}),z&&!I&&e.jsxs("button",{className:"ms-btn ms-btn-primary",onClick:()=>B(!0),children:[e.jsx(q,{size:18}),"Add Milestone"]})]})]})}),e.jsxs("div",{className:"ms-content",children:[I&&z&&e.jsx(Ie,{form:n,onFormChange:F,onSubmit:ie,onCancel:()=>B(!1)}),e.jsxs("div",{className:"ms-table-card",children:[e.jsxs("div",{className:"ms-table-header",children:[e.jsx("h2",{className:"ms-table-title",children:"Project Milestones"}),e.jsxs("span",{className:"ms-table-count",children:[C.length," milestone",C.length!==1?"s":""]})]}),C.length===0?e.jsxs("div",{className:"ms-empty",children:[e.jsx("div",{className:"ms-empty-icon",children:e.jsx(Me,{size:32})}),e.jsx("div",{className:"ms-empty-title",children:"No milestones found"}),e.jsx("div",{className:"ms-empty-text",children:'Click "Add Milestone" to create your first milestone.'})]}):e.jsxs("table",{className:"ms-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Forecast End"}),e.jsx("th",{children:"Billable"}),e.jsx("th",{children:"Certificate"})]})}),e.jsx("tbody",{children:ce.map(s=>{const r=M[s.id],c=y[s.id]?.length||0,d=De(s.computedStatus),j=r?Pe(r.status):null;return e.jsxs("tr",{onClick:()=>t(`/milestones/${s.id}`),children:[e.jsx("td",{children:e.jsx("span",{className:"ms-ref",children:s.milestone_ref})}),e.jsxs("td",{children:[e.jsx("div",{className:"ms-name",children:s.name}),c>0&&e.jsxs("div",{className:"ms-name-sub",children:[c," deliverable",c!==1?"s":""]})]}),e.jsx("td",{children:e.jsxs("span",{className:`ms-status-badge ${d}`,children:[e.jsx("span",{className:"ms-status-dot"}),s.computedStatus]})}),e.jsx("td",{children:e.jsxs("span",{className:`ms-progress ${d}`,children:[s.computedProgress,"%"]})}),e.jsx("td",{children:e.jsx("span",{className:"ms-date",children:ye(s.forecast_end_date||s.end_date)})}),e.jsx("td",{children:e.jsx("span",{className:"ms-billable",children:ve(s.billable)})}),e.jsx("td",{onClick:p=>p.stopPropagation(),children:s.computedStatus!=="Completed"?e.jsx("span",{className:"ms-cert-badge not-ready",children:"Not ready"}):r?e.jsxs("button",{className:`ms-cert-badge ${j?.cssClass||""}`,onClick:()=>A(s),children:[e.jsx(Be,{size:14}),j?.label||"View"]}):z?e.jsxs("button",{className:"ms-cert-badge generate",onClick:()=>de(s),children:[e.jsx(H,{size:14}),"Generate"]}):null})]},s.id)})})]})]}),e.jsxs("div",{className:"ms-info-box",children:[e.jsxs("div",{className:"ms-info-header",children:[e.jsx(ke,{size:18}),"How Milestone Status & Progress Work"]}),e.jsxs("ul",{className:"ms-info-list",children:[e.jsxs("li",{children:["Milestone ",e.jsx("strong",{children:"status"})," and ",e.jsx("strong",{children:"progress"})," are automatically calculated from deliverables"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Not Started:"}),' All deliverables are "Not Started" (or no deliverables exist)']}),e.jsxs("li",{children:[e.jsx("strong",{children:"In Progress:"})," At least one deliverable has begun work"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Completed:"})," All deliverables have been delivered"]}),e.jsx("li",{children:"Click any milestone row to view and manage its deliverables"})]})]})]}),ee&&e.jsx(Te,{form:o,onFormChange:le,onSave:re,onClose:()=>T(!1)}),te&&b&&e.jsx(We,{certificate:b,onClose:()=>E(!1),onSign:oe,canSignSupplier:D,canSignCustomer:P}),e.jsx(je,{isOpen:v.isOpen,onClose:()=>O({isOpen:!1,milestone:null}),onConfirm:ne,title:"Delete Milestone?",message:v.milestone?`This will permanently delete "${v.milestone.milestone_ref}: ${v.milestone.name}" and all associated deliverables. This action cannot be undone.`:"",confirmText:"Delete Milestone",cancelText:"Cancel",type:"danger",isLoading:se})]})}export{Xe as default};
