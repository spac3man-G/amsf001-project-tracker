import{u as Q,a as $,b as B,j as e}from"./index-3cilKHzN.js";import{d as F,u as P,r as i}from"./vendor-react-BUTV5ZEl.js";import{aa as U,B as b,D as X,T as Z,g as C,j as G,b as K,p as O,ab as V,m as J,A as Y,F as ee,H as se,U as ae,Z as z,d as te,e as ie,f as le,R as ce,X as q,i as ne}from"./vendor-icons-CtZxSxcO.js";import"./vendor-supabase-6faYzd5A.js";const w=[{id:"status",label:"Project Status",icon:G,query:"What's the current project status?"},{id:"pending",label:"My Actions",icon:K,query:"What do I need to do?"},{id:"timesheets",label:"My Hours",icon:O,query:"Show my timesheets this week"},{id:"budget",label:"Budget",icon:V,query:"What's the budget status?"},{id:"milestones",label:"Milestones",icon:J,query:"What milestones are due soon?"},{id:"atrisk",label:"At Risk",icon:Y,query:"What's at risk in the project?"},{id:"deliverables",label:"Deliverables",icon:ee,query:"Show deliverables awaiting review"},{id:"help",label:"What Can I Do?",icon:se,query:"What can my role do in this project?"}];function be(){const n=F(),r=P(),{profile:l}=Q(),{projectName:o,projectRef:j}=$(),{messages:a,isLoading:c,isLoadingContext:I,error:x,retryCount:p,sendMessage:g,clearChat:S,cancelRequest:T,dismissError:M,downloadChat:R,copyMessage:E}=B(),[h,f]=i.useState(""),[m,N]=i.useState(null),[d,u]=i.useState(!0),v=i.useRef(null),k=i.useRef(null);i.useEffect(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[a]),i.useEffect(()=>{setTimeout(()=>k.current?.focus(),300)},[]),i.useEffect(()=>{if(m!==null){const s=setTimeout(()=>N(null),2e3);return()=>clearTimeout(s)}},[m]),i.useEffect(()=>{a.length>0&&u(!1)},[a.length]);const W=s=>{s.preventDefault(),h.trim()&&!c&&(g(h),f(""))},y=s=>{c||(g(s),u(!1))},L=async(s,t)=>{await E(s)&&N(t)},D=()=>{r.state?.from?n(r.state.from):n("/dashboard")},_={role:"assistant",content:`Hi${l?.full_name?` ${l.full_name.split(" ")[0]}`:""}! ðŸ‘‹

I'm your Project Assistant. Ask me anything about **${o||"your project"}**.

Tap a quick action below or type your question!`},H=a.length===0?[_]:a;return e.jsxs("div",{className:"mobile-chat",children:[e.jsxs("header",{className:"mobile-chat-header",children:[e.jsx("button",{className:"mobile-chat-back",onClick:D,"aria-label":"Go back",children:e.jsx(U,{size:24})}),e.jsxs("div",{className:"mobile-chat-title",children:[e.jsxs("div",{className:"mobile-chat-title-main",children:[e.jsx(b,{size:20}),e.jsx("span",{children:"Project Assistant"})]}),j&&e.jsx("span",{className:"mobile-chat-project",children:j})]}),e.jsx("div",{className:"mobile-chat-actions",children:a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mobile-chat-action",onClick:R,title:"Export chat",children:e.jsx(X,{size:20})}),e.jsx("button",{className:"mobile-chat-action",onClick:S,title:"Clear chat",children:e.jsx(Z,{size:20})})]})})]}),I&&e.jsxs("div",{className:"mobile-chat-context-loading",children:[e.jsx(C,{size:14,className:"spinning"}),e.jsx("span",{children:"Loading project data..."})]}),d&&a.length===0&&e.jsx("div",{className:"mobile-chat-quick-actions",children:e.jsx("div",{className:"mobile-chat-quick-grid",children:w.map(s=>{const t=s.icon;return e.jsxs("button",{className:"mobile-chat-quick-btn",onClick:()=>y(s.query),disabled:c,children:[e.jsx(t,{size:20}),e.jsx("span",{children:s.label})]},s.id)})})}),e.jsxs("div",{className:"mobile-chat-messages",children:[H.map((s,t)=>e.jsxs("div",{className:`mobile-chat-message ${s.role==="user"?"mobile-chat-message-user":"mobile-chat-message-assistant"} ${s.streaming?"mobile-chat-message-streaming":""}`,children:[e.jsx("div",{className:"mobile-chat-message-avatar",children:s.role==="user"?e.jsx(ae,{size:16}):e.jsx(b,{size:16})}),e.jsxs("div",{className:"mobile-chat-message-content",children:[e.jsx(oe,{content:s.content}),e.jsxs("div",{className:"mobile-chat-message-meta",children:[s.local&&e.jsx("span",{className:"mobile-chat-indicator",title:"Instant response",children:e.jsx(z,{size:12})}),s.toolsUsed&&e.jsx("span",{className:"mobile-chat-indicator",title:"Queried data",children:e.jsx(te,{size:12})}),e.jsx("button",{className:"mobile-chat-copy-btn",onClick:()=>L(s.content,t),children:m===t?e.jsx(ie,{size:14,className:"copied"}):e.jsx(le,{size:14})})]})]})]},t)),c&&e.jsxs("div",{className:"mobile-chat-message mobile-chat-message-assistant",children:[e.jsx("div",{className:"mobile-chat-message-avatar",children:e.jsx(b,{size:16})}),e.jsxs("div",{className:"mobile-chat-message-content mobile-chat-typing",children:[p>0?e.jsxs(e.Fragment,{children:[e.jsx(ce,{size:16,className:"spinning"}),e.jsxs("span",{children:["Retrying (",p,"/2)..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:16,className:"spinning"}),e.jsx("span",{children:"Thinking..."})]}),e.jsx("button",{className:"mobile-chat-cancel",onClick:T,children:e.jsx(q,{size:16})})]})]}),x&&e.jsxs("div",{className:"mobile-chat-error",children:[e.jsx("span",{children:x}),e.jsx("button",{onClick:M,children:e.jsx(q,{size:16})})]}),e.jsx("div",{ref:v})]}),a.length>0&&!d&&e.jsx("button",{className:"mobile-chat-show-actions",onClick:()=>u(!0),children:"Quick Actions"}),d&&a.length>0&&e.jsx("div",{className:"mobile-chat-quick-collapsed",children:e.jsx("div",{className:"mobile-chat-quick-scroll",children:w.map(s=>{const t=s.icon;return e.jsxs("button",{className:"mobile-chat-quick-chip",onClick:()=>y(s.query),disabled:c,children:[e.jsx(t,{size:14}),e.jsx("span",{children:s.label})]},s.id)})})}),e.jsxs("form",{className:"mobile-chat-input-form",onSubmit:W,children:[e.jsx("input",{ref:k,type:"text",className:"mobile-chat-input",value:h,onChange:s=>f(s.target.value),placeholder:"Ask about your project...",disabled:c}),e.jsx("button",{type:"submit",className:"mobile-chat-send",disabled:!h.trim()||c,children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{className:"mobile-chat-footer",children:[e.jsx(z,{size:12}),e.jsx("span",{children:"Powered by Claude AI"})]})]})}function oe({content:n}){const r=n.split(`
`);return e.jsx("div",{className:"mobile-chat-text",children:r.map((l,o)=>l.startsWith("â€¢ ")||l.startsWith("- ")?e.jsxs("div",{className:"mobile-chat-bullet",children:[e.jsx("span",{className:"bullet",children:"â€¢"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:A(l.substring(2))}})]},o):l.trim()===""?e.jsx("div",{className:"mobile-chat-break"},o):e.jsx("p",{dangerouslySetInnerHTML:{__html:A(l)}},o))})}function A(n){return n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}export{be as default};
