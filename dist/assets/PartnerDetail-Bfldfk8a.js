import{j as e,n as ae,u as we,a as ke,d as Ne,p as ne,r as Te,t as Ie,V as De,l as Ee,o as ie,L as Fe,i as Be}from"./index-DpzM1rF-.js";import{r as p,d as oe,i as Re}from"./vendor-react-BUTV5ZEl.js";import{T as Pe}from"./timesheetCalculations-CqT_rZ40.js";import{S as L}from"./StatCard-CiI0rkNi.js";import{a5 as X,az as We,b as Le,o as F,p as H,n as de,h as ce,c as J,aA as Me,F as E,a as He,al as Ve,E as Oe,q as me,ah as le,ak as $e,ac as Ge,U as Ue,a7 as Ye,af as qe}from"./vendor-icons-CWM4So-G.js";import"./vendor-supabase-6faYzd5A.js";function Xe({invoice:t,partner:n,onClose:r,onPrint:l}){if(!t)return null;const o=t.invoice_type||"combined",s=o==="combined"||o==="timesheets",m=o==="combined"||o==="expenses",f=parseFloat(t.timesheet_total||0),v=t.groupedLines?.partnerExpenses||[],d=t.groupedLines?.supplierExpenses||[],A=v.reduce((i,h)=>i+parseFloat(h.line_total||0),0),j=v.filter(i=>i.chargeable_to_customer).reduce((i,h)=>i+parseFloat(h.line_total||0),0),N=v.filter(i=>!i.chargeable_to_customer).reduce((i,h)=>i+parseFloat(h.line_total||0),0),a=d.reduce((i,h)=>i+parseFloat(h.line_total||0),0),C=d.filter(i=>i.chargeable_to_customer).reduce((i,h)=>i+parseFloat(h.line_total||0),0),b=d.filter(i=>!i.chargeable_to_customer).reduce((i,h)=>i+parseFloat(h.line_total||0),0),_=A+a,S=j+C,w=N+b,T=f+A,y=!t.groupedLines?.timesheets?.length&&!t.groupedLines?.partnerExpenses?.length&&!t.groupedLines?.supplierExpenses?.length;return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",padding:"2rem",maxWidth:"900px",width:"95%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{id:"invoice-print-content",children:[e.jsx(Je,{invoice:t}),e.jsx(Ke,{timesheetTotal:f,chargeablePartnerExpenses:j,nonChargeablePartnerExpenses:N,invoiceTotal:T,partnerName:n?.name,invoiceType:o}),m&&e.jsx(Qe,{allExpensesTotal:_,allChargeableExpenses:S,allNonChargeableExpenses:w,partnerExpensesTotal:A,supplierExpensesTotal:a,partnerName:n?.name}),s&&t.groupedLines?.timesheets?.length>0&&e.jsx(Ze,{timesheets:t.groupedLines.timesheets,total:t.timesheet_total}),m&&t.groupedLines?.partnerExpenses?.length>0&&e.jsx(et,{expenses:t.groupedLines.partnerExpenses,total:t.expense_total,partnerName:n?.name}),m&&e.jsx(tt,{expenses:t.groupedLines?.supplierExpenses||[],total:t.supplier_expense_total}),y&&e.jsxs("div",{style:{textAlign:"center",padding:"2rem",backgroundColor:"#fef3c7",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(X,{size:32,style:{color:"#92400e",marginBottom:"0.5rem"}}),e.jsxs("p",{style:{color:"#92400e",margin:0},children:["No approved or submitted ",o==="timesheets"?"timesheets":o==="expenses"?"expenses":"timesheets/expenses"," found for this period."]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",borderTop:"1px solid #e2e8f0",paddingTop:"1rem"},children:[e.jsxs("button",{className:"btn btn-secondary",onClick:l,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(We,{size:16}),"Print / Save PDF"]}),e.jsx("button",{className:"btn btn-secondary",onClick:r,children:"Close"})]})]})})}function Je({invoice:t}){const n=t.invoice_type||"combined",r={combined:{label:"Combined",color:"#16a34a",bg:"#dcfce7"},timesheets:{label:"Timesheets Only",color:"#2563eb",bg:"#dbeafe"},expenses:{label:"Expenses Only",color:"#d97706",bg:"#fef3c7"}},{label:l,color:o,bg:s}=r[n]||r.combined;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#dcfce7",borderRadius:"50%",padding:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Le,{size:24,style:{color:"#16a34a"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h2",{style:{margin:0},children:"Invoice Generated"}),e.jsx("span",{style:{padding:"0.2rem 0.6rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"600",backgroundColor:s,color:o,textTransform:"uppercase"},children:l})]}),e.jsx("p",{style:{margin:0,color:"#64748b"},children:t.invoice_number})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Period"}),e.jsxs("div",{style:{fontWeight:"500"},children:[new Date(t.period_start).toLocaleDateString("en-GB")," - ",new Date(t.period_end).toLocaleDateString("en-GB")]})]})]})}function Ke({timesheetTotal:t,chargeablePartnerExpenses:n,nonChargeablePartnerExpenses:r,invoiceTotal:l,partnerName:o,invoiceType:s="combined"}){const m=s==="combined"||s==="timesheets",f=s==="combined"||s==="expenses",v=s==="timesheets"?t:s==="expenses"?n+r:l,d=m&&f?"1fr 1fr 1fr 1fr":m?"1fr 1fr":f?"1fr 1fr 1fr":"1fr";return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:d,gap:"0.75rem",marginBottom:"1.5rem"},children:[m&&e.jsxs("div",{style:{backgroundColor:"#dbeafe",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.7rem",color:"#1e40af",textTransform:"uppercase",fontWeight:"600"},children:"Timesheets"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#1e40af"},children:["£",t.toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#3b82f6"},children:"All billable"})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{backgroundColor:"#dcfce7",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.7rem",color:"#16a34a",textTransform:"uppercase",fontWeight:"600"},children:"Expenses Billable"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#16a34a"},children:["£",n.toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#22c55e"},children:"Chargeable to customer"})]}),e.jsxs("div",{style:{backgroundColor:"#fee2e2",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.7rem",color:"#dc2626",textTransform:"uppercase",fontWeight:"600"},children:"Expenses Non-Billable"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#dc2626"},children:["£",r.toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#ef4444"},children:"Not chargeable"})]})]}),e.jsxs("div",{style:{backgroundColor:"#7c3aed",borderRadius:"8px",padding:"1rem",color:"white"},children:[e.jsx("div",{style:{fontSize:"0.7rem",textTransform:"uppercase",fontWeight:"600",opacity:.9},children:"Invoice Total"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700"},children:["£",v.toFixed(2)]}),e.jsxs("div",{style:{fontSize:"0.65rem",opacity:.85},children:["To be paid by ",o]})]})]})}function Qe({allExpensesTotal:t,allChargeableExpenses:n,allNonChargeableExpenses:r,partnerExpensesTotal:l,supplierExpensesTotal:o,partnerName:s}){const m=s?.split(" ")[0]||"Partner";return e.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem",border:"1px solid #e2e8f0"},children:[e.jsxs("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.85rem",color:"#475569",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(F,{size:16}),"Expenses Breakdown"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"0.5rem",fontSize:"0.8rem"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"0.75rem",backgroundColor:"#e2e8f0",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#64748b",fontSize:"0.65rem",marginBottom:"0.25rem"},children:"Total Expenses"}),e.jsxs("div",{style:{fontWeight:"700",color:"#334155"},children:["£",t.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#16a34a",fontSize:"0.65rem",marginBottom:"0.25rem"},children:"Chargeable to Customer"}),e.jsxs("div",{style:{fontWeight:"700",color:"#16a34a"},children:["£",n.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.75rem",backgroundColor:"#fee2e2",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#dc2626",fontSize:"0.65rem",marginBottom:"0.25rem"},children:"Not Chargeable"}),e.jsxs("div",{style:{fontWeight:"700",color:"#dc2626"},children:["£",r.toFixed(2)]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.75rem",backgroundColor:"#f3e8ff",borderRadius:"6px"},children:[e.jsxs("div",{style:{color:"#7c3aed",fontSize:"0.65rem",marginBottom:"0.25rem"},children:["Paid by ",m]}),e.jsxs("div",{style:{fontWeight:"700",color:"#7c3aed"},children:["£",l.toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"#a78bfa"},children:"On this invoice"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#92400e",fontSize:"0.65rem",marginBottom:"0.25rem"},children:"Paid by Supplier"}),e.jsxs("div",{style:{fontWeight:"700",color:"#92400e"},children:["£",o.toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"#b45309"},children:"Not on this invoice"})]})]})]})}function Ze({timesheets:t,total:n}){return e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(H,{size:18,style:{color:"#1e40af"}}),"Timesheets (",t.length," entries)"]}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",fontSize:"0.85rem",border:"1px solid #e2e8f0",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#dbeafe"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Hours"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Cost/Day"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Status"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Total"})]})}),e.jsx("tbody",{children:t.map((r,l)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(r.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:r.resource_name}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right"},children:[parseFloat(r.hours||r.quantity||0).toFixed(1),"h"]}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(r.cost_price||r.unit_price||0).toFixed(0)]}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:r.source_status==="Approved"?"#dcfce7":"#fef3c7",color:r.source_status==="Approved"?"#16a34a":"#92400e"},children:r.source_status})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(r.line_total).toFixed(2)]})]},l))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f5f9",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Timesheet Total:"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n||0).toFixed(2)]})]})})]})})]})}function et({expenses:t,total:n,partnerName:r}){return e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(F,{size:18,style:{color:"#7c3aed"}}),"Partner-Procured Expenses (",t.length," entries)",e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#7c3aed"},children:["- Billed to ",r]})]}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",fontSize:"0.85rem",border:"1px solid #e9d5ff",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f3e8ff"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:t.map((l,o)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(l.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:l.resource_name}),e.jsx("td",{style:{padding:"0.5rem"},children:l.expense_category}),e.jsx("td",{style:{padding:"0.5rem",color:"#64748b",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:l.description.split(": ").slice(1).join(": ")||l.description}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:l.chargeable_to_customer?"#dcfce7":"#fee2e2",color:l.chargeable_to_customer?"#16a34a":"#dc2626"},children:l.chargeable_to_customer?"Yes":"No"})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(l.line_total).toFixed(2)]})]},o))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f5f9",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Partner Expenses Total:"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n||0).toFixed(2)]})]})})]})})]})}function tt({expenses:t,total:n}){return e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{backgroundColor:"#fef3c7",border:"2px dashed #f59e0b",borderRadius:"8px",padding:"1rem",marginBottom:"0.5rem"},children:[e.jsxs("h4",{style:{margin:"0 0 0.5rem 0",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e"},children:[e.jsx(de,{size:18}),"Supplier-Procured Expenses",e.jsx("span",{style:{fontSize:"0.65rem",fontWeight:"600",backgroundColor:"#92400e",color:"white",padding:"0.15rem 0.5rem",borderRadius:"4px",marginLeft:"0.5rem"},children:"NOT ON THIS INVOICE"})]}),e.jsx("p",{style:{margin:0,fontSize:"0.8rem",color:"#78350f"},children:"These expenses were paid by the supplier and must be reconciled separately. The supplier should pass these charges to the customer via their own invoicing process."})]}),t.length>0?e.jsx("div",{style:{fontSize:"0.85rem",border:"1px solid #fde68a",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#fef3c7"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:t.map((r,l)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:"#fffbeb"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(r.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:r.resource_name}),e.jsx("td",{style:{padding:"0.5rem"},children:r.expense_category}),e.jsx("td",{style:{padding:"0.5rem",color:"#64748b",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:r.description.split(": ").slice(1).join(": ")||r.description}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:r.chargeable_to_customer?"#dcfce7":"#fee2e2",color:r.chargeable_to_customer?"#16a34a":"#dc2626"},children:r.chargeable_to_customer?"Yes":"No"})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(r.line_total).toFixed(2)]})]},l))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#fef3c7",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Supplier Expenses Total (to be billed separately):"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n||0).toFixed(2)]})]})})]})}):e.jsxs("div",{style:{textAlign:"center",padding:"1rem",backgroundColor:"#fffbeb",borderRadius:"8px",border:"1px solid #fde68a",color:"#92400e"},children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem"},children:"No supplier-procured expenses for this period."}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.75rem",color:"#a16207"},children:'When expenses are marked as "Paid by: Supplier" they will appear here.'})]})]})}const rt=[{value:"combined",label:"Timesheets & Expenses",icon:E,description:"Full invoice with all items"},{value:"timesheets",label:"Timesheets Only",icon:H,description:"Work hours and day rates only"},{value:"expenses",label:"Expenses Only",icon:F,description:"Partner expenses only"}];function st({dateRange:t,selectedMonth:n,onMonthSelect:r,onDateRangeChange:l,onClear:o,onGenerateInvoice:s,generatingInvoice:m,getDateRangeLabel:f}){const[v,d]=p.useState(!1);function A(){const a=[],C=new Date;for(let b=0;b<12;b++){const _=new Date(C.getFullYear(),C.getMonth()-b,1),S=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`,w=_.toLocaleDateString("en-GB",{month:"long",year:"numeric"});a.push({value:S,label:w})}return a}function j(a){d(!1),s(a)}const N=t.start&&t.end;return e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ce,{size:18,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500",color:"#374151"},children:"Period:"})]}),e.jsxs("select",{value:n,onChange:a=>r(a.target.value),className:"input-field",style:{minWidth:"160px"},children:[e.jsx("option",{value:"",children:"Select Month..."}),A().map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsx("span",{style:{color:"#9ca3af"},children:"or"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"date",value:t.start||"",onChange:a=>l("start",a.target.value),className:"input-field",style:{width:"140px"}}),e.jsx("span",{style:{color:"#6b7280"},children:"to"}),e.jsx("input",{type:"date",value:t.end||"",onChange:a=>l("end",a.target.value),className:"input-field",style:{width:"140px"}})]}),(t.start||t.end)&&e.jsxs("button",{onClick:o,className:"btn btn-secondary",style:{padding:"0.4rem 0.75rem",fontSize:"0.85rem"},children:[e.jsx(J,{size:14})," Clear"]}),e.jsxs("div",{style:{marginLeft:"auto",padding:"0.4rem 0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",color:"#0369a1",fontWeight:"500",fontSize:"0.9rem"},children:["Showing: ",f()]})]}),N&&e.jsx("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>d(!v),disabled:m,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:m?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:18,className:"spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{size:18}),"Generate Invoice for ",f(),e.jsx(He,{size:16,style:{marginLeft:"0.25rem"}})]})}),v&&!m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>d(!1)}),e.jsxs("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",border:"1px solid #e5e7eb",minWidth:"280px",zIndex:20,overflow:"hidden"},children:[e.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},children:e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#6b7280",textTransform:"uppercase"},children:"Select Invoice Type"})}),rt.map(a=>{const C=a.icon;return e.jsxs("button",{onClick:()=>j(a.value),style:{display:"flex",alignItems:"flex-start",gap:"12px",width:"100%",padding:"12px 16px",border:"none",background:"none",cursor:"pointer",textAlign:"left",transition:"background-color 0.15s"},onMouseEnter:b=>b.currentTarget.style.backgroundColor="#f3f4f6",onMouseLeave:b=>b.currentTarget.style.backgroundColor="transparent",children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:a.value==="combined"?"#dcfce7":a.value==="timesheets"?"#dbeafe":"#fef3c7",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(C,{size:18,style:{color:a.value==="combined"?"#16a34a":a.value==="timesheets"?"#2563eb":"#d97706"}})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",color:"#1f2937",fontSize:"0.9rem"},children:a.label}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#6b7280",marginTop:"2px"},children:a.description})]})]},a.value)})]})]})]})})]})}function nt({editForm:t,onFormChange:n,onSave:r,onCancel:l,saving:o}){return e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Partner Name *"}),e.jsx("input",{type:"text",className:"input-field",value:t.name,onChange:s=>n({...t,name:s.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Contact Name"}),e.jsx("input",{type:"text",className:"input-field",value:t.contact_name,onChange:s=>n({...t,contact_name:s.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Contact Email"}),e.jsx("input",{type:"email",className:"input-field",value:t.contact_email,onChange:s=>n({...t,contact_email:s.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Payment Terms"}),e.jsxs("select",{className:"input-field",value:t.payment_terms,onChange:s=>n({...t,payment_terms:s.target.value}),style:{width:"100%"},children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:s=>n({...t,is_active:s.target.checked})}),"Active Partner"]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Notes"}),e.jsx("textarea",{className:"input-field",value:t.notes,onChange:s=>n({...t,notes:s.target.value}),rows:3,style:{width:"100%",resize:"vertical"}})]})]}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.75rem"},children:[e.jsx("button",{className:"btn btn-primary",onClick:r,disabled:o,children:o?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ve,{size:16})," Save Changes"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:l,disabled:o,children:[e.jsx(J,{size:16})," Cancel"]})]})]})}function pe(t){switch(t){case"Approved":case"Paid":return{bg:"#dcfce7",color:"#16a34a"};case"Submitted":case"Sent":return{bg:"#fef3c7",color:"#d97706"};case"Rejected":case"Overdue":return{bg:"#fee2e2",color:"#dc2626"};default:return{bg:"#f1f5f9",color:"#64748b"}}}function it({resources:t}){const n=oe();return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Linked Resources"})}),t.length>0?e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Name"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Role"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Cost/Day"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{onClick:()=>n(`/resources/${r.id}`),style:{cursor:"pointer"},className:"hover-row",children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"#2563eb",fontWeight:"500"},children:r.name}),e.jsx(Oe,{size:12,style:{color:"#9ca3af"}})]})}),e.jsx("td",{style:{padding:"0.75rem",color:"#64748b"},children:r.role}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace"},children:r.cost_price?`£${r.cost_price}`:"-"})]},r.id))})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(me,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsx("p",{children:"No resources linked to this partner"}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:"Assign resources to this partner from the Resources page"})]})]})}function lt({timesheets:t,limit:n=10}){return t?.length?e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(H,{size:18,style:{marginRight:"0.5rem"}}),"Recent Timesheets"]})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Hours"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Value"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:t.slice(0,n).map(r=>{const l=parseFloat(r.hours_worked||r.hours||0),o=r.resources?.cost_price||0,s=ae(l,o),m=pe(r.status);return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(r.date).toLocaleDateString()}),e.jsx("td",{style:{padding:"0.75rem"},children:r.resources?.name}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:[l.toFixed(1),"h"]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace"},children:["£",s.toFixed(0)]}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:m.bg,color:m.color},children:r.status})})]},r.id)})})]})})]}):null}function at({expenses:t}){return t?.length?e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(F,{size:18,style:{marginRight:"0.5rem"}}),"Recent Expenses"]})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Procured By"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:t.map(n=>{const r=n.procurement_method==="partner";return e.jsxs("tr",{style:{backgroundColor:r?"#faf5ff":"inherit"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(n.expense_date).toLocaleDateString()}),e.jsx("td",{style:{padding:"0.75rem"},children:n.resource_name}),e.jsx("td",{style:{padding:"0.75rem"},children:n.category}),e.jsx("td",{style:{padding:"0.75rem"},children:n.reason}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:r?"#f3e8ff":"#fef3c7",color:r?"#7c3aed":"#92400e"},children:r?"Partner":"Supplier"})}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n.amount).toFixed(2)]})]},n.id)})})]})})]}):null}function ot({invoices:t}){return t?.length?e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(E,{size:18,style:{marginRight:"0.5rem"}}),"Recent Invoices"]})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Invoice #"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Period"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Total"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"})]})}),e.jsx("tbody",{children:t.map(n=>{const r=pe(n.status);return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontWeight:"500"},children:n.invoice_number}),e.jsxs("td",{style:{padding:"0.75rem"},children:[new Date(n.period_start).toLocaleDateString()," - ",new Date(n.period_end).toLocaleDateString()]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:["£",parseFloat(n.invoice_total).toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:r.bg,color:r.color},children:n.status})}),e.jsx("td",{style:{padding:"0.75rem",color:"#64748b"},children:new Date(n.invoice_date).toLocaleDateString()})]},n.id)})})]})})]}):null}function gt(){const{id:t}=Re(),n=oe(),{user:r}=we(),{projectId:l}=ke(),{canManagePartners:o}=Ne(),[s,m]=p.useState(null),[f,v]=p.useState([]),[d,A]=p.useState({totalHours:0,approvedHours:0,pendingHours:0,totalValue:0,approvedValue:0,pendingValue:0,entries:[]}),[j,N]=p.useState({totalAmount:0,partnerProcuredAmount:0,entries:[]}),[a,C]=p.useState(!0),[b,_]=p.useState(!1),[S,w]=p.useState(!1),[T,y]=p.useState(null),[i,h]=p.useState({start:null,end:null}),[V,O]=p.useState(""),[he,K]=p.useState(!1),[xe,ge]=p.useState([]),[ue,Q]=p.useState(!1),[$,Z]=p.useState(null),[G,U]=p.useState({});p.useEffect(()=>{t&&(ee(),te())},[t,i.start,i.end]);async function ee(){try{C(!0),y(null);const c=await ne.getById(t);if(!c){y("Partner not found");return}m(c);const x=await Te.getByPartner(t);v(x);const g=x.map(u=>u.id);if(g.length>0){const u=[{column:"resource_id",operator:"in",value:g}];i.start&&u.push({column:"date",operator:"gte",value:i.start}),i.end&&u.push({column:"date",operator:"lte",value:i.end});const I=await Ie.getAll(l,{filters:u,select:"id, date, hours_worked, hours, status, resource_id, resources(name, cost_price)",orderBy:{column:"date",ascending:!1},limit:100});if(I){let R=0,P=0,z=0,k=0,q=0;I.forEach(D=>{const W=parseFloat(D.hours_worked||D.hours||0),Ae=D.resources?.cost_price||0,se=ae(W,Ae);R+=W,De.timesheets.completed.includes(D.status)?(P+=W,k+=se):D.status===Pe.SUBMITTED&&(z+=W,q+=se)}),A({totalHours:R,approvedHours:P,pendingHours:z,totalValue:k+q,approvedValue:k,pendingValue:q,entries:I})}const Y=[{column:"resource_id",operator:"in",value:g}];i.start&&Y.push({column:"expense_date",operator:"gte",value:i.start}),i.end&&Y.push({column:"expense_date",operator:"lte",value:i.end});const B=await Ee.getAll(l,{filters:Y,select:"id, expense_date, category, reason, amount, resource_id, resource_name, status, procurement_method",orderBy:{column:"expense_date",ascending:!1},limit:100});if(B){const R=B.reduce((z,k)=>z+parseFloat(k.amount||0),0),P=B.filter(z=>z.procurement_method==="partner").reduce((z,k)=>z+parseFloat(k.amount||0),0);N({totalAmount:R,partnerProcuredAmount:P,entries:B})}}}catch(c){y(c.message)}finally{C(!1)}}async function te(){try{const c=await ie.getByPartner(t);ge(c.slice(0,5))}catch{}}function fe(c){if(O(c),c){const[x,g]=c.split("-").map(Number),u=new Date(x,g-1,1),I=new Date(x,g,0);h({start:u.toISOString().split("T")[0],end:I.toISOString().split("T")[0]})}else h({start:null,end:null})}function ye(c,x){O(""),h(g=>({...g,[c]:x||null}))}function je(){h({start:null,end:null}),O("")}function re(){if(!i.start&&!i.end)return"All Time";if(V){const[g,u]=V.split("-").map(Number);return new Date(g,u-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}const c=i.start?new Date(i.start).toLocaleDateString("en-GB"):"Start",x=i.end?new Date(i.end).toLocaleDateString("en-GB"):"End";return`${c} - ${x}`}function be(){U({name:s.name||"",contact_name:s.contact_name||"",contact_email:s.contact_email||"",payment_terms:s.payment_terms||"Net 30",notes:s.notes||"",is_active:s.is_active??!0}),w(!0)}async function ve(){try{if(_(!0),y(null),!G.name?.trim()){y("Partner name is required");return}await ne.update(t,G),await ee(),w(!1)}catch(c){y("Failed to save: "+c.message)}finally{_(!1)}}function Se(){w(!1),U({})}async function Ce(c="combined"){if(!i.start||!i.end){y("Please select a date range first");return}try{K(!0),y(null);const x=await ie.generateInvoice({projectId:l,partnerId:t,periodStart:i.start,periodEnd:i.end,createdBy:r?.id,notes:null,invoiceType:c});Z(x),Q(!0),te()}catch(x){y("Failed to generate invoice: "+x.message)}finally{K(!1)}}function _e(){const c=document.getElementById("invoice-print-content");if(!c)return;const x=c.cloneNode(!0);x.querySelectorAll("*").forEach(u=>{u.style&&(u.style.maxHeight="none",u.style.overflow="visible")});const g=window.open("","_blank");g.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Invoice ${$?.invoice_number||""}</title>
        <style>
          * { box-sizing: border-box; margin: 0; padding: 0; }
          body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 1.5rem; color: #1e293b; font-size: 11px; }
          h1 { font-size: 1.4rem; margin-bottom: 0.5rem; }
          h2 { font-size: 1.1rem; margin: 1rem 0 0.5rem; color: #475569; }
          h4 { font-size: 0.9rem; margin: 0.75rem 0 0.5rem; }
          table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; font-size: 10px; }
          th { background: #f1f5f9; padding: 5px 6px; text-align: left; font-weight: 600; border: 1px solid #cbd5e1; }
          td { padding: 5px 6px; border: 1px solid #e2e8f0; }
          @media print { body { padding: 0.5cm; } @page { margin: 0.75cm; size: A4; } }
        </style>
      </head>
      <body>${x.innerHTML}</body>
      </html>
    `),g.document.close(),g.focus(),setTimeout(()=>g.print(),250)}if(a)return e.jsx(Fe,{message:"Loading partner...",size:"large",fullPage:!0});if(T&&!s)return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx(X,{size:48,style:{color:"#f59e0b",marginBottom:"1rem"}}),e.jsx("h2",{children:"Partner Not Found"}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1.5rem"},children:T}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>n("/partners"),children:[e.jsx(le,{size:16})," Back to Partners"]})]})});d.totalValue+j.totalAmount;const ze=Be(d.totalHours);return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("button",{onClick:()=>n("/partners"),className:"btn btn-secondary",style:{marginRight:"1rem",padding:"0.5rem"},children:e.jsx(le,{size:20})}),e.jsx(de,{size:28}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h1",{children:s.name}),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:s.is_active?"#dcfce7":"#f1f5f9",color:s.is_active?"#16a34a":"#64748b"},children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{style:{color:"#64748b"},children:[s.contact_name&&`${s.contact_name} • `,s.contact_email]})]})]}),o&&!S&&e.jsxs("button",{className:"btn btn-primary",onClick:be,children:[e.jsx($e,{size:18})," Edit Partner"]})]}),T&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",color:"#dc2626",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(X,{size:18}),T,e.jsx("button",{onClick:()=>y(null),style:{marginLeft:"auto",background:"none",border:"none",cursor:"pointer"},children:e.jsx(J,{size:18})})]}),e.jsx(st,{dateRange:i,selectedMonth:V,onMonthSelect:fe,onDateRangeChange:ye,onClear:je,onGenerateInvoice:Ce,generatingInvoice:he,getDateRangeLabel:re}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(L,{icon:me,label:"Linked Resources",value:f.length,subtext:"Team members",color:"#3b82f6"}),e.jsx(L,{icon:H,label:"Days Worked",value:ze.toFixed(1),subtext:d.pendingHours>0?`${d.approvedHours.toFixed(1)}h approved, ${d.pendingHours.toFixed(1)}h pending`:`${d.totalHours.toFixed(1)} hours`,color:"#10b981"}),e.jsx(L,{icon:Ge,label:"Timesheet Value",value:`£${Math.round(d.totalValue).toLocaleString()}`,subtext:d.pendingValue>0?`£${Math.round(d.approvedValue)} approved, £${Math.round(d.pendingValue)} pending`:"At cost price",color:"#8b5cf6"}),e.jsx(L,{icon:F,label:"Partner Expenses",value:`£${Math.round(j.partnerProcuredAmount||0).toLocaleString()}`,subtext:`£${Math.round(j.totalAmount||0)} total expenses`,color:"#f59e0b"})]}),i.start&&i.end&&e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",backgroundColor:"#faf5ff",border:"1px solid #e9d5ff"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:e.jsxs("div",{children:[e.jsxs("h3",{style:{color:"#7c3aed",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(E,{size:20}),"Invoice Preview: ",re()]}),e.jsxs("div",{style:{display:"flex",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"0.85rem"},children:"Timesheets (at cost):"}),e.jsxs("span",{style:{fontWeight:"600",marginLeft:"0.5rem"},children:["£",Math.round(d.totalValue).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"0.85rem"},children:"Partner Expenses:"}),e.jsxs("span",{style:{fontWeight:"600",marginLeft:"0.5rem"},children:["£",Math.round(j.partnerProcuredAmount||0).toLocaleString()]})]}),e.jsxs("div",{style:{borderLeft:"2px solid #c4b5fd",paddingLeft:"1rem"},children:[e.jsx("span",{style:{color:"#7c3aed",fontSize:"0.9rem",fontWeight:"600"},children:"Invoice Total:"}),e.jsxs("span",{style:{fontWeight:"700",marginLeft:"0.5rem",fontSize:"1.1rem",color:"#7c3aed"},children:["£",Math.round(d.totalValue+(j.partnerProcuredAmount||0)).toLocaleString()]})]})]})]})})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:S?"1fr":"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"card-title",children:S?"Edit Partner Details":"Partner Details"})}),S?e.jsx(nt,{editForm:G,onFormChange:U,onSave:ve,onCancel:Se,saving:b}):e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem"},children:[e.jsx(M,{icon:e.jsx(Ue,{size:16}),label:"Contact Name",value:s.contact_name||"Not set"}),e.jsx(M,{icon:e.jsx(Ye,{size:16}),label:"Contact Email",value:s.contact_email?e.jsx("a",{href:`mailto:${s.contact_email}`,style:{color:"#2563eb"},children:s.contact_email}):"Not set"}),e.jsx(M,{icon:e.jsx(qe,{size:16}),label:"Payment Terms",value:s.payment_terms||"Net 30"}),e.jsx(M,{icon:e.jsx(ce,{size:16}),label:"Added",value:new Date(s.created_at).toLocaleDateString()})]}),s.notes&&e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(E,{size:14})," Notes"]}),e.jsx("p",{style:{marginTop:"0.5rem",color:"#374151"},children:s.notes})]})]})]}),!S&&e.jsx(it,{resources:f})]}),!S&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{timesheets:d.entries}),e.jsx(at,{expenses:j.entries}),e.jsx(ot,{invoices:xe})]}),e.jsx("style",{jsx:!0,children:`
        .input-field {
          padding: 0.5rem 0.75rem;
          border: 1px solid #d1d5db;
          border-radius: 6px;
          font-size: 0.875rem;
        }
        .input-field:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .hover-row:hover {
          background-color: #f8fafc;
        }
        .spin {
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),ue&&$&&e.jsx(Xe,{invoice:$,partner:s,onClose:()=>{Q(!1),Z(null)},onPrint:_e})]})}function M({icon:t,label:n,value:r}){return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[t," ",n]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:r})]})}export{gt as default};
