import{c as be,g as Me,u as He,a as $e,b as Ge,r as o,s as me,j as e,L as Ve,A as T,B as Oe,X as E,v as M,S as N,p as he,k as xe,D as ge,w as pe,U as Ye,q as qe,C as Xe}from"./index-C9_NAjB1.js";import{u as Ue}from"./usePermissions-DQns1k0G.js";import{p as ue,r as Qe,i as fe}from"./qualityStandards.service-B-fcpFUj.js";import{A as ye}from"./arrow-left-DWqfMxwI.js";import{P as Je}from"./pen-B7QJIzNl.js";import{C as je}from"./calendar-DCc08Q_p.js";import{S as Ke}from"./save-DzFhfLqy.js";import{E as Ze}from"./external-link-tpKEMk49.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=be("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=be("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);function mt(){var J,K,Z,ee,te,re,se,ne,ie,le,ae,oe;const{id:g}=Me(),v=He(),{user:S,role:rt}=$e(),{projectId:ve}=Ge(),{canManagePartners:Se}=Ue(),[i,_e]=o.useState(null),[F,Ce]=o.useState([]),[d,Ae]=o.useState({totalHours:0,approvedHours:0,pendingHours:0,totalValue:0,approvedValue:0,pendingValue:0,entries:[]}),[y,ke]=o.useState({totalAmount:0,partnerProcuredAmount:0,entries:[]}),[we,H]=o.useState(!0),[L,$]=o.useState(!1),[p,I]=o.useState(!1),[C,m]=o.useState(null),[s,A]=o.useState({start:null,end:null}),[B,P]=o.useState(""),[G,V]=o.useState(!1),[O,ze]=o.useState([]),[Ne,Y]=o.useState(!1),[n,q]=o.useState(null),[c,u]=o.useState({});o.useEffect(()=>{g&&(X(),Q())},[g,s.start,s.end]);async function X(){try{H(!0),m(null);const t=await ue.getById(g);if(!t){m("Partner not found");return}_e(t);const r=await Qe.getByPartner(g);Ce(r);const l=r.map(a=>a.id);if(l.length>0){let a=me.from("timesheets").select("id, date, hours_worked, hours, status, resource_id, resources(name, cost_price)").in("resource_id",l);s.start&&(a=a.gte("date",s.start)),s.end&&(a=a.lte("date",s.end));const{data:h}=await a.order("date",{ascending:!1}).limit(100);if(h){let k=0,w=0,f=0,b=0,R=0;h.forEach(_=>{var ce;const z=parseFloat(_.hours_worked||_.hours||0),Ee=((ce=_.resources)==null?void 0:ce.cost_price)||0,de=z/8*Ee;k+=z,_.status==="Approved"?(w+=z,b+=de):_.status==="Submitted"&&(f+=z,R+=de)}),Ae({totalHours:k,approvedHours:w,pendingHours:f,totalValue:b+R,approvedValue:b,pendingValue:R,entries:h})}let x=me.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, status, procurement_method").in("resource_id",l);s.start&&(x=x.gte("expense_date",s.start)),s.end&&(x=x.lte("expense_date",s.end));const{data:j}=await x.order("expense_date",{ascending:!1}).limit(100);if(j){const k=j.reduce((f,b)=>f+parseFloat(b.amount||0),0),w=j.filter(f=>f.procurement_method==="partner").reduce((f,b)=>f+parseFloat(b.amount||0),0);ke({totalAmount:k,partnerProcuredAmount:w,entries:j})}}}catch(t){console.error("Error fetching partner data:",t),m(t.message)}finally{H(!1)}}function De(){const t=[],r=new Date;for(let l=0;l<12;l++){const a=new Date(r.getFullYear(),r.getMonth()-l,1),h=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,x=a.toLocaleDateString("en-GB",{month:"long",year:"numeric"});t.push({value:h,label:x})}return t}function Fe(t){if(P(t),t){const[r,l]=t.split("-").map(Number),a=new Date(r,l-1,1),h=new Date(r,l,0);A({start:a.toISOString().split("T")[0],end:h.toISOString().split("T")[0]})}else A({start:null,end:null})}function U(t,r){P(""),A(l=>({...l,[t]:r||null}))}function Le(){A({start:null,end:null}),P("")}function W(){if(!s.start&&!s.end)return"All Time";if(B){const[l,a]=B.split("-").map(Number);return new Date(l,a-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}const t=s.start?new Date(s.start).toLocaleDateString("en-GB"):"Start",r=s.end?new Date(s.end).toLocaleDateString("en-GB"):"End";return`${t} - ${r}`}function Ie(){u({name:i.name||"",contact_name:i.contact_name||"",contact_email:i.contact_email||"",payment_terms:i.payment_terms||"Net 30",notes:i.notes||"",is_active:i.is_active??!0}),I(!0)}async function Be(){var t;try{if($(!0),m(null),!((t=c.name)!=null&&t.trim())){m("Partner name is required");return}await ue.update(g,c),await X(),I(!1)}catch(r){console.error("Error saving partner:",r),m("Failed to save: "+r.message)}finally{$(!1)}}function Pe(){I(!1),u({})}async function We(){if(!s.start||!s.end){m("Please select a date range first");return}try{V(!0),m(null);const t=await fe.generateInvoice({projectId:ve,partnerId:g,periodStart:s.start,periodEnd:s.end,createdBy:S==null?void 0:S.id,notes:null});q(t),Y(!0),Q()}catch(t){console.error("Error generating invoice:",t),m("Failed to generate invoice: "+t.message)}finally{V(!1)}}async function Q(){try{const t=await fe.getByPartner(g);ze(t.slice(0,5))}catch(t){console.error("Error fetching invoices:",t)}}function Re(t){switch(t){case"Approved":return{bg:"#dcfce7",color:"#16a34a"};case"Submitted":return{bg:"#fef3c7",color:"#d97706"};case"Rejected":return{bg:"#fee2e2",color:"#dc2626"};default:return{bg:"#f1f5f9",color:"#64748b"}}}if(we)return e.jsx(Ve,{message:"Loading partner...",size:"large",fullPage:!0});if(C&&!i)return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx(T,{size:48,style:{color:"#f59e0b",marginBottom:"1rem"}}),e.jsx("h2",{children:"Partner Not Found"}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1.5rem"},children:C}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>v("/partners"),children:[e.jsx(ye,{size:16})," Back to Partners"]})]})});d.totalValue+y.totalAmount;const Te=d.totalHours/8;return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("button",{onClick:()=>v("/partners"),className:"btn btn-secondary",style:{marginRight:"1rem",padding:"0.5rem"},children:e.jsx(ye,{size:20})}),e.jsx(Oe,{size:28}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h1",{children:i.name}),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:i.is_active?"#dcfce7":"#f1f5f9",color:i.is_active?"#16a34a":"#64748b"},children:i.is_active?"Active":"Inactive"})]}),e.jsxs("p",{style:{color:"#64748b"},children:[i.contact_name&&`${i.contact_name} • `,i.contact_email]})]})]}),Se&&!p&&e.jsxs("button",{className:"btn btn-primary",onClick:Ie,children:[e.jsx(Je,{size:18})," Edit Partner"]})]}),C&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",color:"#dc2626",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(T,{size:18}),C,e.jsx("button",{onClick:()=>m(null),style:{marginLeft:"auto",background:"none",border:"none",cursor:"pointer"},children:e.jsx(E,{size:18})})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(je,{size:18,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500",color:"#374151"},children:"Period:"})]}),e.jsxs("select",{value:B,onChange:t=>Fe(t.target.value),className:"input-field",style:{minWidth:"160px"},children:[e.jsx("option",{value:"",children:"Select Month..."}),De().map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("span",{style:{color:"#9ca3af"},children:"or"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"date",value:s.start||"",onChange:t=>U("start",t.target.value),className:"input-field",style:{width:"140px"}}),e.jsx("span",{style:{color:"#6b7280"},children:"to"}),e.jsx("input",{type:"date",value:s.end||"",onChange:t=>U("end",t.target.value),className:"input-field",style:{width:"140px"}})]}),(s.start||s.end)&&e.jsxs("button",{onClick:Le,className:"btn btn-secondary",style:{padding:"0.4rem 0.75rem",fontSize:"0.85rem"},children:[e.jsx(E,{size:14})," Clear"]}),e.jsxs("div",{style:{marginLeft:"auto",padding:"0.4rem 0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",color:"#0369a1",fontWeight:"500",fontSize:"0.9rem"},children:["Showing: ",W()]})]}),s.start&&s.end&&e.jsx("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:e.jsx("button",{className:"btn btn-primary",onClick:We,disabled:G,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:G?e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:18,className:"spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{size:18}),"Generate Invoice for ",W()]})})})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(N,{icon:he,label:"Linked Resources",value:F.length,subtext:"Team members",color:"#3b82f6"}),e.jsx(N,{icon:xe,label:"Days Worked",value:Te.toFixed(1),subtext:d.pendingHours>0?`${d.approvedHours.toFixed(1)}h approved, ${d.pendingHours.toFixed(1)}h pending`:`${d.totalHours.toFixed(1)} hours`,color:"#10b981"}),e.jsx(N,{icon:ge,label:"Timesheet Value",value:`£${Math.round(d.totalValue).toLocaleString()}`,subtext:d.pendingValue>0?`£${Math.round(d.approvedValue)} approved, £${Math.round(d.pendingValue)} pending`:"At cost price",color:"#8b5cf6"}),e.jsx(N,{icon:pe,label:"Partner Expenses",value:`£${Math.round(y.partnerProcuredAmount||0).toLocaleString()}`,subtext:`£${Math.round(y.totalAmount||0)} total expenses`,color:"#f59e0b"})]}),s.start&&s.end&&e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",backgroundColor:"#faf5ff",border:"1px solid #e9d5ff"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:e.jsxs("div",{children:[e.jsxs("h3",{style:{color:"#7c3aed",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(M,{size:20}),"Invoice Preview: ",W()]}),e.jsxs("div",{style:{display:"flex",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"0.85rem"},children:"Timesheets (at cost):"}),e.jsxs("span",{style:{fontWeight:"600",marginLeft:"0.5rem"},children:["£",Math.round(d.totalValue).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"0.85rem"},children:"Partner Expenses:"}),e.jsxs("span",{style:{fontWeight:"600",marginLeft:"0.5rem"},children:["£",Math.round(y.partnerProcuredAmount||0).toLocaleString()]})]}),e.jsxs("div",{style:{borderLeft:"2px solid #c4b5fd",paddingLeft:"1rem"},children:[e.jsx("span",{style:{color:"#7c3aed",fontSize:"0.9rem",fontWeight:"600"},children:"Invoice Total:"}),e.jsxs("span",{style:{fontWeight:"700",marginLeft:"0.5rem",fontSize:"1.1rem",color:"#7c3aed"},children:["£",Math.round(d.totalValue+(y.partnerProcuredAmount||0)).toLocaleString()]})]})]})]})})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:p?"1fr":"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"card-title",children:p?"Edit Partner Details":"Partner Details"})}),p?e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Partner Name *"}),e.jsx("input",{type:"text",className:"input-field",value:c.name,onChange:t=>u({...c,name:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Contact Name"}),e.jsx("input",{type:"text",className:"input-field",value:c.contact_name,onChange:t=>u({...c,contact_name:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Contact Email"}),e.jsx("input",{type:"email",className:"input-field",value:c.contact_email,onChange:t=>u({...c,contact_email:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Payment Terms"}),e.jsxs("select",{className:"input-field",value:c.payment_terms,onChange:t=>u({...c,payment_terms:t.target.value}),style:{width:"100%"},children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:c.is_active,onChange:t=>u({...c,is_active:t.target.checked})}),"Active Partner"]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Notes"}),e.jsx("textarea",{className:"input-field",value:c.notes,onChange:t=>u({...c,notes:t.target.value}),rows:3,style:{width:"100%",resize:"vertical"}})]})]}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.75rem"},children:[e.jsx("button",{className:"btn btn-primary",onClick:Be,disabled:L,children:L?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:16})," Save Changes"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:Pe,disabled:L,children:[e.jsx(E,{size:16})," Cancel"]})]})]}):e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem"},children:[e.jsx(D,{icon:e.jsx(Ye,{size:16}),label:"Contact Name",value:i.contact_name||"Not set"}),e.jsx(D,{icon:e.jsx(qe,{size:16}),label:"Contact Email",value:i.contact_email?e.jsx("a",{href:`mailto:${i.contact_email}`,style:{color:"#2563eb"},children:i.contact_email}):"Not set"}),e.jsx(D,{icon:e.jsx(et,{size:16}),label:"Payment Terms",value:i.payment_terms||"Net 30"}),e.jsx(D,{icon:e.jsx(je,{size:16}),label:"Added",value:new Date(i.created_at).toLocaleDateString()})]}),i.notes&&e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(M,{size:14})," Notes"]}),e.jsx("p",{style:{marginTop:"0.5rem",color:"#374151"},children:i.notes})]})]})]}),!p&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Linked Resources"})}),F.length>0?e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Name"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Role"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Cost/Day"})]})}),e.jsx("tbody",{children:F.map(t=>e.jsxs("tr",{onClick:()=>v(`/resources/${t.id}`),style:{cursor:"pointer"},className:"hover-row",children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"#2563eb",fontWeight:"500"},children:t.name}),e.jsx(Ze,{size:12,style:{color:"#9ca3af"}})]})}),e.jsx("td",{style:{padding:"0.75rem",color:"#64748b"},children:t.role}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace"},children:t.cost_price?`£${t.cost_price}`:"-"})]},t.id))})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(he,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsx("p",{children:"No resources linked to this partner"}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:"Assign resources to this partner from the Resources page"})]})]})})]}),!p&&d.entries.length>0&&e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Recent Timesheets"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Hours"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Value"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:d.entries.slice(0,10).map(t=>{var x,j;const r=parseFloat(t.hours_worked||t.hours||0),l=((x=t.resources)==null?void 0:x.cost_price)||0,a=r/8*l,h=Re(t.status);return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{style:{padding:"0.75rem"},children:(j=t.resources)==null?void 0:j.name}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:[r.toFixed(1),"h"]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace"},children:["£",a.toFixed(0)]}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:h.bg,color:h.color},children:t.status})})]},t.id)})})]})})]}),!p&&y.entries.length>0&&e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Recent Expenses"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Procured By"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:y.entries.map(t=>{const r=t.procurement_method==="partner";return e.jsxs("tr",{style:{backgroundColor:r?"#faf5ff":"inherit"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(t.expense_date).toLocaleDateString()}),e.jsx("td",{style:{padding:"0.75rem"},children:t.resource_name}),e.jsx("td",{style:{padding:"0.75rem"},children:t.category}),e.jsx("td",{style:{padding:"0.75rem"},children:t.reason}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"500",backgroundColor:r?"#f3e8ff":"#e0e7ff",color:r?"#7c3aed":"#4338ca"},children:r?"Partner":"Supplier"})}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"500"},children:["£",parseFloat(t.amount).toFixed(2)]})]},t.id)})})]})})]}),!p&&O.length>0&&e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Recent Invoices"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Invoice #"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Period"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Total"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"})]})}),e.jsx("tbody",{children:O.map(t=>{const r={Draft:{bg:"#f1f5f9",color:"#64748b"},Sent:{bg:"#dbeafe",color:"#1e40af"},Paid:{bg:"#dcfce7",color:"#16a34a"},Cancelled:{bg:"#fee2e2",color:"#dc2626"}},l=r[t.status]||r.Draft;return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontWeight:"500"},children:t.invoice_number}),e.jsxs("td",{style:{padding:"0.75rem"},children:[new Date(t.period_start).toLocaleDateString()," - ",new Date(t.period_end).toLocaleDateString()]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:["£",parseFloat(t.invoice_total).toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:l.bg,color:l.color},children:t.status})}),e.jsx("td",{style:{padding:"0.75rem",color:"#64748b"},children:new Date(t.invoice_date).toLocaleDateString()})]},t.id)})})]})})]}),e.jsx("style",{jsx:!0,children:`
        .input-field {
          padding: 0.5rem 0.75rem;
          border: 1px solid #d1d5db;
          border-radius: 6px;
          font-size: 0.875rem;
        }
        .input-field:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .hover-row:hover {
          background-color: #f8fafc;
        }
        .spin {
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),Ne&&n&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",padding:"2rem",maxWidth:"900px",width:"95%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#dcfce7",borderRadius:"50%",padding:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xe,{size:24,style:{color:"#16a34a"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h2",{style:{margin:0},children:"Invoice Generated"}),e.jsx("p",{style:{margin:0,color:"#64748b"},children:n.invoice_number})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Period"}),e.jsxs("div",{style:{fontWeight:"500"},children:[new Date(n.period_start).toLocaleDateString("en-GB")," - ",new Date(n.period_end).toLocaleDateString("en-GB")]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{backgroundColor:"#dbeafe",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#1e40af"},children:"Timesheets"}),e.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#1e40af"},children:["£",parseFloat(n.timesheet_total||0).toFixed(2)]})]}),e.jsxs("div",{style:{backgroundColor:"#f3e8ff",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#7c3aed"},children:"Partner Expenses"}),e.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#7c3aed"},children:["£",parseFloat(n.expense_total||0).toFixed(2)]})]}),e.jsxs("div",{style:{backgroundColor:"#fef3c7",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#92400e"},children:"Supplier Expenses"}),e.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#92400e"},children:["£",parseFloat(n.supplier_expense_total||0).toFixed(2)]}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#92400e",marginTop:"0.25rem"},children:"Not on this invoice"})]}),e.jsxs("div",{style:{backgroundColor:"#dcfce7",borderRadius:"8px",padding:"1rem"},children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#16a34a"},children:"Invoice Total"}),e.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#16a34a"},children:["£",parseFloat(n.invoice_total||0).toFixed(2)]})]})]}),e.jsx("div",{style:{backgroundColor:"#f0fdf4",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem",border:"1px solid #bbf7d0"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:"600",color:"#166534"},children:"Chargeable to Customer:"}),e.jsxs("span",{style:{marginLeft:"0.5rem",fontSize:"1.1rem",fontWeight:"700",color:"#166534"},children:["£",parseFloat(n.chargeable_total||n.invoice_total||0).toFixed(2)]})]}),(n.non_chargeable_total||0)>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"#dc2626",fontSize:"0.85rem"},children:"Non-chargeable:"}),e.jsxs("span",{style:{marginLeft:"0.5rem",fontWeight:"600",color:"#dc2626"},children:["£",parseFloat(n.non_chargeable_total||0).toFixed(2)]})]})]})}),((K=(J=n.groupedLines)==null?void 0:J.timesheets)==null?void 0:K.length)>0&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(xe,{size:18,style:{color:"#1e40af"}}),"Timesheets (",n.groupedLines.timesheets.length," entries)"]}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",fontSize:"0.85rem",border:"1px solid #e2e8f0",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#dbeafe"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Hours"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Cost/Day"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Status"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Total"})]})}),e.jsx("tbody",{children:n.groupedLines.timesheets.map((t,r)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(t.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:t.resource_name}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right"},children:[parseFloat(t.hours||t.quantity||0).toFixed(1),"h"]}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(t.cost_price||t.unit_price||0).toFixed(0)]}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:t.source_status==="Approved"?"#dcfce7":"#fef3c7",color:t.source_status==="Approved"?"#16a34a":"#92400e"},children:t.source_status})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(t.line_total).toFixed(2)]})]},r))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f5f9",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Timesheet Total:"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n.timesheet_total||0).toFixed(2)]})]})})]})})]}),((ee=(Z=n.groupedLines)==null?void 0:Z.partnerExpenses)==null?void 0:ee.length)>0&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(pe,{size:18,style:{color:"#7c3aed"}}),"Partner-Procured Expenses (",n.groupedLines.partnerExpenses.length," entries)",e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#7c3aed"},children:["- Billed to ",i==null?void 0:i.name]})]}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",fontSize:"0.85rem",border:"1px solid #e9d5ff",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f3e8ff"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:n.groupedLines.partnerExpenses.map((t,r)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(t.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:t.resource_name}),e.jsx("td",{style:{padding:"0.5rem"},children:t.expense_category}),e.jsx("td",{style:{padding:"0.5rem",color:"#64748b",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:t.description.split(": ").slice(1).join(": ")||t.description}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:t.chargeable_to_customer?"#dcfce7":"#fee2e2",color:t.chargeable_to_customer?"#16a34a":"#dc2626"},children:t.chargeable_to_customer?"Yes":"No"})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(t.line_total).toFixed(2)]})]},r))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f5f9",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Partner Expenses Total:"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n.expense_total||0).toFixed(2)]})]})})]})})]}),((re=(te=n.groupedLines)==null?void 0:te.supplierExpenses)==null?void 0:re.length)>0&&e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ge,{size:18,style:{color:"#92400e"}}),"Supplier-Procured Expenses (",n.groupedLines.supplierExpenses.length," entries)",e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"normal",color:"#92400e"},children:"- Not on this invoice, for customer billing reference"})]}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",fontSize:"0.85rem",border:"1px solid #fde68a",borderRadius:"8px"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#fef3c7"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Resource"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Description"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right"},children:"Amount"})]})}),e.jsx("tbody",{children:n.groupedLines.supplierExpenses.map((t,r)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:"#fffbeb"},children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(t.line_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.5rem",fontWeight:"500"},children:t.resource_name}),e.jsx("td",{style:{padding:"0.5rem"},children:t.expense_category}),e.jsx("td",{style:{padding:"0.5rem",color:"#64748b",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:t.description.split(": ").slice(1).join(": ")||t.description}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center"},children:e.jsx("span",{style:{padding:"0.1rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",backgroundColor:t.chargeable_to_customer?"#dcfce7":"#fee2e2",color:t.chargeable_to_customer?"#16a34a":"#dc2626"},children:t.chargeable_to_customer?"Yes":"No"})}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace",fontWeight:"600"},children:["£",parseFloat(t.line_total).toFixed(2)]})]},r))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"#fef3c7",fontWeight:"600"},children:[e.jsx("td",{colSpan:5,style:{padding:"0.5rem",textAlign:"right"},children:"Supplier Expenses Total (not invoiced):"}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",fontFamily:"monospace"},children:["£",parseFloat(n.supplier_expense_total||0).toFixed(2)]})]})})]})})]}),!((ne=(se=n.groupedLines)==null?void 0:se.timesheets)!=null&&ne.length)&&!((le=(ie=n.groupedLines)==null?void 0:ie.partnerExpenses)!=null&&le.length)&&!((oe=(ae=n.groupedLines)==null?void 0:ae.supplierExpenses)!=null&&oe.length)&&e.jsxs("div",{style:{textAlign:"center",padding:"2rem",backgroundColor:"#fef3c7",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(T,{size:32,style:{color:"#92400e",marginBottom:"0.5rem"}}),e.jsx("p",{style:{color:"#92400e",margin:0},children:"No approved or submitted timesheets/expenses found for this period."})]}),e.jsx("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",borderTop:"1px solid #e2e8f0",paddingTop:"1rem"},children:e.jsx("button",{className:"btn btn-secondary",onClick:()=>{Y(!1),q(null)},children:"Close"})})]})})]})}function D({icon:g,label:v,value:S}){return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[g," ",v]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:S})]})}export{mt as default};
