import{c as N,u as V,a as X,b as ee,d as te,r as l,j as e,P as se,S as j,B as v,U as ae,t as re,w as ne,T as le,s as y}from"./index-DmdW0Ek6.js";import{u as ie}from"./usePermissions-Dm-BUkcZ.js";import{p as o}from"./qualityStandards.service-yV9-E7N4.js";import{C as ce}from"./ConfirmDialog-CvSoEcpj.js";import{P as D}from"./plus-Bo2LM58J.js";import{E as oe}from"./external-link-C-aGa2m6.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=N("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=N("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=N("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function fe(){var P;const q=V(),{user:me}=X(),{projectId:d}=ee(),{hasRole:z}=ie(),{showSuccess:m,showError:i}=te(),[c,I]=l.useState([]),[M,w]=l.useState(!0),[$,u]=l.useState(!1),[x,C]=l.useState(null),[s,h]=l.useState({show:!1,partner:null,dependents:null}),[f,g]=l.useState(!1),[a,n]=l.useState({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),b=z(["admin","supplier_pm"]);l.useEffect(()=>{d&&b&&p()},[d,b]);const p=async()=>{try{w(!0);const t=await o.getAll(d);I(t)}catch(t){console.error("Failed to load partners:",t),i("Failed to load partners. Please try again.")}finally{w(!1)}},_=()=>{n({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),C(null),u(!1)},B=t=>{n({name:t.name||"",contact_name:t.contact_name||"",contact_email:t.contact_email||"",payment_terms:t.payment_terms||"Net 30",notes:t.notes||"",is_active:t.is_active??!0}),C(t),u(!0)},U=async t=>{if(t.preventDefault(),!a.name.trim()){i("Partner name is required");return}try{g(!0),x?(await o.update(x.id,a),m("Partner updated successfully")):(await o.create({...a,project_id:d}),m("Partner added successfully")),await p(),_()}catch(r){console.error("Failed to save partner:",r),i(r.message||"Failed to save partner. Please try again.")}finally{g(!1)}},Y=async()=>{if(s.partner)try{g(!0),await o.delete(s.partner.id),await p(),h({show:!1,partner:null,dependents:null}),m("Partner deleted successfully")}catch(t){console.error("Failed to delete partner:",t),i("Failed to delete partner. Please try again.")}finally{g(!1)}},H=async t=>{try{const{data:r,error:k}=await y.from("resources").select("id").eq("partner_id",t.id);if(k)throw k;const S=(r==null?void 0:r.length)||0;let A=0,T=0,F=0;if(S>0){const E=r.map(Q=>Q.id),{count:J}=await y.from("timesheets").select("*",{count:"exact",head:!0}).in("resource_id",E);A=J||0;const{count:K}=await y.from("expenses").select("*",{count:"exact",head:!0}).in("resource_id",E);T=K||0}const{count:G}=await y.from("partner_invoices").select("*",{count:"exact",head:!0}).eq("partner_id",t.id);F=G||0,h({show:!0,partner:t,dependents:{resourceCount:S,timesheetCount:A,expenseCount:T,invoiceCount:F}})}catch(r){console.error("Error fetching dependents:",r),h({show:!0,partner:t,dependents:null})}},O=async t=>{try{await o.toggleActive(t.id),await p(),m(`Partner ${t.is_active?"deactivated":"activated"}`)}catch(r){console.error("Failed to toggle partner status:",r),i("Failed to update partner status.")}};if(!b)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:"You don't have permission to access this page. Partners management is only available to Admin and Supplier PM roles."})})});if(M)return e.jsx(PageSkeleton,{statsCount:3,tableRows:5,tableColumns:5});const W=c.filter(t=>t.is_active).length,Z=c.filter(t=>!t.is_active).length;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(se,{title:"Partners",subtitle:"Manage third-party partner companies for resource allocation and invoicing",actions:e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),"Add Partner"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(j,{icon:v,label:"Total Partners",value:c.length}),e.jsx(j,{icon:R,label:"Active Partners",value:W,color:"green"}),e.jsx(j,{icon:L,label:"Inactive Partners",value:Z,color:"gray"})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:x?"Edit Partner":"Add New Partner"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>n({...a,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Agilisys",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Name"}),e.jsx("input",{type:"text",value:a.contact_name,onChange:t=>n({...a,contact_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Primary contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Email"}),e.jsx("input",{type:"email",value:a.contact_email,onChange:t=>n({...a,contact_email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsxs("select",{value:a.payment_terms,onChange:t=>n({...a,payment_terms:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:t=>n({...a,notes:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Additional notes about this partner..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>n({...a,is_active:t.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"Partner is active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:f,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:f,children:f?"Saving...":x?"Update Partner":"Add Partner"})]})]})]})})}),c.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Partners Yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add your first partner company to start tracking third-party resources and expenses."}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),"Add Partner"]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Partner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Terms"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>q(`/partners/${t.id}`),title:"Click to view details",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx("span",{style:{color:"#2563eb"},children:t.name}),e.jsx(oe,{size:14,style:{color:"#9ca3af"}})]}),t.notes&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",title:t.notes,children:t.notes})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"space-y-1",children:[t.contact_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-900",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),t.contact_name]}),t.contact_email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsx("a",{href:`mailto:${t.contact_email}`,className:"hover:text-blue-600",children:t.contact_email})]}),!t.contact_name&&!t.contact_email&&e.jsx("span",{className:"text-sm text-gray-400",children:"No contact info"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-900",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),t.payment_terms]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>O(t),className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium transition-colors ${t.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-3 h-3"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>B(t),className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit partner",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H(t),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete partner",children:e.jsx(le,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsx(ce,{isOpen:s.show,onClose:()=>h({show:!1,partner:null,dependents:null}),onConfirm:Y,title:"Delete Partner",message:e.jsxs("div",{children:[e.jsxs("p",{children:['Are you sure you want to delete "',e.jsx("strong",{children:(P=s.partner)==null?void 0:P.name}),'"?']}),s.dependents&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#fef2f2",borderRadius:"6px",border:"1px solid #fecaca"},children:[e.jsx("p",{style:{fontWeight:"600",color:"#991b1b",marginBottom:"0.5rem"},children:"⚠️ This will also affect:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",fontSize:"0.875rem",color:"#7f1d1d"},children:[s.dependents.resourceCount>0&&e.jsxs("li",{children:[s.dependents.resourceCount," linked resource",s.dependents.resourceCount!==1?"s":""," (will be unlinked)"]}),s.dependents.timesheetCount>0&&e.jsxs("li",{children:[s.dependents.timesheetCount," timesheet",s.dependents.timesheetCount!==1?"s":""]}),s.dependents.expenseCount>0&&e.jsxs("li",{children:[s.dependents.expenseCount," expense",s.dependents.expenseCount!==1?"s":""]}),s.dependents.invoiceCount>0&&e.jsxs("li",{children:[s.dependents.invoiceCount," invoice",s.dependents.invoiceCount!==1?"s":""]})]})]}),e.jsx("p",{style:{marginTop:"1rem",color:"#6b7280",fontSize:"0.875rem"},children:"This action cannot be undone."})]}),confirmText:"Delete",type:"danger"})]})}export{fe as default};
