import{u as M,a as U,b as Y,p as i,j as e,L as q}from"./index-OeZ_v13H.js";import{u as B,r as l}from"./vendor-react-JFEV0ROX.js";import{u as H}from"./usePermissions-R5xloTk0.js";import{S as f}from"./StatCard-tq6sJKiO.js";import{P as O}from"./PageHeader-M8U7kzer.js";import{C as W}from"./ConfirmDialog-fKyY4CL7.js";import{Y as P,o as j,ad as C,ae as _,U as G,z as J,F as K,af as Q,T as V}from"./vendor-icons-BZZethZ5.js";import"./vendor-supabase-DgEUAXvv.js";function ie(){const k=B(),{user:X}=M(),{projectId:d}=U(),{hasRole:S}=H(),{showSuccess:m,showError:c}=Y(),[o,A]=l.useState([]),[T,v]=l.useState(!0),[F,x]=l.useState(!1),[u,N]=l.useState(null),[s,g]=l.useState({show:!1,partner:null,dependents:null}),[y,h]=l.useState(!1),[a,r]=l.useState({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),b=S(["admin","supplier_pm"]);l.useEffect(()=>{d&&b&&p()},[d,b]);const p=async()=>{try{v(!0);const t=await i.getAll(d);A(t)}catch{c("Failed to load partners. Please try again.")}finally{v(!1)}},w=()=>{r({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),N(null),x(!1)},D=t=>{r({name:t.name||"",contact_name:t.contact_name||"",contact_email:t.contact_email||"",payment_terms:t.payment_terms||"Net 30",notes:t.notes||"",is_active:t.is_active??!0}),N(t),x(!0)},E=async t=>{if(t.preventDefault(),!a.name.trim()){c("Partner name is required");return}try{h(!0),u?(await i.update(u.id,a),m("Partner updated successfully")):(await i.create({...a,project_id:d}),m("Partner added successfully")),await p(),w()}catch(n){c(n.message||"Failed to save partner. Please try again.")}finally{h(!1)}},L=async()=>{if(s.partner)try{h(!0),await i.delete(s.partner.id),await p(),g({show:!1,partner:null,dependents:null}),m("Partner deleted successfully")}catch{c("Failed to delete partner. Please try again.")}finally{h(!1)}},z=async t=>{try{const n=await i.getDependencyCounts(t.id);g({show:!0,partner:t,dependents:n})}catch{g({show:!0,partner:t,dependents:null})}},R=async t=>{try{await i.toggleActive(t.id),await p(),m(`Partner ${t.is_active?"deactivated":"activated"}`)}catch{c("Failed to update partner status.")}};if(!b)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:"You don't have permission to access this page. Partners management is only available to Admin and Supplier PM roles."})})});if(T)return e.jsx(q,{message:"Loading partners...",size:"large",fullPage:!0});const $=o.filter(t=>t.is_active).length,I=o.filter(t=>!t.is_active).length;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(O,{title:"Partners",subtitle:"Manage third-party partner companies for resource allocation and invoicing",actions:e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Add Partner"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(f,{icon:j,label:"Total Partners",value:o.length}),e.jsx(f,{icon:C,label:"Active Partners",value:$,color:"green"}),e.jsx(f,{icon:_,label:"Inactive Partners",value:I,color:"gray"})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:u?"Edit Partner":"Add New Partner"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>r({...a,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Agilisys",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Name"}),e.jsx("input",{type:"text",value:a.contact_name,onChange:t=>r({...a,contact_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Primary contact name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Email"}),e.jsx("input",{type:"email",value:a.contact_email,onChange:t=>r({...a,contact_email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),e.jsxs("select",{value:a.payment_terms,onChange:t=>r({...a,payment_terms:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:t=>r({...a,notes:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Additional notes about this partner..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>r({...a,is_active:t.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"Partner is active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:y,children:y?"Saving...":u?"Update Partner":"Add Partner"})]})]})]})})}),o.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Partners Yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add your first partner company to start tracking third-party resources and expenses."}),e.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Add Partner"]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Partner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Terms"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(t=>e.jsxs("tr",{className:"table-row-clickable hover:bg-gray-50",onClick:()=>k(`/partners/${t.id}`),style:{cursor:"pointer"},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium flex items-center gap-2",children:e.jsx("span",{style:{color:"#2563eb"},children:t.name})}),t.notes&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",title:t.notes,children:t.notes})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"space-y-1",children:[t.contact_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-900",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),t.contact_name]}),t.contact_email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),e.jsx("a",{href:`mailto:${t.contact_email}`,className:"hover:text-blue-600",onClick:n=>n.stopPropagation(),children:t.contact_email})]}),!t.contact_name&&!t.contact_email&&e.jsx("span",{className:"text-sm text-gray-400",children:"No contact info"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-900",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400"}),t.payment_terms]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",onClick:n=>n.stopPropagation(),children:e.jsx("button",{onClick:()=>R(t),className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium transition-colors ${t.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>D(t),className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit partner",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t),className:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete partner",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsx(W,{isOpen:s.show,onClose:()=>g({show:!1,partner:null,dependents:null}),onConfirm:L,title:"Delete Partner",message:e.jsxs("div",{children:[e.jsxs("p",{children:['Are you sure you want to delete "',e.jsx("strong",{children:s.partner?.name}),'"?']}),s.dependents&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#fef2f2",borderRadius:"6px",border:"1px solid #fecaca"},children:[e.jsx("p",{style:{fontWeight:"600",color:"#991b1b",marginBottom:"0.5rem"},children:"⚠️ This will also affect:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",fontSize:"0.875rem",color:"#7f1d1d"},children:[s.dependents.resourceCount>0&&e.jsxs("li",{children:[s.dependents.resourceCount," linked resource",s.dependents.resourceCount!==1?"s":""," (will be unlinked)"]}),s.dependents.timesheetCount>0&&e.jsxs("li",{children:[s.dependents.timesheetCount," timesheet",s.dependents.timesheetCount!==1?"s":""]}),s.dependents.expenseCount>0&&e.jsxs("li",{children:[s.dependents.expenseCount," expense",s.dependents.expenseCount!==1?"s":""]}),s.dependents.invoiceCount>0&&e.jsxs("li",{children:[s.dependents.invoiceCount," invoice",s.dependents.invoiceCount!==1?"s":""]})]})]}),e.jsx("p",{style:{marginTop:"1rem",color:"#6b7280",fontSize:"0.875rem"},children:"This action cannot be undone."})]}),confirmText:"Delete",type:"danger"})]})}export{ie as default};
