import{u as R,a as E,d as T,c as L,p as m,j as e,L as q}from"./index-CMEKOLcn.js";import{d as D,r as t}from"./vendor-react-BUTV5ZEl.js";import{n as u,R as M,ac as y,U as $,a3 as U,F as I,aq as Y,ar as B}from"./vendor-icons-pp6BAQhb.js";import"./vendor-supabase-6faYzd5A.js";function Z(){const P=D(),{user:G}=R(),{projectId:c}=E(),{canManagePartners:H,hasRole:_}=T(),{showSuccess:p,showError:l}=L(),[i,C]=t.useState([]),[S,v]=t.useState(!0),[N,g]=t.useState(!1),[w,h]=t.useState(!1),[d,A]=t.useState(null),[J,K]=t.useState({show:!1,partner:null,dependents:null}),[x,f]=t.useState(!1),[s,n]=t.useState({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),j=_(["admin","supplier_pm"]);t.useEffect(()=>{c&&j&&o()},[c,j]);const o=async()=>{try{v(!0);const a=await m.getAll(c);C(a)}catch{l("Failed to load partners. Please try again.")}finally{v(!1),g(!1)}},k=async()=>{g(!0),await o()},b=()=>{n({name:"",contact_name:"",contact_email:"",payment_terms:"Net 30",notes:"",is_active:!0}),A(null),h(!1)},z=async a=>{if(a.preventDefault(),!s.name.trim()){l("Partner name is required");return}try{f(!0),d?(await m.update(d.id,s),p("Partner updated successfully")):(await m.create({...s,project_id:c}),p("Partner added successfully")),await o(),b()}catch(r){l(r.message||"Failed to save partner. Please try again.")}finally{f(!1)}},F=async(a,r)=>{a.stopPropagation();try{await m.toggleActive(r.id),await o(),p(`Partner ${r.is_active?"deactivated":"activated"}`)}catch{l("Failed to update partner status.")}};return j?S?e.jsx(q,{message:"Loading partners...",size:"large",fullPage:!0}):e.jsxs("div",{className:"partners-page",children:[e.jsx("header",{className:"ptr-header",children:e.jsxs("div",{className:"ptr-header-content",children:[e.jsxs("div",{className:"ptr-header-left",children:[e.jsx("div",{className:"ptr-header-icon",children:e.jsx(u,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Partners"}),e.jsx("p",{children:"Manage third-party partner companies for resource allocation and invoicing"})]})]}),e.jsxs("div",{className:"ptr-header-actions",children:[e.jsxs("button",{className:"ptr-btn ptr-btn-secondary",onClick:k,disabled:N,children:[e.jsx(M,{size:18,className:N?"spinning":""}),"Refresh"]}),e.jsxs("button",{className:"ptr-btn ptr-btn-primary",onClick:()=>h(!0),children:[e.jsx(y,{size:18}),"Add Partner"]})]})]})}),e.jsx("div",{className:"ptr-content",children:e.jsxs("div",{className:"ptr-table-card",children:[e.jsxs("div",{className:"ptr-table-header",children:[e.jsx("h2",{className:"ptr-table-title",children:"Partner Companies"}),e.jsxs("span",{className:"ptr-table-count",children:[i.length," partner",i.length!==1?"s":""]})]}),i.length===0?e.jsxs("div",{className:"ptr-empty",children:[e.jsx("div",{className:"ptr-empty-icon",children:e.jsx(u,{size:32})}),e.jsx("div",{className:"ptr-empty-title",children:"No Partners Yet"}),e.jsx("div",{className:"ptr-empty-text",children:"Add your first partner company to start tracking third-party resources and expenses."}),e.jsxs("button",{className:"ptr-empty-btn",onClick:()=>h(!0),children:[e.jsx(y,{size:18}),"Add Partner"]})]}):e.jsxs("table",{className:"ptr-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Partner"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Payment Terms"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{onClick:()=>P(`/partners/${a.id}`),children:[e.jsx("td",{children:e.jsxs("div",{className:"ptr-partner-cell",children:[e.jsx("div",{className:"ptr-partner-icon",children:e.jsx(u,{size:20})}),e.jsxs("div",{className:"ptr-partner-info",children:[e.jsx("span",{className:"ptr-partner-name",children:a.name}),a.notes&&e.jsx("span",{className:"ptr-partner-notes",title:a.notes,children:a.notes})]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"ptr-contact-cell",children:[a.contact_name&&e.jsxs("div",{className:"ptr-contact-name",children:[e.jsx($,{size:14}),a.contact_name]}),a.contact_email&&e.jsxs("div",{className:"ptr-contact-email",children:[e.jsx(U,{size:14}),e.jsx("a",{href:`mailto:${a.contact_email}`,onClick:r=>r.stopPropagation(),children:a.contact_email})]}),!a.contact_name&&!a.contact_email&&e.jsx("span",{className:"ptr-no-contact",children:"No contact info"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"ptr-terms",children:[e.jsx(I,{size:14}),a.payment_terms]})}),e.jsx("td",{children:e.jsx("button",{className:`ptr-status-badge ${a.is_active?"active":"inactive"}`,onClick:r=>F(r,a),children:a.is_active?e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:14}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:14}),"Inactive"]})})})]},a.id))})]})]})}),w&&e.jsx("div",{className:"ptr-modal-overlay",children:e.jsxs("div",{className:"ptr-modal",children:[e.jsx("div",{className:"ptr-modal-header",children:e.jsx("h2",{className:"ptr-modal-title",children:d?"Edit Partner":"Add New Partner"})}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"ptr-modal-body",children:[e.jsxs("div",{className:"ptr-form-group",children:[e.jsxs("label",{className:"ptr-form-label",children:["Company Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",className:"ptr-form-input",value:s.name,onChange:a=>n({...s,name:a.target.value}),placeholder:"e.g., Agilisys",required:!0})]}),e.jsxs("div",{className:"ptr-form-group",children:[e.jsx("label",{className:"ptr-form-label",children:"Contact Name"}),e.jsx("input",{type:"text",className:"ptr-form-input",value:s.contact_name,onChange:a=>n({...s,contact_name:a.target.value}),placeholder:"Primary contact name"})]}),e.jsxs("div",{className:"ptr-form-group",children:[e.jsx("label",{className:"ptr-form-label",children:"Contact Email"}),e.jsx("input",{type:"email",className:"ptr-form-input",value:s.contact_email,onChange:a=>n({...s,contact_email:a.target.value}),placeholder:"contact@company.com"})]}),e.jsxs("div",{className:"ptr-form-group",children:[e.jsx("label",{className:"ptr-form-label",children:"Payment Terms"}),e.jsxs("select",{className:"ptr-form-select",value:s.payment_terms,onChange:a=>n({...s,payment_terms:a.target.value}),children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{className:"ptr-form-group",children:[e.jsx("label",{className:"ptr-form-label",children:"Notes"}),e.jsx("textarea",{className:"ptr-form-textarea",value:s.notes,onChange:a=>n({...s,notes:a.target.value}),rows:3,placeholder:"Additional notes about this partner..."})]}),e.jsxs("div",{className:"ptr-form-checkbox",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:a=>n({...s,is_active:a.target.checked})}),e.jsx("label",{htmlFor:"is_active",children:"Partner is active"})]})]}),e.jsxs("div",{className:"ptr-modal-footer",children:[e.jsx("button",{type:"button",className:"ptr-modal-btn ptr-modal-btn-cancel",onClick:b,disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",className:"ptr-modal-btn ptr-modal-btn-save",disabled:x,children:x?"Saving...":d?"Update Partner":"Add Partner"})]})]})]})})]}):e.jsx("div",{className:"partners-page",children:e.jsx("div",{className:"ptr-content",children:e.jsx("div",{className:"ptr-access-denied",children:e.jsx("p",{children:"You don't have permission to access this page. Partners management is only available to Admin and Supplier PM roles."})})})})}export{Z as default};
