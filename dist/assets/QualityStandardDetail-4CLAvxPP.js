import{a as A,u as R,q as j,s as T,j as e,L as q}from"./index-CZifL8RL.js";import{f as W,b as D,r as n}from"./vendor-react-B1g8b4mG.js";import{ab as E,h as F,a8 as L,i as y,C as b,F as v,l as H,az as Q,Y as P,a9 as M,a as G}from"./vendor-icons-BfsEacNp.js";import"./vendor-supabase-DSZ6Ejbd.js";function K(){const{id:o}=W(),C=D(),{project:O}=A(),{role:c}=R(),[t,d]=n.useState(null),[i,_]=n.useState([]),[S,f]=n.useState(!0),[a,m]=n.useState(!1),[r,l]=n.useState({});n.useEffect(()=>{N()},[o]);async function N(){try{const s=await j.getById(o);if(!s){d(null),f(!1);return}d(s),l(s);const{data:x}=await T.from("deliverable_qs_assessments").select(`
          *,
          deliverables(deliverable_ref, name, status)
        `).eq("quality_standard_id",o).order("assessed_at",{ascending:!1});_(x||[])}catch{}finally{f(!1)}}async function z(){try{await j.update(o,{description:r.description,measurement_criteria:r.measurement_criteria,compliance_expectation:r.compliance_expectation,target:parseFloat(r.target)||100,notes:r.notes}),d({...t,...r}),m(!1)}catch{alert("Failed to save changes")}}function k(){const s=i.filter(p=>p.criteria_met!==null).length,x=i.filter(p=>p.criteria_met===!0).length;if(s===0)return{label:"Not Started",color:"#64748b",bg:"#f1f5f9"};const h=x/s*100,u=t?.target||100;return h>=u?{label:"Achieved",color:"#16a34a",bg:"#dcfce7"}:h>=u*.8?{label:"On Track",color:"#2563eb",bg:"#dbeafe"}:h>=u*.6?{label:"At Risk",color:"#ea580c",bg:"#ffedd5"}:{label:"Critical",color:"#dc2626",bg:"#fee2e2"}}const w=c==="admin"||c==="contributor"||c==="customer_pm";if(S)return e.jsx(q,{message:"Loading quality standard...",size:"large",fullPage:!0});if(!t)return e.jsx("div",{className:"loading",children:"Quality Standard not found"});const g=k(),I=i.filter(s=>s.criteria_met!==null).length,B=i.filter(s=>s.criteria_met===!0).length;return e.jsxs("div",{className:"page-container",children:[e.jsxs("button",{onClick:()=>C("/quality-standards"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"transparent",border:"none",color:"#64748b",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(E,{size:20}),"Back to Quality Standards"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(F,{size:32,style:{color:"#8b5cf6"}}),e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",backgroundColor:"#f3e8ff",color:"#7c3aed",padding:"0.25rem 0.5rem",borderRadius:"4px"},children:t.qs_ref}),t.name]}),e.jsx("span",{style:{display:"inline-block",marginTop:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"500",backgroundColor:g.bg,color:g.color},children:g.label})]})]}),w&&!a&&e.jsxs("button",{onClick:()=>m(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(L,{size:16}),"Edit"]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(y,{size:18,style:{color:"#8b5cf6"}}),"Target"]}),e.jsxs("div",{className:"stat-value",children:[t.target,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(b,{size:18,style:{color:"#16a34a"}}),"Current Score"]}),e.jsxs("div",{className:"stat-value",style:{color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(v,{size:18,style:{color:"#3b82f6"}}),"Assessments"]}),e.jsxs("div",{className:"stat-value",children:[B,"/",I]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(H,{size:18,style:{color:"#f59e0b"}}),"Last Measured"]}),e.jsx("div",{className:"stat-value",style:{fontSize:"1rem"},children:t.last_measured?new Date(t.last_measured).toLocaleDateString("en-GB"):"Never"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(v,{size:20,style:{color:"#8b5cf6"}}),"Description"]}),a?e.jsx("textarea",{value:r.description||"",onChange:s=>l({...r,description:s.target.value}),style:{width:"100%",minHeight:"100px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.description||"No description provided"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Q,{size:20,style:{color:"#3b82f6"}}),"Measurement Criteria"]}),a?e.jsx("textarea",{value:r.measurement_criteria||"",onChange:s=>l({...r,measurement_criteria:s.target.value}),style:{width:"100%",minHeight:"80px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.measurement_criteria||"Not specified"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem",backgroundColor:"#fefce8",border:"1px solid #fef08a"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem",color:"#a16207"},children:[e.jsx(y,{size:20}),"Compliance Expectation"]}),a?e.jsx("textarea",{value:r.compliance_expectation||"",onChange:s=>l({...r,compliance_expectation:s.target.value}),style:{width:"100%",minHeight:"60px"}}):e.jsx("p",{style:{margin:0,color:"#a16207",fontWeight:"500"},children:t.compliance_expectation||"Not specified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Assessment History"}),i.length===0?e.jsx("p",{style:{color:"#64748b",fontStyle:"italic"},children:"No assessments yet. This standard will be assessed when deliverables are marked as delivered."}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Deliverable"}),e.jsx("th",{children:"Result"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverables?.deliverable_ref})," - ",s.deliverables?.name]}),e.jsx("td",{children:s.criteria_met===!0?e.jsxs("span",{style:{color:"#16a34a",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(b,{size:16})," Met"]}):s.criteria_met===!1?e.jsxs("span",{style:{color:"#dc2626",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(P,{size:16})," Not Met"]}):e.jsx("span",{style:{color:"#64748b"},children:"Pending"})}),e.jsx("td",{children:s.assessed_at?new Date(s.assessed_at).toLocaleDateString("en-GB"):"-"})]},s.id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Quick Info"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Target"}),a?e.jsx("input",{type:"number",value:r.target||100,onChange:s=>l({...r,target:s.target.value}),style:{width:"100%"}}):e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600"},children:[t.target,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Current Value"}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600",color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Notes"}),a?e.jsx("textarea",{value:r.notes||"",onChange:s=>l({...r,notes:s.target.value}),style:{width:"100%",minHeight:"100px"},placeholder:"Add notes..."}):e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#374151"},children:t.notes||"No notes"})]})]}),a&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{onClick:z,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(M,{size:18}),"Save"]}),e.jsxs("button",{onClick:()=>{l(t),m(!1)},style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#64748b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(G,{size:18}),"Cancel"]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f0fdf4",borderRadius:"8px",border:"1px solid #bbf7d0"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"SOW Reference"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"#166534"},children:"This quality standard is defined in the Statement of Work - Quality Standards section."})]})]})]})]})}export{K as default};
