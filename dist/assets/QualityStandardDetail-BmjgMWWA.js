import{s as m,j as e,L as R}from"./index-BiMCcVir.js";import{f as A,u as T,r as l}from"./vendor-react-JFEV0ROX.js";import{Q as W,f as D,J as E,w as j,C as y,F as b,h as F,ah as L,u as Q,N as H,a as M}from"./vendor-icons-CoFrSbed.js";import"./vendor-supabase-DgEUAXvv.js";function J(){const{id:g}=A(),v=T(),[t,p]=l.useState(null),[n,_]=l.useState([]),[C,N]=l.useState(!0),[a,h]=l.useState(!1),[r,i]=l.useState({}),[u,S]=l.useState("viewer");l.useEffect(()=>{w()},[g]);async function w(){try{const{data:{user:s}}=await m.auth.getUser();if(s){const{data:d}=await m.from("profiles").select("role").eq("id",s.id).single();d&&S(d.role)}const{data:x,error:o}=await m.from("quality_standards").select("*").eq("id",g).single();if(o)throw o;p(x),i(x);const{data:c}=await m.from("deliverable_qs_assessments").select(`
          *,
          deliverables(deliverable_ref, name, status)
        `).eq("quality_standard_id",g).order("assessed_at",{ascending:!1});_(c||[])}catch{}finally{N(!1)}}async function k(){try{const{error:s}=await m.from("quality_standards").update({description:r.description,measurement_criteria:r.measurement_criteria,compliance_expectation:r.compliance_expectation,target:parseFloat(r.target)||100,notes:r.notes}).eq("id",g);if(s)throw s;p({...t,...r}),h(!1)}catch{alert("Failed to save changes")}}function z(){const s=n.filter(d=>d.criteria_met!==null).length,x=n.filter(d=>d.criteria_met===!0).length;if(s===0)return{label:"Not Started",color:"#64748b",bg:"#f1f5f9"};const o=x/s*100,c=t?.target||100;return o>=c?{label:"Achieved",color:"#16a34a",bg:"#dcfce7"}:o>=c*.8?{label:"On Track",color:"#2563eb",bg:"#dbeafe"}:o>=c*.6?{label:"At Risk",color:"#ea580c",bg:"#ffedd5"}:{label:"Critical",color:"#dc2626",bg:"#fee2e2"}}const I=u==="admin"||u==="contributor"||u==="customer_pm";if(C)return e.jsx(R,{message:"Loading quality standard...",size:"large",fullPage:!0});if(!t)return e.jsx("div",{className:"loading",children:"Quality Standard not found"});const f=z(),q=n.filter(s=>s.criteria_met!==null).length,B=n.filter(s=>s.criteria_met===!0).length;return e.jsxs("div",{className:"page-container",children:[e.jsxs("button",{onClick:()=>v("/quality-standards"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"transparent",border:"none",color:"#64748b",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(W,{size:20}),"Back to Quality Standards"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(D,{size:32,style:{color:"#8b5cf6"}}),e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",backgroundColor:"#f3e8ff",color:"#7c3aed",padding:"0.25rem 0.5rem",borderRadius:"4px"},children:t.qs_ref}),t.name]}),e.jsx("span",{style:{display:"inline-block",marginTop:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"500",backgroundColor:f.bg,color:f.color},children:f.label})]})]}),I&&!a&&e.jsxs("button",{onClick:()=>h(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(E,{size:16}),"Edit"]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(j,{size:18,style:{color:"#8b5cf6"}}),"Target"]}),e.jsxs("div",{className:"stat-value",children:[t.target,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(y,{size:18,style:{color:"#16a34a"}}),"Current Score"]}),e.jsxs("div",{className:"stat-value",style:{color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(b,{size:18,style:{color:"#3b82f6"}}),"Assessments"]}),e.jsxs("div",{className:"stat-value",children:[B,"/",q]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(F,{size:18,style:{color:"#f59e0b"}}),"Last Measured"]}),e.jsx("div",{className:"stat-value",style:{fontSize:"1rem"},children:t.last_measured?new Date(t.last_measured).toLocaleDateString("en-GB"):"Never"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(b,{size:20,style:{color:"#8b5cf6"}}),"Description"]}),a?e.jsx("textarea",{value:r.description||"",onChange:s=>i({...r,description:s.target.value}),style:{width:"100%",minHeight:"100px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.description||"No description provided"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(L,{size:20,style:{color:"#3b82f6"}}),"Measurement Criteria"]}),a?e.jsx("textarea",{value:r.measurement_criteria||"",onChange:s=>i({...r,measurement_criteria:s.target.value}),style:{width:"100%",minHeight:"80px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.measurement_criteria||"Not specified"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem",backgroundColor:"#fefce8",border:"1px solid #fef08a"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem",color:"#a16207"},children:[e.jsx(j,{size:20}),"Compliance Expectation"]}),a?e.jsx("textarea",{value:r.compliance_expectation||"",onChange:s=>i({...r,compliance_expectation:s.target.value}),style:{width:"100%",minHeight:"60px"}}):e.jsx("p",{style:{margin:0,color:"#a16207",fontWeight:"500"},children:t.compliance_expectation||"Not specified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Assessment History"}),n.length===0?e.jsx("p",{style:{color:"#64748b",fontStyle:"italic"},children:"No assessments yet. This standard will be assessed when deliverables are marked as delivered."}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Deliverable"}),e.jsx("th",{children:"Result"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverables?.deliverable_ref})," - ",s.deliverables?.name]}),e.jsx("td",{children:s.criteria_met===!0?e.jsxs("span",{style:{color:"#16a34a",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(y,{size:16})," Met"]}):s.criteria_met===!1?e.jsxs("span",{style:{color:"#dc2626",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(Q,{size:16})," Not Met"]}):e.jsx("span",{style:{color:"#64748b"},children:"Pending"})}),e.jsx("td",{children:s.assessed_at?new Date(s.assessed_at).toLocaleDateString("en-GB"):"-"})]},s.id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Quick Info"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Target"}),a?e.jsx("input",{type:"number",value:r.target||100,onChange:s=>i({...r,target:s.target.value}),style:{width:"100%"}}):e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600"},children:[t.target,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Current Value"}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600",color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Notes"}),a?e.jsx("textarea",{value:r.notes||"",onChange:s=>i({...r,notes:s.target.value}),style:{width:"100%",minHeight:"100px"},placeholder:"Add notes..."}):e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#374151"},children:t.notes||"No notes"})]})]}),a&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{onClick:k,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(H,{size:18}),"Save"]}),e.jsxs("button",{onClick:()=>{i(t),h(!1)},style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#64748b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(M,{size:18}),"Cancel"]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f0fdf4",borderRadius:"8px",border:"1px solid #bbf7d0"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"SOW Reference"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"#166534"},children:"This quality standard is defined in the Statement of Work - Quality Standards section."})]})]})]})]})}export{J as default};
