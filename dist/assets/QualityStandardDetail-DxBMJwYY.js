import{c as B,g as R,u as T,r as o,s as g,j as e,L as E,f as W,h as y,C as j,v as b,k as D,A as L,X as H}from"./index-CspTly-R.js";import{A as F}from"./arrow-left-C-pJy5nj.js";import{P as Q}from"./pen-opG0b6Iw.js";import{S as M}from"./save-CA5ETuwq.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=B("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);function X(){const{id:h}=R(),v=T(),[s,p]=o.useState(null),[c,_]=o.useState([]),[C,S]=o.useState(!0),[i,x]=o.useState(!1),[r,l]=o.useState({}),[u,N]=o.useState("viewer");o.useEffect(()=>{k()},[h]);async function k(){try{const{data:{user:t}}=await g.auth.getUser();if(t){const{data:d}=await g.from("profiles").select("role").eq("id",t.id).single();d&&N(d.role)}const{data:n,error:a}=await g.from("quality_standards").select("*").eq("id",h).single();if(a)throw a;p(n),l(n);const{data:m}=await g.from("deliverable_qs_assessments").select(`
          *,
          deliverables(deliverable_ref, name, status)
        `).eq("quality_standard_id",h).order("assessed_at",{ascending:!1});_(m||[])}catch(t){console.error("Error fetching quality standard:",t)}finally{S(!1)}}async function w(){try{const{error:t}=await g.from("quality_standards").update({description:r.description,measurement_criteria:r.measurement_criteria,compliance_expectation:r.compliance_expectation,target:parseFloat(r.target)||100,notes:r.notes}).eq("id",h);if(t)throw t;p({...s,...r}),x(!1)}catch(t){console.error("Error saving:",t),alert("Failed to save changes")}}function z(){const t=c.filter(d=>d.criteria_met!==null).length,n=c.filter(d=>d.criteria_met===!0).length;if(t===0)return{label:"Not Started",color:"#64748b",bg:"#f1f5f9"};const a=n/t*100,m=(s==null?void 0:s.target)||100;return a>=m?{label:"Achieved",color:"#16a34a",bg:"#dcfce7"}:a>=m*.8?{label:"On Track",color:"#2563eb",bg:"#dbeafe"}:a>=m*.6?{label:"At Risk",color:"#ea580c",bg:"#ffedd5"}:{label:"Critical",color:"#dc2626",bg:"#fee2e2"}}const I=u==="admin"||u==="contributor"||u==="customer_pm";if(C)return e.jsx(E,{message:"Loading quality standard...",size:"large",fullPage:!0});if(!s)return e.jsx("div",{className:"loading",children:"Quality Standard not found"});const f=z(),A=c.filter(t=>t.criteria_met!==null).length,q=c.filter(t=>t.criteria_met===!0).length;return e.jsxs("div",{className:"page-container",children:[e.jsxs("button",{onClick:()=>v("/quality-standards"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"transparent",border:"none",color:"#64748b",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(F,{size:20}),"Back to Quality Standards"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(W,{size:32,style:{color:"#8b5cf6"}}),e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",backgroundColor:"#f3e8ff",color:"#7c3aed",padding:"0.25rem 0.5rem",borderRadius:"4px"},children:s.qs_ref}),s.name]}),e.jsx("span",{style:{display:"inline-block",marginTop:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"500",backgroundColor:f.bg,color:f.color},children:f.label})]})]}),I&&!i&&e.jsxs("button",{onClick:()=>x(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(Q,{size:16}),"Edit"]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(y,{size:18,style:{color:"#8b5cf6"}}),"Target"]}),e.jsxs("div",{className:"stat-value",children:[s.target,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(j,{size:18,style:{color:"#16a34a"}}),"Current Score"]}),e.jsxs("div",{className:"stat-value",style:{color:s.current_value>=s.target?"#16a34a":"#64748b"},children:[s.current_value,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(b,{size:18,style:{color:"#3b82f6"}}),"Assessments"]}),e.jsxs("div",{className:"stat-value",children:[q,"/",A]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(D,{size:18,style:{color:"#f59e0b"}}),"Last Measured"]}),e.jsx("div",{className:"stat-value",style:{fontSize:"1rem"},children:s.last_measured?new Date(s.last_measured).toLocaleDateString("en-GB"):"Never"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(b,{size:20,style:{color:"#8b5cf6"}}),"Description"]}),i?e.jsx("textarea",{value:r.description||"",onChange:t=>l({...r,description:t.target.value}),style:{width:"100%",minHeight:"100px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:s.description||"No description provided"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(P,{size:20,style:{color:"#3b82f6"}}),"Measurement Criteria"]}),i?e.jsx("textarea",{value:r.measurement_criteria||"",onChange:t=>l({...r,measurement_criteria:t.target.value}),style:{width:"100%",minHeight:"80px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:s.measurement_criteria||"Not specified"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem",backgroundColor:"#fefce8",border:"1px solid #fef08a"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem",color:"#a16207"},children:[e.jsx(y,{size:20}),"Compliance Expectation"]}),i?e.jsx("textarea",{value:r.compliance_expectation||"",onChange:t=>l({...r,compliance_expectation:t.target.value}),style:{width:"100%",minHeight:"60px"}}):e.jsx("p",{style:{margin:0,color:"#a16207",fontWeight:"500"},children:s.compliance_expectation||"Not specified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Assessment History"}),c.length===0?e.jsx("p",{style:{color:"#64748b",fontStyle:"italic"},children:"No assessments yet. This standard will be assessed when deliverables are marked as delivered."}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Deliverable"}),e.jsx("th",{children:"Result"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:c.map(t=>{var n,a;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:(n=t.deliverables)==null?void 0:n.deliverable_ref})," - ",(a=t.deliverables)==null?void 0:a.name]}),e.jsx("td",{children:t.criteria_met===!0?e.jsxs("span",{style:{color:"#16a34a",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(j,{size:16})," Met"]}):t.criteria_met===!1?e.jsxs("span",{style:{color:"#dc2626",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(L,{size:16})," Not Met"]}):e.jsx("span",{style:{color:"#64748b"},children:"Pending"})}),e.jsx("td",{children:t.assessed_at?new Date(t.assessed_at).toLocaleDateString("en-GB"):"-"})]},t.id)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Quick Info"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Target"}),i?e.jsx("input",{type:"number",value:r.target||100,onChange:t=>l({...r,target:t.target.value}),style:{width:"100%"}}):e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600"},children:[s.target,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Current Value"}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600",color:s.current_value>=s.target?"#16a34a":"#64748b"},children:[s.current_value,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Notes"}),i?e.jsx("textarea",{value:r.notes||"",onChange:t=>l({...r,notes:t.target.value}),style:{width:"100%",minHeight:"100px"},placeholder:"Add notes..."}):e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#374151"},children:s.notes||"No notes"})]})]}),i&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{onClick:w,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(M,{size:18}),"Save"]}),e.jsxs("button",{onClick:()=>{l(s),x(!1)},style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#64748b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(H,{size:18}),"Cancel"]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f0fdf4",borderRadius:"8px",border:"1px solid #bbf7d0"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"SOW Reference"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"#166534"},children:"This quality standard is defined in the Statement of Work - Quality Standards section."})]})]})]})]})}export{X as default};
