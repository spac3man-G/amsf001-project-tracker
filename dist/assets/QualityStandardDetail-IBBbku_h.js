import{a as A,d as T,q as f,s as q,j as e,L as R}from"./index-Dmy3q9-g.js";import{i as W,d as D,r as n}from"./vendor-react-BUTV5ZEl.js";import{ah as E,l as F,ak as L,m as j,b as y,F as b,p as Q,aI as H,a5 as P,al as M,c as G}from"./vendor-icons-CWM4So-G.js";import"./vendor-supabase-6faYzd5A.js";function U(){const{id:o}=W(),v=D(),{project:O}=A(),{canEditQualityStandard:C}=T(),[t,c]=n.useState(null),[i,S]=n.useState([]),[_,p]=n.useState(!0),[r,d]=n.useState(!1),[a,l]=n.useState({});n.useEffect(()=>{N()},[o]);async function N(){try{const s=await f.getById(o);if(!s){c(null),p(!1);return}c(s),l(s);const{data:g}=await q.from("deliverable_qs_assessments").select(`
          *,
          deliverables(deliverable_ref, name, status)
        `).eq("quality_standard_id",o).order("assessed_at",{ascending:!1});S(g||[])}catch{}finally{p(!1)}}async function k(){try{await f.update(o,{description:a.description,measurement_criteria:a.measurement_criteria,compliance_expectation:a.compliance_expectation,target:parseFloat(a.target)||100,notes:a.notes}),c({...t,...a}),d(!1)}catch{alert("Failed to save changes")}}function z(){const s=i.filter(u=>u.criteria_met!==null).length,g=i.filter(u=>u.criteria_met===!0).length;if(s===0)return{label:"Not Started",color:"#64748b",bg:"#f1f5f9"};const x=g/s*100,h=t?.target||100;return x>=h?{label:"Achieved",color:"#16a34a",bg:"#dcfce7"}:x>=h*.8?{label:"On Track",color:"#2563eb",bg:"#dbeafe"}:x>=h*.6?{label:"At Risk",color:"#ea580c",bg:"#ffedd5"}:{label:"Critical",color:"#dc2626",bg:"#fee2e2"}}const w=C;if(_)return e.jsx(R,{message:"Loading quality standard...",size:"large",fullPage:!0});if(!t)return e.jsx("div",{className:"loading",children:"Quality Standard not found"});const m=z(),I=i.filter(s=>s.criteria_met!==null).length,B=i.filter(s=>s.criteria_met===!0).length;return e.jsxs("div",{className:"page-container",children:[e.jsxs("button",{onClick:()=>v("/quality-standards"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"transparent",border:"none",color:"#64748b",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(E,{size:20}),"Back to Quality Standards"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(F,{size:32,style:{color:"#8b5cf6"}}),e.jsxs("div",{children:[e.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",backgroundColor:"#f3e8ff",color:"#7c3aed",padding:"0.25rem 0.5rem",borderRadius:"4px"},children:t.qs_ref}),t.name]}),e.jsx("span",{style:{display:"inline-block",marginTop:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"500",backgroundColor:m.bg,color:m.color},children:m.label})]})]}),w&&!r&&e.jsxs("button",{onClick:()=>d(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(L,{size:16}),"Edit"]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(j,{size:18,style:{color:"#8b5cf6"}}),"Target"]}),e.jsxs("div",{className:"stat-value",children:[t.target,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(y,{size:18,style:{color:"#16a34a"}}),"Current Score"]}),e.jsxs("div",{className:"stat-value",style:{color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(b,{size:18,style:{color:"#3b82f6"}}),"Assessments"]}),e.jsxs("div",{className:"stat-value",children:[B,"/",I]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsxs("div",{className:"stat-label",children:[e.jsx(Q,{size:18,style:{color:"#f59e0b"}}),"Last Measured"]}),e.jsx("div",{className:"stat-value",style:{fontSize:"1rem"},children:t.last_measured?new Date(t.last_measured).toLocaleDateString("en-GB"):"Never"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(b,{size:20,style:{color:"#8b5cf6"}}),"Description"]}),r?e.jsx("textarea",{value:a.description||"",onChange:s=>l({...a,description:s.target.value}),style:{width:"100%",minHeight:"100px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.description||"No description provided"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(H,{size:20,style:{color:"#3b82f6"}}),"Measurement Criteria"]}),r?e.jsx("textarea",{value:a.measurement_criteria||"",onChange:s=>l({...a,measurement_criteria:s.target.value}),style:{width:"100%",minHeight:"80px"}}):e.jsx("p",{style:{margin:0,color:"#374151",lineHeight:"1.6"},children:t.measurement_criteria||"Not specified"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1rem",backgroundColor:"#fefce8",border:"1px solid #fef08a"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",display:"flex",alignItems:"center",gap:"0.5rem",color:"#a16207"},children:[e.jsx(j,{size:20}),"Compliance Expectation"]}),r?e.jsx("textarea",{value:a.compliance_expectation||"",onChange:s=>l({...a,compliance_expectation:s.target.value}),style:{width:"100%",minHeight:"60px"}}):e.jsx("p",{style:{margin:0,color:"#a16207",fontWeight:"500"},children:t.compliance_expectation||"Not specified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Assessment History"}),i.length===0?e.jsx("p",{style:{color:"#64748b",fontStyle:"italic"},children:"No assessments yet. This standard will be assessed when deliverables are marked as delivered."}):e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Deliverable"}),e.jsx("th",{children:"Result"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:s.deliverables?.deliverable_ref})," - ",s.deliverables?.name]}),e.jsx("td",{children:s.criteria_met===!0?e.jsxs("span",{style:{color:"#16a34a",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(y,{size:16})," Met"]}):s.criteria_met===!1?e.jsxs("span",{style:{color:"#dc2626",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(P,{size:16})," Not Met"]}):e.jsx("span",{style:{color:"#64748b"},children:"Pending"})}),e.jsx("td",{children:s.assessed_at?new Date(s.assessed_at).toLocaleDateString("en-GB"):"-"})]},s.id))})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Quick Info"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Target"}),r?e.jsx("input",{type:"number",value:a.target||100,onChange:s=>l({...a,target:s.target.value}),style:{width:"100%"}}):e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600"},children:[t.target,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Current Value"}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontWeight:"600",color:t.current_value>=t.target?"#16a34a":"#64748b"},children:[t.current_value,"%"]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{fontWeight:"500",color:"#64748b",fontSize:"0.85rem"},children:"Notes"}),r?e.jsx("textarea",{value:a.notes||"",onChange:s=>l({...a,notes:s.target.value}),style:{width:"100%",minHeight:"100px"},placeholder:"Add notes..."}):e.jsx("p",{style:{margin:"0.25rem 0 0 0",color:"#374151"},children:t.notes||"No notes"})]})]}),r&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{onClick:k,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(M,{size:18}),"Save"]}),e.jsxs("button",{onClick:()=>{l(t),d(!1)},style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",backgroundColor:"#64748b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(G,{size:18}),"Cancel"]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f0fdf4",borderRadius:"8px",border:"1px solid #bbf7d0"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#166534"},children:"SOW Reference"}),e.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"#166534"},children:"This quality standard is defined in the Statement of Work - Quality Standards section."})]})]})]})]})}export{U as default};
