import{j as e,u as Se,a as Ce,r as q,t as Z,V as De,h as we,i as ze,L as Ae,p as Le}from"./index-DZjyoUhu.js";import{f as Ne,u as Re,r as m}from"./vendor-react-JFEV0ROX.js";import{u as Te}from"./usePermissions-CeYhrlnU.js";import{S as O}from"./StatCard-pBjX5Jn0.js";import{Z as ke,a as R,a1 as ee,U as te,z as Ie,ac as Be,F as Fe,i as $e,a2 as U,ab as se,k as re,C as Ee,j as Pe,y as J,$ as K,Y as We,a9 as Q,q as Me,aa as He,o as Ge}from"./vendor-icons-CiBQmrAI.js";import"./vendor-supabase-DgEUAXvv.js";function qe({form:t,onFormChange:l,onSave:o,onCancel:n,saving:h,partners:d,canSeeCostPrice:x,canSeeResourceType:g}){const s={padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",width:"100%"},c={display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"};return e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Name *"}),e.jsx("input",{type:"text",style:s,value:t.name,onChange:a=>l({...t,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Email *"}),e.jsx("input",{type:"email",style:s,value:t.email,onChange:a=>l({...t,email:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Role"}),e.jsx("input",{type:"text",style:s,value:t.role,onChange:a=>l({...t,role:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Reference"}),e.jsx("input",{type:"text",style:s,value:t.resource_ref,onChange:a=>l({...t,resource_ref:a.target.value}),placeholder:"e.g., R01"})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"SFIA Level"}),e.jsxs("select",{style:s,value:t.sfia_level,onChange:a=>l({...t,sfia_level:a.target.value}),children:[e.jsx("option",{value:"L3",children:"Level 3"}),e.jsx("option",{value:"L4",children:"Level 4"}),e.jsx("option",{value:"L5",children:"Level 5"}),e.jsx("option",{value:"L6",children:"Level 6"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Days Allocated"}),e.jsx("input",{type:"number",style:s,value:t.days_allocated,onChange:a=>l({...t,days_allocated:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Sell Price (£) - Customer"}),e.jsx("input",{type:"number",style:s,value:t.sell_price,onChange:a=>l({...t,sell_price:a.target.value})})]}),x&&e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Cost Price (£) - Internal"}),e.jsx("input",{type:"number",style:s,value:t.cost_price,onChange:a=>l({...t,cost_price:a.target.value}),placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Discount %"}),e.jsx("input",{type:"number",style:s,value:t.discount_percent,onChange:a=>l({...t,discount_percent:a.target.value})})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Resource Type"}),e.jsxs("select",{style:s,value:t.resource_type,onChange:a=>l({...t,resource_type:a.target.value,partner_id:a.target.value==="internal"?"":t.partner_id}),children:[e.jsx("option",{value:"internal",children:"Internal Supplier Resource"}),e.jsx("option",{value:"third_party",children:"Third-Party Partner"})]})]}),t.resource_type==="third_party"&&e.jsxs("div",{children:[e.jsx("label",{style:c,children:"Partner"}),e.jsxs("select",{style:s,value:t.partner_id,onChange:a=>l({...t,partner_id:a.target.value}),children:[e.jsx("option",{value:"",children:"-- Select Partner --"}),d.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})]}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.75rem"},children:[e.jsx("button",{className:"btn btn-primary",onClick:o,disabled:h,children:h?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:16})," Save Changes"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:n,disabled:h,children:[e.jsx(R,{size:16})," Cancel"]})]})]})}function Oe({selectedMonth:t,dateRange:l,onMonthChange:o,onDateChange:n,onClear:h,dateRangeLabel:d}){function x(){const s=[],c=new Date;for(let a=0;a<12;a++){const _=new Date(c.getFullYear(),c.getMonth()-a,1),T=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`,k=_.toLocaleDateString("en-GB",{month:"long",year:"numeric"});s.push({value:T,label:k})}return s}const g={padding:"0.5rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem"};return e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ee,{size:18,style:{color:"#3b82f6"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Period:"})]}),e.jsxs("select",{value:t,onChange:s=>o(s.target.value),style:{...g,minWidth:"160px"},children:[e.jsx("option",{value:"",children:"Select Month..."}),x().map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsx("span",{style:{color:"#64748b"},children:"or"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"date",value:l.start||"",onChange:s=>n("start",s.target.value),style:g}),e.jsx("span",{style:{color:"#64748b"},children:"to"}),e.jsx("input",{type:"date",value:l.end||"",onChange:s=>n("end",s.target.value),style:g})]}),(l.start||l.end)&&e.jsxs("button",{onClick:h,style:{padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid #e2e8f0",background:"#f8fafc",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(R,{size:14}),"Clear"]}),e.jsxs("div",{style:{marginLeft:"auto",padding:"0.5rem 0.75rem",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500"},children:["Showing: ",d]})]})})}function Ue(t){switch(t?.toString().startsWith("L")?t:`L${t}`){case"L6":return{bg:"#fef3c7",color:"#92400e"};case"L5":return{bg:"#dcfce7",color:"#166534"};case"L4":return{bg:"#dbeafe",color:"#1e40af"};case"L3":return{bg:"#f1f5f9",color:"#475569"};default:return{bg:"#f1f5f9",color:"#475569"}}}function v({icon:t,label:l,value:o}){return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[t," ",l]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:o})]})}function Ye({resource:t,daysAllocated:l,totalValue:o,canSeeResourceType:n}){const h=t.sfia_level?.toString().startsWith("L")?t.sfia_level:`L${t.sfia_level||4}`,d=Ue(t.sfia_level);return e.jsx("div",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx(v,{icon:e.jsx(te,{size:16}),label:"Name",value:t.name}),e.jsx(v,{icon:e.jsx(Ie,{size:16}),label:"Email",value:t.email}),e.jsx(v,{icon:e.jsx(Be,{size:16}),label:"Role",value:t.role}),e.jsx(v,{icon:e.jsx(Fe,{size:16}),label:"Reference",value:t.resource_ref||"Not set"})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx($e,{size:14})," SFIA Level"]}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"0.25rem 0.5rem",backgroundColor:d.bg,color:d.color,borderRadius:"4px",fontWeight:"500",marginTop:"0.25rem"},children:h})]}),e.jsx(v,{icon:e.jsx(ee,{size:16}),label:"Days Allocated",value:`${l} days`}),e.jsx(v,{icon:e.jsx(U,{size:16}),label:"Total Value",value:`£${o.toLocaleString()}`}),n&&t.resource_type==="third_party"&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(se,{size:14})," Partner"]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:t.partner?.name||"Not assigned"})]})]})]})})}function le(t){switch(t){case"Approved":return{bg:"#dcfce7",color:"#16a34a"};case"Submitted":return{bg:"#fef3c7",color:"#d97706"};case"Rejected":return{bg:"#fee2e2",color:"#dc2626"};case"Validated":return{bg:"#dcfce7",color:"#16a34a"};default:return{bg:"#f1f5f9",color:"#64748b"}}}function Ve({daysUsed:t,daysAllocated:l,totalHours:o,approvedHours:n}){const h=Math.max(0,l-t),d=l>0?t/l*100:0;return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Allocation"})}),e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsxs("span",{children:[t.toFixed(1)," days used"]}),e.jsxs("span",{children:[h.toFixed(1)," remaining"]})]}),e.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(d,100)}%`,height:"100%",backgroundColor:d>100?"#dc2626":d>80?"#10b981":"#3b82f6",borderRadius:"4px",transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",fontSize:"0.875rem"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b"},children:"Hours Logged"}),e.jsxs("div",{style:{fontWeight:"600"},children:[o?.toFixed(1)||0,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b"},children:"Approved Hours"}),e.jsxs("div",{style:{fontWeight:"600",color:"#10b981"},children:[n?.toFixed(1)||0,"h"]})]})]})]})]})}function Xe({timesheets:t,dateRangeLabel:l}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{className:"card-title",children:"Timesheets"}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:[t.length," entries",l&&l!=="All Time"?` (${l})`:""]})]}),t.length>0?e.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Hours"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:t.map(o=>{const n=le(o.status);return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(o.date).toLocaleDateString("en-GB")}),e.jsxs("td",{style:{padding:"0.5rem"},children:[parseFloat(o.hours_worked||o.hours||0).toFixed(1),"h"]}),e.jsx("td",{style:{padding:"0.5rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:n.bg,color:n.color},children:o.status})})]},o.id)})})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(re,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsxs("p",{children:["No timesheets ",l&&l!=="All Time"?"in selected period":"recorded"]})]})]})}function Ze({expenses:t,dateRangeLabel:l}){const o={Travel:{bg:"#dbeafe",color:"#1e40af"},Accommodation:{bg:"#f3e8ff",color:"#7c3aed"},Sustenance:{bg:"#fef3c7",color:"#92400e"}};return e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{className:"card-title",children:"Expenses"}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:[t.length," entries",l&&l!=="All Time"?` (${l})`:""]})]}),t.length>0?e.jsx("div",{style:{overflowX:"auto",maxHeight:"400px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{style:{position:"sticky",top:0,backgroundColor:"#fff"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Reason"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Amount"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Paid By"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:t.map(n=>{const h=parseFloat(n.amount)||0,d=le(n.status),x=o[n.category]||{bg:"#f1f5f9",color:"#475569"};return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(n.expense_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:x.bg,color:x.color},children:n.category})}),e.jsx("td",{style:{padding:"0.75rem",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.reason||"-"}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:["£",h.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:n.chargeable_to_customer?e.jsx(Ee,{size:16,style:{color:"#10b981"}}):e.jsx(R,{size:16,style:{color:"#94a3b8"}})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:n.procurement_method==="partner"?"#fef3c7":"#e0f2fe",color:n.procurement_method==="partner"?"#92400e":"#0369a1"},children:n.procurement_method==="partner"?"Partner":"Supplier"})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:d.bg,color:d.color},children:n.status||"Draft"})})]},n.id)})})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(Pe,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsxs("p",{children:["No expenses ",l&&l!=="All Time"?"in selected period":"recorded"]})]})]})}function rt(){const{id:t}=Ne(),l=Re(),{user:o,role:n}=Se(),{projectId:h}=Ce(),{canManageResources:d,canSeeCostPrice:x,canSeeResourceType:g}=Te(),[s,c]=m.useState(null),[a,_]=m.useState([]),[T,k]=m.useState([]),[ae,ne]=m.useState([]),[ie,I]=m.useState(!0),[oe,Y]=m.useState(!1),[f,B]=m.useState(!1),[D,j]=m.useState(null),[i,w]=m.useState({start:null,end:null}),[F,$]=m.useState(""),[u,V]=m.useState({});m.useEffect(()=>{t&&X()},[t,i.start,i.end]),m.useEffect(()=>{async function r(){if(s?.project_id&&n&&["admin","supplier_pm"].includes(n))try{const p=await Le.getAll(s.project_id,{filters:[{column:"is_active",operator:"eq",value:!0}],select:"id, name, is_active",orderBy:{column:"name",ascending:!0}});_(p||[])}catch{}}r()},[s?.project_id,n]);async function X(){try{I(!0),j(null);const r=await q.getById(t,{select:"*, partner:partners(id, name, contact_name, contact_email, is_active)"});if(!r){j("Resource not found"),I(!1);return}const p=await Z.getAll(r.project_id,{filters:[{column:"resource_id",operator:"eq",value:t}],select:"id, hours_worked, hours, status, was_rejected"});let y=0,L=0,N=0;p&&p.forEach(C=>{const G=parseFloat(C.hours_worked||C.hours||0);y+=G,De.timesheets.completed.includes(C.status)?L+=G:C.status==="Submitted"&&!C.was_rejected&&(N+=G)}),c({...r,timesheetSummary:{totalEntries:p?.length||0,totalHours:y,approvedHours:L,pendingHours:N,daysWorked:we(y)}});const M=[{column:"resource_id",operator:"eq",value:t}];i.start&&M.push({column:"date",operator:"gte",value:i.start}),i.end&&M.push({column:"date",operator:"lte",value:i.end});const ve=await Z.getAll(r.project_id,{filters:M,select:"id, date, hours_worked, hours, status, description, milestone:milestones(milestone_ref, name)",orderBy:{column:"date",ascending:!1}});k((ve||[]).slice(0,100));const H=[{column:"resource_id",operator:"eq",value:t}];i.start&&H.push({column:"expense_date",operator:"gte",value:i.start}),i.end&&H.push({column:"expense_date",operator:"lte",value:i.end});const _e=await ze.getAll(r.project_id,{filters:H,select:"id, expense_date, category, reason, amount, chargeable_to_customer, procurement_method, status",orderBy:{column:"expense_date",ascending:!1}});ne((_e||[]).slice(0,100))}catch(r){j(r.message)}finally{I(!1)}}function ce(r){if($(r),r){const[p,y]=r.split("-").map(Number),L=new Date(p,y-1,1),N=new Date(p,y,0);w({start:L.toISOString().split("T")[0],end:N.toISOString().split("T")[0]})}else w({start:null,end:null})}function de(r,p){$(""),w(y=>({...y,[r]:p}))}function ue(){$(""),w({start:null,end:null})}function E(){if(!i.start&&!i.end)return"All Time";if(F){const[r,p]=F.split("-").map(Number);return new Date(r,p-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}return i.start&&i.end?`${new Date(i.start).toLocaleDateString("en-GB")} - ${new Date(i.end).toLocaleDateString("en-GB")}`:i.start?`From ${new Date(i.start).toLocaleDateString("en-GB")}`:i.end?`Until ${new Date(i.end).toLocaleDateString("en-GB")}`:"All Time"}function pe(r){return r?typeof r=="string"&&r.startsWith("L")?r:`L${r}`:"L4"}function me(r){return r?typeof r=="number"?r:typeof r=="string"&&r.startsWith("L")?parseInt(r.substring(1))||4:parseInt(r)||4:4}function he(){V({name:s.name||"",email:s.email||"",role:s.role||"",resource_ref:s.resource_ref||"",sfia_level:pe(s.sfia_level),sell_price:s.sell_price||"",cost_price:s.cost_price||"",discount_percent:s.discount_percent||0,days_allocated:s.days_allocated||"",resource_type:s.resource_type||"internal",partner_id:s.partner_id||""}),B(!0)}async function xe(){try{Y(!0),j(null);const r={name:u.name,email:u.email,role:u.role,resource_ref:u.resource_ref,sfia_level:me(u.sfia_level),sell_price:parseFloat(u.sell_price)||0,discount_percent:parseFloat(u.discount_percent)||0,days_allocated:parseInt(u.days_allocated)||0,resource_type:u.resource_type,partner_id:u.resource_type==="third_party"&&u.partner_id||null};x&&(r.cost_price=u.cost_price===""?null:parseFloat(u.cost_price)),await q.update(t,r),await X(),B(!1)}catch(r){j("Failed to save: "+r.message)}finally{Y(!1)}}function ge(r){return r==null?{color:"#9ca3af",bg:"#f1f5f9",label:"N/A",icon:Q}:r>=25?{color:"#16a34a",bg:"#dcfce7",label:"Good",icon:Me}:r>=10?{color:"#d97706",bg:"#fef3c7",label:"Low",icon:Q}:{color:"#dc2626",bg:"#fee2e2",label:"Critical",icon:He}}function ye(r){return r==="third_party"?{bg:"#fef3c7",color:"#92400e",icon:se,label:"Third-Party Partner"}:{bg:"#dbeafe",color:"#1e40af",icon:Ge,label:"Internal Supplier"}}if(ie)return e.jsx(Ae,{message:"Loading resource...",size:"large",fullPage:!0});if(D&&!s)return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx(J,{size:48,style:{color:"#f59e0b",marginBottom:"1rem"}}),e.jsx("h2",{children:"Resource Not Found"}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1.5rem"},children:D}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>l("/resources"),children:[e.jsx(K,{size:16})," Back to Resources"]})]})});const S=q.calculateMargin(s.sell_price,s.cost_price),z=ge(S.percent),fe=z.icon,A=ye(s.resource_type),je=A.icon,b=s.days_allocated||0,P=s.timesheetSummary?.daysWorked||0,W=b>0?P/b*100:0,be=(s.sell_price||0)*b;return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("button",{onClick:()=>l("/resources"),className:"btn btn-secondary",style:{marginRight:"1rem",padding:"0.5rem"},children:e.jsx(K,{size:20})}),e.jsx(te,{size:28}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h1",{children:s.name}),g&&e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",padding:"0.35rem 0.75rem",backgroundColor:A.bg,color:A.color,borderRadius:"6px",fontSize:"0.85rem",fontWeight:"500"},children:[e.jsx(je,{size:14}),A.label]})]}),e.jsxs("p",{style:{color:"#64748b"},children:[s.role," • ",s.email]})]})]}),d&&!f&&e.jsxs("button",{className:"btn btn-primary",onClick:he,children:[e.jsx(We,{size:18})," Edit Resource"]})]}),D&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",color:"#dc2626",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(J,{size:18}),D,e.jsx("button",{onClick:()=>j(null),style:{marginLeft:"auto",background:"none",border:"none",cursor:"pointer"},children:e.jsx(R,{size:18})})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(O,{icon:U,label:"Sell Price",value:`£${s.sell_price||0}`,subtext:"Customer rate",color:"#10b981"}),x&&e.jsx(O,{icon:U,label:"Cost Price",value:s.cost_price?`£${s.cost_price}`:"Not set",subtext:"Internal cost",color:"#3b82f6"}),x&&e.jsxs("div",{className:"stat-card",style:{borderLeft:`4px solid ${z.color}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(fe,{size:20,style:{color:z.color}}),e.jsx("span",{className:"stat-label",children:"Margin"})]}),e.jsx("div",{className:"stat-value",style:{color:z.color},children:S.percent!==null?`${S.percent.toFixed(1)}%`:"N/A"}),S.amount!==null&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["£",S.amount.toFixed(0)," per day"]})]}),e.jsx(O,{icon:re,label:"Utilization",value:`${Math.round(W)}%`,subtext:`${P.toFixed(1)} / ${b} days`,color:W>80?"#10b981":W>0?"#3b82f6":"#64748b"})]}),e.jsx(Oe,{selectedMonth:F,dateRange:i,onMonthChange:ce,onDateChange:de,onClear:ue,dateRangeLabel:E()}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr":"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"card-title",children:f?"Edit Resource Details":"Resource Details"})}),f?e.jsx(qe,{form:u,onFormChange:V,onSave:xe,onCancel:()=>B(!1),saving:oe,partners:a,canSeeCostPrice:x,canSeeResourceType:g}):e.jsx(Ye,{resource:s,daysAllocated:b,totalValue:be,canSeeResourceType:g})]}),!f&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsx(Ve,{daysUsed:P,daysAllocated:b,totalHours:s.timesheetSummary?.totalHours,approvedHours:s.timesheetSummary?.approvedHours}),e.jsx(Xe,{timesheets:T,dateRangeLabel:E()})]})]}),!f&&e.jsx(Ze,{expenses:ae,dateRangeLabel:E()})]})}export{rt as default};
