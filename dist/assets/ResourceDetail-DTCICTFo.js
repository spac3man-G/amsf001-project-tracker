import{u as Ne,a as De,r as P,t as Z,e as Re,j as e,L as ke,S as H,p as Le}from"./index-CZrS01ZK.js";import{h as Be,u as Ae,r as o}from"./vendor-react-CaXNtsgv.js";import{u as Fe}from"./usePermissions-SI9Nxi_k.js";import{v as J,Y as K,U as Q,W as Ie,a as N,O as G,h as ee,Z as te,y as Te,w as We,N as $e,F as Ee,f as Me,a8 as re,C as Pe,g as He,a6 as se,n as Ge,a7 as Oe,l as Ue}from"./vendor-icons--BgpcKrK.js";import"./vendor-supabase-qY1sfceY.js";import"./vendor-charts-_mIYJ_kN.js";function Qe(){const{id:d}=Be(),b=Ae(),{user:O,role:D}=Ne(),{projectId:Ye}=De(),{canManageResources:ae,canSeeCostPrice:v,canSeeResourceType:R}=Fe(),[r,le]=o.useState(null),[ne,ie]=o.useState([]),[k,oe]=o.useState([]),[L,de]=o.useState([]),[ce,B]=o.useState(!0),[A,U]=o.useState(!1),[m,F]=o.useState(!1),[_,p]=o.useState(null),[a,S]=o.useState({start:null,end:null}),[I,T]=o.useState(""),[s,i]=o.useState({});o.useEffect(()=>{d&&Y()},[d,a.start,a.end]),o.useEffect(()=>{async function t(){if(r?.project_id&&D&&["admin","supplier_pm"].includes(D))try{const l=await Le.getAll(r.project_id,{filters:[{column:"is_active",operator:"eq",value:!0}],select:"id, name, is_active",orderBy:{column:"name",ascending:!0}});ie(l||[])}catch{}}t()},[r?.project_id,D]);async function Y(){try{B(!0),p(null);const t=await P.getById(d,{select:"*, partner:partners(id, name, contact_name, contact_email, is_active)"});if(!t){p("Resource not found"),B(!1);return}const l=await Z.getAll(t.project_id,{filters:[{column:"resource_id",operator:"eq",value:d}],select:"id, hours_worked, hours, status, was_rejected"});let n=0,c=0,u=0;l&&l.forEach(j=>{const M=parseFloat(j.hours_worked||j.hours||0);n+=M,j.status==="Approved"?c+=M:j.status==="Submitted"&&!j.was_rejected&&(u+=M)}),le({...t,timesheetSummary:{totalEntries:l?.length||0,totalHours:n,approvedHours:c,pendingHours:u,daysWorked:n/8}});const y=[{column:"resource_id",operator:"eq",value:d}];a.start&&y.push({column:"date",operator:"gte",value:a.start}),a.end&&y.push({column:"date",operator:"lte",value:a.end});const we=await Z.getAll(t.project_id,{filters:y,select:"id, date, hours_worked, hours, status, description, milestone:milestones(milestone_ref, name)",orderBy:{column:"date",ascending:!1}});oe((we||[]).slice(0,100));const E=[{column:"resource_id",operator:"eq",value:d}];a.start&&E.push({column:"expense_date",operator:"gte",value:a.start}),a.end&&E.push({column:"expense_date",operator:"lte",value:a.end});const ze=await Re.getAll(t.project_id,{filters:E,select:"id, expense_date, category, reason, amount, chargeable_to_customer, procurement_method, status",orderBy:{column:"expense_date",ascending:!1}});de((ze||[]).slice(0,100))}catch(t){p(t.message)}finally{B(!1)}}function ue(){const t=[],l=new Date;for(let n=0;n<12;n++){const c=new Date(l.getFullYear(),l.getMonth()-n,1),u=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,y=c.toLocaleDateString("en-GB",{month:"long",year:"numeric"});t.push({value:u,label:y})}return t}function me(t){if(T(t),t){const[l,n]=t.split("-").map(Number),c=new Date(l,n-1,1),u=new Date(l,n,0);S({start:c.toISOString().split("T")[0],end:u.toISOString().split("T")[0]})}else S({start:null,end:null})}function q(t,l){T(""),S(n=>({...n,[t]:l}))}function pe(){T(""),S({start:null,end:null})}function W(){if(!a.start&&!a.end)return"All Time";if(I){const[t,l]=I.split("-").map(Number);return new Date(t,l-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}return a.start&&a.end?`${new Date(a.start).toLocaleDateString("en-GB")} - ${new Date(a.end).toLocaleDateString("en-GB")}`:a.start?`From ${new Date(a.start).toLocaleDateString("en-GB")}`:a.end?`Until ${new Date(a.end).toLocaleDateString("en-GB")}`:"All Time"}function he(){i({name:r.name||"",email:r.email||"",role:r.role||"",resource_ref:r.resource_ref||"",sfia_level:$(r.sfia_level),daily_rate:r.daily_rate||"",cost_price:r.cost_price||"",discount_percent:r.discount_percent||0,days_allocated:r.days_allocated||"",resource_type:r.resource_type||"internal",partner_id:r.partner_id||""}),F(!0)}async function ge(){try{U(!0),p(null);const t={name:s.name,email:s.email,role:s.role,resource_ref:s.resource_ref,sfia_level:fe(s.sfia_level),daily_rate:parseFloat(s.daily_rate)||0,discount_percent:parseFloat(s.discount_percent)||0,days_allocated:parseInt(s.days_allocated)||0,resource_type:s.resource_type,partner_id:s.resource_type==="third_party"&&s.partner_id||null};v&&(t.cost_price=s.cost_price===""?null:parseFloat(s.cost_price)),await P.update(d,t),await Y(),F(!1)}catch(t){p("Failed to save: "+t.message)}finally{U(!1)}}function xe(){F(!1),i({})}function $(t){return t?typeof t=="string"&&t.startsWith("L")?t:`L${t}`:"L4"}function fe(t){return t?typeof t=="number"?t:typeof t=="string"&&t.startsWith("L")?parseInt(t.substring(1))||4:parseInt(t)||4:4}function ye(t){return t==null?{color:"#9ca3af",bg:"#f1f5f9",label:"N/A",icon:se}:t>=25?{color:"#16a34a",bg:"#dcfce7",label:"Good",icon:Ge}:t>=10?{color:"#d97706",bg:"#fef3c7",label:"Low",icon:se}:{color:"#dc2626",bg:"#fee2e2",label:"Critical",icon:Oe}}function je(t){return t==="third_party"?{bg:"#fef3c7",color:"#92400e",icon:re,label:"Third-Party Partner"}:{bg:"#dbeafe",color:"#1e40af",icon:Ue,label:"Internal Supplier"}}function be(t){switch($(t)){case"L6":return{bg:"#fef3c7",color:"#92400e"};case"L5":return{bg:"#dcfce7",color:"#166534"};case"L4":return{bg:"#dbeafe",color:"#1e40af"};case"L3":return{bg:"#f1f5f9",color:"#475569"};default:return{bg:"#f1f5f9",color:"#475569"}}}function X(t){switch(t){case"Approved":return{bg:"#dcfce7",color:"#16a34a"};case"Submitted":return{bg:"#fef3c7",color:"#d97706"};case"Rejected":return{bg:"#fee2e2",color:"#dc2626"};case"Validated":return{bg:"#dcfce7",color:"#16a34a"};default:return{bg:"#f1f5f9",color:"#64748b"}}}if(ce)return e.jsx(ke,{message:"Loading resource...",size:"large",fullPage:!0});if(_&&!r)return e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx(J,{size:48,style:{color:"#f59e0b",marginBottom:"1rem"}}),e.jsx("h2",{children:"Resource Not Found"}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1.5rem"},children:_}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>b("/resources"),children:[e.jsx(K,{size:16})," Back to Resources"]})]})});const f=P.calculateMargin(r.daily_rate,r.cost_price),C=ye(f.percent),ve=C.icon,w=je(r.resource_type),_e=w.icon,V=be(r.sfia_level),h=r.days_allocated||0,z=r.timesheetSummary?.daysWorked||0,Se=Math.max(0,h-z),g=h>0?z/h*100:0,Ce=(r.daily_rate||0)*h;return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"page-title",children:[e.jsx("button",{onClick:()=>b("/resources"),className:"btn btn-secondary",style:{marginRight:"1rem",padding:"0.5rem"},children:e.jsx(K,{size:20})}),e.jsx(Q,{size:28}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("h1",{children:r.name}),R&&e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.35rem",padding:"0.35rem 0.75rem",backgroundColor:w.bg,color:w.color,borderRadius:"6px",fontSize:"0.85rem",fontWeight:"500"},children:[e.jsx(_e,{size:14}),w.label]})]}),e.jsxs("p",{style:{color:"#64748b"},children:[r.role," • ",r.email]})]})]}),ae&&!m&&e.jsxs("button",{className:"btn btn-primary",onClick:he,children:[e.jsx(Ie,{size:18})," Edit Resource"]})]}),_&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",color:"#dc2626",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(J,{size:18}),_,e.jsx("button",{onClick:()=>p(null),style:{marginLeft:"auto",background:"none",border:"none",cursor:"pointer"},children:e.jsx(N,{size:18})})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(H,{icon:G,label:"Daily Rate",value:`£${r.daily_rate||0}`,subtext:"Customer rate",color:"#10b981"}),v&&e.jsx(H,{icon:G,label:"Cost Price",value:r.cost_price?`£${r.cost_price}`:"Not set",subtext:"Internal cost",color:"#3b82f6"}),v&&e.jsxs("div",{className:"stat-card",style:{borderLeft:`4px solid ${C.color}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ve,{size:20,style:{color:C.color}}),e.jsx("span",{className:"stat-label",children:"Margin"})]}),e.jsx("div",{className:"stat-value",style:{color:C.color},children:f.percent!==null?`${f.percent.toFixed(1)}%`:"N/A"}),f.amount!==null&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["£",f.amount.toFixed(0)," per day"]})]}),e.jsx(H,{icon:ee,label:"Utilization",value:`${Math.round(g)}%`,subtext:`${z.toFixed(1)} / ${h} days`,color:g>80?"#10b981":g>0?"#3b82f6":"#64748b"})]}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(te,{size:18,style:{color:"#3b82f6"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Period:"})]}),e.jsxs("select",{value:I,onChange:t=>me(t.target.value),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem",minWidth:"160px"},children:[e.jsx("option",{value:"",children:"Select Month..."}),ue().map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("span",{style:{color:"#64748b"},children:"or"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"date",value:a.start||"",onChange:t=>q("start",t.target.value),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem"}}),e.jsx("span",{style:{color:"#64748b"},children:"to"}),e.jsx("input",{type:"date",value:a.end||"",onChange:t=>q("end",t.target.value),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"0.875rem"}})]}),(a.start||a.end)&&e.jsxs("button",{onClick:pe,style:{padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid #e2e8f0",background:"#f8fafc",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(N,{size:14}),"Clear"]}),e.jsxs("div",{style:{marginLeft:"auto",padding:"0.5rem 0.75rem",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500"},children:["Showing: ",W()]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:m?"1fr":"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"card-title",children:m?"Edit Resource Details":"Resource Details"})}),m?e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Name *"}),e.jsx("input",{type:"text",className:"input-field",value:s.name,onChange:t=>i({...s,name:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Email *"}),e.jsx("input",{type:"email",className:"input-field",value:s.email,onChange:t=>i({...s,email:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Role"}),e.jsx("input",{type:"text",className:"input-field",value:s.role,onChange:t=>i({...s,role:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Reference"}),e.jsx("input",{type:"text",className:"input-field",value:s.resource_ref,onChange:t=>i({...s,resource_ref:t.target.value}),placeholder:"e.g., R01",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"SFIA Level"}),e.jsxs("select",{className:"input-field",value:s.sfia_level,onChange:t=>i({...s,sfia_level:t.target.value}),style:{width:"100%"},children:[e.jsx("option",{value:"L3",children:"Level 3"}),e.jsx("option",{value:"L4",children:"Level 4"}),e.jsx("option",{value:"L5",children:"Level 5"}),e.jsx("option",{value:"L6",children:"Level 6"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Days Allocated"}),e.jsx("input",{type:"number",className:"input-field",value:s.days_allocated,onChange:t=>i({...s,days_allocated:t.target.value}),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Daily Rate (£) - Customer"}),e.jsx("input",{type:"number",className:"input-field",value:s.daily_rate,onChange:t=>i({...s,daily_rate:t.target.value}),style:{width:"100%"}})]}),v&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Cost Price (£) - Internal"}),e.jsx("input",{type:"number",className:"input-field",value:s.cost_price,onChange:t=>i({...s,cost_price:t.target.value}),placeholder:"Optional",style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Discount %"}),e.jsx("input",{type:"number",className:"input-field",value:s.discount_percent,onChange:t=>i({...s,discount_percent:t.target.value}),style:{width:"100%"}})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Resource Type"}),e.jsxs("select",{className:"input-field",value:s.resource_type,onChange:t=>i({...s,resource_type:t.target.value,partner_id:t.target.value==="internal"?"":s.partner_id}),style:{width:"100%"},children:[e.jsx("option",{value:"internal",children:"Internal Supplier Resource"}),e.jsx("option",{value:"third_party",children:"Third-Party Partner"})]})]}),s.resource_type==="third_party"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontWeight:"500",fontSize:"0.875rem"},children:"Partner"}),e.jsxs("select",{className:"input-field",value:s.partner_id,onChange:t=>i({...s,partner_id:t.target.value}),style:{width:"100%"},children:[e.jsx("option",{value:"",children:"-- Select Partner --"}),ne.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})]}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"0.75rem"},children:[e.jsx("button",{className:"btn btn-primary",onClick:ge,disabled:A,children:A?e.jsx(e.Fragment,{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:16})," Save Changes"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:xe,disabled:A,children:[e.jsx(N,{size:16})," Cancel"]})]})]}):e.jsx("div",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx(x,{icon:e.jsx(Q,{size:16}),label:"Name",value:r.name}),e.jsx(x,{icon:e.jsx(We,{size:16}),label:"Email",value:r.email}),e.jsx(x,{icon:e.jsx($e,{size:16}),label:"Role",value:r.role}),e.jsx(x,{icon:e.jsx(Ee,{size:16}),label:"Reference",value:r.resource_ref||"Not set"})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(Me,{size:14})," SFIA Level"]}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",padding:"0.25rem 0.5rem",backgroundColor:V.bg,color:V.color,borderRadius:"4px",fontWeight:"500",marginTop:"0.25rem"},children:$(r.sfia_level)})]}),e.jsx(x,{icon:e.jsx(te,{size:16}),label:"Days Allocated",value:`${h} days`}),e.jsx(x,{icon:e.jsx(G,{size:16}),label:"Total Value",value:`£${Ce.toLocaleString()}`}),R&&r.resource_type==="third_party"&&e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(re,{size:14})," Partner"]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:r.partner?.name||"Not assigned"})]})]})]})})]}),!m&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Allocation"})}),e.jsxs("div",{style:{padding:"1rem"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsxs("span",{children:[z.toFixed(1)," days used"]}),e.jsxs("span",{children:[Se.toFixed(1)," remaining"]})]}),e.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.min(g,100)}%`,height:"100%",backgroundColor:g>100?"#dc2626":g>80?"#10b981":"#3b82f6",borderRadius:"4px",transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",fontSize:"0.875rem"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b"},children:"Hours Logged"}),e.jsxs("div",{style:{fontWeight:"600"},children:[r.timesheetSummary?.totalHours?.toFixed(1)||0,"h"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b"},children:"Approved Hours"}),e.jsxs("div",{style:{fontWeight:"600",color:"#10b981"},children:[r.timesheetSummary?.approvedHours?.toFixed(1)||0,"h"]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{className:"card-title",children:"Timesheets"}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:[k.length," entries",a.start||a.end?` (${W()})`:""]})]}),k.length>0?e.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Hours"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:k.map(t=>{const l=X(t.status);return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.5rem"},children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsxs("td",{style:{padding:"0.5rem"},children:[parseFloat(t.hours_worked||t.hours||0).toFixed(1),"h"]}),e.jsx("td",{style:{padding:"0.5rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:l.bg,color:l.color},children:t.status})})]},t.id)})})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(ee,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsxs("p",{children:["No timesheets ",a.start||a.end?"in selected period":"recorded"]})]})]})]})]}),!m&&e.jsxs("div",{className:"card",style:{marginTop:"1.5rem"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{className:"card-title",children:"Expenses"}),e.jsxs("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:[L.length," entries",a.start||a.end?` (${W()})`:""]})]}),L.length>0?e.jsx("div",{style:{overflowX:"auto",maxHeight:"400px",overflowY:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem"},children:[e.jsx("thead",{style:{position:"sticky",top:0,backgroundColor:"#fff"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Reason"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right"},children:"Amount"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center"},children:"Chargeable"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Paid By"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:L.map(t=>{const l=parseFloat(t.amount)||0,n=X(t.status),u={Travel:{bg:"#dbeafe",color:"#1e40af"},Accommodation:{bg:"#f3e8ff",color:"#7c3aed"},Sustenance:{bg:"#fef3c7",color:"#92400e"}}[t.category]||{bg:"#f1f5f9",color:"#475569"};return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(t.expense_date).toLocaleDateString("en-GB")}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:u.bg,color:u.color},children:t.category})}),e.jsx("td",{style:{padding:"0.75rem",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.reason||"-"}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:["£",l.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:t.chargeable_to_customer?e.jsx(Pe,{size:16,style:{color:"#10b981"}}):e.jsx(N,{size:16,style:{color:"#94a3b8"}})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:t.procurement_method==="partner"?"#fef3c7":"#e0f2fe",color:t.procurement_method==="partner"?"#92400e":"#0369a1"},children:t.procurement_method==="partner"?"Partner":"Supplier"})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",backgroundColor:n.bg,color:n.color},children:t.status||"Draft"})})]},t.id)})})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(He,{size:32,style:{marginBottom:"0.5rem",opacity:.5}}),e.jsxs("p",{children:["No expenses ",a.start||a.end?"in selected period":"recorded"]})]})]}),e.jsx("style",{jsx:!0,children:`
        .input-field {
          padding: 0.5rem 0.75rem;
          border: 1px solid #d1d5db;
          border-radius: 6px;
          font-size: 0.875rem;
        }
        .input-field:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
      `})]})}function x({icon:d,label:b,value:O}){return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.75rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem"},children:[d," ",b]}),e.jsx("span",{style:{fontWeight:"500",marginTop:"0.25rem",display:"block"},children:O})]})}export{Qe as default};
