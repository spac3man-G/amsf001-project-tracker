import{j as e,o as _e,u as Se,a as De,b as Ne,e as Ce,c as Te,t as F,r as ze,m as Ie,L as Fe,l as Re}from"./index-DgkPpMLd.js";import{r as d}from"./vendor-react-B1g8b4mG.js";import{C as Ee}from"./ConfirmDialog-CUdN7z1c.js";import{g as We,a as Le,b as J,E as v,T as ne,c as ie,d as re,e as Ae}from"./timesheetCalculations-NwQ57IT4.js";import{l as O,a as $,U as le,a2 as G,aj as Be,F as Me,T as Oe,a9 as oe,e as Ue,C as Ye,a8 as He,R as $e,a7 as Ge,ar as Ve}from"./vendor-icons-BfsEacNp.js";import"./vendor-supabase-DSZ6Ejbd.js";function Pe({isOpen:_,timesheet:t,resources:C,milestones:j,userRole:y,canSubmitTimesheet:f,canValidateTimesheet:R,canEditTimesheet:S,canDeleteTimesheet:E,onClose:T,onSave:D,onSubmit:L,onValidate:o,onReject:u,onDelete:m}){const[h,x]=d.useState(!1),[r,p]=d.useState({});if(d.useEffect(()=>{t&&(p({resource_id:t.resource_id,milestone_id:t.milestone_id||"",work_date:t.work_date||t.date||"",hours_worked:t.hours_worked||t.hours||0,description:t.description||t.comments||"",status:t.status}),x(!1))},[t]),!_||!t)return null;const c=We(t.status),A=C?.find(a=>a.id===t.resource_id),W=j?.find(a=>a.id===t.milestone_id),U=parseFloat(t.hours_worked||t.hours||0),V=A?.sell_price||t.resources?.sell_price||0,Y=_e(U,V);async function H(){await D(t.id,r),x(!1)}function b(){x(!1),T()}return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:b,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 1.5rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"8px",backgroundColor:"#dbeafe",color:"#2563eb"},children:e.jsx(O,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Timesheet Entry"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:t.resources?.name||A?.name||"Unknown Resource"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:c.bg,color:c.color},children:c.label}),e.jsx("button",{onClick:b,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b"},children:e.jsx($,{size:24})})]})]}),e.jsx("div",{style:{padding:"1.5rem"},children:h?e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Resource"}),e.jsx("select",{className:"form-input",value:r.resource_id,onChange:a=>p({...r,resource_id:a.target.value}),disabled:y!=="admin",children:C?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Date"}),e.jsx("input",{type:"date",className:"form-input",value:r.work_date,onChange:a=>p({...r,work_date:a.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Milestone"}),e.jsxs("select",{className:"form-input",value:r.milestone_id,onChange:a=>p({...r,milestone_id:a.target.value}),children:[e.jsx("option",{value:"",children:"-- No milestone --"}),j?.map(a=>e.jsxs("option",{value:a.id,children:[a.milestone_ref," - ",a.name]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:"24",className:"form-input",value:r.hours_worked,onChange:a=>p({...r,hours_worked:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:r.description,onChange:a=>p({...r,description:a.target.value}),placeholder:"What did you work on?"})]}),y==="admin"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsx("select",{className:"form-input",value:r.status,onChange:a=>p({...r,status:a.target.value}),children:Le().map(a=>e.jsx("option",{value:a,children:J(a)},a))})]})]}):e.jsxs("div",{style:{display:"grid",gap:"1.25rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(le,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Resource"}),e.jsx("div",{style:{fontWeight:"500"},children:t.resources?.name||A?.name||"Unknown"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(G,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Date"}),e.jsx("div",{style:{fontWeight:"500"},children:t.work_date||t.date?new Date(t.work_date||t.date).toLocaleDateString("en-GB"):"-"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(O,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Hours"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#0f172a"},children:[U.toFixed(1),"h"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Be,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Value"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#10b981"},children:["£",Y.toFixed(2)]})]})]})]}),(t.milestone_id||W)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Me,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Milestone"}),e.jsxs("div",{style:{fontWeight:"500"},children:[t.milestones?.milestone_ref||W?.milestone_ref||""," - ",t.milestones?.name||W?.name||"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.375rem"},children:"Description"}),e.jsx("div",{style:{fontSize:"0.9375rem"},children:t.description||t.comments||"No description provided"})]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.8125rem",color:"#64748b",paddingTop:"0.75rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(O,{size:14}),"Created: ",t.created_at?new Date(t.created_at).toLocaleString("en-GB"):"Unknown"]}),t.updated_at&&t.updated_at!==t.created_at&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(O,{size:14}),"Updated: ",new Date(t.updated_at).toLocaleString("en-GB")]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsx("div",{children:E(t)&&!h&&e.jsxs("button",{onClick:()=>{m(t),b()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Oe,{size:16})," Delete"]})}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:H,className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(oe,{size:16})," Save Changes"]})]}):e.jsxs(e.Fragment,{children:[f(t)&&e.jsxs("button",{onClick:()=>{L(t.id),b()},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Ue,{size:16})," Submit for Validation"]}),R(t)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{u(t.id),b()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx($,{size:16})," Reject"]}),e.jsxs("button",{onClick:()=>{o(t.id),b()},className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Ye,{size:16})," Validate"]})]}),S(t)&&e.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(He,{size:16})," Edit"]})]})})]})]})})}function qe({dateRange:_,selectedPeriod:t,onPeriodSelect:C,onDateRangeChange:j,onClear:y,getDateRangeLabel:f}){function R(){const o=[],u=new Date;for(let m=0;m<12;m++){const h=new Date(u.getFullYear(),u.getMonth()-m,1),x=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`,r=h.toLocaleDateString("en-GB",{month:"long",year:"numeric"});o.push({value:x,label:r})}return o}function S(o){const u=new Date,m=u.getDay();let h,x;switch(o){case"this-week":{const r=new Date(u),p=m===0?6:m-1;r.setDate(u.getDate()-p),h=r;const c=new Date(r);c.setDate(r.getDate()+6),x=c;break}case"last-week":{const r=new Date(u),p=m===0?6:m-1;r.setDate(u.getDate()-p-7),h=r;const c=new Date(r);c.setDate(r.getDate()+6),x=c;break}default:return}C(o,{start:h.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})}function E(o){if(o){const[u,m]=o.split("-").map(Number),h=new Date(u,m-1,1),x=new Date(u,m,0);C(o,{start:h.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})}else y()}const T=t==="this-week",D=t==="last-week",L=t&&t.includes("-")&&t.length===7;return e.jsx("div",{className:"ts-date-filter",children:e.jsxs("div",{className:"ts-date-filter-row",children:[e.jsxs("div",{className:"ts-date-filter-label",children:[e.jsx(G,{size:18}),e.jsx("span",{children:"Period:"})]}),e.jsxs("div",{className:"ts-quick-buttons",children:[e.jsx("button",{type:"button",onClick:()=>S("this-week"),className:`ts-quick-btn ${T?"active":""}`,children:"This Week"}),e.jsx("button",{type:"button",onClick:()=>S("last-week"),className:`ts-quick-btn ${D?"active":""}`,children:"Last Week"})]}),e.jsxs("select",{value:L?t:"",onChange:o=>E(o.target.value),className:"ts-month-select",children:[e.jsx("option",{value:"",children:"Select Month..."}),R().map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsx("span",{className:"ts-date-separator",children:"or"}),e.jsxs("div",{className:"ts-date-inputs",children:[e.jsx("input",{type:"date",value:_.start||"",onChange:o=>j("start",o.target.value),className:"ts-date-input"}),e.jsx("span",{className:"ts-date-to",children:"to"}),e.jsx("input",{type:"date",value:_.end||"",onChange:o=>j("end",o.target.value),className:"ts-date-input"})]}),(_.start||_.end)&&e.jsxs("button",{type:"button",onClick:y,className:"ts-clear-btn",children:[e.jsx($,{size:14})," Clear"]}),e.jsxs("div",{className:"ts-showing-label",children:["Showing: ",f()]})]})})}function as(){const{user:_,role:t,linkedResource:C}=Se(),{projectId:j}=De(),{showSuccess:y,showError:f,showWarning:R}=Ne(),{showTestUsers:S,testUserIds:E}=Ce(),T=_?.id||null,D=C?.id||null,{canAddTimesheet:L,canEditTimesheet:o,canDeleteTimesheet:u,canSubmitTimesheet:m,canValidateTimesheet:h,getAvailableResources:x}=Te(),[r,p]=d.useState([]),[c,A]=d.useState([]),[W,U]=d.useState([]),[V,Y]=d.useState(!0),[H,b]=d.useState(!1),[a,P]=d.useState(!1),[Ke,de]=d.useState(null),[ce,Qe]=d.useState({}),[q,ue]=d.useState("all"),[w,Z]=d.useState(v.DAILY),[z,K]=d.useState({isOpen:!1,timesheetId:null,timesheetData:null}),[ee,se]=d.useState({isOpen:!1,timesheet:null}),[g,Q]=d.useState({start:null,end:null}),[I,X]=d.useState(""),[l,N]=d.useState({resource_id:"",milestone_id:"",work_date:re(),week_ending:ie(),hours_worked:"",description:"",status:ne.DRAFT,entry_type:v.DAILY}),k=d.useCallback(async()=>{if(j){Y(!0);try{const s=await F.getAllFiltered(j,S);p(s);const i=await ze.getAllWithTestFilter(j,S?[]:E);A(i);const n=await Ie.getAll(j,{orderBy:{column:"milestone_ref",ascending:!0}});U(n)}catch{f("Failed to load timesheets")}finally{Y(!1),b(!1)}}},[j,S,E,f]);d.useEffect(()=>{k()},[k]),d.useEffect(()=>{D&&N(s=>({...s,resource_id:D}))},[D]);function me(s,i){X(s),Q(i)}function he(s,i){X("custom"),Q(n=>({...n,[s]:i||null}))}function xe(){Q({start:null,end:null}),X("")}function pe(){if(!g.start&&!g.end)return"All Time";if(I==="this-week")return"This Week";if(I==="last-week")return"Last Week";if(I&&I.length===7&&I.includes("-")){const[n,M]=I.split("-").map(Number);return new Date(n,M-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}const s=g.start?new Date(g.start).toLocaleDateString("en-GB"):"Start",i=g.end?new Date(g.end).toLocaleDateString("en-GB"):"End";return`${s} - ${i}`}async function ge(){b(!0),await k()}async function je(){if(!l.resource_id||!l.hours_worked){R("Please fill in all required fields");return}try{const s=c.find(n=>n.id===l.resource_id),i=w===v.DAILY?l.work_date:l.week_ending;await F.create({project_id:j,resource_id:l.resource_id,milestone_id:l.milestone_id||null,user_id:s?.user_id||T,created_by:T,date:i,work_date:i,week_ending:w===v.WEEKLY?l.week_ending:null,hours_worked:parseFloat(l.hours_worked),hours:parseFloat(l.hours_worked),description:l.description,comments:l.description,status:l.status,entry_type:w}),await k(),P(!1),N({resource_id:D||"",milestone_id:"",work_date:re(),week_ending:ie(),hours_worked:"",description:"",status:ne.DRAFT,entry_type:w}),y("Timesheet added successfully!")}catch(s){f("Failed to add timesheet: "+s.message)}}async function fe(s,i=null){const n=i||ce;try{await F.update(s,{resource_id:n.resource_id,milestone_id:n.milestone_id||null,date:n.work_date,work_date:n.work_date,week_ending:n.week_ending||null,hours:parseFloat(n.hours_worked),hours_worked:parseFloat(n.hours_worked),comments:n.description,description:n.description,status:n.status}),await k(),de(null),y("Timesheet updated!")}catch(M){f("Failed to update: "+M.message)}}function ye(s){const i=c.find(M=>M.id===s.resource_id),n=parseFloat(s.hours_worked)||0;K({isOpen:!0,timesheetId:s.id,timesheetData:{resourceName:s.resources?.name||i?.name||"Unknown",date:s.work_date||s.date,hours:n,costImpact:Re(n,i?.cost_price),status:s.status}})}async function ve(){if(z.timesheetId)try{await F.delete(z.timesheetId,T),await k(),K({isOpen:!1,timesheetId:null,timesheetData:null}),y("Timesheet deleted")}catch(s){f("Failed to delete: "+s.message)}}async function be(s){try{await F.submit(s),await k(),y("Timesheet submitted for validation!")}catch(i){f("Failed to submit: "+i.message)}}async function we(s){try{await F.validate(s),await k(),y("Timesheet validated!")}catch(i){f("Failed to validate: "+i.message)}}async function ke(s){const i=prompt("Rejection reason (optional):");try{await F.reject(s,i),await k(),R("Timesheet rejected")}catch(n){f("Failed to reject: "+n.message)}}const B=r.filter(s=>{if(q!=="all"&&s.resource_id!==q)return!1;if(g.start||g.end){const i=new Date(s.work_date||s.date);if(g.start&&i<new Date(g.start))return!1;if(g.end){const n=new Date(g.end);if(n.setHours(23,59,59,999),i>n)return!1}}return!0}),te=c.map(s=>({name:s.name,hours:B.filter(i=>i.resource_id===s.id).reduce((i,n)=>i+parseFloat(n.hours_worked||n.hours||0),0)})).filter(s=>s.hours>0),ae=x(c);return V?e.jsx(Fe,{message:"Loading timesheets...",size:"large",fullPage:!0}):e.jsxs("div",{className:"timesheets-page",children:[e.jsx("header",{className:"ts-header",children:e.jsxs("div",{className:"ts-header-content",children:[e.jsxs("div",{className:"ts-header-left",children:[e.jsx("div",{className:"ts-header-icon",children:e.jsx(O,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Timesheets"}),e.jsx("p",{children:"Track time spent on project activities"})]})]}),e.jsxs("div",{className:"ts-header-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:ge,disabled:H,children:[e.jsx($e,{size:18,className:H?"spinning":""})," Refresh"]}),!a&&L&&e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:()=>P(!0),children:[e.jsx(Ge,{size:18})," Add Timesheet"]})]})]})}),e.jsxs("div",{className:"ts-content",children:[e.jsx(qe,{dateRange:g,selectedPeriod:I,onPeriodSelect:me,onDateRangeChange:he,onClear:xe,getDateRangeLabel:pe}),te.length>0&&e.jsxs("div",{className:"ts-hours-summary",children:[e.jsx("h4",{className:"ts-hours-title",children:"Hours by Resource"}),e.jsx("div",{className:"ts-hours-grid",children:te.map(s=>e.jsxs("div",{className:"ts-hours-card",children:[e.jsx("div",{className:"ts-hours-name",children:s.name}),e.jsxs("div",{className:"ts-hours-value",children:[s.hours.toFixed(1),"h"]})]},s.name))})]}),e.jsxs("div",{className:"ts-filters",children:[e.jsx("span",{className:"ts-filter-label",children:"Filter:"}),e.jsxs("select",{value:q,onChange:s=>ue(s.target.value),className:"ts-filter-select",children:[e.jsx("option",{value:"all",children:"All Resources"}),c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a&&e.jsxs("div",{className:"ts-add-form",children:[e.jsx("h3",{className:"ts-add-form-title",children:"Add Timesheet Entry"}),e.jsxs("div",{className:"ts-entry-mode",children:[e.jsx("label",{className:"ts-mode-label",children:"Entry Type"}),e.jsxs("div",{className:"ts-mode-buttons",children:[e.jsxs("button",{type:"button",onClick:()=>Z(v.DAILY),className:`ts-mode-btn ${w===v.DAILY?"active":""}`,children:[e.jsx(G,{size:18})," Daily Entry"]}),e.jsxs("button",{type:"button",onClick:()=>Z(v.WEEKLY),className:`ts-mode-btn ${w===v.WEEKLY?"active":""}`,children:[e.jsx(Ve,{size:18})," Weekly Summary"]})]})]}),ae.length===0&&e.jsx("div",{className:"ts-warning",children:"⚠️ Your account is not linked to a resource."}),e.jsxs("div",{className:"ts-form-grid",children:[e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Resource *"}),e.jsxs("select",{value:l.resource_id,onChange:s=>N({...l,resource_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Resource"}),ae.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),w===v.DAILY?e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Date *"}),e.jsx("input",{type:"date",value:l.work_date,onChange:s=>N({...l,work_date:s.target.value})})]}):e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Week Ending *"}),e.jsx("input",{type:"date",value:l.week_ending,onChange:s=>N({...l,week_ending:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>N({...l,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"-- No specific milestone --"}),W.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Hours *"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:w===v.DAILY?"12":"60",placeholder:w===v.DAILY?"e.g., 8":"e.g., 40",value:l.hours_worked,onChange:s=>N({...l,hours_worked:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group ts-full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{rows:2,placeholder:"What did you work on?",value:l.description,onChange:s=>N({...l,description:s.target.value})})]})]}),e.jsxs("div",{className:"ts-form-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:je,children:[e.jsx(oe,{size:16})," Save"]}),e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:()=>P(!1),children:[e.jsx($,{size:16})," Cancel"]})]})]}),e.jsxs("div",{className:"ts-table-card",children:[e.jsxs("div",{className:"ts-table-header",children:[e.jsx("h2",{className:"ts-table-title",children:"Timesheet Entries"}),e.jsxs("span",{className:"ts-table-count",children:[B.length," entr",B.length!==1?"ies":"y"]})]}),e.jsxs("table",{className:"ts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Resource"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:B.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"ts-empty-cell",children:"No timesheets found for the selected period."})}):B.map(s=>e.jsxs("tr",{onClick:()=>se({isOpen:!0,timesheet:s}),children:[e.jsx("td",{children:e.jsxs("div",{className:"ts-resource-cell",children:[e.jsx(le,{size:16}),e.jsx("span",{className:"ts-resource-name",children:s.resources?.name||"Unknown"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"ts-date-cell",children:[e.jsx(G,{size:14}),s.work_date||s.date?new Date(s.work_date||s.date).toLocaleDateString("en-GB"):"—"]})}),e.jsx("td",{children:s.milestones?.milestone_ref||"—"}),e.jsxs("td",{className:"ts-hours",children:[parseFloat(s.hours_worked||s.hours||0).toFixed(1),"h"]}),e.jsx("td",{className:"ts-description",children:s.description||s.comments||"No description"}),e.jsx("td",{children:e.jsx("span",{className:`ts-status-badge ${Ae(s.status)}`,children:J(s.status)})})]},s.id))})]})]})]}),e.jsx(Ee,{isOpen:z.isOpen,onClose:()=>K({isOpen:!1,timesheetId:null,timesheetData:null}),onConfirm:ve,title:"Delete Timesheet",message:z.timesheetData?e.jsxs("div",{children:[e.jsx("p",{children:"Delete this timesheet entry?"}),e.jsx("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"0.75rem",marginTop:"0.75rem"},children:e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",color:"#92400e",fontSize:"0.9rem"},children:[e.jsxs("li",{children:["Resource: ",z.timesheetData.resourceName]}),e.jsxs("li",{children:["Hours: ",z.timesheetData.hours,"h"]}),e.jsxs("li",{children:["Status: ",J(z.timesheetData.status)]})]})})]}):"Delete this timesheet?",confirmText:"Delete",cancelText:"Cancel",variant:"danger"}),e.jsx(Pe,{isOpen:ee.isOpen,timesheet:ee.timesheet,resources:c,milestones:W,userRole:t,canSubmitTimesheet:m,canValidateTimesheet:h,canEditTimesheet:o,canDeleteTimesheet:u,onClose:()=>se({isOpen:!1,timesheet:null}),onSave:fe,onSubmit:be,onValidate:we,onReject:ke,onDelete:ye})]})}export{as as default};
