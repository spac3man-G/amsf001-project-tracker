import{j as e,u as _e,a as we,b as Se,c as Ce,t as C,r as De,m as Ne,L as Te}from"./index-bPiKHbub.js";import{r as l}from"./vendor-react-JFEV0ROX.js";import{u as ze}from"./usePermissions-BUO-hVwM.js";import{S as H}from"./StatCard-Bgsld_cB.js";import{P as Ie}from"./PageHeader-BQvbuzw8.js";import{C as Re}from"./ConfirmDialog-C1noKWmG.js";import{k as T,a as F,U as ue,a0 as M,ad as Fe,F as Ae,T as me,_ as J,e as pe,C as K,Z as he,Y as We,y as Ee,ak as Be}from"./vendor-icons-CMdlt-Xc.js";import"./vendor-supabase-DgEUAXvv.js";const Ue=["Draft","Submitted","Approved","Rejected"],de={Draft:"Draft",Submitted:"Submitted",Approved:"Validated",Rejected:"Rejected"};function Pe(u){switch(u){case"Approved":return{bg:"#dcfce7",color:"#166534"};case"Submitted":return{bg:"#dbeafe",color:"#1e40af"};case"Rejected":return{bg:"#fee2e2",color:"#991b1b"};default:return{bg:"#f1f5f9",color:"#64748b"}}}function Oe({isOpen:u,timesheet:i,resources:v,milestones:x,userRole:f,canSubmitTimesheet:m,canValidateTimesheet:A,canEditTimesheet:z,canDeleteTimesheet:W,onClose:I,onSave:D,onSubmit:L,onValidate:E,onReject:B,onDelete:U}){const[N,k]=l.useState(!1),[o,g]=l.useState({});if(l.useEffect(()=>{i&&(g({resource_id:i.resource_id,milestone_id:i.milestone_id||"",work_date:i.work_date||i.date||"",hours_worked:i.hours_worked||i.hours||0,description:i.description||i.comments||"",status:i.status}),k(!1))},[i]),!u||!i)return null;const p=Pe(i.status),R=v?.find(r=>r.id===i.resource_id),_=x?.find(r=>r.id===i.milestone_id),P=parseFloat(i.hours_worked||i.hours||0),G=R?.daily_rate||i.resources?.daily_rate||0,O=P/8*G;async function V(){await D(i.id,o),k(!1)}function h(){k(!1),I()}return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:h,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 1.5rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"8px",backgroundColor:"#dbeafe",color:"#2563eb"},children:e.jsx(T,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Timesheet Entry"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:i.resources?.name||R?.name||"Unknown Resource"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:p.bg,color:p.color},children:de[i.status]||i.status}),e.jsx("button",{onClick:h,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b"},children:e.jsx(F,{size:24})})]})]}),e.jsx("div",{style:{padding:"1.5rem"},children:N?e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Resource"}),e.jsx("select",{className:"form-input",value:o.resource_id,onChange:r=>g({...o,resource_id:r.target.value}),disabled:f!=="admin",children:v?.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Date"}),e.jsx("input",{type:"date",className:"form-input",value:o.work_date,onChange:r=>g({...o,work_date:r.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Milestone"}),e.jsxs("select",{className:"form-input",value:o.milestone_id,onChange:r=>g({...o,milestone_id:r.target.value}),children:[e.jsx("option",{value:"",children:"-- No milestone --"}),x?.map(r=>e.jsxs("option",{value:r.id,children:[r.milestone_ref," - ",r.name]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:"24",className:"form-input",value:o.hours_worked,onChange:r=>g({...o,hours_worked:r.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:o.description,onChange:r=>g({...o,description:r.target.value}),placeholder:"What did you work on?"})]}),f==="admin"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsx("select",{className:"form-input",value:o.status,onChange:r=>g({...o,status:r.target.value}),children:Ue.map(r=>e.jsx("option",{value:r,children:de[r]||r},r))})]})]}):e.jsxs("div",{style:{display:"grid",gap:"1.25rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(ue,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Resource"}),e.jsx("div",{style:{fontWeight:"500"},children:i.resources?.name||R?.name||"Unknown"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(M,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Date"}),e.jsx("div",{style:{fontWeight:"500"},children:i.work_date||i.date?new Date(i.work_date||i.date).toLocaleDateString("en-GB"):"-"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(T,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Hours"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#0f172a"},children:[P.toFixed(1),"h"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Fe,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Value"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#10b981"},children:["£",O.toFixed(2)]})]})]})]}),(i.milestone_id||_)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Ae,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Milestone"}),e.jsxs("div",{style:{fontWeight:"500"},children:[i.milestones?.milestone_ref||_?.milestone_ref||""," - ",i.milestones?.name||_?.name||"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.375rem"},children:"Description"}),e.jsx("div",{style:{fontSize:"0.9375rem"},children:i.description||i.comments||"No description provided"})]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.8125rem",color:"#64748b",paddingTop:"0.75rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(T,{size:14}),"Created: ",i.created_at?new Date(i.created_at).toLocaleString("en-GB"):"Unknown"]}),i.updated_at&&i.updated_at!==i.created_at&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(T,{size:14}),"Updated: ",new Date(i.updated_at).toLocaleString("en-GB")]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsx("div",{children:W(i)&&!N&&e.jsxs("button",{onClick:()=>{U(i),h()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(me,{size:16})," Delete"]})}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:N?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:V,className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(J,{size:16})," Save Changes"]})]}):e.jsxs(e.Fragment,{children:[m(i)&&e.jsxs("button",{onClick:()=>{L(i.id),h()},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(pe,{size:16})," Submit for Validation"]}),A(i)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{B(i.id),h()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(F,{size:16})," Reject"]}),e.jsxs("button",{onClick:()=>{E(i.id),h()},className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(K,{size:16})," Validate"]})]}),z(i)&&e.jsxs("button",{onClick:()=>k(!0),className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(he,{size:16})," Edit"]})]})})]})]})})}const Ve=["Draft","Submitted","Approved","Rejected"],Z={Draft:"Draft",Submitted:"Submitted",Approved:"Validated",Rejected:"Rejected"};function ce(){const u=new Date,i=7-u.getDay(),v=new Date(u);return v.setDate(u.getDate()+(u.getDay()===0?0:i)),v.toISOString().split("T")[0]}function Ze(){const{user:u,role:i,linkedResource:v}=_e(),{projectId:x}=we(),{showSuccess:f,showError:m,showWarning:A}=Se(),{showTestUsers:z,testUserIds:W}=Ce(),I=u?.id||null,D=v?.id||null,{canAddTimesheet:L,canEditTimesheet:E,canDeleteTimesheet:B,canSubmitTimesheet:U,canValidateTimesheet:N,getAvailableResources:k}=ze(),[o,g]=l.useState([]),[p,R]=l.useState([]),[_,P]=l.useState([]),[G,O]=l.useState(!0),[V,h]=l.useState(!1),[r,Y]=l.useState(null),[c,w]=l.useState({}),[$,xe]=l.useState("all"),[d,Q]=l.useState("daily"),[j,q]=l.useState({isOpen:!1,timesheetId:null,timesheetData:null}),[ee,se]=l.useState({isOpen:!1,timesheet:null}),[a,y]=l.useState({resource_id:"",milestone_id:"",work_date:new Date().toISOString().split("T")[0],week_ending:ce(),hours_worked:"",description:"",status:"Draft",entry_type:"daily"}),b=l.useCallback(async()=>{if(x){O(!0);try{const s=await C.getAllFiltered(x,z);g(s);const t=await De.getAllWithTestFilter(x,z?[]:W);R(t);const n=await Ne.getAll(x,{orderBy:{column:"milestone_ref",ascending:!0}});P(n)}catch{m("Failed to load timesheets")}finally{O(!1)}}},[x,z,W,m]);l.useEffect(()=>{b()},[b]),l.useEffect(()=>{D&&y(s=>({...s,resource_id:D}))},[D]);async function ge(){if(!a.resource_id||!a.hours_worked){A("Please fill in all required fields");return}try{const s=p.find(n=>n.id===a.resource_id),t=d==="daily"?a.work_date:a.week_ending;await C.create({project_id:x,resource_id:a.resource_id,milestone_id:a.milestone_id||null,user_id:s?.user_id||I,created_by:I,date:t,work_date:t,week_ending:d==="weekly"?a.week_ending:null,hours_worked:parseFloat(a.hours_worked),hours:parseFloat(a.hours_worked),description:a.description,comments:a.description,status:a.status,entry_type:d}),await b(),h(!1),y({resource_id:D||"",milestone_id:"",work_date:new Date().toISOString().split("T")[0],week_ending:ce(),hours_worked:"",description:"",status:"Draft",entry_type:d}),f("Timesheet added successfully!")}catch(s){m("Failed to add timesheet: "+s.message)}}function fe(s){Y(s.id),w({resource_id:s.resource_id,milestone_id:s.milestone_id||"",work_date:s.work_date||s.date||"",week_ending:s.week_ending||"",hours_worked:s.hours_worked||s.hours||0,description:s.description||s.comments||"",status:s.status,entry_type:s.entry_type||"daily"})}async function te(s,t=null){const n=t||c;try{await C.update(s,{resource_id:n.resource_id,milestone_id:n.milestone_id||null,date:n.work_date,work_date:n.work_date,week_ending:n.week_ending||null,hours:parseFloat(n.hours_worked),hours_worked:parseFloat(n.hours_worked),comments:n.description,description:n.description,status:n.status}),await b(),Y(null),f("Timesheet updated!")}catch(X){m("Failed to update: "+X.message)}}function ie(s){const t=p.find(X=>X.id===s.resource_id),n=parseFloat(s.hours_worked)||0;q({isOpen:!0,timesheetId:s.id,timesheetData:{resourceName:s.resources?.name||t?.name||"Unknown",date:s.work_date||s.date,hours:n,costImpact:n/8*(t?.cost_price||0),status:s.status}})}async function je(){if(j.timesheetId)try{await C.delete(j.timesheetId,I),await b(),q({isOpen:!1,timesheetId:null,timesheetData:null}),f("Timesheet deleted")}catch(s){m("Failed to delete: "+s.message)}}async function re(s){try{await C.submit(s),await b(),f("Timesheet submitted for validation!")}catch(t){m("Failed to submit: "+t.message)}}async function ae(s){try{await C.validate(s),await b(),f("Timesheet validated!")}catch(t){m("Failed to validate: "+t.message)}}async function ne(s){const t=prompt("Rejection reason (optional):");try{await C.reject(s,t),await b(),A("Timesheet rejected")}catch(n){m("Failed to reject: "+n.message)}}function ye(s){switch(s){case"Approved":return"status-approved";case"Submitted":return"status-submitted";case"Rejected":return"status-rejected";default:return"status-draft"}}const S=o.filter(s=>$==="all"||s.resource_id===$),be=S.reduce((s,t)=>s+parseFloat(t.hours_worked||t.hours||0),0),ve=S.filter(s=>s.status==="Approved").reduce((s,t)=>s+parseFloat(t.hours_worked||t.hours||0),0),ke=S.filter(s=>s.status==="Submitted").length,le=p.map(s=>({name:s.name,hours:S.filter(t=>t.resource_id===s.id).reduce((t,n)=>t+parseFloat(n.hours_worked||n.hours||0),0)})).filter(s=>s.hours>0),oe=k(p);return G?e.jsx(Te,{message:"Loading timesheets...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(Ie,{icon:T,title:"Timesheets",subtitle:"Track time spent on project activities",children:!V&&L&&e.jsxs("button",{className:"btn btn-primary",onClick:()=>h(!0),children:[e.jsx(We,{size:18})," Add Timesheet"]})}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(H,{icon:M,label:"Total Entries",value:S.length,color:"#3b82f6"}),e.jsx(H,{icon:T,label:"Total Hours",value:be.toFixed(1),color:"#3b82f6"}),e.jsx(H,{icon:K,label:"Validated Hours",value:ve.toFixed(1),color:"#10b981"}),e.jsx(H,{icon:Ee,label:"Pending Validation",value:ke,color:"#f59e0b"})]}),le.length>0&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{marginBottom:"0.75rem"},children:"Hours by Resource"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem"},children:le.map(s=>e.jsxs("div",{style:{padding:"0.75rem 1rem",backgroundColor:"#f1f5f9",borderRadius:"8px",minWidth:"120px"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.9rem"},children:s.name}),e.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#3b82f6"},children:[s.hours.toFixed(1),"h"]})]},s.name))})]}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontWeight:"500"},children:"Filter:"}),e.jsxs("select",{value:$,onChange:s=>xe(s.target.value),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid #d1d5db"},children:[e.jsx("option",{value:"all",children:"All Resources"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),V&&e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",border:"2px solid var(--primary)"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Add Timesheet Entry"}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{fontWeight:"500",marginBottom:"0.5rem",display:"block"},children:"Entry Type"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{type:"button",onClick:()=>Q("daily"),style:{padding:"0.75rem 1.5rem",border:"2px solid",borderColor:d==="daily"?"#10b981":"#e2e8f0",backgroundColor:d==="daily"?"#f0fdf4":"white",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontWeight:d==="daily"?"600":"400",color:d==="daily"?"#16a34a":"#64748b"},children:[e.jsx(M,{size:18})," Daily Entry"]}),e.jsxs("button",{type:"button",onClick:()=>Q("weekly"),style:{padding:"0.75rem 1.5rem",border:"2px solid",borderColor:d==="weekly"?"#10b981":"#e2e8f0",backgroundColor:d==="weekly"?"#f0fdf4":"white",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontWeight:d==="weekly"?"600":"400",color:d==="weekly"?"#16a34a":"#64748b"},children:[e.jsx(Be,{size:18})," Weekly Summary"]})]})]}),oe.length===0&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#fef2f2",borderRadius:"6px",marginBottom:"1rem",color:"#dc2626",fontSize:"0.9rem"},children:"⚠️ Your account is not linked to a resource."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Resource *"}),e.jsxs("select",{className:"form-input",value:a.resource_id,onChange:s=>y({...a,resource_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Resource"}),oe.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),d==="daily"?e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Date *"}),e.jsx("input",{type:"date",className:"form-input",value:a.work_date,onChange:s=>y({...a,work_date:s.target.value})})]}):e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Week Ending *"}),e.jsx("input",{type:"date",className:"form-input",value:a.week_ending,onChange:s=>y({...a,week_ending:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Milestone"}),e.jsxs("select",{className:"form-input",value:a.milestone_id,onChange:s=>y({...a,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"-- No specific milestone --"}),_.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Hours *"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:d==="daily"?"12":"60",className:"form-input",placeholder:d==="daily"?"e.g., 8":"e.g., 40",value:a.hours_worked,onChange:s=>y({...a,hours_worked:s.target.value})})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-input",rows:2,placeholder:"What did you work on?",value:a.description,onChange:s=>y({...a,description:s.target.value})})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{className:"btn btn-primary",onClick:ge,children:[e.jsx(J,{size:16})," Save"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>h(!1),children:[e.jsx(F,{size:16})," Cancel"]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Resource"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{style:{textAlign:"right"},children:"Hours"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",color:"#64748b",padding:"2rem"},children:"No timesheets found."})}):S.map(s=>e.jsxs("tr",{style:{cursor:r===s.id?"default":"pointer"},onClick:()=>r!==s.id&&se({isOpen:!0,timesheet:s}),children:[e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ue,{size:16,style:{color:"#64748b"}}),r===s.id?e.jsx("select",{className:"form-input",value:c.resource_id,onChange:t=>w({...c,resource_id:t.target.value}),disabled:i!=="admin",onClick:t=>t.stopPropagation(),children:p.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))}):e.jsx("span",{style:{fontWeight:"500"},children:s.resources?.name||"Unknown"})]})}),e.jsx("td",{children:r===s.id?e.jsx("input",{type:"date",className:"form-input",value:c.work_date,onChange:t=>w({...c,work_date:t.target.value}),onClick:t=>t.stopPropagation()}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(M,{size:14,style:{color:"#64748b"}}),s.work_date||s.date?new Date(s.work_date||s.date).toLocaleDateString("en-GB"):"-"]})}),e.jsx("td",{children:r===s.id?e.jsxs("select",{className:"form-input",value:c.milestone_id,onChange:t=>w({...c,milestone_id:t.target.value}),onClick:t=>t.stopPropagation(),children:[e.jsx("option",{value:"",children:"None"}),_.map(t=>e.jsx("option",{value:t.id,children:t.milestone_ref},t.id))]}):s.milestones?.milestone_ref||"-"}),e.jsx("td",{style:{textAlign:"right",fontWeight:"600"},children:r===s.id?e.jsx("input",{type:"number",step:"0.5",className:"form-input",value:c.hours_worked,onChange:t=>w({...c,hours_worked:t.target.value}),style:{width:"80px",textAlign:"right"},onClick:t=>t.stopPropagation()}):`${parseFloat(s.hours_worked||s.hours||0).toFixed(1)}h`}),e.jsx("td",{style:{maxWidth:"200px"},children:r===s.id?e.jsx("input",{type:"text",className:"form-input",value:c.description,onChange:t=>w({...c,description:t.target.value}),onClick:t=>t.stopPropagation()}):e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.description||s.comments||"No description"})}),e.jsx("td",{children:r===s.id&&i==="admin"?e.jsx("select",{className:"form-input",value:c.status,onChange:t=>w({...c,status:t.target.value}),onClick:t=>t.stopPropagation(),children:Ve.map(t=>e.jsx("option",{value:t,children:Z[t]||t},t))}):e.jsx("span",{className:`status-badge ${ye(s.status)}`,children:Z[s.status]||s.status})}),e.jsx("td",{onClick:t=>t.stopPropagation(),children:r===s.id?e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-icon btn-success",onClick:()=>te(s.id),children:e.jsx(J,{size:16})}),e.jsx("button",{className:"btn-icon btn-secondary",onClick:()=>Y(null),children:e.jsx(F,{size:16})})]}):e.jsxs("div",{className:"action-buttons",children:[U(s)&&e.jsx("button",{className:"btn-icon",onClick:()=>re(s.id),title:"Submit for Validation",style:{color:"#3b82f6"},children:e.jsx(pe,{size:16})}),N(s)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon btn-success",onClick:()=>ae(s.id),title:"Validate",children:e.jsx(K,{size:16})}),e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>ne(s.id),title:"Reject",children:e.jsx(F,{size:16})})]}),E(s)&&e.jsx("button",{className:"btn-icon",onClick:()=>fe(s),title:"Edit",children:e.jsx(he,{size:16})}),B(s)&&e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>ie(s),title:"Delete",children:e.jsx(me,{size:16})})]})})]},s.id))})]})}),e.jsx(Re,{isOpen:j.isOpen,onClose:()=>q({isOpen:!1,timesheetId:null,timesheetData:null}),onConfirm:je,title:"Delete Timesheet",message:j.timesheetData?e.jsxs("div",{children:[e.jsx("p",{children:"Delete this timesheet entry?"}),e.jsx("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"0.75rem",marginTop:"0.75rem"},children:e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",color:"#92400e",fontSize:"0.9rem"},children:[e.jsxs("li",{children:["Resource: ",j.timesheetData.resourceName]}),e.jsxs("li",{children:["Hours: ",j.timesheetData.hours,"h"]}),e.jsxs("li",{children:["Status: ",Z[j.timesheetData.status]||j.timesheetData.status]})]})})]}):"Delete this timesheet?",confirmText:"Delete",cancelText:"Cancel",variant:"danger"}),e.jsx(Oe,{isOpen:ee.isOpen,timesheet:ee.timesheet,resources:p,milestones:_,userRole:i,canSubmitTimesheet:U,canValidateTimesheet:N,canEditTimesheet:E,canDeleteTimesheet:B,onClose:()=>se({isOpen:!1,timesheet:null}),onSave:te,onSubmit:re,onValidate:ae,onReject:ne,onDelete:ie})]})}export{Ze as default};
