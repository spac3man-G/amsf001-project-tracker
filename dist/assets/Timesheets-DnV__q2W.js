import{j as e,o as ke,u as Se,a as _e,b as De,e as Ne,c as Ce,t as I,r as Te,m as ze,L as Ie,l as Re}from"./index-Dn18I8kp.js";import{r as d}from"./vendor-react-JFEV0ROX.js";import{C as Fe}from"./ConfirmDialog-D41ykVDo.js";import{k as O,a as $,U as re,V as G,af as We,F as Ae,T as Ee,a2 as ie,e as Be,C as Me,a1 as Oe,R as Le,a0 as Ue,am as Ve}from"./vendor-icons-yzeFIsqS.js";import"./vendor-supabase-DgEUAXvv.js";const $e=["Draft","Submitted","Approved","Rejected"],te={Draft:"Draft",Submitted:"Submitted",Approved:"Validated",Rejected:"Rejected"};function Ge(c){switch(c){case"Approved":return{bg:"#dcfce7",color:"#166534"};case"Submitted":return{bg:"#dbeafe",color:"#1e40af"};case"Rejected":return{bg:"#fee2e2",color:"#991b1b"};default:return{bg:"#f1f5f9",color:"#64748b"}}}function He({isOpen:c,timesheet:t,resources:v,milestones:g,userRole:b,canSubmitTimesheet:y,canValidateTimesheet:R,canEditTimesheet:_,canDeleteTimesheet:F,onClose:T,onSave:D,onSubmit:A,onValidate:o,onReject:u,onDelete:m}){const[h,p]=d.useState(!1),[i,f]=d.useState({});if(d.useEffect(()=>{t&&(f({resource_id:t.resource_id,milestone_id:t.milestone_id||"",work_date:t.work_date||t.date||"",hours_worked:t.hours_worked||t.hours||0,description:t.description||t.comments||"",status:t.status}),p(!1))},[t]),!c||!t)return null;const x=Ge(t.status),E=v?.find(a=>a.id===t.resource_id),W=g?.find(a=>a.id===t.milestone_id),L=parseFloat(t.hours_worked||t.hours||0),H=E?.sell_price||t.resources?.sell_price||0,U=ke(L,H);async function V(){await D(t.id,i),p(!1)}function w(){p(!1),T()}return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:w,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 1.5rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"8px",backgroundColor:"#dbeafe",color:"#2563eb"},children:e.jsx(O,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Timesheet Entry"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:t.resources?.name||E?.name||"Unknown Resource"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:x.bg,color:x.color},children:te[t.status]||t.status}),e.jsx("button",{onClick:w,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b"},children:e.jsx($,{size:24})})]})]}),e.jsx("div",{style:{padding:"1.5rem"},children:h?e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Resource"}),e.jsx("select",{className:"form-input",value:i.resource_id,onChange:a=>f({...i,resource_id:a.target.value}),disabled:b!=="admin",children:v?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Date"}),e.jsx("input",{type:"date",className:"form-input",value:i.work_date,onChange:a=>f({...i,work_date:a.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Milestone"}),e.jsxs("select",{className:"form-input",value:i.milestone_id,onChange:a=>f({...i,milestone_id:a.target.value}),children:[e.jsx("option",{value:"",children:"-- No milestone --"}),g?.map(a=>e.jsxs("option",{value:a.id,children:[a.milestone_ref," - ",a.name]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:"24",className:"form-input",value:i.hours_worked,onChange:a=>f({...i,hours_worked:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:i.description,onChange:a=>f({...i,description:a.target.value}),placeholder:"What did you work on?"})]}),b==="admin"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsx("select",{className:"form-input",value:i.status,onChange:a=>f({...i,status:a.target.value}),children:$e.map(a=>e.jsx("option",{value:a,children:te[a]||a},a))})]})]}):e.jsxs("div",{style:{display:"grid",gap:"1.25rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(re,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Resource"}),e.jsx("div",{style:{fontWeight:"500"},children:t.resources?.name||E?.name||"Unknown"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(G,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Date"}),e.jsx("div",{style:{fontWeight:"500"},children:t.work_date||t.date?new Date(t.work_date||t.date).toLocaleDateString("en-GB"):"-"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(O,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Hours"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#0f172a"},children:[L.toFixed(1),"h"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(We,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Value"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#10b981"},children:["£",U.toFixed(2)]})]})]})]}),(t.milestone_id||W)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Ae,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Milestone"}),e.jsxs("div",{style:{fontWeight:"500"},children:[t.milestones?.milestone_ref||W?.milestone_ref||""," - ",t.milestones?.name||W?.name||"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.375rem"},children:"Description"}),e.jsx("div",{style:{fontSize:"0.9375rem"},children:t.description||t.comments||"No description provided"})]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.8125rem",color:"#64748b",paddingTop:"0.75rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(O,{size:14}),"Created: ",t.created_at?new Date(t.created_at).toLocaleString("en-GB"):"Unknown"]}),t.updated_at&&t.updated_at!==t.created_at&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(O,{size:14}),"Updated: ",new Date(t.updated_at).toLocaleString("en-GB")]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsx("div",{children:F(t)&&!h&&e.jsxs("button",{onClick:()=>{m(t),w()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Ee,{size:16})," Delete"]})}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:V,className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(ie,{size:16})," Save Changes"]})]}):e.jsxs(e.Fragment,{children:[y(t)&&e.jsxs("button",{onClick:()=>{A(t.id),w()},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Be,{size:16})," Submit for Validation"]}),R(t)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{u(t.id),w()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx($,{size:16})," Reject"]}),e.jsxs("button",{onClick:()=>{o(t.id),w()},className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Me,{size:16})," Validate"]})]}),_(t)&&e.jsxs("button",{onClick:()=>p(!0),className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Oe,{size:16})," Edit"]})]})})]})]})})}function Pe({dateRange:c,selectedPeriod:t,onPeriodSelect:v,onDateRangeChange:g,onClear:b,getDateRangeLabel:y}){function R(){const o=[],u=new Date;for(let m=0;m<12;m++){const h=new Date(u.getFullYear(),u.getMonth()-m,1),p=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`,i=h.toLocaleDateString("en-GB",{month:"long",year:"numeric"});o.push({value:p,label:i})}return o}function _(o){const u=new Date,m=u.getDay();let h,p;switch(o){case"this-week":{const i=new Date(u),f=m===0?6:m-1;i.setDate(u.getDate()-f),h=i;const x=new Date(i);x.setDate(i.getDate()+6),p=x;break}case"last-week":{const i=new Date(u),f=m===0?6:m-1;i.setDate(u.getDate()-f-7),h=i;const x=new Date(i);x.setDate(i.getDate()+6),p=x;break}default:return}v(o,{start:h.toISOString().split("T")[0],end:p.toISOString().split("T")[0]})}function F(o){if(o){const[u,m]=o.split("-").map(Number),h=new Date(u,m-1,1),p=new Date(u,m,0);v(o,{start:h.toISOString().split("T")[0],end:p.toISOString().split("T")[0]})}else b()}const T=t==="this-week",D=t==="last-week",A=t&&t.includes("-")&&t.length===7;return e.jsx("div",{className:"ts-date-filter",children:e.jsxs("div",{className:"ts-date-filter-row",children:[e.jsxs("div",{className:"ts-date-filter-label",children:[e.jsx(G,{size:18}),e.jsx("span",{children:"Period:"})]}),e.jsxs("div",{className:"ts-quick-buttons",children:[e.jsx("button",{type:"button",onClick:()=>_("this-week"),className:`ts-quick-btn ${T?"active":""}`,children:"This Week"}),e.jsx("button",{type:"button",onClick:()=>_("last-week"),className:`ts-quick-btn ${D?"active":""}`,children:"Last Week"})]}),e.jsxs("select",{value:A?t:"",onChange:o=>F(o.target.value),className:"ts-month-select",children:[e.jsx("option",{value:"",children:"Select Month..."}),R().map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsx("span",{className:"ts-date-separator",children:"or"}),e.jsxs("div",{className:"ts-date-inputs",children:[e.jsx("input",{type:"date",value:c.start||"",onChange:o=>g("start",o.target.value),className:"ts-date-input"}),e.jsx("span",{className:"ts-date-to",children:"to"}),e.jsx("input",{type:"date",value:c.end||"",onChange:o=>g("end",o.target.value),className:"ts-date-input"})]}),(c.start||c.end)&&e.jsxs("button",{type:"button",onClick:b,className:"ts-clear-btn",children:[e.jsx($,{size:14})," Clear"]}),e.jsxs("div",{className:"ts-showing-label",children:["Showing: ",y()]})]})})}const ae={Draft:"Draft",Submitted:"Submitted",Approved:"Validated",Rejected:"Rejected"};function ne(){const c=new Date,t=7-c.getDay(),v=new Date(c);return v.setDate(c.getDate()+(c.getDay()===0?0:t)),v.toISOString().split("T")[0]}function es(){const{user:c,role:t,linkedResource:v}=Se(),{projectId:g}=_e(),{showSuccess:b,showError:y,showWarning:R}=De(),{showTestUsers:_,testUserIds:F}=Ne(),T=c?.id||null,D=v?.id||null,{canAddTimesheet:A,canEditTimesheet:o,canDeleteTimesheet:u,canSubmitTimesheet:m,canValidateTimesheet:h,getAvailableResources:p}=Ce(),[i,f]=d.useState([]),[x,E]=d.useState([]),[W,L]=d.useState([]),[H,U]=d.useState(!0),[V,w]=d.useState(!1),[a,P]=d.useState(!1),[Ye,le]=d.useState(null),[oe,qe]=d.useState({}),[Y,de]=d.useState("all"),[k,J]=d.useState("daily"),[N,q]=d.useState({isOpen:!1,timesheetId:null,timesheetData:null}),[K,Z]=d.useState({isOpen:!1,timesheet:null}),[j,Q]=d.useState({start:null,end:null}),[z,X]=d.useState(""),[l,C]=d.useState({resource_id:"",milestone_id:"",work_date:new Date().toISOString().split("T")[0],week_ending:ne(),hours_worked:"",description:"",status:"Draft",entry_type:"daily"}),S=d.useCallback(async()=>{if(g){U(!0);try{const s=await I.getAllFiltered(g,_);f(s);const r=await Te.getAllWithTestFilter(g,_?[]:F);E(r);const n=await ze.getAll(g,{orderBy:{column:"milestone_ref",ascending:!0}});L(n)}catch{y("Failed to load timesheets")}finally{U(!1),w(!1)}}},[g,_,F,y]);d.useEffect(()=>{S()},[S]),d.useEffect(()=>{D&&C(s=>({...s,resource_id:D}))},[D]);function ce(s,r){X(s),Q(r)}function ue(s,r){X("custom"),Q(n=>({...n,[s]:r||null}))}function me(){Q({start:null,end:null}),X("")}function he(){if(!j.start&&!j.end)return"All Time";if(z==="this-week")return"This Week";if(z==="last-week")return"Last Week";if(z&&z.length===7&&z.includes("-")){const[n,M]=z.split("-").map(Number);return new Date(n,M-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}const s=j.start?new Date(j.start).toLocaleDateString("en-GB"):"Start",r=j.end?new Date(j.end).toLocaleDateString("en-GB"):"End";return`${s} - ${r}`}async function pe(){w(!0),await S()}async function xe(){if(!l.resource_id||!l.hours_worked){R("Please fill in all required fields");return}try{const s=x.find(n=>n.id===l.resource_id),r=k==="daily"?l.work_date:l.week_ending;await I.create({project_id:g,resource_id:l.resource_id,milestone_id:l.milestone_id||null,user_id:s?.user_id||T,created_by:T,date:r,work_date:r,week_ending:k==="weekly"?l.week_ending:null,hours_worked:parseFloat(l.hours_worked),hours:parseFloat(l.hours_worked),description:l.description,comments:l.description,status:l.status,entry_type:k}),await S(),P(!1),C({resource_id:D||"",milestone_id:"",work_date:new Date().toISOString().split("T")[0],week_ending:ne(),hours_worked:"",description:"",status:"Draft",entry_type:k}),b("Timesheet added successfully!")}catch(s){y("Failed to add timesheet: "+s.message)}}async function fe(s,r=null){const n=r||oe;try{await I.update(s,{resource_id:n.resource_id,milestone_id:n.milestone_id||null,date:n.work_date,work_date:n.work_date,week_ending:n.week_ending||null,hours:parseFloat(n.hours_worked),hours_worked:parseFloat(n.hours_worked),comments:n.description,description:n.description,status:n.status}),await S(),le(null),b("Timesheet updated!")}catch(M){y("Failed to update: "+M.message)}}function je(s){const r=x.find(M=>M.id===s.resource_id),n=parseFloat(s.hours_worked)||0;q({isOpen:!0,timesheetId:s.id,timesheetData:{resourceName:s.resources?.name||r?.name||"Unknown",date:s.work_date||s.date,hours:n,costImpact:Re(n,r?.cost_price),status:s.status}})}async function ge(){if(N.timesheetId)try{await I.delete(N.timesheetId,T),await S(),q({isOpen:!1,timesheetId:null,timesheetData:null}),b("Timesheet deleted")}catch(s){y("Failed to delete: "+s.message)}}async function ye(s){try{await I.submit(s),await S(),b("Timesheet submitted for validation!")}catch(r){y("Failed to submit: "+r.message)}}async function be(s){try{await I.validate(s),await S(),b("Timesheet validated!")}catch(r){y("Failed to validate: "+r.message)}}async function ve(s){const r=prompt("Rejection reason (optional):");try{await I.reject(s,r),await S(),R("Timesheet rejected")}catch(n){y("Failed to reject: "+n.message)}}function we(s){switch(s){case"Approved":return"status-validated";case"Submitted":return"status-submitted";case"Rejected":return"status-rejected";default:return"status-draft"}}const B=i.filter(s=>{if(Y!=="all"&&s.resource_id!==Y)return!1;if(j.start||j.end){const r=new Date(s.work_date||s.date);if(j.start&&r<new Date(j.start))return!1;if(j.end){const n=new Date(j.end);if(n.setHours(23,59,59,999),r>n)return!1}}return!0}),ee=x.map(s=>({name:s.name,hours:B.filter(r=>r.resource_id===s.id).reduce((r,n)=>r+parseFloat(n.hours_worked||n.hours||0),0)})).filter(s=>s.hours>0),se=p(x);return H?e.jsx(Ie,{message:"Loading timesheets...",size:"large",fullPage:!0}):e.jsxs("div",{className:"timesheets-page",children:[e.jsx("header",{className:"ts-header",children:e.jsxs("div",{className:"ts-header-content",children:[e.jsxs("div",{className:"ts-header-left",children:[e.jsx("div",{className:"ts-header-icon",children:e.jsx(O,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Timesheets"}),e.jsx("p",{children:"Track time spent on project activities"})]})]}),e.jsxs("div",{className:"ts-header-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:pe,disabled:V,children:[e.jsx(Le,{size:18,className:V?"spinning":""})," Refresh"]}),!a&&A&&e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:()=>P(!0),children:[e.jsx(Ue,{size:18})," Add Timesheet"]})]})]})}),e.jsxs("div",{className:"ts-content",children:[e.jsx(Pe,{dateRange:j,selectedPeriod:z,onPeriodSelect:ce,onDateRangeChange:ue,onClear:me,getDateRangeLabel:he}),ee.length>0&&e.jsxs("div",{className:"ts-hours-summary",children:[e.jsx("h4",{className:"ts-hours-title",children:"Hours by Resource"}),e.jsx("div",{className:"ts-hours-grid",children:ee.map(s=>e.jsxs("div",{className:"ts-hours-card",children:[e.jsx("div",{className:"ts-hours-name",children:s.name}),e.jsxs("div",{className:"ts-hours-value",children:[s.hours.toFixed(1),"h"]})]},s.name))})]}),e.jsxs("div",{className:"ts-filters",children:[e.jsx("span",{className:"ts-filter-label",children:"Filter:"}),e.jsxs("select",{value:Y,onChange:s=>de(s.target.value),className:"ts-filter-select",children:[e.jsx("option",{value:"all",children:"All Resources"}),x.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a&&e.jsxs("div",{className:"ts-add-form",children:[e.jsx("h3",{className:"ts-add-form-title",children:"Add Timesheet Entry"}),e.jsxs("div",{className:"ts-entry-mode",children:[e.jsx("label",{className:"ts-mode-label",children:"Entry Type"}),e.jsxs("div",{className:"ts-mode-buttons",children:[e.jsxs("button",{type:"button",onClick:()=>J("daily"),className:`ts-mode-btn ${k==="daily"?"active":""}`,children:[e.jsx(G,{size:18})," Daily Entry"]}),e.jsxs("button",{type:"button",onClick:()=>J("weekly"),className:`ts-mode-btn ${k==="weekly"?"active":""}`,children:[e.jsx(Ve,{size:18})," Weekly Summary"]})]})]}),se.length===0&&e.jsx("div",{className:"ts-warning",children:"⚠️ Your account is not linked to a resource."}),e.jsxs("div",{className:"ts-form-grid",children:[e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Resource *"}),e.jsxs("select",{value:l.resource_id,onChange:s=>C({...l,resource_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Resource"}),se.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),k==="daily"?e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Date *"}),e.jsx("input",{type:"date",value:l.work_date,onChange:s=>C({...l,work_date:s.target.value})})]}):e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Week Ending *"}),e.jsx("input",{type:"date",value:l.week_ending,onChange:s=>C({...l,week_ending:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>C({...l,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"-- No specific milestone --"}),W.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Hours *"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:k==="daily"?"12":"60",placeholder:k==="daily"?"e.g., 8":"e.g., 40",value:l.hours_worked,onChange:s=>C({...l,hours_worked:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group ts-full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{rows:2,placeholder:"What did you work on?",value:l.description,onChange:s=>C({...l,description:s.target.value})})]})]}),e.jsxs("div",{className:"ts-form-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:xe,children:[e.jsx(ie,{size:16})," Save"]}),e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:()=>P(!1),children:[e.jsx($,{size:16})," Cancel"]})]})]}),e.jsxs("div",{className:"ts-table-card",children:[e.jsxs("div",{className:"ts-table-header",children:[e.jsx("h2",{className:"ts-table-title",children:"Timesheet Entries"}),e.jsxs("span",{className:"ts-table-count",children:[B.length," entr",B.length!==1?"ies":"y"]})]}),e.jsxs("table",{className:"ts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Resource"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:B.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"ts-empty-cell",children:"No timesheets found for the selected period."})}):B.map(s=>e.jsxs("tr",{onClick:()=>Z({isOpen:!0,timesheet:s}),children:[e.jsx("td",{children:e.jsxs("div",{className:"ts-resource-cell",children:[e.jsx(re,{size:16}),e.jsx("span",{className:"ts-resource-name",children:s.resources?.name||"Unknown"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"ts-date-cell",children:[e.jsx(G,{size:14}),s.work_date||s.date?new Date(s.work_date||s.date).toLocaleDateString("en-GB"):"—"]})}),e.jsx("td",{children:s.milestones?.milestone_ref||"—"}),e.jsxs("td",{className:"ts-hours",children:[parseFloat(s.hours_worked||s.hours||0).toFixed(1),"h"]}),e.jsx("td",{className:"ts-description",children:s.description||s.comments||"No description"}),e.jsx("td",{children:e.jsx("span",{className:`ts-status-badge ${we(s.status)}`,children:ae[s.status]||s.status})})]},s.id))})]})]})]}),e.jsx(Fe,{isOpen:N.isOpen,onClose:()=>q({isOpen:!1,timesheetId:null,timesheetData:null}),onConfirm:ge,title:"Delete Timesheet",message:N.timesheetData?e.jsxs("div",{children:[e.jsx("p",{children:"Delete this timesheet entry?"}),e.jsx("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"0.75rem",marginTop:"0.75rem"},children:e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",color:"#92400e",fontSize:"0.9rem"},children:[e.jsxs("li",{children:["Resource: ",N.timesheetData.resourceName]}),e.jsxs("li",{children:["Hours: ",N.timesheetData.hours,"h"]}),e.jsxs("li",{children:["Status: ",ae[N.timesheetData.status]||N.timesheetData.status]})]})})]}):"Delete this timesheet?",confirmText:"Delete",cancelText:"Cancel",variant:"danger"}),e.jsx(He,{isOpen:K.isOpen,timesheet:K.timesheet,resources:x,milestones:W,userRole:t,canSubmitTimesheet:m,canValidateTimesheet:h,canEditTimesheet:o,canDeleteTimesheet:u,onClose:()=>Z({isOpen:!1,timesheet:null}),onSave:fe,onSubmit:ye,onValidate:be,onReject:ve,onDelete:je})]})}export{es as default};
