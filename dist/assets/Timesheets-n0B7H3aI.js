import{j as e,v as Ne,u as Ce,a as Te,c as Ie,f as ze,d as Re,t as R,r as Fe,m as Ee,L as We,n as Le}from"./index-BAKS0PkB.js";import{r as d}from"./vendor-react-BUTV5ZEl.js";import{C as Ae}from"./ConfirmDialog-CdeaWCWH.js";import{P as Oe}from"./PromptDialog-fJOeHijp.js";import{g as Be,a as Me,b as ee,E as v,T as re,c as le,d as oe,e as Ue}from"./timesheetCalculations-BXhAt_b1.js";import{p as M,c as H,U as de,h as $,ap as Ye,F as Pe,T as He,ag as ce,i as $e,b as Ge,af as Ve,R as qe,ae as Ke,z as Qe}from"./vendor-icons-D4HYsxEu.js";import"./vendor-supabase-6faYzd5A.js";function Xe({isOpen:_,timesheet:t,resources:C,milestones:j,userRole:y,canSubmitTimesheet:f,canValidateTimesheet:F,canEditTimesheet:S,canDeleteTimesheet:E,onClose:T,onSave:D,onSubmit:L,onValidate:o,onReject:u,onDelete:m}){const[h,p]=d.useState(!1),[i,x]=d.useState({});if(d.useEffect(()=>{t&&(x({resource_id:t.resource_id,milestone_id:t.milestone_id||"",work_date:t.work_date||t.date||"",hours_worked:t.hours_worked||t.hours||0,description:t.description||t.comments||"",status:t.status}),p(!1))},[t]),!_||!t)return null;const c=Be(t.status),A=C?.find(a=>a.id===t.resource_id),W=j?.find(a=>a.id===t.milestone_id),U=parseFloat(t.hours_worked||t.hours||0),G=A?.sell_price||t.resources?.sell_price||0,Y=Ne(U,G);async function P(){await D(t.id,i),p(!1)}function b(){p(!1),T()}return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},onClick:b,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1.25rem 1.5rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"8px",backgroundColor:"#dbeafe",color:"#2563eb"},children:e.jsx(M,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Timesheet Entry"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:t.resources?.name||A?.name||"Unknown Resource"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:c.bg,color:c.color},children:c.label}),e.jsx("button",{onClick:b,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b"},children:e.jsx(H,{size:24})})]})]}),e.jsx("div",{style:{padding:"1.5rem"},children:h?e.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Resource"}),e.jsx("select",{className:"form-input",value:i.resource_id,onChange:a=>x({...i,resource_id:a.target.value}),disabled:y!=="admin",children:C?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Date"}),e.jsx("input",{type:"date",className:"form-input",value:i.work_date,onChange:a=>x({...i,work_date:a.target.value})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Milestone"}),e.jsxs("select",{className:"form-input",value:i.milestone_id,onChange:a=>x({...i,milestone_id:a.target.value}),children:[e.jsx("option",{value:"",children:"-- No milestone --"}),j?.map(a=>e.jsxs("option",{value:a.id,children:[a.milestone_ref," - ",a.name]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:"24",className:"form-input",value:i.hours_worked,onChange:a=>x({...i,hours_worked:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Description"}),e.jsx("textarea",{className:"form-input",rows:3,value:i.description,onChange:a=>x({...i,description:a.target.value}),placeholder:"What did you work on?"})]}),y==="admin"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.375rem",fontWeight:"500",fontSize:"0.875rem"},children:"Status"}),e.jsx("select",{className:"form-input",value:i.status,onChange:a=>x({...i,status:a.target.value}),children:Me().map(a=>e.jsx("option",{value:a,children:ee(a)},a))})]})]}):e.jsxs("div",{style:{display:"grid",gap:"1.25rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(de,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Resource"}),e.jsx("div",{style:{fontWeight:"500"},children:t.resources?.name||A?.name||"Unknown"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx($,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Date"}),e.jsx("div",{style:{fontWeight:"500"},children:t.work_date||t.date?new Date(t.work_date||t.date).toLocaleDateString("en-GB"):"-"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(M,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Hours"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#0f172a"},children:[U.toFixed(1),"h"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Ye,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Value"}),e.jsxs("div",{style:{fontWeight:"600",fontSize:"1.125rem",color:"#10b981"},children:["£",Y.toFixed(2)]})]})]})]}),(t.milestone_id||W)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Pe,{size:18,style:{color:"#64748b"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase"},children:"Milestone"}),e.jsxs("div",{style:{fontWeight:"500"},children:[t.milestones?.milestone_ref||W?.milestone_ref||""," - ",t.milestones?.name||W?.name||"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",textTransform:"uppercase",marginBottom:"0.375rem"},children:"Description"}),e.jsx("div",{style:{fontSize:"0.9375rem"},children:t.description||t.comments||"No description provided"})]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.8125rem",color:"#64748b",paddingTop:"0.75rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(M,{size:14}),"Created: ",t.created_at?new Date(t.created_at).toLocaleString("en-GB"):"Unknown"]}),t.updated_at&&t.updated_at!==t.created_at&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(M,{size:14}),"Updated: ",new Date(t.updated_at).toLocaleString("en-GB")]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:[e.jsx("div",{children:E(t)&&!h&&e.jsxs("button",{onClick:()=>{m(t),b()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(He,{size:16})," Delete"]})}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:P,className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(ce,{size:16})," Save Changes"]})]}):e.jsxs(e.Fragment,{children:[f(t)&&e.jsxs("button",{onClick:()=>{L(t.id),b()},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx($e,{size:16})," Submit for Validation"]}),F(t)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{u(t.id),b()},className:"btn btn-danger",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(H,{size:16})," Reject"]}),e.jsxs("button",{onClick:()=>{o(t.id),b()},className:"btn btn-success",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Ge,{size:16})," Validate"]})]}),S(t)&&e.jsxs("button",{onClick:()=>p(!0),className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.375rem"},children:[e.jsx(Ve,{size:16})," Edit"]})]})})]})]})})}function Je({dateRange:_,selectedPeriod:t,onPeriodSelect:C,onDateRangeChange:j,onClear:y,getDateRangeLabel:f}){function F(){const o=[],u=new Date;for(let m=0;m<12;m++){const h=new Date(u.getFullYear(),u.getMonth()-m,1),p=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`,i=h.toLocaleDateString("en-GB",{month:"long",year:"numeric"});o.push({value:p,label:i})}return o}function S(o){const u=new Date,m=u.getDay();let h,p;switch(o){case"this-week":{const i=new Date(u),x=m===0?6:m-1;i.setDate(u.getDate()-x),h=i;const c=new Date(i);c.setDate(i.getDate()+6),p=c;break}case"last-week":{const i=new Date(u),x=m===0?6:m-1;i.setDate(u.getDate()-x-7),h=i;const c=new Date(i);c.setDate(i.getDate()+6),p=c;break}default:return}C(o,{start:h.toISOString().split("T")[0],end:p.toISOString().split("T")[0]})}function E(o){if(o){const[u,m]=o.split("-").map(Number),h=new Date(u,m-1,1),p=new Date(u,m,0);C(o,{start:h.toISOString().split("T")[0],end:p.toISOString().split("T")[0]})}else y()}const T=t==="this-week",D=t==="last-week",L=t&&t.includes("-")&&t.length===7;return e.jsx("div",{className:"ts-date-filter",children:e.jsxs("div",{className:"ts-date-filter-row",children:[e.jsxs("div",{className:"ts-date-filter-label",children:[e.jsx($,{size:18}),e.jsx("span",{children:"Period:"})]}),e.jsxs("div",{className:"ts-quick-buttons",children:[e.jsx("button",{type:"button",onClick:()=>S("this-week"),className:`ts-quick-btn ${T?"active":""}`,children:"This Week"}),e.jsx("button",{type:"button",onClick:()=>S("last-week"),className:`ts-quick-btn ${D?"active":""}`,children:"Last Week"})]}),e.jsxs("select",{value:L?t:"",onChange:o=>E(o.target.value),className:"ts-month-select",children:[e.jsx("option",{value:"",children:"Select Month..."}),F().map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),e.jsx("span",{className:"ts-date-separator",children:"or"}),e.jsxs("div",{className:"ts-date-inputs",children:[e.jsx("input",{type:"date",value:_.start||"",onChange:o=>j("start",o.target.value),className:"ts-date-input"}),e.jsx("span",{className:"ts-date-to",children:"to"}),e.jsx("input",{type:"date",value:_.end||"",onChange:o=>j("end",o.target.value),className:"ts-date-input"})]}),(_.start||_.end)&&e.jsxs("button",{type:"button",onClick:y,className:"ts-clear-btn",children:[e.jsx(H,{size:14})," Clear"]}),e.jsxs("div",{className:"ts-showing-label",children:["Showing: ",f()]})]})})}function os(){const{user:_,role:t,linkedResource:C}=Ce(),{projectId:j}=Te(),{showSuccess:y,showError:f,showWarning:F}=Ie(),{showTestUsers:S,testUserIds:E}=ze(),T=_?.id||null,D=C?.id||null,{canAddTimesheet:L,canEditTimesheet:o,canDeleteTimesheet:u,canSubmitTimesheet:m,canValidateTimesheet:h,getAvailableResources:p}=Re(),[i,x]=d.useState([]),[c,A]=d.useState([]),[W,U]=d.useState([]),[G,Y]=d.useState(!0),[P,b]=d.useState(!1),[a,V]=d.useState(!1),[Ze,ue]=d.useState(null),[me,es]=d.useState({}),[q,he]=d.useState("all"),[w,se]=d.useState(v.DAILY),[I,K]=d.useState({isOpen:!1,timesheetId:null,timesheetData:null}),[Q,X]=d.useState({isOpen:!1,timesheetId:null}),[te,ae]=d.useState({isOpen:!1,timesheet:null}),[g,J]=d.useState({start:null,end:null}),[z,Z]=d.useState(""),[l,N]=d.useState({resource_id:"",milestone_id:"",work_date:oe(),week_ending:le(),hours_worked:"",description:"",status:re.DRAFT,entry_type:v.DAILY}),k=d.useCallback(async()=>{if(j){Y(!0);try{const s=await R.getAllFiltered(j,S);x(s);const n=await Fe.getAllWithTestFilter(j,S?[]:E);A(n);const r=await Ee.getAll(j,{orderBy:{column:"milestone_ref",ascending:!0}});U(r)}catch{f("Failed to load timesheets")}finally{Y(!1),b(!1)}}},[j,S,E,f]);d.useEffect(()=>{k()},[k]),d.useEffect(()=>{D&&N(s=>({...s,resource_id:D}))},[D]);function pe(s,n){Z(s),J(n)}function xe(s,n){Z("custom"),J(r=>({...r,[s]:n||null}))}function ge(){J({start:null,end:null}),Z("")}function je(){if(!g.start&&!g.end)return"All Time";if(z==="this-week")return"This Week";if(z==="last-week")return"Last Week";if(z&&z.length===7&&z.includes("-")){const[r,B]=z.split("-").map(Number);return new Date(r,B-1,1).toLocaleDateString("en-GB",{month:"long",year:"numeric"})}const s=g.start?new Date(g.start).toLocaleDateString("en-GB"):"Start",n=g.end?new Date(g.end).toLocaleDateString("en-GB"):"End";return`${s} - ${n}`}async function fe(){b(!0),await k()}async function ye(){if(!l.resource_id||!l.hours_worked){F("Please fill in all required fields");return}try{const s=c.find(r=>r.id===l.resource_id),n=w===v.DAILY?l.work_date:l.week_ending;await R.create({project_id:j,resource_id:l.resource_id,milestone_id:l.milestone_id||null,user_id:s?.user_id||T,created_by:T,date:n,work_date:n,week_ending:w===v.WEEKLY?l.week_ending:null,hours_worked:parseFloat(l.hours_worked),hours:parseFloat(l.hours_worked),description:l.description,comments:l.description,status:l.status,entry_type:w}),await k(),V(!1),N({resource_id:D||"",milestone_id:"",work_date:oe(),week_ending:le(),hours_worked:"",description:"",status:re.DRAFT,entry_type:w}),y("Timesheet added successfully!")}catch(s){f("Failed to add timesheet: "+s.message)}}async function ve(s,n=null){const r=n||me;try{await R.update(s,{resource_id:r.resource_id,milestone_id:r.milestone_id||null,date:r.work_date,work_date:r.work_date,week_ending:r.week_ending||null,hours:parseFloat(r.hours_worked),hours_worked:parseFloat(r.hours_worked),comments:r.description,description:r.description,status:r.status}),await k(),ue(null),y("Timesheet updated!")}catch(B){f("Failed to update: "+B.message)}}function be(s){const n=c.find(B=>B.id===s.resource_id),r=parseFloat(s.hours_worked)||0;K({isOpen:!0,timesheetId:s.id,timesheetData:{resourceName:s.resources?.name||n?.name||"Unknown",date:s.work_date||s.date,hours:r,costImpact:Le(r,n?.cost_price),status:s.status}})}async function we(){if(I.timesheetId)try{await R.delete(I.timesheetId,T),await k(),K({isOpen:!1,timesheetId:null,timesheetData:null}),y("Timesheet deleted")}catch(s){f("Failed to delete: "+s.message)}}async function ke(s){try{await R.submit(s),await k(),y("Timesheet submitted for validation!")}catch(n){f("Failed to submit: "+n.message)}}async function _e(s){try{await R.validate(s),await k(),y("Timesheet validated!")}catch(n){f("Failed to validate: "+n.message)}}function Se(s){X({isOpen:!0,timesheetId:s})}async function De(s){if(Q.timesheetId)try{await R.reject(Q.timesheetId,s),X({isOpen:!1,timesheetId:null}),await k(),F("Timesheet rejected")}catch(n){f("Failed to reject: "+n.message)}}const O=i.filter(s=>{if(q!=="all"&&s.resource_id!==q)return!1;if(g.start||g.end){const n=new Date(s.work_date||s.date);if(g.start&&n<new Date(g.start))return!1;if(g.end){const r=new Date(g.end);if(r.setHours(23,59,59,999),n>r)return!1}}return!0}),ne=c.map(s=>({name:s.name,hours:O.filter(n=>n.resource_id===s.id).reduce((n,r)=>n+parseFloat(r.hours_worked||r.hours||0),0)})).filter(s=>s.hours>0),ie=p(c);return G?e.jsx(We,{message:"Loading timesheets...",size:"large",fullPage:!0}):e.jsxs("div",{className:"timesheets-page",children:[e.jsx("header",{className:"ts-header",children:e.jsxs("div",{className:"ts-header-content",children:[e.jsxs("div",{className:"ts-header-left",children:[e.jsx("div",{className:"ts-header-icon",children:e.jsx(M,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Timesheets"}),e.jsx("p",{children:"Track time spent on project activities"})]})]}),e.jsxs("div",{className:"ts-header-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:fe,disabled:P,children:[e.jsx(qe,{size:18,className:P?"spinning":""})," Refresh"]}),!a&&L&&e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:()=>V(!0),children:[e.jsx(Ke,{size:18})," Add Timesheet"]})]})]})}),e.jsxs("div",{className:"ts-content",children:[e.jsx(Je,{dateRange:g,selectedPeriod:z,onPeriodSelect:pe,onDateRangeChange:xe,onClear:ge,getDateRangeLabel:je}),ne.length>0&&e.jsxs("div",{className:"ts-hours-summary",children:[e.jsx("h4",{className:"ts-hours-title",children:"Hours by Resource"}),e.jsx("div",{className:"ts-hours-grid",children:ne.map(s=>e.jsxs("div",{className:"ts-hours-card",children:[e.jsx("div",{className:"ts-hours-name",children:s.name}),e.jsxs("div",{className:"ts-hours-value",children:[s.hours.toFixed(1),"h"]})]},s.name))})]}),e.jsxs("div",{className:"ts-filters",children:[e.jsx("span",{className:"ts-filter-label",children:"Filter:"}),e.jsxs("select",{value:q,onChange:s=>he(s.target.value),className:"ts-filter-select",children:[e.jsx("option",{value:"all",children:"All Resources"}),c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),a&&e.jsxs("div",{className:"ts-add-form",children:[e.jsx("h3",{className:"ts-add-form-title",children:"Add Timesheet Entry"}),e.jsxs("div",{className:"ts-entry-mode",children:[e.jsx("label",{className:"ts-mode-label",children:"Entry Type"}),e.jsxs("div",{className:"ts-mode-buttons",children:[e.jsxs("button",{type:"button",onClick:()=>se(v.DAILY),className:`ts-mode-btn ${w===v.DAILY?"active":""}`,children:[e.jsx($,{size:18})," Daily Entry"]}),e.jsxs("button",{type:"button",onClick:()=>se(v.WEEKLY),className:`ts-mode-btn ${w===v.WEEKLY?"active":""}`,children:[e.jsx(Qe,{size:18})," Weekly Summary"]})]})]}),ie.length===0&&e.jsx("div",{className:"ts-warning",children:"⚠️ Your account is not linked to a resource."}),e.jsxs("div",{className:"ts-form-grid",children:[e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Resource *"}),e.jsxs("select",{value:l.resource_id,onChange:s=>N({...l,resource_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Resource"}),ie.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),w===v.DAILY?e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Date *"}),e.jsx("input",{type:"date",value:l.work_date,onChange:s=>N({...l,work_date:s.target.value})})]}):e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Week Ending *"}),e.jsx("input",{type:"date",value:l.week_ending,onChange:s=>N({...l,week_ending:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Milestone"}),e.jsxs("select",{value:l.milestone_id,onChange:s=>N({...l,milestone_id:s.target.value}),children:[e.jsx("option",{value:"",children:"-- No specific milestone --"}),W.map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref," - ",s.name]},s.id))]})]}),e.jsxs("div",{className:"ts-form-group",children:[e.jsx("label",{children:"Hours *"}),e.jsx("input",{type:"number",step:"0.5",min:"0.5",max:w===v.DAILY?"12":"60",placeholder:w===v.DAILY?"e.g., 8":"e.g., 40",value:l.hours_worked,onChange:s=>N({...l,hours_worked:s.target.value})})]}),e.jsxs("div",{className:"ts-form-group ts-full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{rows:2,placeholder:"What did you work on?",value:l.description,onChange:s=>N({...l,description:s.target.value})})]})]}),e.jsxs("div",{className:"ts-form-actions",children:[e.jsxs("button",{className:"ts-btn ts-btn-primary",onClick:ye,children:[e.jsx(ce,{size:16})," Save"]}),e.jsxs("button",{className:"ts-btn ts-btn-secondary",onClick:()=>V(!1),children:[e.jsx(H,{size:16})," Cancel"]})]})]}),e.jsxs("div",{className:"ts-table-card",children:[e.jsxs("div",{className:"ts-table-header",children:[e.jsx("h2",{className:"ts-table-title",children:"Timesheet Entries"}),e.jsxs("span",{className:"ts-table-count",children:[O.length," entr",O.length!==1?"ies":"y"]})]}),e.jsxs("table",{className:"ts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Resource"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:O.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"ts-empty-cell",children:"No timesheets found for the selected period."})}):O.map(s=>e.jsxs("tr",{onClick:()=>ae({isOpen:!0,timesheet:s}),children:[e.jsx("td",{children:e.jsxs("div",{className:"ts-resource-cell",children:[e.jsx(de,{size:16}),e.jsx("span",{className:"ts-resource-name",children:s.resources?.name||"Unknown"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"ts-date-cell",children:[e.jsx($,{size:14}),s.work_date||s.date?new Date(s.work_date||s.date).toLocaleDateString("en-GB"):"—"]})}),e.jsx("td",{children:s.milestones?.milestone_ref||"—"}),e.jsxs("td",{className:"ts-hours",children:[parseFloat(s.hours_worked||s.hours||0).toFixed(1),"h"]}),e.jsx("td",{className:"ts-description",children:s.description||s.comments||"No description"}),e.jsx("td",{children:e.jsx("span",{className:`ts-status-badge ${Ue(s.status)}`,children:ee(s.status)})})]},s.id))})]})]})]}),e.jsx(Ae,{isOpen:I.isOpen,onClose:()=>K({isOpen:!1,timesheetId:null,timesheetData:null}),onConfirm:we,title:"Delete Timesheet",message:I.timesheetData?e.jsxs("div",{children:[e.jsx("p",{children:"Delete this timesheet entry?"}),e.jsx("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"6px",padding:"0.75rem",marginTop:"0.75rem"},children:e.jsxs("ul",{style:{margin:"0",paddingLeft:"1.25rem",color:"#92400e",fontSize:"0.9rem"},children:[e.jsxs("li",{children:["Resource: ",I.timesheetData.resourceName]}),e.jsxs("li",{children:["Hours: ",I.timesheetData.hours,"h"]}),e.jsxs("li",{children:["Status: ",ee(I.timesheetData.status)]})]})})]}):"Delete this timesheet?",confirmText:"Delete",cancelText:"Cancel",variant:"danger"}),e.jsx(Xe,{isOpen:te.isOpen,timesheet:te.timesheet,resources:c,milestones:W,userRole:t,canSubmitTimesheet:m,canValidateTimesheet:h,canEditTimesheet:o,canDeleteTimesheet:u,onClose:()=>ae({isOpen:!1,timesheet:null}),onSave:ve,onSubmit:ke,onValidate:_e,onReject:Se,onDelete:be}),e.jsx(Oe,{isOpen:Q.isOpen,onClose:()=>X({isOpen:!1,timesheetId:null}),onConfirm:De,title:"Reject Timesheet",message:"Please provide a reason for rejecting this timesheet.",inputLabel:"Rejection Reason",inputPlaceholder:"Enter reason (optional)",confirmText:"Reject",cancelText:"Cancel",type:"warning"})]})}export{os as default};
