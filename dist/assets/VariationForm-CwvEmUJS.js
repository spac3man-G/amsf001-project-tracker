import{u as Ne,a as we,c as ye,d as Se,m as Ce,e as De,x as p,j as e,L as ke,z as w}from"./index-DBy7juAg.js";import{i as Ae,d as Te,r as m}from"./vendor-react-BUTV5ZEl.js";import{a as j,f as _}from"./formatters-BTbCMDgc.js";import{ah as U,al as Ie,F as Re,Y as Q,Q as k,m as Z,o as ee,P as se,aR as Ee,e as D,r as ze,z as Y,T as Me,A as H,p as q,I as O,V as Pe,u as J,i as Fe}from"./vendor-icons-L8EmaAR6.js";import"./vendor-supabase-6faYzd5A.js";const X=[{id:1,name:"Basic Info",icon:Re},{id:2,name:"Milestones",icon:Q},{id:3,name:"Impacts",icon:k},{id:4,name:"Assumptions",icon:Z},{id:5,name:"Costs",icon:ee},{id:6,name:"Deliverables",icon:se},{id:7,name:"Review",icon:Ee}],G=[{value:w.SCOPE_EXTENSION,label:"Scope Extension",desc:"Additional work beyond original scope"},{value:w.SCOPE_REDUCTION,label:"Scope Reduction",desc:"Removal of work from original scope"},{value:w.TIME_EXTENSION,label:"Time Extension",desc:"Schedule adjustment without scope change"},{value:w.COST_ADJUSTMENT,label:"Cost Adjustment",desc:"Price change without scope/time change"},{value:w.COMBINED,label:"Combined",desc:"Multiple impact types"}],K=[{value:"H",label:"High",desc:"Critical - requires immediate attention",color:"#dc2626"},{value:"M",label:"Medium",desc:"Important - standard processing",color:"#f59e0b"},{value:"L",label:"Low",desc:"Minor - can be addressed as time permits",color:"#22c55e"}];function Be(){const{id:y}=Ae(),A=Te(),{user:ae}=Ne(),{projectId:b}=we(),{showSuccess:T,showError:I,showWarning:R}=ye(),{canCreateVariation:qe}=Se(),ie=!!y,[le,te]=m.useState(!0),[W,S]=m.useState(!1),[r,E]=m.useState(1),[L,ne]=m.useState([]),[z,re]=m.useState([]),[g,C]=m.useState("saved"),[a,M]=m.useState({title:"",variation_type:"",description:"",reason:"",contract_terms_reference:"",priority:"",date_required:"",benefits:"",initiator_name:"",initiator_name:"",affected_milestones:[],assumptions:"",risks:"",cost_summary:"",impact_on_charges:"",impact_on_service_levels:"",implementation_timetable:"",deliverable_date_updates:[],impact_summary:""}),[v,$]=m.useState(null);m.useEffect(()=>{b&&ce()},[b,y]);async function ce(){try{const s=await Ce.getAll(b,{orderBy:{column:"milestone_ref",ascending:!0}});ne(s||[]);const i=await De.getAll(b,{orderBy:{column:"deliverable_ref",ascending:!0}});if(re(i||[]),y){const l=await p.getWithDetails(y);l&&($(l),E(l.form_step||1),l.form_data?M(t=>({...t,...l.form_data})):M({title:l.title||"",variation_type:l.variation_type||"",description:l.description||"",reason:l.reason||"",contract_terms_reference:l.contract_terms_reference||"",priority:l.priority||"",date_required:l.date_required||"",benefits:l.benefits||"",initiator_name:l.initiator_name||"",affected_milestones:l.affected_milestones||[],assumptions:l.assumptions||"",risks:l.risks||"",cost_summary:l.cost_summary||"",impact_on_charges:l.impact_on_charges||"",impact_on_service_levels:l.impact_on_service_levels||"",implementation_timetable:l.implementation_timetable||"",deliverable_date_updates:[],impact_summary:l.impact_summary||""}))}}catch{I("Failed to load data")}finally{te(!1)}}const de=m.useCallback(async()=>{if(v?.id){C("saving");try{await p.saveFormProgress(v.id,a,r),C("saved")}catch{C("error")}}},[v?.id,a,r]);m.useEffect(()=>{if(!v?.id)return;const s=setTimeout(()=>{de()},2e3);return()=>clearTimeout(s)},[a,r]);function n(s,i){M(l=>({...l,[s]:i})),C("unsaved")}async function P(s){v?.id&&await p.saveFormProgress(v.id,a,s),E(s)}async function oe(){r<7&&await P(r+1)}async function ve(){r>1&&await P(r-1)}function V(s){switch(s){case 1:return a.title&&a.variation_type;case 2:return a.affected_milestones.length>0;case 3:return a.affected_milestones.every(i=>i.new_baseline_cost!==void 0||i.new_baseline_end);case 4:return!0;case 5:return!0;case 6:return!0;case 7:return a.impact_summary&&a.impact_summary.trim().length>0;default:return!0}}function me(s){const i=L.find(t=>t.id===s);if(!i)return;if(a.affected_milestones.some(t=>t.milestone_id===s)){R("Milestone already added");return}const l={milestone_id:s,milestone:i,is_new_milestone:!1,original_baseline_cost:i.billable||0,new_baseline_cost:i.billable||0,original_baseline_start:i.baseline_start_date||i.start_date,new_baseline_start:i.baseline_start_date||i.start_date,original_baseline_end:i.baseline_end_date||i.end_date,new_baseline_end:i.baseline_end_date||i.end_date,change_rationale:""};n("affected_milestones",[...a.affected_milestones,l])}function fe(s){const i=a.affected_milestones[s],l=[...a.affected_milestones];if(l.splice(s,1),n("affected_milestones",l),i?.milestone_id){const t=a.deliverable_date_updates.filter(d=>d.milestone_id!==i.milestone_id);n("deliverable_date_updates",t)}}function F(s,i,l){const t=[...a.affected_milestones];t[s]={...t[s],[i]:l},n("affected_milestones",t)}function he(){const s=a.affected_milestones.map(i=>i.milestone_id);return z.filter(i=>s.includes(i.milestone_id))}function pe(s,i,l){if(a.deliverable_date_updates.find(d=>d.deliverable_id===s.id))n("deliverable_date_updates",a.deliverable_date_updates.filter(d=>d.deliverable_id!==s.id));else{const d=s.due_date||i.baseline_end_date||i.end_date;let c=null;if(d&&l!==0){const o=new Date(d);o.setDate(o.getDate()+l),c=o.toISOString().split("T")[0]}n("deliverable_date_updates",[...a.deliverable_date_updates,{deliverable_id:s.id,deliverable_ref:s.deliverable_ref,deliverable_name:s.name,milestone_id:i.milestone_id,original_due_date:d,new_due_date:c,days_shift:l}])}}function _e(s,i,l){const t=z.filter(c=>c.milestone_id===s),d=a.affected_milestones.find(c=>c.milestone_id===s);if(l){const c=t.filter(o=>!a.deliverable_date_updates.some(f=>f.deliverable_id===o.id)).map(o=>{const f=o.due_date||d?.original_baseline_end;let N=null;if(f&&i!==0){const h=new Date(f);h.setDate(h.getDate()+i),N=h.toISOString().split("T")[0]}return{deliverable_id:o.id,deliverable_ref:o.deliverable_ref,deliverable_name:o.name,milestone_id:s,original_due_date:f,new_due_date:N,days_shift:i}});n("deliverable_date_updates",[...a.deliverable_date_updates,...c])}else n("deliverable_date_updates",a.deliverable_date_updates.filter(c=>c.milestone_id!==s))}function ue(){let s=0,i=0;return a.affected_milestones.forEach(l=>{if(s+=(l.new_baseline_cost||0)-(l.original_baseline_cost||0),l.original_baseline_end&&l.new_baseline_end){const t=new Date(l.original_baseline_end),d=new Date(l.new_baseline_end);i+=Math.round((d-t)/(1e3*60*60*24))}}),{totalCost:s,totalDays:i}}function xe(s){if(!s.original_baseline_end||!s.new_baseline_end)return 0;const i=new Date(s.original_baseline_end),l=new Date(s.new_baseline_end);return Math.round((l-i)/(1e3*60*60*24))}async function B(){S(!0);try{if(v?.id)return await p.update(v.id,{title:a.title,variation_type:a.variation_type,description:a.description,reason:a.reason,contract_terms_reference:a.contract_terms_reference,priority:a.priority||null,date_required:a.date_required||null,benefits:a.benefits||null,initiator_name:a.initiator_name||null,assumptions:a.assumptions||null,risks:a.risks||null,cost_summary:a.cost_summary||null,impact_on_charges:a.impact_on_charges||null,impact_on_service_levels:a.impact_on_service_levels||null,implementation_timetable:a.implementation_timetable||null,form_data:a,form_step:r}),T("Draft saved"),v;{const s=await p.createVariation(b,{title:a.title,variation_type:a.variation_type,description:a.description,reason:a.reason,contract_terms_reference:a.contract_terms_reference,priority:a.priority||null,date_required:a.date_required||null,benefits:a.benefits||null,initiator_name:a.initiator_name||null,assumptions:a.assumptions||null,risks:a.risks||null,cost_summary:a.cost_summary||null,impact_on_charges:a.impact_on_charges||null,impact_on_service_levels:a.impact_on_service_levels||null,implementation_timetable:a.implementation_timetable||null,form_data:a,form_step:r},ae?.id);return $(s),T("Draft created"),A(`/variations/${s.id}/edit`,{replace:!0}),s}}catch(s){throw I("Failed to save draft"),s}finally{S(!1)}}async function je(){for(let s=1;s<=7;s++)if(!V(s)){R(s===7?"Please provide an Impact Summary before submitting":`Please complete Step ${s} before submitting`),E(s);return}S(!0);try{let s=v;if(s?.id?await p.update(s.id,{title:a.title,variation_type:a.variation_type,description:a.description,reason:a.reason,contract_terms_reference:a.contract_terms_reference,priority:a.priority||null,date_required:a.date_required||null,benefits:a.benefits||null,initiator_name:a.initiator_name||null,assumptions:a.assumptions||null,risks:a.risks||null,cost_summary:a.cost_summary||null,impact_on_charges:a.impact_on_charges||null,impact_on_service_levels:a.impact_on_service_levels||null,implementation_timetable:a.implementation_timetable||null,form_data:a,form_step:7}):s=await B(),!s?.id)throw new Error("Failed to create variation");await p.clearAffectedMilestones(s.id);for(const i of a.affected_milestones)await p.addAffectedMilestone(s.id,{milestone_id:i.milestone_id,is_new_milestone:i.is_new_milestone||!1,original_baseline_cost:i.original_baseline_cost,new_baseline_cost:i.new_baseline_cost,original_baseline_start:i.original_baseline_start,new_baseline_start:i.new_baseline_start,original_baseline_end:i.original_baseline_end,new_baseline_end:i.new_baseline_end,change_rationale:i.change_rationale});await p.submitForApproval(s.id,a.impact_summary),T("Variation submitted for approval"),A(`/variations/${s.id}`)}catch(s){I("Failed to submit variation: "+(s.message||"Unknown error"))}finally{S(!1)}}function be(){A("/variations")}if(le)return e.jsx(ke,{message:"Loading...",size:"large",fullPage:!0});const{totalCost:u,totalDays:x}=ue(),ge=he();return e.jsxs("div",{className:"variation-form-page",children:[e.jsx("header",{className:"vf-header",children:e.jsxs("div",{className:"vf-header-content",children:[e.jsxs("div",{className:"vf-header-left",children:[e.jsx("button",{className:"vf-back-btn",onClick:be,children:e.jsx(U,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{children:ie?"Edit Variation":"Create Variation"}),v&&e.jsx("span",{className:"vf-header-ref",children:v.variation_ref})]})]}),e.jsxs("div",{className:"vf-header-right",children:[e.jsxs("span",{className:`vf-save-status ${g}`,children:[g==="saving"&&"Saving...",g==="saved"&&"Draft saved",g==="unsaved"&&"Unsaved changes",g==="error"&&"Save failed"]}),e.jsxs("button",{className:"vf-btn vf-btn-secondary",onClick:B,disabled:W,children:[e.jsx(Ie,{size:18}),"Save Draft"]})]})]})}),e.jsx("div",{className:"vf-progress",children:e.jsx("div",{className:"vf-progress-content",children:X.map((s,i)=>{const l=s.icon,t=r===s.id,d=r>s.id;return e.jsxs("div",{className:`vf-step ${t?"active":""} ${d?"complete":""}`,onClick:()=>P(s.id),children:[e.jsx("div",{className:"vf-step-icon",children:d?e.jsx(D,{size:16}):e.jsx(l,{size:16})}),e.jsx("span",{className:"vf-step-name",children:s.name}),i<X.length-1&&e.jsx("div",{className:"vf-step-connector"})]},s.id)})})}),e.jsxs("div",{className:"vf-content",children:[e.jsxs("div",{className:"vf-form",children:[r===1&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Basic Information"}),e.jsx("p",{className:"vf-card-desc",children:"Enter the basic details of this variation request."}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Variation Title *"}),e.jsx("input",{type:"text",value:a.title,onChange:s=>n("title",s.target.value),placeholder:"e.g., Additional Security Requirements"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Initiator Name"}),e.jsx("input",{type:"text",value:a.initiator_name,onChange:s=>n("initiator_name",s.target.value),placeholder:"e.g., John Smith"}),e.jsx("span",{className:"vf-field-hint",children:"Person requesting this change"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Variation Type *"}),e.jsx("div",{className:"vf-type-grid",children:G.map(s=>e.jsxs("div",{className:`vf-type-option ${a.variation_type===s.value?"selected":""}`,onClick:()=>n("variation_type",s.value),children:[e.jsx("div",{className:"vf-type-radio",children:a.variation_type===s.value&&e.jsx(D,{size:14})}),e.jsxs("div",{className:"vf-type-info",children:[e.jsx("span",{className:"vf-type-label",children:s.label}),e.jsx("span",{className:"vf-type-desc",children:s.desc})]})]},s.value))})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(ze,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Priority"]}),e.jsx("div",{className:"vf-priority-grid",children:K.map(s=>e.jsxs("div",{className:`vf-priority-option ${a.priority===s.value?"selected":""}`,onClick:()=>n("priority",s.value),style:{"--priority-color":s.color},children:[e.jsx("div",{className:"vf-priority-radio",children:a.priority===s.value&&e.jsx(D,{size:14})}),e.jsxs("div",{className:"vf-priority-info",children:[e.jsx("span",{className:"vf-priority-label",children:s.label}),e.jsx("span",{className:"vf-priority-desc",children:s.desc})]})]},s.value))})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(Y,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Date Required"]}),e.jsx("input",{type:"date",value:a.date_required,onChange:s=>n("date_required",s.target.value)}),e.jsx("span",{className:"vf-field-hint",children:"When is this change needed by?"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>n("description",s.target.value),placeholder:"Describe the variation in detail...",rows:4})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Reason for Change"}),e.jsx("textarea",{value:a.reason,onChange:s=>n("reason",s.target.value),placeholder:"Why is this variation necessary?",rows:3})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(Z,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Expected Benefits"]}),e.jsx("textarea",{value:a.benefits,onChange:s=>n("benefits",s.target.value),placeholder:"What benefits will this change deliver?",rows:3})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Contract Terms Reference"}),e.jsx("input",{type:"text",value:a.contract_terms_reference,onChange:s=>n("contract_terms_reference",s.target.value),placeholder:"e.g., Clause 7.2 - Change Control"})]})]})}),r===2&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Affected Milestones"}),e.jsx("p",{className:"vf-card-desc",children:"Select the milestones affected by this variation."}),e.jsx("div",{className:"vf-milestone-selector",children:e.jsxs("select",{className:"vf-milestone-select",onChange:s=>{s.target.value&&(me(s.target.value),s.target.value="")},children:[e.jsx("option",{value:"",children:"+ Add milestone..."}),L.filter(s=>!a.affected_milestones.some(i=>i.milestone_id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.milestone_ref,": ",s.name]},s.id))]})}),a.affected_milestones.length===0?e.jsxs("div",{className:"vf-empty",children:[e.jsx(Q,{size:32}),e.jsx("p",{children:"No milestones selected"}),e.jsx("span",{children:"Use the dropdown above to add affected milestones"})]}):e.jsx("div",{className:"vf-milestone-list",children:a.affected_milestones.map((s,i)=>e.jsxs("div",{className:"vf-milestone-item",children:[e.jsxs("div",{className:"vf-milestone-info",children:[e.jsx("span",{className:"vf-milestone-ref",children:s.milestone?.milestone_ref}),e.jsx("span",{className:"vf-milestone-name",children:s.milestone?.name})]}),e.jsxs("div",{className:"vf-milestone-current",children:[e.jsxs("span",{children:["Current: ",j(s.original_baseline_cost)]}),e.jsxs("span",{children:["End: ",_(s.original_baseline_end)]})]}),e.jsx("button",{className:"vf-milestone-remove",onClick:()=>fe(i),children:e.jsx(Me,{size:16})})]},i))})]})}),r===3&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Impact Details"}),e.jsx("p",{className:"vf-card-desc",children:"Specify the cost and schedule changes for each affected milestone."}),a.affected_milestones.length===0?e.jsxs("div",{className:"vf-empty",children:[e.jsx(H,{size:32}),e.jsx("p",{children:"No milestones selected"}),e.jsx("span",{children:"Go back to Step 2 to add affected milestones"})]}):e.jsx("div",{className:"vf-impacts-list",children:a.affected_milestones.map((s,i)=>e.jsxs("div",{className:"vf-impact-item",children:[e.jsxs("div",{className:"vf-impact-header",children:[e.jsx("span",{className:"vf-impact-ref",children:s.milestone?.milestone_ref}),e.jsx("span",{className:"vf-impact-name",children:s.milestone?.name})]}),e.jsxs("div",{className:"vf-impact-fields",children:[e.jsxs("div",{className:"vf-impact-field",children:[e.jsxs("label",{children:[e.jsx(k,{size:14}),"New Baseline Cost"]}),e.jsxs("div",{className:"vf-impact-input-group",children:[e.jsx("span",{className:"vf-currency",children:"£"}),e.jsx("input",{type:"number",value:s.new_baseline_cost||"",onChange:l=>F(i,"new_baseline_cost",parseFloat(l.target.value)||0)}),e.jsxs("span",{className:"vf-original",children:["Was: ",j(s.original_baseline_cost)]})]})]}),e.jsxs("div",{className:"vf-impact-field",children:[e.jsxs("label",{children:[e.jsx(q,{size:14}),"New End Date"]}),e.jsxs("div",{className:"vf-impact-input-group",children:[e.jsx("input",{type:"date",value:s.new_baseline_end||"",onChange:l=>F(i,"new_baseline_end",l.target.value)}),e.jsxs("span",{className:"vf-original",children:["Was: ",_(s.original_baseline_end)]})]})]})]}),e.jsxs("div",{className:"vf-impact-rationale",children:[e.jsx("label",{children:"Rationale for this milestone"}),e.jsx("textarea",{value:s.change_rationale||"",onChange:l=>F(i,"change_rationale",l.target.value),placeholder:"Why is this milestone affected?",rows:2})]})]},i))}),e.jsxs("div",{className:"vf-impact-summary",children:[e.jsx("h3",{children:"Total Impact"}),e.jsxs("div",{className:"vf-impact-totals",children:[e.jsxs("div",{className:`vf-impact-total ${u>=0?"positive":"negative"}`,children:[e.jsx(k,{size:20}),e.jsxs("span",{className:"vf-total-value",children:[u>0?"+":"",j(u)]}),e.jsx("span",{className:"vf-total-label",children:"Cost"})]}),e.jsxs("div",{className:`vf-impact-total ${x>=0?"positive":"negative"}`,children:[e.jsx(q,{size:20}),e.jsxs("span",{className:"vf-total-value",children:[x>0?"+":"",x," days"]}),e.jsx("span",{className:"vf-total-label",children:"Schedule"})]})]})]})]})}),r===4&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Assumptions & Risks"}),e.jsx("p",{className:"vf-card-desc",children:"Document any assumptions and identify potential risks associated with this change."}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(O,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Key Assumptions"]}),e.jsx("textarea",{value:a.assumptions,onChange:s=>n("assumptions",s.target.value),placeholder:`List the key assumptions this change request is based on...

For example:
- Existing infrastructure can support the new requirements
- Required resources will be available during implementation
- Third-party dependencies will be delivered on schedule`,rows:6}),e.jsx("span",{className:"vf-field-hint",children:"What conditions must be true for this change to succeed?"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(Pe,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Identified Risks"]}),e.jsx("textarea",{value:a.risks,onChange:s=>n("risks",s.target.value),placeholder:`Identify potential risks and their mitigation strategies...

For example:
- Risk: Resource availability may be limited
  Mitigation: Identify backup resources in advance
- Risk: Integration complexity may cause delays
  Mitigation: Allow buffer time in schedule`,rows:6}),e.jsx("span",{className:"vf-field-hint",children:"What could go wrong and how will you address it?"})]}),e.jsxs("div",{className:"vf-info-box",children:[e.jsx(O,{size:18}),e.jsxs("div",{children:[e.jsx("strong",{children:"Why document assumptions and risks?"}),e.jsx("p",{children:"Clearly documented assumptions help stakeholders understand the basis for estimates. Identifying risks upfront enables proactive mitigation planning and sets realistic expectations."})]})]})]})}),r===5&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Costs & Implementation"}),e.jsx("p",{className:"vf-card-desc",children:"Provide details on costs, billing impact, service levels, and implementation timeline."}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(ee,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Cost Summary"]}),e.jsx("textarea",{value:a.cost_summary,onChange:s=>n("cost_summary",s.target.value),placeholder:`Provide a breakdown of the costs...

For example:
- Labour: 40 hours @ £125/hr = £5,000
- Materials/Equipment: £2,500
- Third-party services: £1,500
- Contingency (10%): £900
- Total: £9,900`,rows:6}),e.jsx("span",{className:"vf-field-hint",children:"Break down the cost components of this change"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(k,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Impact on Charges"]}),e.jsx("textarea",{value:a.impact_on_charges,onChange:s=>n("impact_on_charges",s.target.value),placeholder:`Describe how this change affects billing...

For example:
- One-time implementation charge of £9,900
- No impact on recurring monthly charges
- Or: Monthly service fee will increase by £500 from effective date`,rows:4}),e.jsx("span",{className:"vf-field-hint",children:"How will this change affect the client's billing?"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(H,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Impact on Service Levels"]}),e.jsx("textarea",{value:a.impact_on_service_levels,onChange:s=>n("impact_on_service_levels",s.target.value),placeholder:`Describe any impact on SLAs...

For example:
- No impact on existing SLAs
- Or: Response time SLA will be temporarily relaxed during migration window
- Or: New availability target of 99.9% will apply to additional component`,rows:4}),e.jsx("span",{className:"vf-field-hint",children:"Will this change affect any Service Level Agreements?"})]}),e.jsxs("div",{className:"vf-field",children:[e.jsxs("label",{children:[e.jsx(q,{size:14,style:{marginRight:"6px",verticalAlign:"middle"}}),"Implementation Timetable"]}),e.jsx("textarea",{value:a.implementation_timetable,onChange:s=>n("implementation_timetable",s.target.value),placeholder:`Outline the implementation plan and timeline...

For example:
Week 1-2: Design and planning
Week 3-4: Development and configuration
Week 5: Testing and UAT
Week 6: Deployment and go-live
Week 7: Post-implementation support`,rows:6}),e.jsx("span",{className:"vf-field-hint",children:"What is the planned approach and schedule for implementation?"})]})]})}),r===6&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Deliverable Due Dates"}),e.jsx("p",{className:"vf-card-desc",children:"When milestone dates change, you may want to update the due dates of linked deliverables. Select which deliverables should have their due dates adjusted."}),ge.length===0?e.jsxs("div",{className:"vf-empty",children:[e.jsx(se,{size:32}),e.jsx("p",{children:"No deliverables linked to affected milestones"}),e.jsx("span",{children:"This step is optional - proceed to Review"})]}):e.jsxs(e.Fragment,{children:[a.affected_milestones.map((s,i)=>{const l=z.filter(c=>c.milestone_id===s.milestone_id),t=xe(s);if(l.length===0)return null;const d=l.every(c=>a.deliverable_date_updates.some(o=>o.deliverable_id===c.id));return e.jsxs("div",{className:"vf-deliverable-group",children:[e.jsxs("div",{className:"vf-deliverable-group-header",children:[e.jsxs("div",{className:"vf-deliverable-group-info",children:[e.jsx("span",{className:"vf-deliverable-group-ref",children:s.milestone?.milestone_ref}),e.jsx("span",{className:"vf-deliverable-group-name",children:s.milestone?.name}),t!==0&&e.jsxs("span",{className:`vf-deliverable-group-shift ${t>0?"positive":"negative"}`,children:[t>0?"+":"",t," days"]})]}),t!==0&&e.jsx("button",{className:`vf-select-all-btn ${d?"selected":""}`,onClick:()=>_e(s.milestone_id,t,!d),children:d?"Deselect All":"Select All"})]}),t===0?e.jsxs("div",{className:"vf-deliverable-no-shift",children:[e.jsx(O,{size:16}),e.jsx("span",{children:"No date change for this milestone - deliverable dates will remain unchanged"})]}):e.jsx("div",{className:"vf-deliverable-list",children:l.map(c=>{const o=a.deliverable_date_updates.some(h=>h.deliverable_id===c.id),f=c.due_date||s.original_baseline_end;let N=null;if(f){const h=new Date(f);h.setDate(h.getDate()+t),N=h.toISOString().split("T")[0]}return e.jsxs("div",{className:`vf-deliverable-item ${o?"selected":""}`,onClick:()=>pe(c,s,t),children:[e.jsx("div",{className:"vf-deliverable-checkbox",children:o&&e.jsx(D,{size:14})}),e.jsxs("div",{className:"vf-deliverable-info",children:[e.jsx("span",{className:"vf-deliverable-ref",children:c.deliverable_ref}),e.jsx("span",{className:"vf-deliverable-name",children:c.name})]}),e.jsxs("div",{className:"vf-deliverable-dates",children:[e.jsx("span",{className:"vf-deliverable-current",children:_(f)||"No date"}),e.jsx(J,{size:14}),e.jsx("span",{className:"vf-deliverable-new",children:_(N)||"No date"})]})]},c.id)})})]},i)}),a.deliverable_date_updates.length>0&&e.jsxs("div",{className:"vf-deliverable-summary",children:[e.jsx(Y,{size:18}),e.jsxs("span",{children:[e.jsx("strong",{children:a.deliverable_date_updates.length})," deliverable",a.deliverable_date_updates.length!==1?"s":""," will have due dates updated when this variation is applied"]})]})]})]})}),r===7&&e.jsx("div",{className:"vf-step-content",children:e.jsxs("div",{className:"vf-card",children:[e.jsx("h2",{children:"Review & Submit"}),e.jsx("p",{className:"vf-card-desc",children:"Review your variation and add a summary before submitting."}),e.jsxs("div",{className:"vf-review-section",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Title"}),e.jsx("span",{className:"vf-review-value",children:a.title||"-"})]}),a.initiator_name&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Initiator"}),e.jsx("span",{className:"vf-review-value",children:a.initiator_name})]}),e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Type"}),e.jsx("span",{className:"vf-review-value",children:G.find(s=>s.value===a.variation_type)?.label||"-"})]}),a.priority&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Priority"}),e.jsx("span",{className:"vf-review-value",children:e.jsx("span",{className:`vf-priority-badge priority-${a.priority.toLowerCase()}`,children:K.find(s=>s.value===a.priority)?.label||a.priority})})]}),a.date_required&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Date Required"}),e.jsx("span",{className:"vf-review-value",children:_(a.date_required)})]}),a.description&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Description"}),e.jsx("span",{className:"vf-review-value",children:a.description})]}),a.reason&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Reason"}),e.jsx("span",{className:"vf-review-value",children:a.reason})]}),a.benefits&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Expected Benefits"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.benefits})]}),a.contract_terms_reference&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Contract Reference"}),e.jsx("span",{className:"vf-review-value",children:a.contract_terms_reference})]})]}),e.jsxs("div",{className:"vf-review-section",children:[e.jsxs("h3",{children:["Affected Milestones (",a.affected_milestones.length,")"]}),a.affected_milestones.map((s,i)=>e.jsxs("div",{className:"vf-review-milestone",children:[e.jsx("span",{className:"vf-review-ms-ref",children:s.milestone?.milestone_ref}),e.jsx("span",{className:"vf-review-ms-name",children:s.milestone?.name}),e.jsxs("div",{className:"vf-review-ms-changes",children:[s.original_baseline_cost!==s.new_baseline_cost&&e.jsxs("span",{children:["Cost: ",j(s.original_baseline_cost)," → ",j(s.new_baseline_cost)]}),s.original_baseline_end!==s.new_baseline_end&&e.jsxs("span",{children:["End: ",_(s.original_baseline_end)," → ",_(s.new_baseline_end)]})]})]},i))]}),(a.assumptions||a.risks)&&e.jsxs("div",{className:"vf-review-section",children:[e.jsx("h3",{children:"Assumptions & Risks"}),a.assumptions&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Assumptions"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.assumptions})]}),a.risks&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Risks"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.risks})]})]}),(a.cost_summary||a.impact_on_charges||a.impact_on_service_levels||a.implementation_timetable)&&e.jsxs("div",{className:"vf-review-section",children:[e.jsx("h3",{children:"Costs & Implementation"}),a.cost_summary&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Cost Summary"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.cost_summary})]}),a.impact_on_charges&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Impact on Charges"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.impact_on_charges})]}),a.impact_on_service_levels&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Impact on Service Levels"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.impact_on_service_levels})]}),a.implementation_timetable&&e.jsxs("div",{className:"vf-review-row",children:[e.jsx("span",{className:"vf-review-label",children:"Implementation Timetable"}),e.jsx("span",{className:"vf-review-value vf-review-multiline",children:a.implementation_timetable})]})]}),a.deliverable_date_updates.length>0&&e.jsxs("div",{className:"vf-review-section",children:[e.jsxs("h3",{children:["Deliverable Date Updates (",a.deliverable_date_updates.length,")"]}),a.deliverable_date_updates.map((s,i)=>e.jsxs("div",{className:"vf-review-deliverable",children:[e.jsx("span",{className:"vf-review-del-ref",children:s.deliverable_ref}),e.jsx("span",{className:"vf-review-del-name",children:s.deliverable_name}),e.jsxs("span",{className:"vf-review-del-dates",children:[_(s.original_due_date)," → ",_(s.new_due_date)]})]},i))]}),e.jsxs("div",{className:"vf-review-section",children:[e.jsx("h3",{children:"Total Impact"}),e.jsxs("div",{className:"vf-review-impacts",children:[e.jsxs("div",{className:`vf-review-impact ${u>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"vf-review-impact-label",children:"Cost"}),e.jsxs("span",{className:"vf-review-impact-value",children:[u>0?"+":"",j(u)]})]}),e.jsxs("div",{className:`vf-review-impact ${x>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"vf-review-impact-label",children:"Schedule"}),e.jsxs("span",{className:"vf-review-impact-value",children:[x>0?"+":"",x," days"]})]})]})]}),e.jsxs("div",{className:"vf-field",children:[e.jsx("label",{children:"Impact Summary *"}),e.jsx("textarea",{value:a.impact_summary,onChange:s=>n("impact_summary",s.target.value),placeholder:"Provide a summary of the overall impact of this variation...",rows:4}),e.jsx("span",{className:"vf-field-hint",children:"This summary will appear on the variation certificate"})]})]})})]}),e.jsx("div",{className:"vf-footer",children:e.jsxs("div",{className:"vf-footer-content",children:[e.jsxs("button",{className:"vf-btn vf-btn-secondary",onClick:ve,disabled:r===1,children:[e.jsx(U,{size:18}),"Previous"]}),e.jsx("div",{className:"vf-footer-right",children:r<7?e.jsxs("button",{className:"vf-btn vf-btn-primary",onClick:oe,disabled:!V(r),children:["Next",e.jsx(J,{size:18})]}):e.jsxs("button",{className:"vf-btn vf-btn-submit",onClick:je,disabled:W||!a.impact_summary,children:[e.jsx(Fe,{size:18}),"Submit for Approval"]})})]})})]})]})}export{Be as default};
