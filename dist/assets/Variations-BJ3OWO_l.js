import{u as O,a as F,c as D,d as M,x,y as e,j as s,L as U,S as k,T as L,z as c}from"./index-BAKS0PkB.js";import{d as G,r as i}from"./vendor-react-BUTV5ZEl.js";import{a as p,f as W}from"./formatters-BTbCMDgc.js";import{R as $,ae as B,F as d,p as N,aN as J,O as f,aI as X,I as Y,w as g}from"./vendor-icons-D4HYsxEu.js";import"./vendor-supabase-6faYzd5A.js";const q=[{value:"all",label:"All Variations"},{value:"draft",label:"Drafts"},{value:"pending",label:"Pending Approval"},{value:"approved",label:"Approved"},{value:"applied",label:"Applied"},{value:"rejected",label:"Rejected"}];function ls(){const o=G(),{user:H,profile:K}=O(),{projectId:l}=F(),{showSuccess:Q,showError:y}=D(),{canCreateVariation:S,canSignAsSupplier:Z,canSignAsCustomer:ss}=M(),[T,C]=i.useState([]),[b,_]=i.useState(!0),[m,h]=i.useState(!1),[t,I]=i.useState("all"),[r,A]=i.useState(null);i.useEffect(()=>{l&&(u(),v())},[l]);async function u(){try{const a=await x.getAllWithStats(l);C(a||[])}catch{y("Failed to load variations")}finally{_(!1),h(!1)}}async function v(){try{const a=await x.getSummary(l);A(a)}catch{}}async function E(){h(!0),await u(),await v()}function P(){o("/variations/new")}function R(a){o(`/variations/${a.id}`)}const n=T.filter(a=>t==="all"?!0:t==="pending"?[e.SUBMITTED,e.AWAITING_CUSTOMER,e.AWAITING_SUPPLIER].includes(a.status):a.status===t);function w(a){return{[e.DRAFT]:"draft",[e.SUBMITTED]:"submitted",[e.AWAITING_CUSTOMER]:"awaiting",[e.AWAITING_SUPPLIER]:"awaiting",[e.APPROVED]:"approved",[e.APPLIED]:"applied",[e.REJECTED]:"rejected"}[a]||"draft"}function z(a){switch(a){case c.SCOPE_EXTENSION:return s.jsx(g,{size:14});case c.SCOPE_REDUCTION:return s.jsx(g,{size:14,className:"rotate-180"});case c.TIME_EXTENSION:return s.jsx(N,{size:14});case c.COST_ADJUSTMENT:return s.jsx(f,{size:14});default:return s.jsx(d,{size:14})}}return b?s.jsx(U,{message:"Loading variations...",size:"large",fullPage:!0}):s.jsxs("div",{className:"variations-page",children:[s.jsx("header",{className:"var-header",children:s.jsxs("div",{className:"var-header-content",children:[s.jsxs("div",{className:"var-header-left",children:[s.jsx("h1",{children:"Variations"}),s.jsx("p",{children:"Project change control and variation management"})]}),s.jsxs("div",{className:"var-header-actions",children:[s.jsxs("button",{className:"var-btn var-btn-secondary",onClick:E,disabled:m,children:[s.jsx($,{size:18,className:m?"spinning":""}),"Refresh"]}),S&&s.jsxs("button",{className:"var-btn var-btn-primary",onClick:P,children:[s.jsx(B,{size:18}),"Create Variation"]})]})]})}),s.jsxs("div",{className:"var-content",children:[r&&s.jsxs("div",{className:"var-summary-grid",children:[s.jsxs("div",{className:"var-summary-card accent",children:[s.jsx("div",{className:"var-summary-icon",children:s.jsx(d,{size:22})}),s.jsx("div",{className:"var-summary-value",children:r.total}),s.jsx("div",{className:"var-summary-label",children:"Total Variations"})]}),s.jsxs("div",{className:"var-summary-card warning",children:[s.jsx("div",{className:"var-summary-icon",children:s.jsx(N,{size:22})}),s.jsx("div",{className:"var-summary-value",children:r.pending}),s.jsx("div",{className:"var-summary-label",children:"Pending Approval"})]}),s.jsxs("div",{className:"var-summary-card success",children:[s.jsx("div",{className:"var-summary-icon",children:s.jsx(J,{size:22})}),s.jsx("div",{className:"var-summary-value",children:r.applied}),s.jsx("div",{className:"var-summary-label",children:"Applied"})]}),s.jsxs("div",{className:"var-summary-card primary",children:[s.jsx("div",{className:"var-summary-icon",children:s.jsx(f,{size:22})}),s.jsxs("div",{className:"var-summary-value",children:[r.totalCostImpact>=0?"+":"",p(r.totalCostImpact)]}),s.jsx("div",{className:"var-summary-label",children:"Net Cost Impact"})]})]}),s.jsxs("div",{className:"var-filter-bar",children:[s.jsxs("div",{className:"var-filter-group",children:[s.jsx(X,{size:16}),s.jsx("span",{children:"Filter:"}),q.map(a=>s.jsx("button",{className:`var-filter-btn ${t===a.value?"active":""}`,onClick:()=>I(a.value),children:a.label},a.value))]}),s.jsxs("div",{className:"var-filter-count",children:[n.length," variation",n.length!==1?"s":""]})]}),s.jsx("div",{className:"var-table-card",children:n.length===0?s.jsxs("div",{className:"var-empty",children:[s.jsx("div",{className:"var-empty-icon",children:s.jsx(d,{size:32})}),s.jsx("div",{className:"var-empty-title",children:t==="all"?"No variations yet":`No ${t} variations`}),s.jsx("div",{className:"var-empty-text",children:t==="all"?'Click "Create Variation" to request a project change.':"Try a different filter to see more variations."})]}):s.jsxs("table",{className:"var-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Reference"}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Type"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Cost Impact"}),s.jsx("th",{children:"Days Impact"}),s.jsx("th",{children:"Milestones"}),s.jsx("th",{children:"Created"})]})}),s.jsx("tbody",{children:n.map(a=>{const j=k[a.status],V=L[a.variation_type];return s.jsxs("tr",{onClick:()=>R(a),children:[s.jsx("td",{children:s.jsx("span",{className:"var-ref",children:a.variation_ref})}),s.jsxs("td",{children:[s.jsx("div",{className:"var-title",children:a.title}),a.description&&s.jsxs("div",{className:"var-title-sub",children:[a.description.substring(0,60),a.description.length>60?"...":""]})]}),s.jsx("td",{children:s.jsxs("span",{className:"var-type-badge",children:[z(a.variation_type),V?.label||a.variation_type]})}),s.jsx("td",{children:s.jsxs("span",{className:`var-status-badge ${w(a.status)}`,children:[s.jsx("span",{className:"var-status-dot"}),j?.label||a.status]})}),s.jsx("td",{children:s.jsx("span",{className:`var-impact ${a.total_cost_impact>=0?"positive":"negative"}`,children:a.total_cost_impact!==0?s.jsxs(s.Fragment,{children:[a.total_cost_impact>0?"+":"",p(a.total_cost_impact)]}):s.jsx("span",{className:"var-neutral",children:"—"})})}),s.jsx("td",{children:s.jsx("span",{className:`var-impact ${a.total_days_impact>=0?"positive":"negative"}`,children:a.total_days_impact!==0?s.jsxs(s.Fragment,{children:[a.total_days_impact>0?"+":"",a.total_days_impact," days"]}):s.jsx("span",{className:"var-neutral",children:"—"})})}),s.jsx("td",{children:s.jsx("span",{className:"var-milestone-count",children:a.milestone_count||0})}),s.jsx("td",{children:s.jsx("span",{className:"var-date",children:W(a.created_at)})})]},a.id)})})]})}),s.jsxs("div",{className:"var-info-box",children:[s.jsxs("div",{className:"var-info-header",children:[s.jsx(Y,{size:18}),"How Variations Work"]}),s.jsxs("ul",{className:"var-info-list",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Create:"})," Define the change, select affected milestones, and specify impacts"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Submit:"})," Send the variation for dual-signature approval"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Approve:"})," Both Supplier PM and Customer PM must sign to approve"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Apply:"})," Approved variations update milestone baselines automatically"]}),s.jsx("li",{children:"Click any variation row to view details or continue editing drafts"})]})]})]})]})}export{ls as default};
