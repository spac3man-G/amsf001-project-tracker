const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-ipvhnFqW.js","assets/vendor-react-JFEV0ROX.js","assets/vendor-icons-C_cLyTyv.js","assets/vendor-supabase-DgEUAXvv.js","assets/Milestones-BjnYVDZX.js","assets/usePermissions-Y7hRSoBg.js","assets/ConfirmDialog-Cc-bj3UD.js","assets/MilestoneDetail-BNe_qgyY.js","assets/Gantt-D3fNjn6P.js","assets/Deliverables-D9s9WITB.js","assets/Resources-26ZjJHtw.js","assets/ResourceDetail-BCayuzau.js","assets/Partners-CsgI1D8y.js","assets/PartnerDetail-BbY8krwj.js","assets/Timesheets-Cgsa1G7_.js","assets/Expenses-DlDQikEK.js","assets/KPIs-C0qVSboJ.js","assets/KPIDetail-Dbzcd2B1.js","assets/QualityStandards-Dg9J1lzk.js","assets/QualityStandardDetail-DvYoLRXq.js","assets/Reports-dNRSHMLj.js","assets/Users-vn7R_AD9.js","assets/Settings-CznuwEXd.js","assets/AccountSettings-BFSbEgIz.js","assets/WorkflowSummary-BLagldO9.js","assets/AuditLog-6OgHxO6_.js","assets/DeletedItems-B3k_qUGV.js"])))=>i.map(i=>d[i]);
var Rt=Object.defineProperty;var Dt=(n,r,t)=>r in n?Rt(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var we=(n,r,t)=>Dt(n,typeof r!="symbol"?r+"":r,t);import{r as d,a as Mt,R as Je,u as Te,b as kt,L as Q,c as Nt,B as At,d as Tt,e as z,N as Re,O as Lt}from"./vendor-react-JFEV0ROX.js";import{c as zt}from"./vendor-supabase-DgEUAXvv.js";import{A as Ze,R as De,L as et,I as Ot,X as Bt,C as qt,a as oe,M as Ut,S as $t,B as je,T as Wt,U as Ft,b as Vt,c as Pe,d as Ht,e as Kt,f as ue,F as tt,g as rt,h as ie,i as Gt,H as Qt,j as Yt,k as Xt,l as Jt,m as Zt,n as de,P as Me,o as er,G as tr,p as rr,q as sr,r as nr,s as ar,t as or,u as ir,K as lr,v as Ee,w as Ie,x as qe,D as cr,y as dr,z as ur}from"./vendor-icons-C_cLyTyv.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var st={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fr=d,mr=Symbol.for("react.element"),hr=Symbol.for("react.fragment"),pr=Object.prototype.hasOwnProperty,gr=fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yr={key:!0,ref:!0,__self:!0,__source:!0};function nt(n,r,t){var s,a={},o=null,i=null;t!==void 0&&(o=""+t),r.key!==void 0&&(o=""+r.key),r.ref!==void 0&&(i=r.ref);for(s in r)pr.call(r,s)&&!yr.hasOwnProperty(s)&&(a[s]=r[s]);if(n&&n.defaultProps)for(s in r=n.defaultProps,r)a[s]===void 0&&(a[s]=r[s]);return{$$typeof:mr,type:n,key:o,ref:i,props:a,_owner:gr.current}}he.Fragment=hr;he.jsx=nt;he.jsxs=nt;st.exports=he;var e=st.exports,ke={},Ue=Mt;ke.createRoot=Ue.createRoot,ke.hydrateRoot=Ue.hydrateRoot;const xr="modulepreload",br=function(n){return"/"+n},$e={},$=function(r,t,s){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=i?.nonce||i?.getAttribute("nonce");a=Promise.allSettled(t.map(m=>{if(m=br(m),m in $e)return;$e[m]=!0;const h=m.endsWith(".css"),b=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${b}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":xr,h||(p.as="script"),p.crossOrigin="",p.href=m,c&&p.setAttribute("nonce",c),document.head.appendChild(p),h)return new Promise((E,R)=>{p.addEventListener("load",E),p.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return a.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return r().catch(o)})};var We={},_r="@vercel/analytics",Sr="1.5.0",vr=()=>{window.va||(window.va=function(...r){(window.vaq=window.vaq||[]).push(r)})};function at(){return typeof window<"u"}function ot(){try{const n="production"}catch{}return"production"}function wr(n="auto"){if(n==="auto"){window.vam=ot();return}window.vam=n}function jr(){return(at()?window.vam:ot())||"production"}function Ne(){return jr()==="development"}function Pr(n){return n.scriptSrc?n.scriptSrc:Ne()?"https://va.vercel-scripts.com/v1/script.debug.js":n.basePath?`${n.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Er(n={debug:!0}){var r;if(!at())return;wr(n.mode),vr(),n.beforeSend&&((r=window.va)==null||r.call(window,"beforeSend",n.beforeSend));const t=Pr(n);if(document.head.querySelector(`script[src*="${t}"]`))return;const s=document.createElement("script");s.src=t,s.defer=!0,s.dataset.sdkn=_r+(n.framework?`/${n.framework}`:""),s.dataset.sdkv=Sr,n.disableAutoTrack&&(s.dataset.disableAutoTrack="1"),n.endpoint?s.dataset.endpoint=n.endpoint:n.basePath&&(s.dataset.endpoint=`${n.basePath}/insights`),n.dsn&&(s.dataset.dsn=n.dsn),s.onerror=()=>{const a=Ne()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information."},Ne()&&n.debug===!1&&(s.dataset.debug="false"),document.head.appendChild(s)}function Ir({route:n,path:r}){var t;(t=window.va)==null||t.call(window,"pageview",{route:n,path:r})}function Cr(){if(!(typeof process>"u"||typeof We>"u"))return We.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Rr(n){return d.useEffect(()=>{var r;n.beforeSend&&((r=window.va)==null||r.call(window,"beforeSend",n.beforeSend))},[n.beforeSend]),d.useEffect(()=>{Er({framework:n.framework||"react",basePath:n.basePath??Cr(),...n.route!==void 0&&{disableAutoTrack:!0},...n})},[]),d.useEffect(()=>{n.route&&n.path&&Ir({route:n.route,path:n.path})},[n.route,n.path]),null}var Fe={},Dr="@vercel/speed-insights",Mr="1.2.0",kr=()=>{window.si||(window.si=function(...r){(window.siq=window.siq||[]).push(r)})};function Nr(){return typeof window<"u"}function Ar(){try{const n="production"}catch{}return"production"}function it(){return Ar()==="development"}function Tr(n){return n.scriptSrc?n.scriptSrc:it()?"https://va.vercel-scripts.com/v1/speed-insights/script.debug.js":n.dsn?"https://va.vercel-scripts.com/v1/speed-insights/script.js":n.basePath?`${n.basePath}/speed-insights/script.js`:"/_vercel/speed-insights/script.js"}function Lr(n={}){var r;if(!Nr()||n.route===null)return null;kr();const t=Tr(n);if(document.head.querySelector(`script[src*="${t}"]`))return null;n.beforeSend&&((r=window.si)==null||r.call(window,"beforeSend",n.beforeSend));const s=document.createElement("script");return s.src=t,s.defer=!0,s.dataset.sdkn=Dr+(n.framework?`/${n.framework}`:""),s.dataset.sdkv=Mr,n.sampleRate&&(s.dataset.sampleRate=n.sampleRate.toString()),n.route&&(s.dataset.route=n.route),n.endpoint?s.dataset.endpoint=n.endpoint:n.basePath&&(s.dataset.endpoint=`${n.basePath}/speed-insights/vitals`),n.dsn&&(s.dataset.dsn=n.dsn),it()&&n.debug===!1&&(s.dataset.debug="false"),s.onerror=()=>{},document.head.appendChild(s),{setRoute:a=>{s.dataset.route=a??void 0}}}function zr(){if(!(typeof process>"u"||typeof Fe>"u"))return Fe.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Or(n){d.useEffect(()=>{var t;n.beforeSend&&((t=window.si)==null||t.call(window,"beforeSend",n.beforeSend))},[n.beforeSend]);const r=d.useRef(null);return d.useEffect(()=>{if(r.current)n.route&&r.current(n.route);else{const t=Lr({framework:n.framework??"react",basePath:n.basePath??zr(),...n});t&&(r.current=t.setRoute)}},[n.route]),null}const Br=void 0,qr=void 0;throw new Error("Missing Supabase environment variables");const f=zt(Br,qr),lt=d.createContext(null),Ur=60*1e3,$r=5*60*1e3;function Wr({children:n}){const[r,t]=d.useState(null),[s,a]=d.useState(null),[o,i]=d.useState(null),[c,m]=d.useState(!0),[h,b]=d.useState(null),[p,E]=d.useState(!1),R=d.useRef(null),B=d.useRef(Date.now()),S=d.useCallback(()=>{B.current=Date.now()},[]);async function N(g){if(!g){a(null),i(null);return}try{const{data:u,error:y}=await f.from("profiles").select("*").eq("id",g.id).single();if(y){b(y);return}a(u);const{data:D}=await f.from("resources").select("*").eq("user_id",g.id).maybeSingle();i(D),b(null)}catch(u){b(u)}}const L=d.useCallback(async()=>{try{const{data:{session:g},error:u}=await f.auth.getSession();if(u)return;if(!g){await W();return}const y=g.expires_at*1e3,D=Date.now(),x=y-D;if(x<=0)await W();else if(x<=$r){E(!0);const{data:I,error:T}=await f.auth.refreshSession();T||!I.session||E(!1)}else E(!1)}catch{}},[]);async function W(){t(null),a(null),i(null),E(!1),await f.auth.signOut();const g=window.location.pathname;g!=="/login"&&g!=="/register"&&(window.location.href="/login?expired=true")}const O=d.useCallback(()=>{R.current&&clearInterval(R.current),R.current=setInterval(()=>{L()},Ur);const g=()=>{document.visibilityState==="visible"&&L()};document.addEventListener("visibilitychange",g);const u=["mousedown","keydown","touchstart","scroll"];return u.forEach(y=>{document.addEventListener(y,S,{passive:!0})}),()=>{R.current&&clearInterval(R.current),document.removeEventListener("visibilitychange",g),u.forEach(y=>{document.removeEventListener(y,S)})}},[L,S]);d.useEffect(()=>{let g=!0,u=null;async function y(){try{const{data:{session:x},error:I}=await f.auth.getSession();I&&g&&b(I),g&&(t(x?.user??null),m(!1),x?.user&&(N(x.user),u=O()))}catch(x){g&&(b(x),m(!1))}}y();const{data:{subscription:D}}=f.auth.onAuthStateChange(async(x,I)=>{g&&(t(I?.user??null),m(!1),I?.user?(N(I.user),u&&u(),u=O()):(a(null),i(null),u&&(u(),u=null)),(x==="SIGNED_OUT"||x==="TOKEN_REFRESHED")&&E(!1))});return()=>{g=!1,D.unsubscribe(),u&&u()}},[O]);async function _(){try{await f.auth.signOut(),t(null),a(null),i(null),E(!1)}catch(g){b(g)}}async function w(){r&&await N(r)}async function C(){try{const{data:g,error:u}=await f.auth.refreshSession();return u?!1:g.session?(E(!1),!0):!1}catch{return!1}}const P={user:r,profile:s,role:s?.role||"viewer",linkedResource:o,isLoading:c,error:h,signOut:_,refreshUserData:w,refreshSession:C,isAuthenticated:!!r,sessionExpiring:p};return e.jsx(lt.Provider,{value:P,children:n})}function Le(){const n=d.useContext(lt);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n}const ct=d.createContext(null);function Fr({children:n}){const[r,t]=d.useState(null),[s,a]=d.useState(!0),[o,i]=d.useState(null);d.useEffect(()=>{let b=!0;async function p(){try{const{data:E,error:R}=await f.from("projects").select("*").eq("reference","AMSF001").single();R?b&&i(R):b&&(t(E),i(null))}catch(E){b&&i(E)}finally{b&&a(!1)}}return p(),()=>{b=!1}},[]);async function c(b){a(!0),i(null);try{const{data:p,error:E}=await f.from("projects").select("*").eq("reference",b).single();E?i(E):t(p)}catch(p){i(p)}finally{a(!1)}}async function m(){if(r)try{const{data:b,error:p}=await f.from("projects").select("*").eq("id",r.id).single();p?i(p):t(b)}catch(b){i(b)}}const h={currentProject:r,projectId:r?.id||null,projectRef:r?.reference||null,projectName:r?.name||null,isLoading:s,error:o,switchProject:c,refreshProject:m};return e.jsx(ct.Provider,{value:h,children:n})}function dt(){const n=d.useContext(ct);if(!n)throw new Error("useProject must be used within a ProjectProvider");return n}const ut=d.createContext();function Vr({children:n}){const[r,t]=d.useState(!1),[s,a]=d.useState(null),[o,i]=d.useState([]);d.useEffect(()=>{c(),m()},[]);async function c(){const{data:{user:S}}=await f.auth.getUser();if(S){const{data:N}=await f.from("profiles").select("role").eq("id",S.id).single();N&&a(N.role)}}async function m(){const{data:S}=await f.from("profiles").select("id").eq("is_test_user",!0);S&&i(S.map(N=>N.id))}const h=s==="admin"||s==="supplier_pm";function b(){h&&t(S=>!S)}function p(S){return o.includes(S)}function E(S,N="user_id"){return!S||r?S:S.filter(L=>!o.includes(L[N]))}function R(S){return!S||r?S:S.filter(N=>!N.is_test_content)}const B={showTestUsers:r,setShowTestUsers:t,toggleTestUsers:b,canToggleTestUsers:h,testUserIds:o,isTestUser:p,filterTestContent:E,filterByTestFlag:R,userRole:s};return e.jsx(ut.Provider,{value:B,children:n})}function Hr(){const n=d.useContext(ut);if(!n)throw new Error("useTestUsers must be used within a TestUserProvider");return n}const ft=d.createContext();function Kr(){return d.useContext(ft)}function Gr({children:n}){const[r,t]=d.useState([]),[s,a]=d.useState(0),[o,i]=d.useState(0),[c,m]=d.useState(!0),[h,b]=d.useState(null),[p,E]=d.useState(null),R=w=>["admin","supplier_pm","customer_pm"].includes(w),B=d.useCallback(async(w,C)=>{try{let P=[];if(R(C)){const{data:g}=await f.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:u}=await f.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:y}=await f.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:D}=await f.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");g&&g.forEach(x=>{P.push({id:`ts-${x.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${x.hours_worked||x.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),u&&u.forEach(x=>{const I=x.chargeable_to_customer!==!1;P.push({id:`exp-${x.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${x.resource_name||"Unknown"} expense (£${parseFloat(x.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:I})}),y&&y.forEach(x=>{P.push({id:`del-${x.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${x.deliverable_ref}: ${x.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),D&&D.forEach(x=>{P.push({id:`cert-${x.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:g}=await f.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",w),{data:u}=await f.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",w);g&&g.forEach(y=>{P.push({id:`ts-${y.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${y.hours_worked||y.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),u&&u.forEach(y=>{P.push({id:`exp-${y.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (£${parseFloat(y.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:P.length,items:P}}catch{return{count:0,items:[]}}},[]),S=d.useCallback(async()=>{try{const{data:{user:w}}=await f.auth.getUser();if(!w){t([]),a(0),i(0),m(!1);return}b(w.id);const{data:C}=await f.from("profiles").select("role").eq("id",w.id).single(),P=C?.role||"viewer";E(P);const{count:g,items:u}=await B(w.id,P);t(u),a(g),i(g)}catch{}finally{m(!1)}},[B]),N=d.useCallback(async w=>{t(C=>C.map(P=>P.id===w?{...P,is_read:!0}:P)),a(C=>Math.max(0,C-1))},[]),L=d.useCallback(async w=>{t(C=>C.map(P=>P.id===w?{...P,is_actioned:!0,is_read:!0}:P)),a(C=>Math.max(0,C-1)),i(C=>Math.max(0,C-1))},[]),W=d.useCallback(async()=>{t(w=>w.map(C=>({...C,is_read:!0}))),a(0)},[]),O=d.useCallback(async w=>{const C=r.find(P=>P.id===w);C&&(t(P=>P.filter(g=>g.id!==w)),C.is_read||a(P=>Math.max(0,P-1)),C.notification_type==="action"&&!C.is_actioned&&i(P=>Math.max(0,P-1)))},[r]);d.useEffect(()=>{S();const w=setInterval(()=>{S()},3e4);return()=>clearInterval(w)},[S]),d.useEffect(()=>{const{data:{subscription:w}}=f.auth.onAuthStateChange((C,P)=>{C==="SIGNED_IN"?S():C==="SIGNED_OUT"&&(t([]),a(0),i(0),b(null),E(null))});return()=>w.unsubscribe()},[S]);const _={notifications:r,unreadCount:s,actionCount:o,loading:c,fetchNotifications:S,markAsRead:N,markAsActioned:L,markAllAsRead:W,dismissNotification:O};return e.jsx(ft.Provider,{value:_,children:n})}const mt=d.createContext(null);function Qr({children:n}){const{user:r,profile:t,linkedResource:s,role:a}=Le(),{projectId:o,projectName:i,projectRef:c,currentProject:m}=dt(),[h,b]=d.useState(!1),[p,E]=d.useState([]),[R,B]=d.useState(!1),[S,N]=d.useState(null),L=d.useCallback(()=>m?{reference:c||m?.reference,name:i||m?.name,description:m?.description||null}:null,[m,c,i]),W=d.useCallback(()=>({name:t?.full_name||r?.email?.split("@")[0]||"User",email:r?.email,role:a||t?.role||"unknown",linkedResourceName:s?.name||null,linkedResourceId:s?.id||null}),[r,t,s,a]),O=d.useCallback(async()=>{if(!o)return null;const g=[];try{const{data:u}=await f.from("projects").select("name, code, total_budget, start_date, end_date").eq("id",o).single();u&&g.push(`Project: ${u.name} (${u.code})
Budget: £${u.total_budget?.toLocaleString()||0}
Timeline: ${u.start_date} to ${u.end_date}`);const{data:y}=await f.from("milestones").select("id, name, status, progress_percent, planned_end_date").eq("project_id",o).order("planned_end_date",{ascending:!0});if(y?.length>0){const x=y.filter(A=>A.status==="Completed").length,I=y.filter(A=>A.status==="In Progress").length,T=Math.round(y.reduce((A,K)=>A+(K.progress_percent||0),0)/y.length);g.push(`Milestones: ${y.length} total (${x} completed, ${I} in progress)
Average Progress: ${T}%`);const q=new Date().toISOString().split("T")[0],v=y.filter(A=>A.planned_end_date<q&&A.status!=="Completed");v.length>0&&g.push(`Overdue Milestones: ${v.map(A=>A.name).join(", ")}`)}const{data:D}=await f.from("deliverables").select("id, status").eq("project_id",o);if(D?.length>0){const x={};D.forEach(I=>{x[I.status]=(x[I.status]||0)+1}),g.push(`Deliverables: ${D.length} total
Status breakdown: ${Object.entries(x).map(([I,T])=>`${I}: ${T}`).join(", ")}`)}if(a==="admin"||a==="supplier_pm"){const{data:x}=await f.from("timesheets").select("hours_worked, status").eq("project_id",o);if(x?.length>0){const I=x.reduce((q,v)=>q+(v.hours_worked||0),0),T=x.filter(q=>q.status==="Submitted").length;g.push(`Timesheets: ${I.toFixed(1)} total hours logged
Pending approval: ${T} entries`)}}else if(s?.id){const{data:x}=await f.from("timesheets").select("hours_worked, status").eq("resource_id",s.id);if(x?.length>0){const I=x.reduce((T,q)=>T+(q.hours_worked||0),0);g.push(`Your Timesheets: ${I.toFixed(1)} hours logged`)}}if(a==="admin"||a==="supplier_pm"){const{data:x}=await f.from("expenses").select("amount, status, is_chargeable").eq("project_id",o);if(x?.length>0){const I=x.reduce((q,v)=>q+(v.amount||0),0),T=x.filter(q=>q.status==="Submitted").length;g.push(`Expenses: £${I.toLocaleString()} total claimed
Pending validation: ${T} entries`)}}if(a==="admin"||a==="supplier_pm"||a==="customer_pm"){const{data:x}=await f.from("resources").select("id, name, days_allocated, days_used").eq("project_id",o);if(x?.length>0){const I=x.reduce((T,q)=>T+(q.days_allocated||0),0);g.push(`Resources: ${x.length} team members
Total days allocated: ${I}`)}}return g.join(`

`)}catch{return null}},[o,a,s]),_=d.useCallback(async g=>{if(!g.trim()||R)return;const u={role:"user",content:g.trim()};E(y=>[...y,u]),B(!0),N(null);try{const y=L(),D=W(),x=await O(),I=[...p.slice(-9),u].map(v=>({role:v.role,content:v.content})),T=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:I,projectContext:y,userContext:D,dataContext:x})});if(!T.ok)throw new Error("Failed to get response");const q=await T.json();E(v=>[...v,{role:"assistant",content:q.message}])}catch{N("Failed to send message. Please try again."),E(D=>D.slice(0,-1))}finally{B(!1)}},[p,R,L,W,O]),w=d.useCallback(()=>{E([]),N(null)},[]),C=d.useCallback(()=>{b(g=>!g)},[]),P={isOpen:h,setIsOpen:b,toggleChat:C,messages:p,isLoading:R,error:S,sendMessage:_,clearChat:w};return e.jsx(mt.Provider,{value:P,children:n})}function Yr(){const n=d.useContext(mt);if(!n)throw new Error("useChat must be used within a ChatProvider");return n}class Xr extends Je.Component{constructor(t){super(t);we(this,"handleReload",()=>{window.location.reload()});we(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){this.setState({errorInfo:s})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[e.jsx(Ze,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),e.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),e.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),e.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[e.jsx(De,{size:16}),"Reload Page"]})]})]}):this.props.children}}function ze({message:n,size:r="medium",fullPage:t=!1}){const s={small:{icon:16,text:"0.75rem",padding:"0.5rem"},medium:{icon:24,text:"0.875rem",padding:"1.5rem"},large:{icon:40,text:"1rem",padding:"3rem"}},a=s[r]||s.medium,o={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:a.padding,...t&&{minHeight:"60vh"}},i={animation:"spin 1s linear infinite",color:"#3b82f6"},c={marginTop:"0.75rem",color:"#64748b",fontSize:a.text};return e.jsxs("div",{style:o,children:[e.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}),e.jsx(et,{size:a.icon,style:i}),n&&e.jsx("p",{style:c,children:n})]})}const Jr={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function H({width:n="100%",height:r="1rem",style:t={},className:s=""}){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),e.jsx("div",{className:s,style:{width:n,height:r,borderRadius:"4px",...Jr,...t}})]})}function Ae({width:n="100%",lines:r=1}){return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:r}).map((t,s)=>e.jsx(H,{width:s===r-1&&r>1?"70%":n,height:"1rem"},s))})}function Zr(){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(H,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx(H,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),e.jsx(H,{width:"40%",height:"1.5rem"})]})]})}function es({columns:n=6}){return e.jsx("tr",{children:Array.from({length:n}).map((r,t)=>e.jsx("td",{style:{padding:"0.75rem 1rem"},children:e.jsx(H,{width:t===0?"80%":t===n-1?"60px":"70%",height:"1rem"})},t))})}function Ce({hasHeader:n=!0}){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[n&&e.jsx(H,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),e.jsx(Ae,{lines:3})]})}function ae({type:n="text",count:r=1,...t}){return(()=>{switch(n){case"text":return e.jsx(Ae,{...t});case"stat-card":case"stats":return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:r}).map((a,o)=>e.jsx(Zr,{},o))});case"table":return e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:t.columns||6}).map((a,o)=>e.jsx("th",{style:{padding:"0.75rem 1rem"},children:e.jsx(H,{width:"60%",height:"0.875rem"})},o))})}),e.jsx("tbody",{children:Array.from({length:t.rows||5}).map((a,o)=>e.jsx(es,{columns:t.columns||6},o))})]})});case"card":return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:r}).map((a,o)=>e.jsx(Ce,{...t},o))});case"page":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(H,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),e.jsx(H,{width:"300px",height:"1rem"})]}),e.jsx(H,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),e.jsx(ae,{type:"stats",count:4}),e.jsx(ae,{type:"table",rows:8,columns:6})]});case"detail":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(H,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),e.jsx(H,{width:"250px",height:"1.75rem"})]}),e.jsx(ae,{type:"stats",count:4}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsx(Ce,{}),e.jsx(Ce,{})]}),e.jsx(ae,{type:"table",rows:5,columns:5})]});default:return e.jsx(Ae,{...t})}})()}function ce({icon:n,label:r,value:t,subtext:s,color:a="#3b82f6",borderColor:o,backgroundColor:i,style:c={},onClick:m}){const h={...o&&{borderLeft:`4px solid ${o}`},...i&&{backgroundColor:i},...m&&{cursor:"pointer"},...c};return e.jsxs("div",{className:"stat-card",style:h,onClick:m,role:m?"button":void 0,tabIndex:m?0:void 0,children:[e.jsxs("div",{className:"stat-label",children:[n&&e.jsx(n,{size:20,style:{color:a}}),r]}),e.jsx("div",{className:"stat-value",style:{color:a},children:t}),s&&e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:s})]})}function ts({icon:n,title:r,subtitle:t,children:s,style:a={}}){return e.jsxs("div",{className:"page-header",style:a,children:[e.jsxs("div",{className:"page-title",children:[n&&e.jsx(n,{size:28}),e.jsxs("div",{children:[e.jsx("h1",{children:r}),t&&e.jsx("p",{children:t})]})]}),s&&e.jsx("div",{className:"page-actions",children:s})]})}const Ve={Completed:{bg:"#dcfce7",color:"#16a34a"},"In Progress":{bg:"#dbeafe",color:"#2563eb"},"Not Started":{bg:"#f1f5f9",color:"#64748b"},Approved:{bg:"#dcfce7",color:"#16a34a"},Submitted:{bg:"#fef3c7",color:"#d97706"},Draft:{bg:"#f1f5f9",color:"#64748b"},Rejected:{bg:"#fee2e2",color:"#dc2626"},Validated:{bg:"#dcfce7",color:"#16a34a"},Delivered:{bg:"#dcfce7",color:"#16a34a"},"Under Review":{bg:"#fef3c7",color:"#d97706"},"Rework Required":{bg:"#fee2e2",color:"#dc2626"},Signed:{bg:"#dcfce7",color:"#16a34a"},"Pending Customer Signature":{bg:"#fef3c7",color:"#d97706"},"Pending Supplier Signature":{bg:"#dbeafe",color:"#2563eb"},High:{bg:"#fee2e2",color:"#dc2626"},Medium:{bg:"#fef3c7",color:"#d97706"},Low:{bg:"#dcfce7",color:"#16a34a"},Active:{bg:"#dcfce7",color:"#16a34a"},Inactive:{bg:"#f1f5f9",color:"#64748b"},Yes:{bg:"#dcfce7",color:"#16a34a"},No:{bg:"#f1f5f9",color:"#64748b"}};function rs({status:n,size:r="medium",customStyle:t,style:s={}}){if(!n)return null;const a=t||Ve[n]||Ve["Not Started"],o={small:{padding:"0.15rem 0.4rem",fontSize:"0.75rem"},medium:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},large:{padding:"0.35rem 0.75rem",fontSize:"0.95rem"}};return e.jsx("span",{style:{display:"inline-block",borderRadius:"4px",fontWeight:"500",whiteSpace:"nowrap",backgroundColor:a.bg,color:a.color,...o[r],...s},children:n})}const He={success:{icon:qt,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:Bt,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:Ze,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:Ot,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function ss({id:n,message:r,type:t="info",duration:s=4e3,onClose:a}){const o=He[t]||He.info,i=o.icon;return d.useEffect(()=>{if(s>0){const c=setTimeout(()=>{a(n)},s);return()=>clearTimeout(c)}},[n,s,a]),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:o.bgColor,border:`1px solid ${o.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[e.jsx(i,{size:20,style:{color:o.iconColor,flexShrink:0}}),e.jsx("span",{style:{color:o.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:r}),e.jsx("button",{onClick:()=>a(n),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:o.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:c=>c.target.style.opacity=1,onMouseLeave:c=>c.target.style.opacity=.7,children:e.jsx(oe,{size:16})})]})}function ns({toasts:n,removeToast:r}){return n.length===0?null:e.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),n.map(t=>e.jsx(ss,{id:t.id,message:t.message,type:t.type,duration:t.duration,onClose:r},t.id))]})}const ht=d.createContext(null),as=4e3;function os({children:n}){const[r,t]=d.useState([]),s=d.useCallback(b=>{t(p=>p.filter(E=>E.id!==b))},[]),a=d.useCallback((b,p="info",E=as)=>{const R=Date.now()+Math.random(),B={id:R,message:b,type:p,duration:E};return t(S=>[...S,B]),R},[]),o=d.useCallback((b,p)=>a(b,"success",p),[a]),i=d.useCallback((b,p)=>a(b,"error",p||6e3),[a]),c=d.useCallback((b,p)=>a(b,"warning",p),[a]),m=d.useCallback((b,p)=>a(b,"info",p),[a]),h={showToast:a,showSuccess:o,showError:i,showWarning:c,showInfo:m,removeToast:s};return e.jsxs(ht.Provider,{value:h,children:[n,e.jsx(ns,{toasts:r,removeToast:s})]})}function is(){const n=d.useContext(ht);if(!n)throw new Error("useToast must be used within a ToastProvider");return n}function ls(){const{isOpen:n,toggleChat:r,messages:t,isLoading:s,error:a,sendMessage:o,clearChat:i}=Yr(),[c,m]=d.useState(""),h=d.useRef(null),b=d.useRef(null);d.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[t]),d.useEffect(()=>{n&&setTimeout(()=>b.current?.focus(),100)},[n]);const p=S=>{S.preventDefault(),c.trim()&&!s&&(o(c),m(""))},E=S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),p(S))},R={role:"assistant",content:`Hello! I'm your AMSF001 Project Assistant. I can help you with:

• **Using the app** - How to navigate, submit timesheets, review deliverables, etc.
• **Your project data** - Ask about milestones, budgets, team utilization, and more
• **Your permissions** - What actions you can perform in your role

How can I help you today?`},B=t.length===0?[R]:t;return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`chat-toggle-btn ${n?"chat-open":""}`,onClick:r,"aria-label":n?"Close chat":"Open AI assistant",children:n?e.jsx(oe,{size:24}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{size:24}),e.jsx($t,{className:"chat-sparkle",size:12})]})}),e.jsxs("div",{className:`chat-panel ${n?"chat-panel-open":""}`,children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"chat-header-title",children:[e.jsx(je,{size:20}),e.jsx("span",{children:"Project Assistant"})]}),e.jsxs("div",{className:"chat-header-actions",children:[t.length>0&&e.jsx("button",{className:"chat-clear-btn",onClick:i,title:"Clear chat",children:e.jsx(Wt,{size:16})}),e.jsx("button",{className:"chat-close-btn",onClick:r,"aria-label":"Close chat",children:e.jsx(oe,{size:20})})]})]}),e.jsxs("div",{className:"chat-messages",children:[B.map((S,N)=>e.jsxs("div",{className:`chat-message ${S.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[e.jsx("div",{className:"chat-message-avatar",children:S.role==="user"?e.jsx(Ft,{size:16}):e.jsx(je,{size:16})}),e.jsx("div",{className:"chat-message-content",children:e.jsx(cs,{content:S.content})})]},N)),s&&e.jsxs("div",{className:"chat-message chat-message-assistant",children:[e.jsx("div",{className:"chat-message-avatar",children:e.jsx(je,{size:16})}),e.jsxs("div",{className:"chat-message-content chat-typing",children:[e.jsx(et,{className:"chat-typing-icon",size:16}),e.jsx("span",{children:"Thinking..."})]})]}),a&&e.jsx("div",{className:"chat-error",children:a}),e.jsx("div",{ref:h})]}),e.jsxs("form",{className:"chat-input-form",onSubmit:p,children:[e.jsx("textarea",{ref:b,className:"chat-input",value:c,onChange:S=>m(S.target.value),onKeyDown:E,placeholder:"Ask me anything about the project...",rows:1,disabled:s}),e.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!c.trim()||s,"aria-label":"Send message",children:e.jsx(Vt,{size:18})})]}),e.jsx("div",{className:"chat-footer",children:"Powered by Claude AI"})]})]})}function cs({content:n}){const r=n.split(`
`);return e.jsx("div",{className:"chat-message-text",children:r.map((t,s)=>{if(t.startsWith("• ")||t.startsWith("- ")){const a=t.substring(2);return e.jsxs("div",{className:"chat-bullet",children:[e.jsx("span",{className:"chat-bullet-dot",children:"•"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:Ke(a)}})]},s)}return t.trim()===""?e.jsx("div",{className:"chat-line-break"},s):e.jsx("p",{dangerouslySetInnerHTML:{__html:Ke(t)}},s)})})}function Ke(n){return n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function ds(){const[n,r]=d.useState(!1),t=d.useRef(null),s=Te(),{notifications:a,unreadCount:o,actionCount:i,loading:c,markAsRead:m,markAsActioned:h,markAllAsRead:b,dismissNotification:p}=Kr();d.useEffect(()=>{function _(w){t.current&&!t.current.contains(w.target)&&r(!1)}return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const E=_=>{switch(_){case"timesheet":return e.jsx(ie,{size:16});case"expense":return e.jsx(rt,{size:16});case"deliverable":return e.jsx(tt,{size:16});case"certificate":return e.jsx(ue,{size:16});default:return e.jsx(Pe,{size:16})}},R=_=>_.notification_type==="action"?_.is_actioned?"#10b981":"#f59e0b":"#3b82f6",B=async _=>{_.is_read||await m(_.id),_.action_url&&(s(_.action_url),r(!1))},S=async(_,w)=>{_.stopPropagation(),await h(w.id),w.action_url&&(s(w.action_url),r(!1))},N=async(_,w)=>{_.stopPropagation(),await p(w.id)},L=_=>{const w=new Date(_),P=new Date-w,g=Math.floor(P/6e4),u=Math.floor(P/36e5),y=Math.floor(P/864e5);return g<1?"Just now":g<60?`${g}m ago`:u<24?`${u}h ago`:y<7?`${y}d ago`:w.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},W=a.slice(0,10),O=a.filter(_=>_.notification_type==="action"&&!_.is_actioned);return e.jsxs("div",{className:"notification-bell-container",ref:t,style:{position:"relative"},children:[e.jsxs("button",{onClick:()=>r(!n),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:n?"#f1f5f9":"transparent"},onMouseEnter:_=>_.target.style.backgroundColor="#f1f5f9",onMouseLeave:_=>_.target.style.backgroundColor=n?"#f1f5f9":"transparent",title:`${i} actions pending`,children:[e.jsx(Pe,{size:22,color:"#64748b"}),(o>0||i>0)&&e.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:i>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:i>0?i:o})]}),n&&e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),i>0&&e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[i," action",i!==1?"s":""," required"]})]}),o>0&&e.jsx("button",{onClick:b,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),O.length>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),e.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),e.jsxs("button",{onClick:()=>{s("/workflow-summary"),r(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",e.jsx(Ht,{size:16})]})]}),e.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:c?e.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):W.length===0?e.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[e.jsx(Pe,{size:32,style:{marginBottom:"8px",opacity:.5}}),e.jsx("p",{style:{margin:0},children:"No notifications"})]}):W.map(_=>e.jsx("div",{onClick:()=>B(_),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:_.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:w=>w.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:w=>w.currentTarget.style.backgroundColor=_.is_read?"white":"#f8fafc",children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:_.notification_type==="action"&&!_.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:R(_),flexShrink:0},children:E(_.category)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[e.jsx("span",{style:{fontWeight:_.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:_.title}),e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:L(_.created_at)})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.message}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[_.notification_type==="action"&&!_.is_actioned&&_.action_label&&e.jsx("button",{onClick:w=>S(w,_),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:_.action_label}),_.notification_type==="info"&&e.jsxs("button",{onClick:w=>N(w,_),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(oe,{size:12}),"Dismiss"]}),_.is_actioned&&e.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Kt,{size:12}),"Completed"]})]})]})]})},_.id))}),a.length>10&&e.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:e.jsx("button",{onClick:()=>{s("/workflow-summary"),r(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const l={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"};function k(n,r){return r.includes(n)}function Fn(n){return k(n,[l.ADMIN,l.SUPPLIER_PM])}function pt(n){return k(n,[l.CONTRIBUTOR,l.SUPPLIER_PM,l.ADMIN])}function gt(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function us(n){return k(n,[l.CUSTOMER_PM,l.ADMIN])}function Vn(n,r,t,s){if(k(n,[l.ADMIN,l.SUPPLIER_PM]))return!0;let a,o,i;return typeof r=="object"&&r!==null?(a=r.status,o=r.created_by||r.resource?.user_id,i=t):(a=r,o=t,i=s),o===i&&(a==="Draft"||a==="Rejected")}function Hn(n,r,t,s){if(n===l.ADMIN||n===l.SUPPLIER_PM)return!0;let a,o,i;return typeof r=="object"&&r!==null?(a=r.status,o=r.created_by||r.resource?.user_id,i=t):(a=r,o=t,i=s),o===i&&a==="Draft"}function Kn(n,r,t,s){let a,o,i;return typeof r=="object"&&r!==null?(a=r.status,o=r.created_by||r.resource?.user_id,i=t):(a=r,o=t,i=s),a!=="Draft"&&a!=="Rejected"?!1:k(n,[l.ADMIN,l.SUPPLIER_PM])?!0:o===i&&pt(n)}function fs(n){return k(n,[l.CONTRIBUTOR,l.SUPPLIER_PM,l.ADMIN])}function ms(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Gn(n,r,t){let s,a;return typeof r=="object"&&r!==null?(s=r.status,a=r.chargeable||r.chargeable_to_customer):(s=r,a=t),s!=="Submitted"?!1:n===l.ADMIN?!0:a?n===l.CUSTOMER_PM:n===l.SUPPLIER_PM}function hs(n){return k(n,[l.CUSTOMER_PM,l.ADMIN])}function ps(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Qn(n,r,t,s){if(k(n,[l.ADMIN,l.SUPPLIER_PM]))return!0;let a,o,i;return typeof r=="object"&&r!==null?(a=r.status,o=r.created_by,i=t):(a=r,o=t,i=s),o===i&&(a==="Draft"||a==="Rejected")}function Yn(n,r,t,s){if(n===l.ADMIN||n===l.SUPPLIER_PM)return!0;let a,o,i;return typeof r=="object"&&r!==null?(a=r.status,o=r.created_by,i=t):(a=r,o=t,i=s),o===i&&a==="Draft"}function gs(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function ys(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function xs(n){return n===l.ADMIN}function bs(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function _s(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function Ss(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function Xn(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Jn(n,r,t){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])?!0:n===l.CONTRIBUTOR?r?.assigned_to===t||r?.resource?.user_id===t:!1}function vs(n){return k(n,[l.CUSTOMER_PM,l.ADMIN])}function Zn(n){return k(n,[l.CONTRIBUTOR,l.SUPPLIER_PM,l.ADMIN])}function pe(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function ea(n){return pe(n)}function ta(n){return pe(n)}function ra(n){return pe(n)}function ge(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function sa(n){return ge(n)}function na(n){return ge(n)}function aa(n){return ge(n)}function Oe(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function oa(n){return Oe(n)}function ia(n){return Oe(n)}function ws(n){return n===l.ADMIN}function js(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function la(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function yt(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Ps(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function ye(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function ca(n){return ye(n)}function da(n){return ye(n)}function ua(n){return ye(n)}function Es(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Is(n){return k(n,[l.CUSTOMER_PM,l.ADMIN])}function fa(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function Cs(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function ma(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Rs(n){return n===l.ADMIN}function ha(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function Ds(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function Ms(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function ks(n){return k(n,[l.SUPPLIER_PM,l.ADMIN])}function pa(n){return yt(n)}function ga(n){return k(n,[l.CUSTOMER_PM,l.SUPPLIER_PM,l.ADMIN])}function Ns(n,r,t){return!r||!Array.isArray(r)?[]:gt(n)?r:r.filter(s=>s.user_id===t)}function ya(n,r){return!n||!Array.isArray(n)?null:n.find(t=>t.user_id===r)||null}function As(n,r,t){const s=Ns(n,r,t);return s.length===0?null:s.find(o=>o.user_id===t)||s[0]}function xa(n,r,t){return As(n,r,t)?.id||null}function Ts(n){const r={admin:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},supplier_pm:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},customer_pm:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},contributor:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},viewer:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}};return r[n]||r.viewer}function Ls(n){return Ts(n).label}const ba=[{value:"viewer",label:"Viewer",color:"#64748b",bg:"#f1f5f9"},{value:"contributor",label:"Contributor",color:"#2563eb",bg:"#dbeafe"},{value:"customer_pm",label:"Customer PM",color:"#d97706",bg:"#fef3c7"},{value:"supplier_pm",label:"Supplier PM",color:"#059669",bg:"#d1fae5"},{value:"admin",label:"Admin",color:"#7c3aed",bg:"#f3e8ff"}];function _a(n){return{role:n,roleLabel:Ls(n),timesheets:{canAdd:pt(n),canAddForOthers:gt(n),canApprove:us(n)},expenses:{canAdd:fs(n),canAddForOthers:ms(n),canValidateChargeable:hs(n),canValidateNonChargeable:ps(n)},milestones:{canCreate:gs(n),canEdit:ys(n),canDelete:xs(n),canUseGantt:bs(n)},deliverables:{canCreate:_s(n),canEdit:Ss(n),canReview:vs(n)},kpis:{canManage:pe(n)},qualityStandards:{canManage:ge(n)},resources:{canManage:Oe(n),canDelete:ws(n),canSeeCostPrice:js(n),canSeeMargins:yt(n)},partners:{canView:Ps(n),canManage:ye(n)},certificates:{canSignAsSupplier:Es(n),canSignAsCustomer:Is(n)},admin:{canAccessSettings:Cs(n),canManageUsers:Rs(n),canViewWorkflowSummary:Ds(n)},invoicing:{canGenerateCustomerInvoice:Ms(n),canGenerateThirdPartyInvoice:ks(n)}}}const xe={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:sr,label:"Workflow Summary",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:rr,label:"Dashboard",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.VIEWER],readOnlyRoles:[l.VIEWER]},reports:{id:"reports",path:"/reports",icon:tt,label:"Reports",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:tr,label:"Gantt Chart",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.VIEWER],readOnlyRoles:[l.VIEWER,l.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:er,label:"Milestones",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.VIEWER],readOnlyRoles:[l.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:Me,label:"Deliverables",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.CONTRIBUTOR,l.VIEWER],readOnlyRoles:[l.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:de,label:"KPIs",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.VIEWER],readOnlyRoles:[l.VIEWER,l.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:ue,label:"Quality Standards",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.VIEWER],readOnlyRoles:[l.VIEWER,l.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:Zt,label:"Resources",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:ie,label:"Timesheets",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:rt,label:"Expenses",allowedRoles:[l.ADMIN,l.SUPPLIER_PM,l.CUSTOMER_PM,l.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:Jt,label:"Partners",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:Xt,label:"Users",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[l.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:Yt,label:"Settings",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[]},auditLog:{id:"auditLog",path:"/audit-log",icon:Qt,label:"Audit Log",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[]},deletedItems:{id:"deletedItems",path:"/deleted-items",icon:Gt,label:"Deleted Items",allowedRoles:[l.ADMIN,l.SUPPLIER_PM],readOnlyRoles:[]}},fe={[l.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[l.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[l.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[l.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[l.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function zs(n){return(fe[n]||fe[l.VIEWER]).map(t=>xe[t]?.path).filter(Boolean)}function xt(n){return(fe[n]||fe[l.VIEWER]).map(t=>xe[t]).filter(t=>t&&t.allowedRoles.includes(n))}function Ge(n,r){const t=xe[r];return t?t.readOnlyRoles?.includes(n)||!1:!0}function Os(n){return n!==l.VIEWER}function Bs(n){return Object.values(xe).find(r=>r.path===n)||null}function qs(n){return Bs(n)?.id||null}function Us(n,r){const t=xt(n);if(!r||!Array.isArray(r)||r.length===0)return t;const s={};t.forEach(o=>{s[o.path]=o});const a=[];return r.forEach(o=>{s[o]&&(a.push(s[o]),delete s[o])}),Object.values(s).forEach(o=>{a.push(o)}),a}function $s(n,r){if(!r||r.length===0)return!0;const t=zs(n);return r.length!==t.length?!1:r.every((s,a)=>s===t[a])}const Qe={[l.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[l.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[l.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[l.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[l.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function Ws(n){return Qe[n]||Qe[l.VIEWER]}function Fs({children:n}){const r=kt(),t=Te(),{showSuccess:s,showError:a}=is(),{user:o,profile:i,role:c,signOut:m}=Le(),[h,b]=d.useState(!0),[p,E]=d.useState(null),[R,B]=d.useState(null),[S,N]=d.useState(null),L=d.useRef(null),W=d.useMemo(()=>Ws(c),[c]),O=d.useMemo(()=>i&&(i.full_name||i.email||o?.email)||"User",[i,o]),_=d.useMemo(()=>{if(!i)return"U";if(i.full_name){const v=i.full_name.split(" ");return v.length>=2?v[0][0]+v[v.length-1][0]:i.full_name[0].toUpperCase()}return O[0].toUpperCase()},[i,O]);d.useEffect(()=>{i?.nav_order&&Array.isArray(i.nav_order)&&E(i.nav_order)},[i]);async function w(){await m(),t("/login")}const C=d.useMemo(()=>Os(c),[c]),P=d.useMemo(()=>p&&!$s(c,p),[c,p]),g=d.useMemo(()=>{const v=xt(c);return p&&p.length>0?Us(c,p):v},[c,p]),u=d.useMemo(()=>{const v=qs(r.pathname);return v?Ge(c,v):!1},[c,r.pathname]);function y(v,A){C&&(L.current=v.target,B(A),setTimeout(()=>{L.current&&(L.current.style.opacity="0.5")},0))}function D(v,A){C&&A!==R&&N(A)}function x(v){C&&v.preventDefault()}function I(){if(C){if(L.current&&(L.current.style.opacity="1"),R!==null&&S!==null&&R!==S){const v=[...g],A=v[R];v.splice(R,1),v.splice(S,0,A);const K=v.map(G=>G.path);E(K),T(K)}B(null),N(null),L.current=null}}async function T(v){if(o)try{const{error:A}=await f.from("profiles").update({nav_order:v}).eq("id",o.id);A&&a("Failed to save menu order")}catch{a("Failed to save menu order")}}async function q(){if(o)try{const{error:v}=await f.from("profiles").update({nav_order:null}).eq("id",o.id);if(v){a("Failed to reset menu order");return}E(null),s("Menu order reset to default")}catch{a("Failed to reset menu order")}}return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[e.jsxs("aside",{style:{width:h?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[h&&e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),e.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),e.jsx("button",{onClick:()=>b(!h),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:h?e.jsx(oe,{size:20}):e.jsx(nr,{size:20})})]}),e.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:g.map((v,A)=>{const K=v.icon,G=r.pathname===v.path||v.path!=="/dashboard"&&r.pathname.startsWith(v.path),J=R===A,X=S===A,Z=Ge(c,v.id);return e.jsx("div",{draggable:C,onDragStart:j=>y(j,A),onDragEnter:j=>D(j,A),onDragOver:x,onDragEnd:I,style:{position:"relative",marginBottom:"0.25rem",borderTop:X&&R>A?"2px solid #10b981":"2px solid transparent",borderBottom:X&&R<A?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:e.jsxs(Q,{to:v.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:h?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:G?"#10b981":"#64748b",backgroundColor:G?"#f0fdf4":J?"#f1f5f9":"transparent",fontWeight:G?"600":"500",justifyContent:h?"flex-start":"center",transition:"all 0.15s ease",cursor:C?"grab":"pointer"},children:[h&&C&&e.jsx(ar,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),e.jsx(K,{size:20}),h&&e.jsx("span",{style:{flex:1},children:v.label}),h&&Z&&e.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},v.path)})}),h&&C&&P&&e.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:e.jsxs("button",{onClick:q,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:v=>{v.currentTarget.style.backgroundColor="#f1f5f9",v.currentTarget.style.color="#475569"},onMouseLeave:v=>{v.currentTarget.style.backgroundColor="#f8fafc",v.currentTarget.style.color="#64748b"},children:[e.jsx(or,{size:14}),"Reset Menu Order"]})}),e.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:e.jsxs("button",{onClick:w,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:h?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[e.jsx(ir,{size:20}),h&&e.jsx("span",{children:"Logout"})]})})]}),e.jsxs("main",{style:{flex:1,marginLeft:h?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[e.jsxs(Q,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:v=>v.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:v=>v.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:O}),e.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:W.bg,color:W.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:W.shortLabel})]}),e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:W.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:_})]}),e.jsx(ds,{})]}),u&&e.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e.jsx("span",{children:"You have read-only access to this page"})]}),e.jsx("div",{style:{flex:1},children:n})]})]})}function Vs(){const n=Te(),[r]=Nt(),[t,s]=d.useState(!1),[a,o]=d.useState(""),[i,c]=d.useState(""),[m,h]=d.useState(null),[b,p]=d.useState(null),[E,R]=d.useState(!1),[B,S]=d.useState(!1),[N,L]=d.useState(!1),[W,O]=d.useState(!1);d.useEffect(()=>{r.get("expired")==="true"&&(O(!0),window.history.replaceState({},document.title,"/login")),f.auth.getSession().then(({data:{session:u}})=>{u&&n("/dashboard",{replace:!0})});const{data:{subscription:g}}=f.auth.onAuthStateChange((u,y)=>{u==="SIGNED_IN"&&y&&n("/dashboard",{replace:!0})});return()=>g.unsubscribe()},[n,r]);const _=async g=>{g.preventDefault(),s(!0),h(null),p(null),O(!1);try{if(E){const{error:u}=await f.auth.signUp({email:a,password:i,options:{data:{full_name:a.split("@")[0]}}});if(u)throw u;p("Check your email for confirmation link!")}else{const{error:u}=await f.auth.signInWithPassword({email:a,password:i});if(u)throw u}}catch(u){h(u.message)}finally{s(!1)}},w=async g=>{if(g.preventDefault(),!a){h("Please enter your email address");return}s(!0),h(null),p(null);try{const{error:u}=await f.auth.resetPasswordForEmail(a,{redirectTo:`${window.location.origin}/reset-password`});if(u)throw u;p("Password reset email sent! Check your inbox.")}catch(u){h(u.message)}finally{s(!1)}},C=async g=>{if(g.preventDefault(),!a){h("Please enter your email address");return}s(!0),h(null),p(null);try{const{error:u}=await f.auth.resend({type:"signup",email:a});if(u)throw u;p("Verification email resent! Check your inbox.")}catch(u){h(u.message)}finally{s(!1)}},P=()=>{S(!1),L(!1),h(null),p(null),O(!1)};return B?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(lr,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Reset Password"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:g=>o(g.target.value),required:!0})]}),m&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:m})]}),b&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ie,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:b})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Send Reset Link"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:P,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):N?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(De,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Resend Verification"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:g=>o(g.target.value),required:!0})]}),m&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:m})]}),b&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ie,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:b})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Resend Verification Email"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:P,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),e.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),W&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[e.jsx(ie,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:g=>o(g.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"••••••••",value:i,onChange:g=>c(g.target.value),required:!0})]}),m&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:m})]}),b&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ie,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:b})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Loading...":E?"Sign Up":"Sign In"})]}),!E&&e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{S(!0),h(null),p(null),O(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{R(!E),h(null),p(null),O(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:E?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),e.jsxs("button",{onClick:()=>{L(!0),h(null),p(null),O(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(De,{size:14})," Resend Verification Email"]})]})]})})}const Hs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ks(n){return n==null?"":typeof n!="string"?String(n):n.replace(/[&<>"'`=\/]/g,r=>Hs[r])}function Be(n,r={}){const{maxLength:t=1e4,trim:s=!0,normalizeWhitespace:a=!0}=r;if(n==null)return"";typeof n!="string"&&(n=String(n));let o=n;return o=o.replace(/\0/g,""),o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),s&&(o=o.trim()),a&&(o=o.replace(/[ \t]+/g," ")),o.length>t&&(o=o.substring(0,t)),o}function me(n,r=255){return n==null?"":(typeof n!="string"&&(n=String(n)),Be(n,{maxLength:r}).replace(/[\r\n]/g," ").replace(/\s+/g," ").trim())}function bt(n,r=1e4){return n==null?"":(typeof n!="string"&&(n=String(n)),Be(n,{maxLength:r,normalizeWhitespace:!1}).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`).trim())}function _t(n){return n?me(n,254).toLowerCase():""}function be(n,r={}){const{min:t=-1/0,max:s=1/0,decimals:a=2}=r;if(n==null||n==="")return null;let o=String(n).replace(/[^0-9.\-]/g,""),i=parseFloat(o);return isNaN(i)?null:(i=Math.max(t,Math.min(s,i)),i=Math.round(i*Math.pow(10,a))/Math.pow(10,a),i)}function Gs(n){const r=be(n,{min:0,decimals:2});return r!==null?Math.round(r*100)/100:null}function Qs(n){const r=be(n,{min:0,max:24,decimals:1});return r===null?null:Math.round(r*2)/2}function Ys(n){return be(n,{min:0,max:100,decimals:1})}function Xs(n){if(!n)return null;const r=String(n).trim();return/^(javascript|data|vbscript):/i.test(r)?null:/^(https?:\/\/|\/|#)/i.test(r)?r:`https://${r}`}function Js(n,r={}){if(!n||typeof n!="object")return n;const t={...n};for(const[s,a]of Object.entries(r)){if(t[s]===void 0)continue;const{type:o="text",maxLength:i}=a;switch(o){case"singleLine":t[s]=me(t[s],i);break;case"multiLine":t[s]=bt(t[s],i);break;case"email":t[s]=_t(t[s]);break;case"number":t[s]=be(t[s],a);break;case"currency":t[s]=Gs(t[s]);break;case"hours":t[s]=Qs(t[s]);break;case"percentage":t[s]=Ys(t[s]);break;case"url":t[s]=Xs(t[s]);break;case"html":t[s]=Ks(t[s]);break;default:t[s]=Be(t[s],{maxLength:i})}}return t}const Zs={timesheet:{description:{type:"multiLine",maxLength:2e3},hours_worked:{type:"hours"}},expense:{reason:{type:"multiLine",maxLength:2e3},amount:{type:"currency"}},resource:{name:{type:"singleLine",maxLength:100},email:{type:"email"},role:{type:"singleLine",maxLength:100},notes:{type:"multiLine",maxLength:5e3}},partner:{name:{type:"singleLine",maxLength:200},contact_name:{type:"singleLine",maxLength:100},contact_email:{type:"email"},notes:{type:"multiLine",maxLength:5e3}},milestone:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},deliverable:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},kpi:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"number",decimals:2},actual_value:{type:"number",decimals:2}},qualityStandard:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"percentage"}}};function Ye(n,r){const t=Zs[n];return t?Js(r,t):r}class Y{constructor(r,t={}){this.tableName=r,this.supportsSoftDelete=t.supportsSoftDelete!==!1,this.sanitizeConfig=t.sanitizeConfig||null}getSoftDeleteFilter(){return this.supportsSoftDelete?"is_deleted.is.null,is_deleted.eq.false":null}async getAll(r,t={}){try{let s=f.from(this.tableName).select(t.select||"*").eq("project_id",r);this.supportsSoftDelete&&!t.includeDeleted&&(s=s.or(this.getSoftDeleteFilter())),t.filters&&Array.isArray(t.filters)&&t.filters.forEach(i=>{const{column:c,operator:m,value:h}=i;switch(m){case"eq":s=s.eq(c,h);break;case"neq":s=s.neq(c,h);break;case"gt":s=s.gt(c,h);break;case"gte":s=s.gte(c,h);break;case"lt":s=s.lt(c,h);break;case"lte":s=s.lte(c,h);break;case"like":s=s.like(c,h);break;case"ilike":s=s.ilike(c,h);break;case"in":s=s.in(c,h);break;case"is":s=s.is(c,h);break;default:s=s.eq(c,h)}}),t.orderBy&&(s=s.order(t.orderBy.column,{ascending:t.orderBy.ascending??!0}));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getDeleted(r){if(!this.supportsSoftDelete)return[];try{const{data:t,error:s}=await f.from(this.tableName).select("*").eq("project_id",r).eq("is_deleted",!0).order("deleted_at",{ascending:!1});if(s)throw s;return t||[]}catch(t){throw t}}async getById(r,t={}){try{let s=f.from(this.tableName).select(t.select||"*").eq("id",r);this.supportsSoftDelete&&!t.includeDeleted&&(s=s.or(this.getSoftDeleteFilter()));const{data:a,error:o}=await s.single();if(o){if(o.code==="PGRST116")return null;throw o}return a}catch(s){throw s}}async create(r){try{if(!r.project_id)throw new Error("project_id is required");let t=r;this.sanitizeConfig&&(t=Ye(this.sanitizeConfig,r)),this.supportsSoftDelete&&(delete t.is_deleted,delete t.deleted_at,delete t.deleted_by);const{data:s,error:a}=await f.from(this.tableName).insert(t).select().single();if(a)throw a;return s}catch(t){throw t}}async update(r,t){try{let s=t;this.sanitizeConfig&&(s=Ye(this.sanitizeConfig,t));const a={...s,updated_at:new Date().toISOString()};delete a.is_deleted,delete a.deleted_at,delete a.deleted_by;const{data:o,error:i}=await f.from(this.tableName).update(a).eq("id",r).select().single();if(i)throw i;return o}catch(s){throw s}}async delete(r,t=null){try{if(this.supportsSoftDelete){const{error:s}=await f.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",r);if(s)throw s}else{const{error:s}=await f.from(this.tableName).delete().eq("id",r);if(s)throw s}return!0}catch(s){throw s}}async hardDelete(r){try{const{error:t}=await f.from(this.tableName).delete().eq("id",r);if(t)throw t;return!0}catch(t){throw t}}async restore(r){if(!this.supportsSoftDelete)throw new Error("This entity does not support soft delete");try{const{data:t,error:s}=await f.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",r).select().single();if(s)throw s;return t}catch(t){throw t}}async exists(r){try{let t=f.from(this.tableName).select("id",{count:"exact",head:!0}).eq("id",r);this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{count:s,error:a}=await t;if(a)throw a;return s>0}catch(t){throw t}}async count(r,t=[]){try{let s=f.from(this.tableName).select("id",{count:"exact",head:!0}).eq("project_id",r);this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter())),t.forEach(i=>{const{column:c,operator:m,value:h}=i;m==="eq"?s=s.eq(c,h):m==="in"&&(s=s.in(c,h))});const{count:a,error:o}=await s;if(o)throw o;return a||0}catch(s){throw s}}}class en extends Y{constructor(){super("partners")}async getAll(r){return super.getAll(r,{orderBy:{column:"name",ascending:!0}})}async getActive(r){return super.getAll(r,{filters:[{column:"is_active",operator:"eq",value:!0}],orderBy:{column:"name",ascending:!0}})}async getWithResources(r){try{const{data:t,error:s}=await f.from("partners").select(`
          *,
          resources (
            id,
            name,
            daily_rate,
            cost_price,
            is_active
          )
        `).eq("id",r).single();if(s){if(s.code==="PGRST116")return null;throw s}return t}catch(t){throw t}}async getSummary(r){try{const{data:t,error:s}=await f.from("partners").select(`
          id,
          name,
          contact_name,
          contact_email,
          payment_terms,
          is_active,
          created_at
        `).eq("project_id",r).order("name",{ascending:!0});if(s)throw s;return t||[]}catch(t){throw t}}async create(r){if(!r.name?.trim())throw new Error("Partner name is required");if(await this.findByName(r.project_id,r.name))throw new Error(`Partner "${r.name}" already exists`);return super.create({...r,name:r.name.trim(),is_active:r.is_active??!0,payment_terms:r.payment_terms||"Net 30"})}async findByName(r,t){try{const{data:s,error:a}=await f.from("partners").select("*").eq("project_id",r).ilike("name",t.trim()).single();if(a){if(a.code==="PGRST116")return null;throw a}return s}catch(s){if(s.code==="PGRST116")return null;throw s}}async toggleActive(r){const t=await this.getById(r);if(!t)throw new Error("Partner not found");return this.update(r,{is_active:!t.is_active})}async getForSelect(r,t=!0){return(t?await this.getActive(r):await this.getAll(r)).map(a=>({value:a.id,label:a.name}))}}const Sa=new en;class tn extends Y{constructor(){super("resources",{sanitizeConfig:"resource",supportsSoftDelete:!0})}sanitizeData(r){const t={...r};return t.name&&(t.name=me(t.name,100)),t.role&&(t.role=me(t.role,100)),t.email&&(t.email=_t(t.email)),t.notes&&(t.notes=bt(t.notes,5e3)),t}async getAll(r,t={}){const{includePartner:s=!0,activeOnly:a=!1,showTestUsers:o=!0,includeDeleted:i=!1}=t;let c="*";s&&(c="*, partner:partners(id, name, is_active)");let m=f.from(this.tableName).select(c).eq("project_id",r).order("name");i||(m=m.or("is_deleted.is.null,is_deleted.eq.false")),a&&(m=m.eq("is_active",!0)),o||(m=m.or("is_test_content.is.null,is_test_content.eq.false"));const{data:h,error:b}=await m;if(b)throw b;return h||[]}async getAllFiltered(r,t=!0){return this.getAll(r,{showTestUsers:t,includePartner:!0})}async getById(r){const{data:t,error:s}=await f.from(this.tableName).select("*, partner:partners(id, name, contact_name, contact_email, is_active)").eq("id",r).or("is_deleted.is.null,is_deleted.eq.false").single();if(s)throw s;return t}async getByType(r,t){const{data:s,error:a}=await f.from(this.tableName).select("*, partner:partners(id, name)").eq("project_id",r).eq("resource_type",t).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(a)throw a;return s||[]}async getByPartner(r){const{data:t,error:s}=await f.from(this.tableName).select("*").eq("partner_id",r).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(s)throw s;return t||[]}async getWithTimesheetSummary(r){const t=await this.getById(r);if(!t)return null;const{data:s,error:a}=await f.from("timesheets").select("id, hours_worked, hours, status, was_rejected, date").eq("resource_id",r).or("is_deleted.is.null,is_deleted.eq.false");let o=0,i=0,c=0;return s&&s.forEach(m=>{const h=parseFloat(m.hours_worked||m.hours||0);o+=h,m.status==="Approved"?i+=h:m.status==="Submitted"&&!m.was_rejected&&(c+=h)}),{...t,timesheetSummary:{totalEntries:s?.length||0,totalHours:o,approvedHours:i,pendingHours:c,daysWorked:o/8}}}async create(r){const t=this.sanitizeData(r);if(!t.name?.trim())throw new Error("Resource name is required");if(!t.project_id)throw new Error("Project ID is required");if(!t.email?.trim())throw new Error("Email is required");t.resource_type==="internal"&&(t.partner_id=null);const{data:s,error:a}=await f.from(this.tableName).insert([t]).select("*, partner:partners(id, name)").single();if(a)throw a;return s}async update(r,t){const s=this.sanitizeData(t);s.resource_type==="internal"&&(s.partner_id=null),s.updated_at=new Date().toISOString();const{data:a,error:o}=await f.from(this.tableName).update(s).eq("id",r).select("*, partner:partners(id, name)").single();if(o)throw o;return a}async delete(r,t=null){const{data:s,error:a}=await f.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",r).select().single();if(a)throw a;return s}async restore(r){const{data:t,error:s}=await f.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",r).select().single();if(s)throw s;return t}async linkToPartner(r,t){const s={partner_id:t,resource_type:t?"third_party":"internal",updated_at:new Date().toISOString()};return this.update(r,s)}async toggleActive(r){const t=await this.getById(r);if(!t)throw new Error("Resource not found");return this.update(r,{is_active:!t.is_active})}async getForSelect(r){const{data:t,error:s}=await f.from(this.tableName).select("id, name, resource_type, role").eq("project_id",r).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(s)throw s;return t||[]}calculateMargin(r,t){if(!r||r===0||!t)return{percent:null,amount:null,status:"unknown"};const s=(r-t)/r*100,a=r-t;let o="critical";return s>=25?o="good":s>=10&&(o="low"),{percent:s,amount:a,status:o}}async getUtilization(r){const t=await this.getWithTimesheetSummary(r);if(!t)return null;const s=t.days_allocated||0,a=t.timesheetSummary.daysWorked,o=Math.max(0,s-a),i=s>0?a/s*100:0;return{resourceId:r,resourceName:t.name,daysAllocated:s,daysUsed:a,remaining:o,utilizationPercent:i,totalValue:(t.daily_rate||0)*s,valueUsed:(t.daily_rate||0)*a}}async getSummary(r){const t=await this.getAll(r,{includePartner:!1});return{total:t.length,internal:t.filter(s=>s.resource_type==="internal").length,thirdParty:t.filter(s=>s.resource_type==="third_party").length,active:t.filter(s=>s.is_active).length,totalBudget:t.reduce((s,a)=>s+(a.daily_rate||0)*(a.days_allocated||0),0)}}}const va=new tn;class rn extends Y{constructor(){super("timesheets",{supportsSoftDelete:!0,sanitizeConfig:"timesheet"})}async getAll(r,t={}){return super.getAll(r,{...t,select:t.select||`
      *,
      resources(id, name, email, daily_rate, cost_price),
      milestones(id, milestone_ref, name)
    `,orderBy:t.orderBy||{column:"date",ascending:!1}})}async getAllFiltered(r,t=!1){try{let s=f.from(this.tableName).select(`
          *,
          resources(id, name, email, daily_rate, cost_price),
          milestones(id, milestone_ref, name)
        `).eq("project_id",r).order("date",{ascending:!1});this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter())),t||(s=s.or("is_test_content.is.null,is_test_content.eq.false"));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getByResource(r,t={}){try{let s=f.from(this.tableName).select("*, milestones(id, milestone_ref, name)").eq("resource_id",r).order("date",{ascending:!1});this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter())),t.start&&(s=s.gte("date",t.start)),t.end&&(s=s.lte("date",t.end)),t.status&&(s=s.eq("status",t.status));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getByPartner(r,t={}){try{const{data:s}=await f.from("resources").select("id, name, cost_price").eq("partner_id",r).or("is_deleted.is.null,is_deleted.eq.false");if(!s||s.length===0)return[];const a=s.map(m=>m.id);let o=f.from(this.tableName).select("*, resources(id, name, cost_price), milestones(id, milestone_ref, name)").in("resource_id",a).order("date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("date",t.start)),t.end&&(o=o.lte("date",t.end)),t.status&&(o=o.eq("status",t.status));const{data:i,error:c}=await o;if(c)throw c;return i||[]}catch(s){throw s}}async getApprovedForInvoice(r,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(r,{...t,status:"Approved"})}async getSummary(r,t={}){try{const s=await this.getAll(r,t),a={totalHours:0,totalDays:0,approvedHours:0,pendingHours:0,draftHours:0,rejectedHours:0,totalCost:0,approvedCost:0,byStatus:{Draft:{count:0,hours:0},Submitted:{count:0,hours:0},Approved:{count:0,hours:0},Rejected:{count:0,hours:0}},byMilestone:{},count:s.length};return s.forEach(o=>{const i=parseFloat(o.hours_worked||o.hours||0),c=o.resources?.cost_price||0,m=i/8*c;switch(a.totalHours+=i,a.totalCost+=m,a.byStatus[o.status]&&(a.byStatus[o.status].count++,a.byStatus[o.status].hours+=i),o.status){case"Approved":a.approvedHours+=i,a.approvedCost+=m;break;case"Submitted":o.was_rejected||(a.pendingHours+=i);break;case"Draft":a.draftHours+=i;break;case"Rejected":a.rejectedHours+=i;break}if(o.milestone_id){const h=o.milestones?.milestone_ref||"Unknown";a.byMilestone[o.milestone_id]||(a.byMilestone[o.milestone_id]={ref:h,name:o.milestones?.name||"Unknown",hours:0,cost:0}),a.byMilestone[o.milestone_id].hours+=i,a.byMilestone[o.milestone_id].cost+=m}}),a.totalDays=a.totalHours/8,a}catch(s){throw s}}async create(r){if(!r.resource_id)throw new Error("resource_id is required");if(!r.date)throw new Error("date is required");const t=parseFloat(r.hours_worked||r.hours||0);if(!t||t<=0)throw new Error("hours must be greater than 0");const s={...r,hours_worked:t,hours:t,date:r.date||r.work_date,work_date:r.work_date||r.date,description:r.description||r.comments||"",comments:r.comments||r.description||"",status:r.status||"Draft"};return super.create(s)}async submit(r){return this.update(r,{status:"Submitted"})}async approve(r){return this.update(r,{status:"Approved"})}async reject(r,t=null){const s={status:"Rejected",was_rejected:!0};return t&&(s.rejection_reason=t),this.update(r,s)}calculateCost(r,t){return r/8*t}calculateBillable(r,t){return r/8*t}}const sn=new rn;class nn extends Y{constructor(){super("expenses",{supportsSoftDelete:!0,sanitizeConfig:"expense"})}async getAll(r,t={}){return super.getAll(r,{...t,select:t.select||"*, expense_files(*)",orderBy:t.orderBy||{column:"expense_date",ascending:!1}})}async getAllFiltered(r,t=!1){try{let s=f.from(this.tableName).select("*, expense_files(*)").eq("project_id",r).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter())),t||(s=s.or("is_test_content.is.null,is_test_content.eq.false"));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getByResource(r,t={}){try{let s=f.from(this.tableName).select("*, expense_files(*)").eq("resource_id",r).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter())),t.start&&(s=s.gte("expense_date",t.start)),t.end&&(s=s.lte("expense_date",t.end));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getByPartner(r,t={}){try{const{data:s}=await f.from("resources").select("id").eq("partner_id",r);if(!s||s.length===0)return[];const a=s.map(m=>m.id);let o=f.from(this.tableName).select("*, expense_files(*)").in("resource_id",a).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("expense_date",t.start)),t.end&&(o=o.lte("expense_date",t.end)),t.procurementMethod&&(o=o.eq("procurement_method",t.procurementMethod));const{data:i,error:c}=await o;if(c)throw c;return i||[]}catch(s){throw s}}async getPartnerProcuredForInvoice(r,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(r,{...t,procurementMethod:"partner"})}async getSummary(r,t={}){try{const s=await this.getAll(r,t),a={total:0,chargeable:0,nonChargeable:0,supplierProcured:0,partnerProcured:0,byCategory:{Travel:0,Accommodation:0,Sustenance:0},byStatus:{Draft:0,Submitted:0,Approved:0,Rejected:0,Paid:0},count:s.length};return s.forEach(o=>{const i=parseFloat(o.amount||0);a.total+=i,o.chargeable_to_customer!==!1?a.chargeable+=i:a.nonChargeable+=i,o.procurement_method==="partner"?a.partnerProcured+=i:a.supplierProcured+=i,a.byCategory[o.category]!==void 0&&(a.byCategory[o.category]+=i),a.byStatus[o.status]!==void 0&&(a.byStatus[o.status]+=i)}),a}catch(s){throw s}}async create(r){if(!r.resource_id)throw new Error("resource_id is required");if(!r.category)throw new Error("category is required");if(!r.amount||r.amount<=0)throw new Error("amount must be greater than 0");const t={...r,status:r.status||"Draft",chargeable_to_customer:r.chargeable_to_customer??!0,procurement_method:r.procurement_method||"supplier"};return super.create(t)}async createMany(r){if(!r||r.length===0)return[];try{const t=r.map(o=>{if(!o.resource_id)throw new Error("resource_id is required for all expenses");if(!o.category)throw new Error("category is required for all expenses");if(!o.amount||o.amount<=0)throw new Error("amount must be greater than 0 for all expenses");return{...o,status:o.status||"Draft",chargeable_to_customer:o.chargeable_to_customer??!0,procurement_method:o.procurement_method||"supplier"}}),{data:s,error:a}=await f.from(this.tableName).insert(t).select();if(a)throw a;return s||[]}catch(t){throw t}}async submit(r){return this.update(r,{status:"Submitted"})}async approve(r){return this.update(r,{status:"Approved"})}async reject(r,t=null){const s={status:"Rejected"};return t&&(s.rejection_reason=t),this.update(r,s)}async markPaid(r){return this.update(r,{status:"Paid"})}async uploadReceipt(r,t,s){try{const a=`${r}/${Date.now()}-${t.name}`,{error:o}=await f.storage.from("receipts").upload(a,t);if(o)throw o;const{data:i,error:c}=await f.from("expense_files").insert({expense_id:r,file_name:t.name,file_path:a,file_size:t.size,file_type:t.type,uploaded_by:s}).select().single();if(c)throw c;return i}catch(a){throw a}}async downloadReceipt(r){try{const{data:t,error:s}=await f.storage.from("receipts").download(r);if(s)throw s;return t}catch(t){throw t}}}const wa=new nn;class an extends Y{constructor(){super("partner_invoices")}async getAll(r,t={}){return super.getAll(r,{...t,select:t.select||"*, partners(name)",orderBy:t.orderBy||{column:"invoice_date",ascending:!1}})}async getByPartner(r,t={}){try{let s=f.from(this.tableName).select("*").eq("partner_id",r).order("invoice_date",{ascending:!1});t.status&&(s=s.eq("status",t.status));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(s){throw s}}async getWithLines(r){try{const{data:t,error:s}=await f.from(this.tableName).select("*, partners(name, contact_name, contact_email, payment_terms)").eq("id",r).single();if(s)throw s;if(!t)return null;const{data:a,error:o}=await f.from("partner_invoice_lines").select("*").eq("invoice_id",r).order("line_type",{ascending:!0}).order("resource_name",{ascending:!0}).order("line_date",{ascending:!0});if(o)throw o;const i={timesheets:(a||[]).filter(c=>c.line_type==="timesheet"),supplierExpenses:(a||[]).filter(c=>c.line_type==="supplier_expense"),partnerExpenses:(a||[]).filter(c=>c.line_type==="expense")};return{...t,lines:a||[],groupedLines:i}}catch(t){throw t}}async generateInvoiceNumber(r){try{const s=`INV-${new Date().getFullYear()}-`,{data:a,error:o}=await f.from(this.tableName).select("invoice_number").eq("project_id",r).like("invoice_number",`${s}%`).order("invoice_number",{ascending:!1}).limit(1);if(o)throw o;let i=1;if(a&&a.length>0){const c=a[0].invoice_number,m=parseInt(c.replace(s,""),10);isNaN(m)||(i=m+1)}return`${s}${String(i).padStart(3,"0")}`}catch(t){throw t}}async generateInvoice(r){const{projectId:t,partnerId:s,periodStart:a,periodEnd:o,createdBy:i,notes:c,includeSubmitted:m=!0}=r;try{const{data:h,error:b}=await f.from("resources").select("id, name, cost_price").eq("partner_id",s);if(b)throw b;if(!h||h.length===0)throw new Error("No resources linked to this partner");const p=h.map(j=>j.id),E={};h.forEach(j=>{E[j.id]=j});const R=m?["Approved","Submitted"]:["Approved"],{data:B,error:S}=await f.from("timesheets").select("id, date, hours_worked, hours, status, resource_id").in("resource_id",p).gte("date",a).lte("date",o).in("status",R);if(S)throw S;const{data:N,error:L}=await f.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, procurement_method, chargeable_to_customer, status").in("resource_id",p).gte("expense_date",a).lte("expense_date",o).in("status",["Approved","Submitted","Paid"]);if(L)throw L;const W=(N||[]).filter(j=>j.procurement_method==="partner"),O=(N||[]).filter(j=>j.procurement_method==="supplier");let _=0,w=0;const C=[],P={};(B||[]).forEach(j=>{P[j.resource_id]||(P[j.resource_id]=[]),P[j.resource_id].push(j)}),Object.keys(P).forEach(j=>{const F=E[j];P[j].forEach(ee=>{const te=parseFloat(ee.hours_worked||ee.hours||0),se=F?.cost_price||0,le=te/8,ne=le*se;_+=ne,w+=ne,C.push({line_type:"timesheet",timesheet_id:ee.id,expense_id:null,description:`${F?.name||"Unknown"} - ${te}h (${le.toFixed(2)} days)`,quantity:te,unit_price:se,line_total:ne,resource_name:F?.name,line_date:ee.date,hours:te,cost_price:se,source_status:ee.status,chargeable_to_customer:!0,procurement_method:null,expense_category:null})})});let g=0,u=0,y=0;const D=[];W.forEach(j=>{const F=parseFloat(j.amount||0);g+=F,j.chargeable_to_customer?u+=F:y+=F,D.push({line_type:"expense",timesheet_id:null,expense_id:j.id,description:`${j.resource_name} - ${j.category}: ${j.reason}`,quantity:1,unit_price:F,line_total:F,resource_name:j.resource_name,line_date:j.expense_date,hours:null,cost_price:null,source_status:j.status,chargeable_to_customer:j.chargeable_to_customer,procurement_method:"partner",expense_category:j.category})});let x=0,I=0,T=0;const q=[];O.forEach(j=>{const F=parseFloat(j.amount||0);x+=F,j.chargeable_to_customer?I+=F:T+=F,q.push({line_type:"supplier_expense",timesheet_id:null,expense_id:j.id,description:`${j.resource_name} - ${j.category}: ${j.reason}`,quantity:1,unit_price:F,line_total:F,resource_name:j.resource_name,line_date:j.expense_date,hours:null,cost_price:null,source_status:j.status,chargeable_to_customer:j.chargeable_to_customer,procurement_method:"supplier",expense_category:j.category})});const v=_+g,A=w+u+I,K=y+T,G=await this.generateInvoiceNumber(t),{data:J,error:X}=await f.from(this.tableName).insert({project_id:t,partner_id:s,invoice_number:G,invoice_date:new Date().toISOString().split("T")[0],period_start:a,period_end:o,timesheet_total:_,expense_total:g,supplier_expense_total:x,invoice_total:v,chargeable_total:A,non_chargeable_total:K,status:"Draft",notes:c||null,created_by:i}).select().single();if(X)throw X;const Z=[...C,...D,...q].map(j=>({...j,invoice_id:J.id}));if(Z.length>0){const{error:j}=await f.from("partner_invoice_lines").insert(Z);if(j)throw j}return this.getWithLines(J.id)}catch(h){throw h}}async updateStatus(r,t){const s={status:t};return t==="Sent"?s.sent_at=new Date().toISOString():t==="Paid"&&(s.paid_at=new Date().toISOString()),this.update(r,s)}async markSent(r){return this.updateStatus(r,"Sent")}async markPaid(r){return this.updateStatus(r,"Paid")}async cancel(r){return this.updateStatus(r,"Cancelled")}async getPartnerStats(r){try{const{data:t,error:s}=await f.from(this.tableName).select("status, invoice_total").eq("partner_id",r);if(s)throw s;const a={total:0,draft:0,sent:0,paid:0,cancelled:0,count:t?.length||0};return(t||[]).forEach(o=>{const i=parseFloat(o.invoice_total||0);switch(a.total+=i,o.status){case"Draft":a.draft+=i;break;case"Sent":a.sent+=i;break;case"Paid":a.paid+=i;break;case"Cancelled":a.cancelled+=i;break}}),a}catch(t){throw t}}}const ja=new an;class on extends Y{constructor(){super("milestones",{supportsSoftDelete:!0,sanitizeConfig:"milestone"})}async getAllWithStats(r){try{const t=await this.getAll(r,{orderBy:{column:"start_date",ascending:!0}}),{data:s}=await f.from("timesheets").select("milestone_id, hours_worked").eq("project_id",r).not("milestone_id","is",null).or("is_deleted.is.null,is_deleted.eq.false"),a={};return(s||[]).forEach(o=>{a[o.milestone_id]||(a[o.milestone_id]=0),a[o.milestone_id]+=parseFloat(o.hours_worked||0)}),t.map(o=>({...o,logged_hours:a[o.id]||0,logged_days:(a[o.id]||0)/8}))}catch(t){throw t}}async getWithDeliverables(r){try{const{data:t,error:s}=await f.from(this.tableName).select("*").eq("id",r).or(this.getSoftDeleteFilter()).single();if(s)throw s;const{data:a,error:o}=await f.from("deliverables").select("*").eq("milestone_id",r).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(o)throw o;return{...t,deliverables:a||[]}}catch(t){throw t}}async getByStatus(r,t){return this.getAll(r,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"start_date",ascending:!0}})}async getUpcoming(r,t=30){try{const s=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+t);const o=a.toISOString().split("T")[0];let i=f.from(this.tableName).select("*").eq("project_id",r).gte("end_date",s).lte("end_date",o).neq("status","Completed").order("end_date",{ascending:!0});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter()));const{data:c,error:m}=await i;if(m)throw m;return c||[]}catch(s){throw s}}async updateStatus(r,t){return this.update(r,{status:t})}async updateCompletion(r,t){const s={completion_percentage:t};return t>=100&&(s.status="Completed"),this.update(r,s)}async getSummary(r){try{const t=await this.getAll(r),s={total:t.length,completed:0,inProgress:0,notStarted:0,overdue:0,upcoming:0},a=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()+7);const i=o.toISOString().split("T")[0];return t.forEach(c=>{c.status==="Completed"?s.completed++:c.status==="In Progress"?(s.inProgress++,c.end_date<a&&s.overdue++):c.status==="Not Started"&&(s.notStarted++,c.start_date<=i&&s.upcoming++)}),s}catch(t){throw t}}}const ln=new on;class cn extends Y{constructor(){super("deliverables",{supportsSoftDelete:!0,sanitizeConfig:"deliverable"})}async getAllWithMilestones(r){return this.getAll(r,{select:"*, milestones(name, milestone_ref)",orderBy:{column:"due_date",ascending:!0}})}async getByMilestone(r){try{let t=f.from(this.tableName).select("*").eq("milestone_id",r).order("due_date",{ascending:!0});this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{data:s,error:a}=await t;if(a)throw a;return s||[]}catch(t){throw t}}async getByStatus(r,t){return this.getAll(r,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"due_date",ascending:!0}})}async getOverdue(r){try{const t=new Date().toISOString().split("T")[0];let s=f.from(this.tableName).select("*, milestones(name)").eq("project_id",r).lt("due_date",t).not("status","in",'("Delivered","Cancelled")').order("due_date",{ascending:!0});this.supportsSoftDelete&&(s=s.or(this.getSoftDeleteFilter()));const{data:a,error:o}=await s;if(o)throw o;return a||[]}catch(t){throw t}}async getUpcoming(r,t=14){try{const s=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+t);const o=a.toISOString().split("T")[0];let i=f.from(this.tableName).select("*, milestones(name)").eq("project_id",r).gte("due_date",s).lte("due_date",o).not("status","eq","Delivered").order("due_date",{ascending:!0});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter()));const{data:c,error:m}=await i;if(m)throw m;return c||[]}catch(s){throw s}}async updateStatus(r,t,s){const a={status:t};return t==="Submitted"?(a.submitted_date=new Date().toISOString(),a.submitted_by=s):t==="Delivered"&&(a.delivered_date=new Date().toISOString(),a.delivered_by=s),this.update(r,a)}async submit(r,t){return this.updateStatus(r,"Submitted",t)}async markDelivered(r,t){return this.updateStatus(r,"Delivered",t)}async reject(r,t){return this.update(r,{status:"Rejected",rejection_reason:t})}async getSummary(r){try{const t=await this.getAll(r),s=new Date().toISOString().split("T")[0],a={total:t.length,delivered:0,inProgress:0,notStarted:0,overdue:0,dueThisWeek:0},o=new Date;o.setDate(o.getDate()+7);const i=o.toISOString().split("T")[0];return t.forEach(c=>{c.status==="Delivered"?a.delivered++:c.status==="In Progress"?(a.inProgress++,c.due_date<s?a.overdue++:c.due_date<=i&&a.dueThisWeek++):(c.status==="Not Started"||c.status==="Draft")&&(a.notStarted++,c.due_date<s&&a.overdue++)}),a}catch(t){throw t}}}const dn=new cn;class un extends Y{constructor(){super("kpis")}async getAllWithStatus(r){try{return(await this.getAll(r,{orderBy:{column:"name",ascending:!0}})).map(s=>({...s,rag_status:this.calculateRAG(s)}))}catch(t){throw t}}calculateRAG(r){if(!r.target_value||r.actual_value===null||r.actual_value===void 0)return"Unknown";const t=parseFloat(r.actual_value),s=parseFloat(r.target_value),a=parseFloat(r.threshold_amber||10);return r.trend==="higher_better"?t>=s?"Green":t>=s*(1-a/100)?"Amber":"Red":t<=s?"Green":t<=s*(1+a/100)?"Amber":"Red"}async getByRAGStatus(r,t){try{return(await this.getAllWithStatus(r)).filter(a=>a.rag_status===t)}catch(s){throw s}}async getNeedingAttention(r){try{return(await this.getAllWithStatus(r)).filter(s=>s.rag_status==="Amber"||s.rag_status==="Red")}catch(t){throw t}}async updateActualValue(r,t){return this.update(r,{actual_value:t,last_updated:new Date().toISOString()})}async getHistory(r,t=12){try{const{data:s,error:a}=await f.from("kpi_history").select("*").eq("kpi_id",r).order("recorded_at",{ascending:!1}).limit(t);if(a)throw a;return s||[]}catch{return[]}}async getSummary(r){try{const t=await this.getAllWithStatus(r);return{total:t.length,green:t.filter(s=>s.rag_status==="Green").length,amber:t.filter(s=>s.rag_status==="Amber").length,red:t.filter(s=>s.rag_status==="Red").length,unknown:t.filter(s=>s.rag_status==="Unknown").length}}catch(t){throw t}}}const fn=new un;class mn extends Y{constructor(){super("quality_standards")}async getAllWithStatus(r){try{return(await this.getAll(r,{orderBy:{column:"name",ascending:!0}})).map(s=>({...s,compliance_status:this.calculateCompliance(s)}))}catch(t){throw t}}calculateCompliance(r){if(r.actual_value===null||r.actual_value===void 0)return"Not Measured";const t=parseFloat(r.actual_value),s=parseFloat(r.target_value||0);return t>=s?"Compliant":t>=s*.9?"Near Compliant":"Non-Compliant"}async getNonCompliant(r){try{return(await this.getAllWithStatus(r)).filter(s=>s.compliance_status==="Non-Compliant")}catch(t){throw t}}async updateMeasurement(r,t,s){return this.update(r,{actual_value:t,measurement_notes:s,last_measured:new Date().toISOString()})}async getSummary(r){try{const t=await this.getAllWithStatus(r);return{total:t.length,compliant:t.filter(s=>s.compliance_status==="Compliant").length,nearCompliant:t.filter(s=>s.compliance_status==="Near Compliant").length,nonCompliant:t.filter(s=>s.compliance_status==="Non-Compliant").length,notMeasured:t.filter(s=>s.compliance_status==="Not Measured").length}}catch(t){throw t}}}const hn=new mn;function Xe(n){if(!n)return!1;const r=n.toLowerCase();return r.includes("pmo")||r.includes("project manager")}function pn(){const{showTestUsers:n,testUserIds:r}=Hr(),{projectId:t,projectName:s,projectRef:a}=dt(),[o,i]=d.useState(!0),[c,m]=d.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[h,b]=d.useState({signed:0,pending:0,awaitingGeneration:0}),[p,E]=d.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0,pmoResources:[],nonPmoResources:[]}),[R,B]=d.useState([]),[S,N]=d.useState({}),[L,W]=d.useState({}),[O,_]=d.useState([]),[w,C]=d.useState(0),P=d.useCallback(async()=>{if(t){i(!0);try{const u=await ln.getAll(t,{orderBy:{column:"milestone_ref",ascending:!0}});B(u);const y=await dn.getSummary(t),D=await fn.getAll(t,{orderBy:{column:"kpi_ref",ascending:!0}}),x=await hn.getAll(t,{orderBy:{column:"qs_ref",ascending:!0}});_(x);const{data:I}=await f.from("resources").select("*"),T=await sn.getAllFiltered(t,n);let q=0,v=0;const A=[],K=[];I&&I.forEach(M=>{const V=(M.daily_rate||0)*(M.days_allocated||0);Xe(M.role)?(q+=V,A.push({name:M.name,role:M.role,budget:V})):(v+=V,K.push({name:M.name,role:M.role,budget:V}))});const G={};let J=0,X=0,Z=0;T&&I&&T.forEach(M=>{if(!(M.status==="Approved"||M.status==="Submitted"&&!M.was_rejected))return;const Ct=parseFloat(M.hours_worked||M.hours||0),ve=M.resources||I.find(re=>re.id===M.resource_id);if(ve){const re=Ct/8*(ve.daily_rate||0);M.milestone_id&&(G[M.milestone_id]=(G[M.milestone_id]||0)+re),J+=re,Xe(ve.role)?X+=re:Z+=re}}),N(G),E({pmoBudget:q,pmoSpend:X,nonPmoBudget:v,nonPmoSpend:Z,pmoResources:A,nonPmoResources:K});const j={};D.forEach(M=>{const V=M.category||"Other";j[V]||(j[V]=[]),j[V].push(M)}),W(j);const F=u.length,_e=u.filter(M=>M.status==="Completed").length,ee=y.total,te=y.delivered,se=I?.length||0,le=D.length,ne=D.filter(M=>(M.current_value||0)>=(M.target||90)).length,St=x.length,vt=x.filter(M=>(M.current_value||0)>=(M.target||100)).length,{data:Se}=await f.from("milestone_certificates").select("*").eq("project_id",t),wt=Se?.filter(M=>M.status==="Signed").length||0,jt=Se?.filter(M=>M.status==="Pending Customer Signature"||M.status==="Pending Supplier Signature").length||0,Pt=Math.max(0,_e-(Se?.length||0));b({signed:wt,pending:jt,awaitingGeneration:Pt});const Et=u.reduce((M,V)=>M+(V.budget||0),0),It=F>0?Math.round(u.reduce((M,V)=>M+(V.progress||0),0)/F):0;C(It),m({totalMilestones:F,completedMilestones:_e,totalDeliverables:ee,deliveredCount:te,totalResources:se,totalKPIs:le,achievedKPIs:ne,totalQS:St,achievedQS:vt,totalBudget:Et,spendToDate:J})}catch{}finally{i(!1)}}},[t,n]);d.useEffect(()=>{P()},[P]);function g(u){switch(u){case"Time Performance":return"#3b82f6";case"Quality of Collaboration":return"#8b5cf6";case"Delivery Performance":return"#10b981";default:return"#64748b"}}return o?e.jsx(ze,{message:"Loading dashboard...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(ts,{icon:qe,title:`${a||"Project"} Dashboard`,subtitle:s||"Project Tracker"}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",background:"linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%)",color:"white"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"2.5rem",fontWeight:"700",margin:0},children:[w,"%"]}),e.jsx("p",{style:{opacity:.9,margin:0},children:"Overall Progress"})]}),e.jsx("div",{style:{width:"120px",height:"120px",position:"relative"},children:e.jsxs("svg",{viewBox:"0 0 100 100",style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"10"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"white",strokeWidth:"10",strokeDasharray:`${w*2.51} 251`,strokeLinecap:"round"})]})})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsx("div",{className:"card",style:{borderLeft:"4px solid #3b82f6"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total Budget"}),e.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:["£",c.totalBudget.toLocaleString()]})]}),e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px"},children:e.jsx(cr,{size:24,style:{color:"#3b82f6"}})})]})}),e.jsx("div",{className:"card",style:{borderLeft:"4px solid #10b981"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Spend to Date"}),e.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#10b981"},children:["£",Math.round(c.spendToDate).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:[c.totalBudget>0?Math.round(c.spendToDate/c.totalBudget*100):0,"% of budget"]})]}),e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px"},children:e.jsx(de,{size:24,style:{color:"#10b981"}})})]})})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(dr,{size:20})," PMO Cost Tracking"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",borderRadius:"8px",borderLeft:"4px solid #f59e0b"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e",marginBottom:"0.25rem"},children:"PMO Budget"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#d97706"},children:["£",Math.round(p.pmoBudget).toLocaleString()]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#ffedd5",borderRadius:"8px",borderLeft:"4px solid #ea580c"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#9a3412",marginBottom:"0.25rem"},children:"PMO Spend"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#ea580c"},children:["£",Math.round(p.pmoSpend).toLocaleString()]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dbeafe",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#1e40af",marginBottom:"0.25rem"},children:"Non-PMO Budget"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#2563eb"},children:["£",Math.round(p.nonPmoBudget).toLocaleString()]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dcfce7",borderRadius:"8px",borderLeft:"4px solid #16a34a"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#166534",marginBottom:"0.25rem"},children:"Non-PMO Spend"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#16a34a"},children:["£",Math.round(p.nonPmoSpend).toLocaleString()]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:"Spend Distribution"}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["PMO: ",c.spendToDate>0?Math.round(p.pmoSpend/c.spendToDate*100):0,"% | Non-PMO: ",c.spendToDate>0?Math.round(p.nonPmoSpend/c.spendToDate*100):0,"%"]})]}),e.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#e2e8f0"},children:[e.jsx("div",{style:{width:`${c.spendToDate>0?p.pmoSpend/c.spendToDate*100:0}%`,backgroundColor:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:p.pmoSpend>0?"40px":"0"},children:p.pmoSpend>0&&"PMO"}),e.jsx("div",{style:{width:`${c.spendToDate>0?p.nonPmoSpend/c.spendToDate*100:0}%`,backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:p.nonPmoSpend>0?"60px":"0"},children:p.nonPmoSpend>0&&"Non-PMO"})]})]}),p.pmoResources.length>0&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#fffbeb",borderRadius:"8px"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:"600",color:"#92400e",marginBottom:"0.5rem"},children:["PMO Resources (",p.pmoResources.length,")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:p.pmoResources.map((u,y)=>e.jsx("span",{style:{padding:"0.25rem 0.75rem",backgroundColor:"#fef3c7",borderRadius:"4px",fontSize:"0.8rem",color:"#92400e"},children:u.name},y))})]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(ce,{icon:ie,label:"Milestones",value:`${c.completedMilestones} / ${c.totalMilestones}`,subtext:`${c.totalMilestones>0?Math.round(c.completedMilestones/c.totalMilestones*100):0}% Complete`,color:"#3b82f6"}),e.jsx(ce,{icon:Me,label:"Deliverables",value:`${c.deliveredCount} / ${c.totalDeliverables}`,subtext:`${c.totalDeliverables>0?Math.round(c.deliveredCount/c.totalDeliverables*100):0}% Delivered`,color:"#10b981"}),e.jsx(ce,{icon:de,label:"KPIs",value:`${c.achievedKPIs} / ${c.totalKPIs}`,subtext:`${c.totalKPIs>0?Math.round(c.achievedKPIs/c.totalKPIs*100):0}% Achieved`,color:"#3b82f6"}),e.jsx(ce,{icon:ue,label:"Quality Standards",value:`${c.achievedQS} / ${c.totalQS}`,subtext:`${c.totalQS>0?Math.round(c.achievedQS/c.totalQS*100):0}% Achieved`,color:"#8b5cf6"})]}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",backgroundColor:"#fefce8",borderLeft:"4px solid #eab308"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(ur,{size:28,style:{color:"#ca8a04"}}),e.jsx("div",{children:e.jsx("h4",{style:{margin:0,color:"#854d0e"},children:"Milestone Certificates"})})]}),e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#16a34a"},children:h.signed}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#166534"},children:"Signed"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#d97706"},children:h.pending}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e"},children:"Pending"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:h.awaitingGeneration>0?"#dc2626":"#64748b"},children:h.awaitingGeneration}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Awaiting"})]})]}),e.jsx(Q,{to:"/milestones",style:{padding:"0.5rem 1rem",backgroundColor:"#ca8a04",color:"white",textDecoration:"none",borderRadius:"6px",fontWeight:"500"},children:"View →"})]})}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Billable vs Spend by Milestone"}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"1rem"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem",marginRight:"1rem"},children:[e.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),"Billable"]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem"},children:[e.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"2px"}}),"Spend"]})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",height:"220px",alignItems:"flex-end"},children:R.map(u=>{const y=Math.max(...R.map(T=>T.budget||0)),D=S[u.id]||0,x=y>0?(u.budget||0)/y*100:0,I=y>0?D/y*100:0;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"flex-end",height:"180px",width:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{width:"45%",height:`${x}%`,backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",minHeight:u.budget>0?"20px":"0",position:"relative"},title:`Billable: £${(u.budget||0).toLocaleString()}`,children:x>15&&e.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round((u.budget||0)/1e3),"k"]})}),e.jsx("div",{style:{width:"45%",height:`${I}%`,backgroundColor:"#10b981",borderRadius:"4px 4px 0 0",minHeight:D>0?"20px":"0",position:"relative"},title:`Spend: £${Math.round(D).toLocaleString()}`,children:I>15&&e.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round(D/1e3),"k"]})})]}),e.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"600",color:"#64748b"},children:u.milestone_ref})]},u.id)})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Performance"}),e.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end",height:"200px"},children:Object.entries(L).map(([u,y])=>{const D=y.length,x=y.filter(T=>(T.current_value||0)>=(T.target||90)).length,I=D>0?x/D*100:0;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"160px"},children:[e.jsx("div",{style:{height:`${100-I}%`,backgroundColor:"#e2e8f0",borderRadius:I>0?"4px 4px 0 0":"4px"}}),e.jsxs("div",{style:{height:`${I}%`,backgroundColor:g(u),borderRadius:I<100?"0 0 4px 4px":"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"700"},children:[x,"/",D]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.75rem"},children:u.split(" ")[0]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[Math.round(I),"%"]})]})]},u)})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Quality Standards"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:O.map(u=>{const y=u.current_value||0,D=y>=(u.target||100);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600",minWidth:"45px",color:"#8b5cf6"},children:u.qs_ref}),e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${y}%`,height:"100%",backgroundColor:D?"#10b981":"#8b5cf6"}})})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"45px",color:D?"#10b981":"#64748b"},children:[y,"%"]})]},u.id)})})]})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0},children:"Milestone Summary"}),e.jsx(Q,{to:"/milestones",style:{color:"#3b82f6",textDecoration:"none",fontSize:"0.9rem",fontWeight:"500"},children:"View Details →"})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Budget"}),e.jsx("th",{children:"Spend"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No milestones"})}):R.map(u=>{const y=S[u.id]||0,D=u.budget>0?Math.round(y/u.budget*100):0;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Q,{to:`/milestones/${u.id}`,style:{fontFamily:"monospace",fontWeight:"600",color:"#3b82f6",textDecoration:"none"},children:u.milestone_ref})}),e.jsx("td",{style:{fontWeight:"500"},children:u.name}),e.jsx("td",{children:u.end_date?new Date(u.end_date).toLocaleDateString("en-GB"):"-"}),e.jsxs("td",{children:["£",(u.budget||0).toLocaleString()]}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{color:y>0?"#10b981":"#9ca3af"},children:["£",Math.round(y).toLocaleString()]}),u.budget>0&&e.jsxs("span",{style:{fontSize:"0.75rem",color:D>100?"#dc2626":"#64748b"},children:["(",D,"%)"]})]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"6px",backgroundColor:"#e2e8f0",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u.progress||0}%`,height:"100%",backgroundColor:u.status==="Completed"?"#10b981":"#3b82f6"}})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600"},children:[u.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsx(rs,{status:u.status||"Not Started"})})]},u.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"1rem"},children:[e.jsxs(Q,{to:"/milestones",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(ie,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Milestones"})]}),e.jsxs(Q,{to:"/deliverables",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(Me,{size:32,style:{color:"#10b981",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Deliverables"})]}),e.jsxs(Q,{to:"/kpis",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(de,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"KPIs"})]}),e.jsxs(Q,{to:"/quality-standards",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(ue,{size:32,style:{color:"#8b5cf6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Quality"})]}),e.jsxs(Q,{to:"/reports",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(qe,{size:32,style:{color:"#f59e0b",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Reports"})]})]})]})}const gn=d.lazy(()=>$(()=>import("./ResetPassword-ipvhnFqW.js"),__vite__mapDeps([0,1,2,3]))),yn=d.lazy(()=>$(()=>import("./Milestones-BjnYVDZX.js"),__vite__mapDeps([4,1,5,6,2,3]))),xn=d.lazy(()=>$(()=>import("./MilestoneDetail-BNe_qgyY.js"),__vite__mapDeps([7,1,2,3]))),bn=d.lazy(()=>$(()=>import("./Gantt-D3fNjn6P.js"),__vite__mapDeps([8,1,5,2,3]))),_n=d.lazy(()=>$(()=>import("./Deliverables-D9s9WITB.js"),__vite__mapDeps([9,1,5,2,3]))),Sn=d.lazy(()=>$(()=>import("./Resources-26ZjJHtw.js"),__vite__mapDeps([10,1,5,6,2,3]))),vn=d.lazy(()=>$(()=>import("./ResourceDetail-BCayuzau.js"),__vite__mapDeps([11,1,5,2,3]))),wn=d.lazy(()=>$(()=>import("./Partners-CsgI1D8y.js"),__vite__mapDeps([12,1,5,6,2,3]))),jn=d.lazy(()=>$(()=>import("./PartnerDetail-BbY8krwj.js"),__vite__mapDeps([13,1,5,2,3]))),Pn=d.lazy(()=>$(()=>import("./Timesheets-Cgsa1G7_.js"),__vite__mapDeps([14,1,5,6,2,3]))),En=d.lazy(()=>$(()=>import("./Expenses-DlDQikEK.js"),__vite__mapDeps([15,1,5,6,2,3]))),In=d.lazy(()=>$(()=>import("./KPIs-C0qVSboJ.js"),__vite__mapDeps([16,1,5,6,2,3]))),Cn=d.lazy(()=>$(()=>import("./KPIDetail-Dbzcd2B1.js"),__vite__mapDeps([17,1,5,2,3]))),Rn=d.lazy(()=>$(()=>import("./QualityStandards-Dg9J1lzk.js"),__vite__mapDeps([18,1,5,6,2,3]))),Dn=d.lazy(()=>$(()=>import("./QualityStandardDetail-DvYoLRXq.js"),__vite__mapDeps([19,1,2,3]))),Mn=d.lazy(()=>$(()=>import("./Reports-dNRSHMLj.js"),__vite__mapDeps([20,2,1,3]))),kn=d.lazy(()=>$(()=>import("./Users-vn7R_AD9.js"),__vite__mapDeps([21,1,2,3]))),Nn=d.lazy(()=>$(()=>import("./Settings-CznuwEXd.js"),__vite__mapDeps([22,1,5,2,3]))),An=d.lazy(()=>$(()=>import("./AccountSettings-BFSbEgIz.js"),__vite__mapDeps([23,1,2,3]))),Tn=d.lazy(()=>$(()=>import("./WorkflowSummary-BLagldO9.js"),__vite__mapDeps([24,1,2,3]))),Ln=d.lazy(()=>$(()=>import("./AuditLog-6OgHxO6_.js"),__vite__mapDeps([25,1,2,3]))),zn=d.lazy(()=>$(()=>import("./DeletedItems-B3k_qUGV.js"),__vite__mapDeps([26,1,6,2,3])));function On(){return e.jsx("div",{className:"page-container",children:e.jsx(ae,{type:"page"})})}function U({children:n}){const{user:r,isLoading:t}=Le();return t?e.jsx(ze,{message:"Loading...",size:"large",fullPage:!0}):r?e.jsx(Fs,{children:e.jsx(d.Suspense,{fallback:e.jsx(On,{}),children:n||e.jsx(Lt,{})})}):e.jsx(Re,{to:"/login",replace:!0})}function Bn(){return e.jsx(At,{children:e.jsx(Xr,{children:e.jsx(os,{children:e.jsx(Wr,{children:e.jsx(Fr,{children:e.jsx(Vr,{children:e.jsx(Gr,{children:e.jsxs(Qr,{children:[e.jsxs(Tt,{children:[e.jsx(z,{path:"/login",element:e.jsx(Vs,{})}),e.jsx(z,{path:"/reset-password",element:e.jsx(d.Suspense,{fallback:e.jsx(ze,{fullPage:!0}),children:e.jsx(gn,{})})}),e.jsx(z,{path:"/",element:e.jsx(Re,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"/dashboard",element:e.jsx(U,{children:e.jsx(pn,{})})}),e.jsx(z,{path:"/milestones",element:e.jsx(U,{children:e.jsx(yn,{})})}),e.jsx(z,{path:"/milestones/:id",element:e.jsx(U,{children:e.jsx(xn,{})})}),e.jsx(z,{path:"/gantt",element:e.jsx(U,{children:e.jsx(bn,{})})}),e.jsx(z,{path:"/deliverables",element:e.jsx(U,{children:e.jsx(_n,{})})}),e.jsx(z,{path:"/resources",element:e.jsx(U,{children:e.jsx(Sn,{})})}),e.jsx(z,{path:"/resources/:id",element:e.jsx(U,{children:e.jsx(vn,{})})}),e.jsx(z,{path:"/partners",element:e.jsx(U,{children:e.jsx(wn,{})})}),e.jsx(z,{path:"/partners/:id",element:e.jsx(U,{children:e.jsx(jn,{})})}),e.jsx(z,{path:"/timesheets",element:e.jsx(U,{children:e.jsx(Pn,{})})}),e.jsx(z,{path:"/expenses",element:e.jsx(U,{children:e.jsx(En,{})})}),e.jsx(z,{path:"/kpis",element:e.jsx(U,{children:e.jsx(In,{})})}),e.jsx(z,{path:"/kpis/:id",element:e.jsx(U,{children:e.jsx(Cn,{})})}),e.jsx(z,{path:"/quality-standards",element:e.jsx(U,{children:e.jsx(Rn,{})})}),e.jsx(z,{path:"/quality-standards/:id",element:e.jsx(U,{children:e.jsx(Dn,{})})}),e.jsx(z,{path:"/reports",element:e.jsx(U,{children:e.jsx(Mn,{})})}),e.jsx(z,{path:"/users",element:e.jsx(U,{children:e.jsx(kn,{})})}),e.jsx(z,{path:"/settings",element:e.jsx(U,{children:e.jsx(Nn,{})})}),e.jsx(z,{path:"/account",element:e.jsx(U,{children:e.jsx(An,{})})}),e.jsx(z,{path:"/workflow-summary",element:e.jsx(U,{children:e.jsx(Tn,{})})}),e.jsx(z,{path:"/audit-log",element:e.jsx(U,{children:e.jsx(Ln,{})})}),e.jsx(z,{path:"/deleted-items",element:e.jsx(U,{children:e.jsx(zn,{})})}),e.jsx(z,{path:"*",element:e.jsx(Re,{to:"/dashboard",replace:!0})})]}),e.jsx(ls,{}),e.jsx(Rr,{}),e.jsx(Or,{})]})})})})})})})})}ke.createRoot(document.getElementById("root")).render(e.jsx(Je.StrictMode,{children:e.jsx(Bn,{})}));export{_s as $,Es as A,ua as B,da as C,ca as D,ye as E,Ps as F,yt as G,la as H,js as I,ia as J,oa as K,ze as L,Oe as M,aa as N,na as O,ts as P,sa as Q,ge as R,ce as S,ra as T,ta as U,ea as V,pe as W,Zn as X,vs as Y,Xn as Z,Ss as _,dt as a,bs as a0,ys as a1,gs as a2,ps as a3,hs as a4,ms as a5,fs as a6,us as a7,gt as a8,pt as a9,k as aa,ba as ab,l as ac,Ls as ad,Ts as ae,_a as af,xa as ag,As as ah,ya as ai,Ns as aj,Jn as ak,Yn as al,Qn as am,Gn as an,Kn as ao,Hn as ap,Vn as aq,Rs as ar,ws as as,xs as at,is as b,Hr as c,dn as d,wa as e,Fn as f,ga as g,pa as h,ja as i,e as j,fn as k,ks as l,ln as m,Ms as n,Ds as o,Sa as p,hn as q,va as r,f as s,sn as t,Le as u,ha as v,ma as w,Cs as x,fa as y,Is as z};
