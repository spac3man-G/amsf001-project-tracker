const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-CW30N-r4.js","assets/vendor-react-CaXNtsgv.js","assets/vendor-icons--BgpcKrK.js","assets/vendor-supabase-qY1sfceY.js","assets/vendor-charts-_mIYJ_kN.js","assets/Milestones-D_dX0DCm.js","assets/usePermissions-cl9WcJlf.js","assets/ConfirmDialog-D5ycXPpB.js","assets/MilestoneDetail-CtCGcCxT.js","assets/Gantt-BzWowR8g.js","assets/Deliverables-COG3x1AJ.js","assets/Resources-BuQXLRab.js","assets/ResourceDetail-CcRA2u5E.js","assets/Partners-M3Xecgjx.js","assets/PartnerDetail-BFLTK3TK.js","assets/Timesheets-BBGbTHwV.js","assets/Expenses-BlDeJrZO.js","assets/Expenses-BoxYWZca.css","assets/KPIs-Cy7qUYH1.js","assets/KPIDetail-DnNHDfMP.js","assets/QualityStandards-iBe3Dtcg.js","assets/QualityStandardDetail-Bp8L6t-k.js","assets/Reports-DjBspiyn.js","assets/Users-CF50tLz_.js","assets/Settings-m_dD-RNw.js","assets/AccountSettings-D_BxBp2Q.js","assets/WorkflowSummary-CE7L2px4.js","assets/AuditLog-D0KPB2VU.js","assets/DeletedItems-Dk-1W2pq.js"])))=>i.map(i=>d[i]);
var Qs=Object.defineProperty;var Js=(r,e,t)=>e in r?Qs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Xt=(r,e,t)=>Js(r,typeof e!="symbol"?e+"":e,t);import{r as f,a as Ct,R as En,u as Dr,b as Zs,L as Le,c as eo,d as to,g as ro,B as no,e as so,f as Q,N as hr,O as oo}from"./vendor-react-CaXNtsgv.js";import{c as io}from"./vendor-supabase-qY1sfceY.js";import{A as Dn,R as vt,L as Mn,I as ao,X as On,C as lo,a as Ue,M as co,S as uo,B as Qt,T as fo,U as ho,D as po,b as mo,c as Jt,d as go,e as kn,f as xt,F as In,g as zn,h as at,i as yo,H as bo,j as Nn,k as vo,l as xo,m as wo,n as yt,P as pr,o as _o,G as So,p as jo,q as Po,r as Ro,s as Co,t as Tn,u as Eo,K as Do,v as Zt,w as er,E as Mo,x as Oo,y as ko,z as tn,J as Io,N as zo,O as No}from"./vendor-icons--BgpcKrK.js";import{p as qe,c as Et}from"./vendor-charts-_mIYJ_kN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var An={exports:{}},Dt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var To=f,Ao=Symbol.for("react.element"),Lo=Symbol.for("react.fragment"),qo=Object.prototype.hasOwnProperty,Wo=To.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bo={key:!0,ref:!0,__self:!0,__source:!0};function Ln(r,e,t){var n,s={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)qo.call(e,n)&&!Bo.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Ao,type:r,key:o,ref:a,props:s,_owner:Wo.current}}Dt.Fragment=Lo;Dt.jsx=Ln;Dt.jsxs=Ln;An.exports=Dt;var i=An.exports,mr={},rn=Ct;mr.createRoot=rn.createRoot,mr.hydrateRoot=rn.hydrateRoot;const Ho="modulepreload",$o=function(r){return"/"+r},nn={},ie=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=Promise.allSettled(t.map(c=>{if(c=$o(c),c in nn)return;nn[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Ho,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((y,_)=>{m.addEventListener("load",y),m.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};var sn={},Uo="@vercel/analytics",Fo="1.6.0",Go=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function qn(){return typeof window<"u"}function Wn(){try{const r="production"}catch{}return"production"}function Vo(r="auto"){if(r==="auto"){window.vam=Wn();return}window.vam=r}function Yo(){return(qn()?window.vam:Wn())||"production"}function gr(){return Yo()==="development"}function Ko(r){return r.scriptSrc?r.scriptSrc:gr()?"https://va.vercel-scripts.com/v1/script.debug.js":r.basePath?`${r.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Xo(r={debug:!0}){var e;if(!qn())return;Vo(r.mode),Go(),r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend));const t=Ko(r);if(document.head.querySelector(`script[src*="${t}"]`))return;const n=document.createElement("script");n.src=t,n.defer=!0,n.dataset.sdkn=Uo+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=Fo,r.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/insights`),r.dsn&&(n.dataset.dsn=r.dsn),n.onerror=()=>{const s=gr()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information."},gr()&&r.debug===!1&&(n.dataset.debug="false"),document.head.appendChild(n)}function Qo({route:r,path:e}){var t;(t=window.va)==null||t.call(window,"pageview",{route:r,path:e})}function Jo(){if(!(typeof process>"u"||typeof sn>"u"))return sn.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Zo(r){return f.useEffect(()=>{var e;r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]),f.useEffect(()=>{Xo({framework:r.framework||"react",basePath:r.basePath??Jo(),...r.route!==void 0&&{disableAutoTrack:!0},...r})},[]),f.useEffect(()=>{r.route&&r.path&&Qo({route:r.route,path:r.path})},[r.route,r.path]),null}var on={},ei="@vercel/speed-insights",ti="1.2.0",ri=()=>{window.si||(window.si=function(...e){(window.siq=window.siq||[]).push(e)})};function ni(){return typeof window<"u"}function si(){try{const r="production"}catch{}return"production"}function Bn(){return si()==="development"}function oi(r){return r.scriptSrc?r.scriptSrc:Bn()?"https://va.vercel-scripts.com/v1/speed-insights/script.debug.js":r.dsn?"https://va.vercel-scripts.com/v1/speed-insights/script.js":r.basePath?`${r.basePath}/speed-insights/script.js`:"/_vercel/speed-insights/script.js"}function ii(r={}){var e;if(!ni()||r.route===null)return null;ri();const t=oi(r);if(document.head.querySelector(`script[src*="${t}"]`))return null;r.beforeSend&&((e=window.si)==null||e.call(window,"beforeSend",r.beforeSend));const n=document.createElement("script");return n.src=t,n.defer=!0,n.dataset.sdkn=ei+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=ti,r.sampleRate&&(n.dataset.sampleRate=r.sampleRate.toString()),r.route&&(n.dataset.route=r.route),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/speed-insights/vitals`),r.dsn&&(n.dataset.dsn=r.dsn),Bn()&&r.debug===!1&&(n.dataset.debug="false"),n.onerror=()=>{},document.head.appendChild(n),{setRoute:s=>{n.dataset.route=s??void 0}}}function ai(){if(!(typeof process>"u"||typeof on>"u"))return on.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function li(r){f.useEffect(()=>{var t;r.beforeSend&&((t=window.si)==null||t.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]);const e=f.useRef(null);return f.useEffect(()=>{if(e.current)r.route&&e.current(r.route);else{const t=ii({framework:r.framework??"react",basePath:r.basePath??ai(),...r});t&&(e.current=t.setRoute)}},[r.route]),null}const ci=void 0,ui=void 0;throw new Error("Missing Supabase environment variables");const S=io(ci,ui),Hn=f.createContext(null),di=60*1e3,fi=5*60*1e3;function hi({children:r}){const[e,t]=f.useState(null),[n,s]=f.useState(null),[o,a]=f.useState(null),[l,c]=f.useState(!0),[u,h]=f.useState(null),[m,y]=f.useState(!1),_=f.useRef(null),M=f.useRef(Date.now()),R=f.useCallback(()=>{M.current=Date.now()},[]);async function C(x){if(!x){s(null),a(null);return}try{const{data:D,error:z}=await S.from("profiles").select("*").eq("id",x.id).single();if(z){h(z);return}s(D);const{data:te}=await S.from("resources").select("*").eq("user_id",x.id).maybeSingle();a(te),h(null)}catch(D){h(D)}}const w=f.useCallback(async()=>{try{const{data:{session:x},error:D}=await S.auth.getSession();if(D)return;if(!x){await P();return}const z=x.expires_at*1e3,te=Date.now(),q=z-te;if(q<=0)await P();else if(q<=fi){y(!0);const{data:G,error:re}=await S.auth.refreshSession();re||!G.session||y(!1)}else y(!1)}catch{}},[]);async function P(){t(null),s(null),a(null),y(!1),await S.auth.signOut();const x=window.location.pathname;x!=="/login"&&x!=="/register"&&(window.location.href="/login?expired=true")}const b=f.useCallback(()=>{_.current&&clearInterval(_.current),_.current=setInterval(()=>{w()},di);const x=()=>{document.visibilityState==="visible"&&w()};document.addEventListener("visibilitychange",x);const D=["mousedown","keydown","touchstart","scroll"];return D.forEach(z=>{document.addEventListener(z,R,{passive:!0})}),()=>{_.current&&clearInterval(_.current),document.removeEventListener("visibilitychange",x),D.forEach(z=>{document.removeEventListener(z,R)})}},[w,R]);f.useEffect(()=>{let x=!0,D=null;async function z(){try{const{data:{session:q},error:G}=await S.auth.getSession();G&&x&&h(G),x&&(t(q?.user??null),c(!1),q?.user&&(C(q.user),D=b()))}catch(q){x&&(h(q),c(!1))}}z();const{data:{subscription:te}}=S.auth.onAuthStateChange(async(q,G)=>{x&&(t(G?.user??null),c(!1),G?.user?(C(G.user),D&&D(),D=b()):(s(null),a(null),D&&(D(),D=null)),(q==="SIGNED_OUT"||q==="TOKEN_REFRESHED")&&y(!1))});return()=>{x=!1,te.unsubscribe(),D&&D()}},[b]);async function g(){try{await S.auth.signOut(),t(null),s(null),a(null),y(!1)}catch(x){h(x)}}async function p(){e&&await C(e)}async function v(){try{const{data:x,error:D}=await S.auth.refreshSession();return D?!1:x.session?(y(!1),!0):!1}catch{return!1}}const j={user:e,profile:n,role:n?.role||"viewer",linkedResource:o,isLoading:l,error:u,signOut:g,refreshUserData:p,refreshSession:v,isAuthenticated:!!e,sessionExpiring:m};return i.jsx(Hn.Provider,{value:j,children:r})}function Mt(){const r=f.useContext(Hn);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r}const $n=f.createContext(null);function pi({children:r}){const[e,t]=f.useState(null),[n,s]=f.useState(!0),[o,a]=f.useState(null);f.useEffect(()=>{let h=!0;async function m(){try{const{data:y,error:_}=await S.from("projects").select("*").eq("reference","AMSF001").single();_?h&&a(_):h&&(t(y),a(null))}catch(y){h&&a(y)}finally{h&&s(!1)}}return m(),()=>{h=!1}},[]);async function l(h){s(!0),a(null);try{const{data:m,error:y}=await S.from("projects").select("*").eq("reference",h).single();y?a(y):t(m)}catch(m){a(m)}finally{s(!1)}}async function c(){if(e)try{const{data:h,error:m}=await S.from("projects").select("*").eq("id",e.id).single();m?a(m):t(h)}catch(h){a(h)}}const u={currentProject:e,projectId:e?.id||null,projectRef:e?.reference||null,projectName:e?.name||null,isLoading:n,error:o,switchProject:l,refreshProject:c};return i.jsx($n.Provider,{value:u,children:r})}function Un(){const r=f.useContext($n);if(!r)throw new Error("useProject must be used within a ProjectProvider");return r}const Fn=f.createContext();function mi({children:r}){const[e,t]=f.useState(!1),[n,s]=f.useState(null),[o,a]=f.useState([]);f.useEffect(()=>{l(),c()},[]);async function l(){const{data:{user:R}}=await S.auth.getUser();if(R){const{data:C}=await S.from("profiles").select("role").eq("id",R.id).single();C&&s(C.role)}}async function c(){const{data:R}=await S.from("profiles").select("id").eq("is_test_user",!0);R&&a(R.map(C=>C.id))}const u=n==="admin"||n==="supplier_pm";function h(){u&&t(R=>!R)}function m(R){return o.includes(R)}function y(R,C="user_id"){return!R||e?R:R.filter(w=>!o.includes(w[C]))}function _(R){return!R||e?R:R.filter(C=>!C.is_test_content)}const M={showTestUsers:e,setShowTestUsers:t,toggleTestUsers:h,canToggleTestUsers:u,testUserIds:o,isTestUser:m,filterTestContent:y,filterByTestFlag:_,userRole:n};return i.jsx(Fn.Provider,{value:M,children:r})}function gi(){const r=f.useContext(Fn);if(!r)throw new Error("useTestUsers must be used within a TestUserProvider");return r}const Gn=f.createContext();function yi(){return f.useContext(Gn)}function bi({children:r}){const[e,t]=f.useState([]),[n,s]=f.useState(0),[o,a]=f.useState(0),[l,c]=f.useState(!0),[u,h]=f.useState(null),[m,y]=f.useState(null),_=p=>["admin","supplier_pm","customer_pm"].includes(p),M=f.useCallback(async(p,v)=>{try{let j=[];if(_(v)){const{data:x}=await S.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:D}=await S.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:z}=await S.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:te}=await S.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");x&&x.forEach(q=>{j.push({id:`ts-${q.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${q.hours_worked||q.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),D&&D.forEach(q=>{const G=q.chargeable_to_customer!==!1;j.push({id:`exp-${q.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${q.resource_name||"Unknown"} expense (£${parseFloat(q.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:G})}),z&&z.forEach(q=>{j.push({id:`del-${q.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${q.deliverable_ref}: ${q.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),te&&te.forEach(q=>{j.push({id:`cert-${q.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:x}=await S.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",p),{data:D}=await S.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",p);x&&x.forEach(z=>{j.push({id:`ts-${z.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${z.hours_worked||z.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),D&&D.forEach(z=>{j.push({id:`exp-${z.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (£${parseFloat(z.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:j.length,items:j}}catch{return{count:0,items:[]}}},[]),R=f.useCallback(async()=>{try{const{data:{user:p}}=await S.auth.getUser();if(!p){t([]),s(0),a(0),c(!1);return}h(p.id);const{data:v}=await S.from("profiles").select("role").eq("id",p.id).single(),j=v?.role||"viewer";y(j);const{count:x,items:D}=await M(p.id,j);t(D),s(x),a(x)}catch{}finally{c(!1)}},[M]),C=f.useCallback(async p=>{t(v=>v.map(j=>j.id===p?{...j,is_read:!0}:j)),s(v=>Math.max(0,v-1))},[]),w=f.useCallback(async p=>{t(v=>v.map(j=>j.id===p?{...j,is_actioned:!0,is_read:!0}:j)),s(v=>Math.max(0,v-1)),a(v=>Math.max(0,v-1))},[]),P=f.useCallback(async()=>{t(p=>p.map(v=>({...v,is_read:!0}))),s(0)},[]),b=f.useCallback(async p=>{const v=e.find(j=>j.id===p);v&&(t(j=>j.filter(x=>x.id!==p)),v.is_read||s(j=>Math.max(0,j-1)),v.notification_type==="action"&&!v.is_actioned&&a(j=>Math.max(0,j-1)))},[e]);f.useEffect(()=>{R();const p=setInterval(()=>{R()},3e4);return()=>clearInterval(p)},[R]),f.useEffect(()=>{const{data:{subscription:p}}=S.auth.onAuthStateChange((v,j)=>{v==="SIGNED_IN"?R():v==="SIGNED_OUT"&&(t([]),s(0),a(0),h(null),y(null))});return()=>p.unsubscribe()},[R]);const g={notifications:e,unreadCount:n,actionCount:o,loading:l,fetchNotifications:R,markAsRead:C,markAsActioned:w,markAllAsRead:P,dismissNotification:b};return i.jsx(Gn.Provider,{value:g,children:r})}const Vn=f.createContext(null),tr={maxRetries:2,baseDelayMs:1e3,retryableCodes:[429,503,504]};function vi({children:r}){const{user:e,profile:t,linkedResource:n,role:s}=Mt(),{projectId:o,projectName:a,projectRef:l,currentProject:c}=Un(),[u,h]=f.useState(!1),[m,y]=f.useState([]),[_,M]=f.useState(!1),[R,C]=f.useState(null),[w,P]=f.useState(0),b=f.useRef(null),g=f.useCallback(()=>c?{id:o,reference:l||c?.reference,name:a||c?.name,description:c?.description||null}:null,[c,o,l,a]),p=f.useCallback(()=>({name:t?.full_name||e?.email?.split("@")[0]||"User",email:e?.email,role:s||t?.role||"unknown",linkedResourceName:n?.name||null,linkedResourceId:n?.id||null,partnerId:n?.partner_id||null,partnerName:n?.partners?.name||null}),[e,t,n,s]),v=async(G,re=1)=>{b.current=new AbortController;try{const J=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G),signal:b.current.signal}),O=await J.json().catch(()=>({}));if(!J.ok){if(tr.retryableCodes.includes(J.status)&&re<=tr.maxRetries&&O.recoverable!==!1){const ue=O.retryAfter?O.retryAfter*1e3:tr.baseDelayMs*Math.pow(2,re-1);return P(re),await new Promise(ne=>setTimeout(ne,ue)),v(G,re+1)}throw new Error(O.error||`Request failed (${J.status})`)}return P(0),O}catch(J){throw J.name==="AbortError"?new Error("Request cancelled"):J}},j=f.useCallback(async G=>{if(!G.trim()||_)return;b.current&&b.current.abort();const re={role:"user",content:G.trim()};y(J=>[...J,re]),M(!0),C(null),P(0);try{const J=g(),O=p(),U=[...m.slice(-9),re].map(ne=>({role:ne.role,content:ne.content})),ue=await v({messages:U,projectContext:J,userContext:O,projectId:o});y(ne=>[...ne,{role:"assistant",content:ue.message,toolsUsed:ue.toolsUsed||!1,cached:ue.cached||!1}])}catch(J){let O=J.message;J.message==="Request cancelled"?O=null:J.message.includes("Failed to fetch")&&(O="Unable to connect. Please check your internet connection."),O&&(C(O),y(U=>U.slice(0,-1)))}finally{M(!1),P(0)}},[m,_,g,p,o]),x=f.useCallback(()=>{b.current&&(b.current.abort(),M(!1),P(0))},[]),D=f.useCallback(()=>{x(),y([]),C(null)},[x]),z=f.useCallback(()=>{h(G=>!G)},[]),te=f.useCallback(()=>{C(null)},[]),q={isOpen:u,setIsOpen:h,toggleChat:z,messages:m,isLoading:_,error:R,retryCount:w,sendMessage:j,clearChat:D,cancelRequest:x,dismissError:te};return i.jsx(Vn.Provider,{value:q,children:r})}function xi(){const r=f.useContext(Vn);if(!r)throw new Error("useChat must be used within a ChatProvider");return r}class wi extends En.Component{constructor(t){super(t);Xt(this,"handleReload",()=>{window.location.reload()});Xt(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){this.setState({errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[i.jsx(Dn,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),i.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),i.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),i.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[i.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),i.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[i.jsx(vt,{size:16}),"Reload Page"]})]})]}):this.props.children}}function Mr({message:r,size:e="medium",fullPage:t=!1}){const n={small:{icon:16,text:"0.75rem",padding:"0.5rem"},medium:{icon:24,text:"0.875rem",padding:"1.5rem"},large:{icon:40,text:"1rem",padding:"3rem"}},s=n[e]||n.medium,o={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:s.padding,...t&&{minHeight:"60vh"}},a={animation:"spin 1s linear infinite",color:"#3b82f6"},l={marginTop:"0.75rem",color:"#64748b",fontSize:s.text};return i.jsxs("div",{style:o,children:[i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}),i.jsx(Mn,{size:s.icon,style:a}),r&&i.jsx("p",{style:l,children:r})]})}const _i={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function Pe({width:r="100%",height:e="1rem",style:t={},className:n=""}){return i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),i.jsx("div",{className:n,style:{width:r,height:e,borderRadius:"4px",..._i,...t}})]})}function yr({width:r="100%",lines:e=1}){return i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:e}).map((t,n)=>i.jsx(Pe,{width:n===e-1&&e>1?"70%":r,height:"1rem"},n))})}function Si(){return i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx(Pe,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Pe,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),i.jsx(Pe,{width:"40%",height:"1.5rem"})]})]})}function ji({columns:r=6}){return i.jsx("tr",{children:Array.from({length:r}).map((e,t)=>i.jsx("td",{style:{padding:"0.75rem 1rem"},children:i.jsx(Pe,{width:t===0?"80%":t===r-1?"60px":"70%",height:"1rem"})},t))})}function rr({hasHeader:r=!0}){return i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[r&&i.jsx(Pe,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),i.jsx(yr,{lines:3})]})}function st({type:r="text",count:e=1,...t}){return(()=>{switch(r){case"text":return i.jsx(yr,{...t});case"stat-card":case"stats":return i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:e}).map((s,o)=>i.jsx(Si,{},o))});case"table":return i.jsx("div",{className:"card",children:i.jsxs("table",{children:[i.jsx("thead",{children:i.jsx("tr",{children:Array.from({length:t.columns||6}).map((s,o)=>i.jsx("th",{style:{padding:"0.75rem 1rem"},children:i.jsx(Pe,{width:"60%",height:"0.875rem"})},o))})}),i.jsx("tbody",{children:Array.from({length:t.rows||5}).map((s,o)=>i.jsx(ji,{columns:t.columns||6},o))})]})});case"card":return i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:e}).map((s,o)=>i.jsx(rr,{...t},o))});case"page":return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx(Pe,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),i.jsx(Pe,{width:"300px",height:"1rem"})]}),i.jsx(Pe,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),i.jsx(st,{type:"stats",count:4}),i.jsx(st,{type:"table",rows:8,columns:6})]});case"detail":return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx(Pe,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),i.jsx(Pe,{width:"250px",height:"1.75rem"})]}),i.jsx(st,{type:"stats",count:4}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[i.jsx(rr,{}),i.jsx(rr,{})]}),i.jsx(st,{type:"table",rows:5,columns:5})]});default:return i.jsx(yr,{...t})}})()}function ft({icon:r,label:e,value:t,subtext:n,color:s="#3b82f6",borderColor:o,backgroundColor:a,style:l={},onClick:c}){const u={...o&&{borderLeft:`4px solid ${o}`},...a&&{backgroundColor:a},...c&&{cursor:"pointer"},...l};return i.jsxs("div",{className:"stat-card",style:u,onClick:c,role:c?"button":void 0,tabIndex:c?0:void 0,children:[i.jsxs("div",{className:"stat-label",children:[r&&i.jsx(r,{size:20,style:{color:s}}),e]}),i.jsx("div",{className:"stat-value",style:{color:s},children:t}),n&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:n})]})}function Pi({icon:r,title:e,subtitle:t,children:n,style:s={}}){return i.jsxs("div",{className:"page-header",style:s,children:[i.jsxs("div",{className:"page-title",children:[r&&i.jsx(r,{size:28}),i.jsxs("div",{children:[i.jsx("h1",{children:e}),t&&i.jsx("p",{children:t})]})]}),n&&i.jsx("div",{className:"page-actions",children:n})]})}const an={success:{icon:lo,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:On,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:Dn,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:ao,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function Ri({id:r,message:e,type:t="info",duration:n=4e3,onClose:s}){const o=an[t]||an.info,a=o.icon;return f.useEffect(()=>{if(n>0){const l=setTimeout(()=>{s(r)},n);return()=>clearTimeout(l)}},[r,n,s]),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:o.bgColor,border:`1px solid ${o.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[i.jsx(a,{size:20,style:{color:o.iconColor,flexShrink:0}}),i.jsx("span",{style:{color:o.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:e}),i.jsx("button",{onClick:()=>s(r),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:o.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:l=>l.target.style.opacity=1,onMouseLeave:l=>l.target.style.opacity=.7,children:i.jsx(Ue,{size:16})})]})}function Ci({toasts:r,removeToast:e}){return r.length===0?null:i.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),r.map(t=>i.jsx(Ri,{id:t.id,message:t.message,type:t.type,duration:t.duration,onClose:e},t.id))]})}const Yn=f.createContext(null),Ei=4e3;function Di({children:r}){const[e,t]=f.useState([]),n=f.useCallback(h=>{t(m=>m.filter(y=>y.id!==h))},[]),s=f.useCallback((h,m="info",y=Ei)=>{const _=Date.now()+Math.random(),M={id:_,message:h,type:m,duration:y};return t(R=>[...R,M]),_},[]),o=f.useCallback((h,m)=>s(h,"success",m),[s]),a=f.useCallback((h,m)=>s(h,"error",m||6e3),[s]),l=f.useCallback((h,m)=>s(h,"warning",m),[s]),c=f.useCallback((h,m)=>s(h,"info",m),[s]),u={showToast:s,showSuccess:o,showError:a,showWarning:l,showInfo:c,removeToast:n};return i.jsxs(Yn.Provider,{value:u,children:[r,i.jsx(Ci,{toasts:e,removeToast:n})]})}function Mi(){const r=f.useContext(Yn);if(!r)throw new Error("useToast must be used within a ToastProvider");return r}function Oi(){const{isOpen:r,toggleChat:e,messages:t,isLoading:n,error:s,retryCount:o,sendMessage:a,clearChat:l,cancelRequest:c,dismissError:u}=xi(),[h,m]=f.useState(""),y=f.useRef(null),_=f.useRef(null);f.useEffect(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[t]),f.useEffect(()=>{r&&setTimeout(()=>_.current?.focus(),100)},[r]);const M=P=>{P.preventDefault(),h.trim()&&!n&&(a(h),m(""))},R=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),M(P))},C={role:"assistant",content:`Hello! I'm your Project Assistant. I can query your project data and help you understand what's happening. Try asking:

• **"What do I need to do?"** - See your pending actions
• **"Show my timesheets this month"** - Query your time entries
• **"What milestones are at risk?"** - Check project progress
• **"What's the budget status?"** - View spend vs forecast
• **"What can my role do?"** - Understand your permissions

All data is scoped to your role, so just ask naturally!`},w=t.length===0?[C]:t;return i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`chat-toggle-btn ${r?"chat-open":""}`,onClick:e,"aria-label":r?"Close chat":"Open AI assistant",children:r?i.jsx(Ue,{size:24}):i.jsxs(i.Fragment,{children:[i.jsx(co,{size:24}),i.jsx(uo,{className:"chat-sparkle",size:12})]})}),i.jsxs("div",{className:`chat-panel ${r?"chat-panel-open":""}`,children:[i.jsxs("div",{className:"chat-header",children:[i.jsxs("div",{className:"chat-header-title",children:[i.jsx(Qt,{size:20}),i.jsx("span",{children:"Project Assistant"})]}),i.jsxs("div",{className:"chat-header-actions",children:[t.length>0&&i.jsx("button",{className:"chat-clear-btn",onClick:l,title:"Clear chat",children:i.jsx(fo,{size:16})}),i.jsx("button",{className:"chat-close-btn",onClick:e,"aria-label":"Close chat",children:i.jsx(Ue,{size:20})})]})]}),i.jsxs("div",{className:"chat-messages",children:[w.map((P,b)=>i.jsxs("div",{className:`chat-message ${P.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[i.jsx("div",{className:"chat-message-avatar",children:P.role==="user"?i.jsx(ho,{size:16}):i.jsx(Qt,{size:16})}),i.jsxs("div",{className:"chat-message-content",children:[i.jsx(ki,{content:P.content}),P.toolsUsed&&i.jsx("div",{className:"chat-tools-indicator",title:"Queried project data",children:i.jsx(po,{size:12})})]})]},b)),n&&i.jsxs("div",{className:"chat-message chat-message-assistant",children:[i.jsx("div",{className:"chat-message-avatar",children:i.jsx(Qt,{size:16})}),i.jsxs("div",{className:"chat-message-content chat-typing",children:[o>0?i.jsxs(i.Fragment,{children:[i.jsx(vt,{className:"chat-typing-icon",size:16}),i.jsxs("span",{children:["Retrying (",o,"/2)..."]})]}):i.jsxs(i.Fragment,{children:[i.jsx(Mn,{className:"chat-typing-icon",size:16}),i.jsx("span",{children:"Querying data..."})]}),i.jsx("button",{className:"chat-cancel-btn",onClick:c,title:"Cancel request",children:i.jsx(On,{size:14})})]})]}),s&&i.jsxs("div",{className:"chat-error",children:[i.jsx("span",{children:s}),i.jsx("button",{className:"chat-error-dismiss",onClick:u,title:"Dismiss",children:i.jsx(Ue,{size:14})})]}),i.jsx("div",{ref:y})]}),i.jsxs("form",{className:"chat-input-form",onSubmit:M,children:[i.jsx("textarea",{ref:_,className:"chat-input",value:h,onChange:P=>m(P.target.value),onKeyDown:R,placeholder:"Ask me anything about the project...",rows:1,disabled:n}),i.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!h.trim()||n,"aria-label":"Send message",children:i.jsx(mo,{size:18})})]}),i.jsx("div",{className:"chat-footer",children:"Powered by Claude AI"})]})]})}function ki({content:r}){const e=r.split(`
`);return i.jsx("div",{className:"chat-message-text",children:e.map((t,n)=>{if(t.startsWith("• ")||t.startsWith("- ")){const s=t.substring(2);return i.jsxs("div",{className:"chat-bullet",children:[i.jsx("span",{className:"chat-bullet-dot",children:"•"}),i.jsx("span",{dangerouslySetInnerHTML:{__html:ln(s)}})]},n)}return t.trim()===""?i.jsx("div",{className:"chat-line-break"},n):i.jsx("p",{dangerouslySetInnerHTML:{__html:ln(t)}},n)})})}function ln(r){return r.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function Ii(){const[r,e]=f.useState(!1),t=f.useRef(null),n=Dr(),{notifications:s,unreadCount:o,actionCount:a,loading:l,markAsRead:c,markAsActioned:u,markAllAsRead:h,dismissNotification:m}=yi();f.useEffect(()=>{function g(p){t.current&&!t.current.contains(p.target)&&e(!1)}return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const y=g=>{switch(g){case"timesheet":return i.jsx(at,{size:16});case"expense":return i.jsx(zn,{size:16});case"deliverable":return i.jsx(In,{size:16});case"certificate":return i.jsx(xt,{size:16});default:return i.jsx(Jt,{size:16})}},_=g=>g.notification_type==="action"?g.is_actioned?"#10b981":"#f59e0b":"#3b82f6",M=async g=>{g.is_read||await c(g.id),g.action_url&&(n(g.action_url),e(!1))},R=async(g,p)=>{g.stopPropagation(),await u(p.id),p.action_url&&(n(p.action_url),e(!1))},C=async(g,p)=>{g.stopPropagation(),await m(p.id)},w=g=>{const p=new Date(g),j=new Date-p,x=Math.floor(j/6e4),D=Math.floor(j/36e5),z=Math.floor(j/864e5);return x<1?"Just now":x<60?`${x}m ago`:D<24?`${D}h ago`:z<7?`${z}d ago`:p.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},P=s.slice(0,10),b=s.filter(g=>g.notification_type==="action"&&!g.is_actioned);return i.jsxs("div",{className:"notification-bell-container",ref:t,style:{position:"relative"},children:[i.jsxs("button",{onClick:()=>e(!r),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:r?"#f1f5f9":"transparent"},onMouseEnter:g=>g.target.style.backgroundColor="#f1f5f9",onMouseLeave:g=>g.target.style.backgroundColor=r?"#f1f5f9":"transparent",title:`${a} actions pending`,children:[i.jsx(Jt,{size:22,color:"#64748b"}),(o>0||a>0)&&i.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:a>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:a>0?a:o})]}),r&&i.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),a>0&&i.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[a," action",a!==1?"s":""," required"]})]}),o>0&&i.jsx("button",{onClick:h,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),b.length>0&&i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),i.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),i.jsxs("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",i.jsx(go,{size:16})]})]}),i.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:l?i.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):P.length===0?i.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[i.jsx(Jt,{size:32,style:{marginBottom:"8px",opacity:.5}}),i.jsx("p",{style:{margin:0},children:"No notifications"})]}):P.map(g=>i.jsx("div",{onClick:()=>M(g),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:g.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:p=>p.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:p=>p.currentTarget.style.backgroundColor=g.is_read?"white":"#f8fafc",children:i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:g.notification_type==="action"&&!g.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:_(g),flexShrink:0},children:y(g.category)}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[i.jsx("span",{style:{fontWeight:g.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:g.title}),i.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:w(g.created_at)})]}),i.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:g.message}),i.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[g.notification_type==="action"&&!g.is_actioned&&g.action_label&&i.jsx("button",{onClick:p=>R(p,g),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:g.action_label}),g.notification_type==="info"&&i.jsxs("button",{onClick:p=>C(p,g),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ue,{size:12}),"Dismiss"]}),g.is_actioned&&i.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(kn,{size:12}),"Completed"]})]})]})]})},g.id))}),s.length>10&&i.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:i.jsx("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),i.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const d={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"};function H(r,e){return e.includes(r)}function Fu(r){return H(r,[d.ADMIN,d.SUPPLIER_PM])}function Kn(r){return H(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function Xn(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function zi(r){return H(r,[d.CUSTOMER_PM,d.ADMIN])}function Gu(r,e,t,n){if(H(r,[d.ADMIN,d.SUPPLIER_PM]))return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),o===a&&(s==="Draft"||s==="Rejected")}function Vu(r,e,t,n){if(r===d.ADMIN||r===d.SUPPLIER_PM)return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),o===a&&s==="Draft"}function Yu(r,e,t,n){let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),s!=="Draft"&&s!=="Rejected"?!1:H(r,[d.ADMIN,d.SUPPLIER_PM])?!0:o===a&&Kn(r)}function Ni(r){return H(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function Ti(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Ku(r,e,t){let n,s;return typeof e=="object"&&e!==null?(n=e.status,s=e.chargeable||e.chargeable_to_customer):(n=e,s=t),n!=="Submitted"?!1:r===d.ADMIN?!0:s?r===d.CUSTOMER_PM:r===d.SUPPLIER_PM}function Ai(r){return H(r,[d.CUSTOMER_PM,d.ADMIN])}function Li(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Xu(r,e,t,n){if(H(r,[d.ADMIN,d.SUPPLIER_PM]))return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by,a=t):(s=e,o=t,a=n),o===a&&(s==="Draft"||s==="Rejected")}function Qu(r,e,t,n){if(r===d.ADMIN||r===d.SUPPLIER_PM)return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by,a=t):(s=e,o=t,a=n),o===a&&s==="Draft"}function qi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Wi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Bi(r){return r===d.ADMIN}function Hi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function $i(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Ui(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Ju(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Zu(r,e,t){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])?!0:r===d.CONTRIBUTOR?e?.assigned_to===t||e?.resource?.user_id===t:!1}function Fi(r){return H(r,[d.CUSTOMER_PM,d.ADMIN])}function ed(r){return H(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function Ot(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function td(r){return Ot(r)}function rd(r){return Ot(r)}function nd(r){return Ot(r)}function kt(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function sd(r){return kt(r)}function od(r){return kt(r)}function id(r){return kt(r)}function Or(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function ad(r){return Or(r)}function ld(r){return Or(r)}function Gi(r){return r===d.ADMIN}function Vi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function cd(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Qn(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Yi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function It(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function ud(r){return It(r)}function dd(r){return It(r)}function fd(r){return It(r)}function Ki(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Xi(r){return H(r,[d.CUSTOMER_PM,d.ADMIN])}function hd(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Qi(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function pd(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Ji(r){return r===d.ADMIN}function md(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function Zi(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function ea(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function ta(r){return H(r,[d.SUPPLIER_PM,d.ADMIN])}function gd(r){return Qn(r)}function yd(r){return H(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function ra(r,e,t){return!e||!Array.isArray(e)?[]:Xn(r)?e:e.filter(n=>n.user_id===t)}function bd(r,e){return!r||!Array.isArray(r)?null:r.find(t=>t.user_id===e)||null}function na(r,e,t){const n=ra(r,e,t);return n.length===0?null:n.find(o=>o.user_id===t)||n[0]}function vd(r,e,t){return na(r,e,t)?.id||null}function sa(r){const e={admin:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},supplier_pm:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},customer_pm:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},contributor:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},viewer:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}};return e[r]||e.viewer}function oa(r){return sa(r).label}const xd=[{value:"viewer",label:"Viewer",color:"#64748b",bg:"#f1f5f9"},{value:"contributor",label:"Contributor",color:"#2563eb",bg:"#dbeafe"},{value:"customer_pm",label:"Customer PM",color:"#d97706",bg:"#fef3c7"},{value:"supplier_pm",label:"Supplier PM",color:"#059669",bg:"#d1fae5"},{value:"admin",label:"Admin",color:"#7c3aed",bg:"#f3e8ff"}];function wd(r){return{role:r,roleLabel:oa(r),timesheets:{canAdd:Kn(r),canAddForOthers:Xn(r),canApprove:zi(r)},expenses:{canAdd:Ni(r),canAddForOthers:Ti(r),canValidateChargeable:Ai(r),canValidateNonChargeable:Li(r)},milestones:{canCreate:qi(r),canEdit:Wi(r),canDelete:Bi(r),canUseGantt:Hi(r)},deliverables:{canCreate:$i(r),canEdit:Ui(r),canReview:Fi(r)},kpis:{canManage:Ot(r)},qualityStandards:{canManage:kt(r)},resources:{canManage:Or(r),canDelete:Gi(r),canSeeCostPrice:Vi(r),canSeeMargins:Qn(r)},partners:{canView:Yi(r),canManage:It(r)},certificates:{canSignAsSupplier:Ki(r),canSignAsCustomer:Xi(r)},admin:{canAccessSettings:Qi(r),canManageUsers:Ji(r),canViewWorkflowSummary:Zi(r)},invoicing:{canGenerateCustomerInvoice:ea(r),canGenerateThirdPartyInvoice:ta(r)}}}const zt={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:Po,label:"Workflow Summary",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:jo,label:"Dashboard",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER]},reports:{id:"reports",path:"/reports",icon:In,label:"Reports",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:So,label:"Gantt Chart",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:_o,label:"Milestones",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:pr,label:"Deliverables",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR,d.VIEWER],readOnlyRoles:[d.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:yt,label:"KPIs",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:xt,label:"Quality Standards",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:wo,label:"Resources",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:at,label:"Timesheets",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:zn,label:"Expenses",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:xo,label:"Partners",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:vo,label:"Users",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[d.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:Nn,label:"Settings",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},auditLog:{id:"auditLog",path:"/audit-log",icon:bo,label:"Audit Log",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},deletedItems:{id:"deletedItems",path:"/deleted-items",icon:yo,label:"Deleted Items",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]}},wt={[d.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[d.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[d.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[d.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[d.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function ia(r){return(wt[r]||wt[d.VIEWER]).map(t=>zt[t]?.path).filter(Boolean)}function Jn(r){return(wt[r]||wt[d.VIEWER]).map(t=>zt[t]).filter(t=>t&&t.allowedRoles.includes(r))}function cn(r,e){const t=zt[e];return t?t.readOnlyRoles?.includes(r)||!1:!0}function aa(r){return r!==d.VIEWER}function la(r){return Object.values(zt).find(e=>e.path===r)||null}function ca(r){return la(r)?.id||null}function ua(r,e){const t=Jn(r);if(!e||!Array.isArray(e)||e.length===0)return t;const n={};t.forEach(o=>{n[o.path]=o});const s=[];return e.forEach(o=>{n[o]&&(s.push(n[o]),delete n[o])}),Object.values(n).forEach(o=>{s.push(o)}),s}function da(r,e){if(!e||e.length===0)return!0;const t=ia(r);return e.length!==t.length?!1:e.every((n,s)=>n===t[s])}const un={[d.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[d.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[d.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[d.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[d.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function fa(r){return un[r]||un[d.VIEWER]}function ha({children:r}){const e=Zs(),t=Dr(),{showSuccess:n,showError:s}=Mi(),{user:o,profile:a,role:l,signOut:c}=Mt(),[u,h]=f.useState(!0),[m,y]=f.useState(null),[_,M]=f.useState(null),[R,C]=f.useState(null),w=f.useRef(null),P=f.useMemo(()=>fa(l),[l]),b=f.useMemo(()=>a&&(a.full_name||a.email||o?.email)||"User",[a,o]),g=f.useMemo(()=>{if(!a)return"U";if(a.full_name){const O=a.full_name.split(" ");return O.length>=2?O[0][0]+O[O.length-1][0]:a.full_name[0].toUpperCase()}return b[0].toUpperCase()},[a,b]);f.useEffect(()=>{a?.nav_order&&Array.isArray(a.nav_order)&&y(a.nav_order)},[a]);async function p(){await c(),t("/login")}const v=f.useMemo(()=>aa(l),[l]),j=f.useMemo(()=>m&&!da(l,m),[l,m]),x=f.useMemo(()=>{const O=Jn(l);return m&&m.length>0?ua(l,m):O},[l,m]),D=f.useMemo(()=>{const O=ca(e.pathname);return O?cn(l,O):!1},[l,e.pathname]);function z(O,U){v&&(w.current=O.target,M(U),setTimeout(()=>{w.current&&(w.current.style.opacity="0.5")},0))}function te(O,U){v&&U!==_&&C(U)}function q(O){v&&O.preventDefault()}function G(){if(v){if(w.current&&(w.current.style.opacity="1"),_!==null&&R!==null&&_!==R){const O=[...x],U=O[_];O.splice(_,1),O.splice(R,0,U);const ue=O.map(ne=>ne.path);y(ue),re(ue)}M(null),C(null),w.current=null}}async function re(O){if(o)try{const{error:U}=await S.from("profiles").update({nav_order:O}).eq("id",o.id);U&&s("Failed to save menu order")}catch{s("Failed to save menu order")}}async function J(){if(o)try{const{error:O}=await S.from("profiles").update({nav_order:null}).eq("id",o.id);if(O){s("Failed to reset menu order");return}y(null),n("Menu order reset to default")}catch{s("Failed to reset menu order")}}return i.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[i.jsxs("aside",{style:{width:u?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[i.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[u&&i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),i.jsx("button",{onClick:()=>h(!u),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u?i.jsx(Ue,{size:20}):i.jsx(Ro,{size:20})})]}),i.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:x.map((O,U)=>{const ue=O.icon,ne=e.pathname===O.path||O.path!=="/dashboard"&&e.pathname.startsWith(O.path),ke=_===U,Ie=R===U,Ne=cn(l,O.id);return i.jsx("div",{draggable:v,onDragStart:I=>z(I,U),onDragEnter:I=>te(I,U),onDragOver:q,onDragEnd:G,style:{position:"relative",marginBottom:"0.25rem",borderTop:Ie&&_>U?"2px solid #10b981":"2px solid transparent",borderBottom:Ie&&_<U?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:i.jsxs(Le,{to:O.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:u?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:ne?"#10b981":"#64748b",backgroundColor:ne?"#f0fdf4":ke?"#f1f5f9":"transparent",fontWeight:ne?"600":"500",justifyContent:u?"flex-start":"center",transition:"all 0.15s ease",cursor:v?"grab":"pointer"},children:[u&&v&&i.jsx(Co,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),i.jsx(ue,{size:20}),u&&i.jsx("span",{style:{flex:1},children:O.label}),u&&Ne&&i.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},O.path)})}),u&&v&&j&&i.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:i.jsxs("button",{onClick:J,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:O=>{O.currentTarget.style.backgroundColor="#f1f5f9",O.currentTarget.style.color="#475569"},onMouseLeave:O=>{O.currentTarget.style.backgroundColor="#f8fafc",O.currentTarget.style.color="#64748b"},children:[i.jsx(Tn,{size:14}),"Reset Menu Order"]})}),i.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:i.jsxs("button",{onClick:p,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:u?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[i.jsx(Eo,{size:20}),u&&i.jsx("span",{children:"Logout"})]})})]}),i.jsxs("main",{style:{flex:1,marginLeft:u?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[i.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[i.jsxs(Le,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:O=>O.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:O=>O.currentTarget.style.backgroundColor="transparent",children:[i.jsxs("div",{style:{textAlign:"right"},children:[i.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:b}),i.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:P.bg,color:P.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:P.shortLabel})]}),i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:P.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:g})]}),i.jsx(Ii,{})]}),D&&i.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),i.jsx("span",{children:"You have read-only access to this page"})]}),i.jsx("div",{style:{flex:1},children:r})]})]})}function pa(){const r=Dr(),[e]=eo(),[t,n]=f.useState(!1),[s,o]=f.useState(""),[a,l]=f.useState(""),[c,u]=f.useState(null),[h,m]=f.useState(null),[y,_]=f.useState(!1),[M,R]=f.useState(!1),[C,w]=f.useState(!1),[P,b]=f.useState(!1);f.useEffect(()=>{e.get("expired")==="true"&&(b(!0),window.history.replaceState({},document.title,"/login")),S.auth.getSession().then(({data:{session:D}})=>{D&&r("/dashboard",{replace:!0})});const{data:{subscription:x}}=S.auth.onAuthStateChange((D,z)=>{D==="SIGNED_IN"&&z&&r("/dashboard",{replace:!0})});return()=>x.unsubscribe()},[r,e]);const g=async x=>{x.preventDefault(),n(!0),u(null),m(null),b(!1);try{if(y){const{error:D}=await S.auth.signUp({email:s,password:a,options:{data:{full_name:s.split("@")[0]}}});if(D)throw D;m("Check your email for confirmation link!")}else{const{error:D}=await S.auth.signInWithPassword({email:s,password:a});if(D)throw D}}catch(D){u(D.message)}finally{n(!1)}},p=async x=>{if(x.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),m(null);try{const{error:D}=await S.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/reset-password`});if(D)throw D;m("Password reset email sent! Check your inbox.")}catch(D){u(D.message)}finally{n(!1)}},v=async x=>{if(x.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),m(null);try{const{error:D}=await S.auth.resend({type:"signup",email:s});if(D)throw D;m("Verification email resent! Check your inbox.")}catch(D){u(D.message)}finally{n(!1)}},j=()=>{R(!1),w(!1),u(null),m(null),b(!1)};return M?i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx(Do,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),i.jsx("h1",{className:"auth-title",children:"Reset Password"}),i.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),i.jsxs("form",{onSubmit:p,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>o(x.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(er,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Send Reset Link"})]}),i.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:i.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):C?i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx(vt,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),i.jsx("h1",{className:"auth-title",children:"Resend Verification"}),i.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),i.jsxs("form",{onSubmit:v,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>o(x.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(er,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Resend Verification Email"})]}),i.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:i.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),i.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),P&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[i.jsx(at,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),i.jsxs("form",{onSubmit:g,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>o(x.target.value),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),i.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"••••••••",value:a,onChange:x=>l(x.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(er,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Loading...":y?"Sign Up":"Sign In"})]}),!y&&i.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:i.jsx("button",{onClick:()=>{R(!0),u(null),m(null),b(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),i.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:i.jsx("button",{onClick:()=>{_(!y),u(null),m(null),b(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:y?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),i.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[i.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),i.jsxs("button",{onClick:()=>{w(!0),u(null),m(null),b(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx(vt,{size:14})," Resend Verification Email"]})]})]})})}var Zn={exports:{}},lt={},br={exports:{}};(function(r,e){(function(t,n){n(e)})(to,function(t){function n(E){return function(T,W,F,Z,le,he,ee){return E(T,W,ee)}}function s(E){return function(T,W,F,Z){if(!T||!W||typeof T!="object"||typeof W!="object")return E(T,W,F,Z);var le=Z.get(T),he=Z.get(W);if(le&&he)return le===W&&he===T;Z.set(T,W),Z.set(W,T);var ee=E(T,W,F,Z);return Z.delete(T),Z.delete(W),ee}}function o(E,k){var T={};for(var W in E)T[W]=E[W];for(var W in k)T[W]=k[W];return T}function a(E){return E.constructor===Object||E.constructor==null}function l(E){return typeof E.then=="function"}function c(E,k){return E===k||E!==E&&k!==k}var u="[object Arguments]",h="[object Boolean]",m="[object Date]",y="[object RegExp]",_="[object Map]",M="[object Number]",R="[object Object]",C="[object Set]",w="[object String]",P=Object.prototype.toString;function b(E){var k=E.areArraysEqual,T=E.areDatesEqual,W=E.areMapsEqual,F=E.areObjectsEqual,Z=E.areRegExpsEqual,le=E.areSetsEqual,he=E.createIsNestedEqual,ee=he(xe);function xe(K,X,be){if(K===X)return!0;if(!K||!X||typeof K!="object"||typeof X!="object")return K!==K&&X!==X;if(a(K)&&a(X))return F(K,X,ee,be);var tt=Array.isArray(K),dt=Array.isArray(X);if(tt||dt)return tt===dt&&k(K,X,ee,be);var je=P.call(K);return je!==P.call(X)?!1:je===m?T(K,X,ee,be):je===y?Z(K,X,ee,be):je===_?W(K,X,ee,be):je===C?le(K,X,ee,be):je===R||je===u?l(K)||l(X)?!1:F(K,X,ee,be):je===h||je===M||je===w?c(K.valueOf(),X.valueOf()):!1}return xe}function g(E,k,T,W){var F=E.length;if(k.length!==F)return!1;for(;F-- >0;)if(!T(E[F],k[F],F,F,E,k,W))return!1;return!0}var p=s(g);function v(E,k){return c(E.valueOf(),k.valueOf())}function j(E,k,T,W){var F=E.size===k.size;if(!F)return!1;if(!E.size)return!0;var Z={},le=0;return E.forEach(function(he,ee){if(F){var xe=!1,K=0;k.forEach(function(X,be){!xe&&!Z[K]&&(xe=T(ee,be,le,K,E,k,W)&&T(he,X,ee,be,E,k,W))&&(Z[K]=!0),K++}),le++,F=xe}}),F}var x=s(j),D="_owner",z=Object.prototype.hasOwnProperty;function te(E,k,T,W){var F=Object.keys(E),Z=F.length;if(Object.keys(k).length!==Z)return!1;for(var le;Z-- >0;){if(le=F[Z],le===D){var he=!!E.$$typeof,ee=!!k.$$typeof;if((he||ee)&&he!==ee)return!1}if(!z.call(k,le)||!T(E[le],k[le],le,le,E,k,W))return!1}return!0}var q=s(te);function G(E,k){return E.source===k.source&&E.flags===k.flags}function re(E,k,T,W){var F=E.size===k.size;if(!F)return!1;if(!E.size)return!0;var Z={};return E.forEach(function(le,he){if(F){var ee=!1,xe=0;k.forEach(function(K,X){!ee&&!Z[xe]&&(ee=T(le,K,he,X,E,k,W))&&(Z[xe]=!0),xe++}),F=ee}}),F}var J=s(re),O=Object.freeze({areArraysEqual:g,areDatesEqual:v,areMapsEqual:j,areObjectsEqual:te,areRegExpsEqual:G,areSetsEqual:re,createIsNestedEqual:n}),U=Object.freeze({areArraysEqual:p,areDatesEqual:v,areMapsEqual:x,areObjectsEqual:q,areRegExpsEqual:G,areSetsEqual:J,createIsNestedEqual:n}),ue=b(O);function ne(E,k){return ue(E,k,void 0)}var ke=b(o(O,{createIsNestedEqual:function(){return c}}));function Ie(E,k){return ke(E,k,void 0)}var Ne=b(U);function I(E,k){return Ne(E,k,new WeakMap)}var ce=b(o(U,{createIsNestedEqual:function(){return c}}));function de(E,k){return ce(E,k,new WeakMap)}function Y(E){return b(o(O,E(O)))}function se(E){var k=b(o(U,E(U)));return function(T,W,F){return F===void 0&&(F=new WeakMap),k(T,W,F)}}t.circularDeepEqual=I,t.circularShallowEqual=de,t.createCustomCircularEqual=se,t.createCustomEqual=Y,t.deepEqual=ne,t.sameValueZeroEqual=c,t.shallowEqual=Ie,Object.defineProperty(t,"__esModule",{value:!0})})})(br,br.exports);var kr=br.exports,$={},ma=function(e,t,n){return e===t?!0:e.className===t.className&&n(e.style,t.style)&&e.width===t.width&&e.autoSize===t.autoSize&&e.cols===t.cols&&e.draggableCancel===t.draggableCancel&&e.draggableHandle===t.draggableHandle&&n(e.verticalCompact,t.verticalCompact)&&n(e.compactType,t.compactType)&&n(e.layout,t.layout)&&n(e.margin,t.margin)&&n(e.containerPadding,t.containerPadding)&&e.rowHeight===t.rowHeight&&e.maxRows===t.maxRows&&e.isBounded===t.isBounded&&e.isDraggable===t.isDraggable&&e.isResizable===t.isResizable&&e.allowOverlap===t.allowOverlap&&e.preventCollision===t.preventCollision&&e.useCSSTransforms===t.useCSSTransforms&&e.transformScale===t.transformScale&&e.isDroppable===t.isDroppable&&n(e.resizeHandles,t.resizeHandles)&&n(e.resizeHandle,t.resizeHandle)&&e.onLayoutChange===t.onLayoutChange&&e.onDragStart===t.onDragStart&&e.onDrag===t.onDrag&&e.onDragStop===t.onDragStop&&e.onResizeStart===t.onResizeStart&&e.onResize===t.onResize&&e.onResizeStop===t.onResizeStop&&e.onDrop===t.onDrop&&n(e.droppingItem,t.droppingItem)&&n(e.innerRef,t.innerRef)};Object.defineProperty($,"__esModule",{value:!0});$.bottom=Ir;$.childrenEqual=ba;$.cloneLayout=es;$.cloneLayoutItem=Fe;$.collides=Nt;$.compact=rs;$.compactItem=ns;$.compactType=ka;$.correctBounds=ss;$.fastPositionEqual=va;$.fastRGLPropsEqual=void 0;$.getAllCollisions=os;$.getFirstCollision=He;$.getLayoutItem=zr;$.getStatics=Nr;$.modifyLayout=ts;$.moveElement=it;$.moveElementAwayFromCollision=xr;$.noop=void 0;$.perc=wa;$.resizeItemInDirection=Ca;$.setTopLeft=Da;$.setTransform=Ea;$.sortLayoutItems=Br;$.sortLayoutItemsByColRow=us;$.sortLayoutItemsByRowCol=cs;$.synchronizeLayoutWithChildren=Ma;$.validateLayout=Oa;$.withLayoutItem=ya;var dn=kr,ot=ga(f);function ga(r){return r&&r.__esModule?r:{default:r}}function Ir(r){let e=0,t;for(let n=0,s=r.length;n<s;n++)t=r[n].y+r[n].h,t>e&&(e=t);return e}function es(r){const e=Array(r.length);for(let t=0,n=r.length;t<n;t++)e[t]=Fe(r[t]);return e}function ts(r,e){const t=Array(r.length);for(let n=0,s=r.length;n<s;n++)e.i===r[n].i?t[n]=e:t[n]=r[n];return t}function ya(r,e,t){let n=zr(r,e);return n?(n=t(Fe(n)),r=ts(r,n),[r,n]):[r,null]}function Fe(r){return{w:r.w,h:r.h,x:r.x,y:r.y,i:r.i,minW:r.minW,maxW:r.maxW,minH:r.minH,maxH:r.maxH,moved:!!r.moved,static:!!r.static,isDraggable:r.isDraggable,isResizable:r.isResizable,resizeHandles:r.resizeHandles,isBounded:r.isBounded}}function ba(r,e){return(0,dn.deepEqual)(ot.default.Children.map(r,t=>t?.key),ot.default.Children.map(e,t=>t?.key))&&(0,dn.deepEqual)(ot.default.Children.map(r,t=>t?.props["data-grid"]),ot.default.Children.map(e,t=>t?.props["data-grid"]))}$.fastRGLPropsEqual=ma;function va(r,e){return r.left===e.left&&r.top===e.top&&r.width===e.width&&r.height===e.height}function Nt(r,e){return!(r.i===e.i||r.x+r.w<=e.x||r.x>=e.x+e.w||r.y+r.h<=e.y||r.y>=e.y+e.h)}function rs(r,e,t,n){const s=Nr(r),o=Br(r,e),a=Array(r.length);for(let l=0,c=o.length;l<c;l++){let u=Fe(o[l]);u.static||(u=ns(s,u,e,t,o,n),s.push(u)),a[r.indexOf(o[l])]=u,u.moved=!1}return a}const xa={x:"w",y:"h"};function vr(r,e,t,n){const s=xa[n];e[n]+=1;const o=r.map(a=>a.i).indexOf(e.i);for(let a=o+1;a<r.length;a++){const l=r[a];if(!l.static){if(l.y>e.y+e.h)break;Nt(e,l)&&vr(r,l,t+e[s],n)}}e[n]=t}function ns(r,e,t,n,s,o){const a=t==="vertical",l=t==="horizontal";if(a)for(e.y=Math.min(Ir(r),e.y);e.y>0&&!He(r,e);)e.y--;else if(l)for(;e.x>0&&!He(r,e);)e.x--;let c;for(;(c=He(r,e))&&!(t===null&&o);)if(l?vr(s,e,c.x+c.w,"x"):vr(s,e,c.y+c.h,"y"),l&&e.x+e.w>n)for(e.x=n-e.w,e.y++;e.x>0&&!He(r,e);)e.x--;return e.y=Math.max(e.y,0),e.x=Math.max(e.x,0),e}function ss(r,e){const t=Nr(r);for(let n=0,s=r.length;n<s;n++){const o=r[n];if(o.x+o.w>e.cols&&(o.x=e.cols-o.w),o.x<0&&(o.x=0,o.w=e.cols),!o.static)t.push(o);else for(;He(t,o);)o.y++}return r}function zr(r,e){for(let t=0,n=r.length;t<n;t++)if(r[t].i===e)return r[t]}function He(r,e){for(let t=0,n=r.length;t<n;t++)if(Nt(r[t],e))return r[t]}function os(r,e){return r.filter(t=>Nt(t,e))}function Nr(r){return r.filter(e=>e.static)}function it(r,e,t,n,s,o,a,l,c){if(e.static&&e.isDraggable!==!0||e.y===n&&e.x===t)return r;`${e.i}${String(t)}${String(n)}${e.x}${e.y}`;const u=e.x,h=e.y;typeof t=="number"&&(e.x=t),typeof n=="number"&&(e.y=n),e.moved=!0;let m=Br(r,a);(a==="vertical"&&typeof n=="number"?h>=n:a==="horizontal"&&typeof t=="number"?u>=t:!1)&&(m=m.reverse());const _=os(m,e),M=_.length>0;if(M&&c)return es(r);if(M&&o)return`${e.i}`,e.x=u,e.y=h,e.moved=!1,r;for(let R=0,C=_.length;R<C;R++){const w=_[R];`${e.i}${e.x}${e.y}${w.i}${w.x}${w.y}`,!w.moved&&(w.static?r=xr(r,w,e,s,a):r=xr(r,e,w,s,a))}return r}function xr(r,e,t,n,s,o){const a=s==="horizontal",l=s==="vertical",c=e.static;if(n){n=!1;const m={x:a?Math.max(e.x-t.w,0):t.x,y:l?Math.max(e.y-t.h,0):t.y,w:t.w,h:t.h,i:"-1"},y=He(r,m),_=y&&y.y+y.h>e.y,M=y&&e.x+e.w>y.x;if(y){if(_&&l)return it(r,t,void 0,e.y+1,n,c,s);if(_&&s==null)return e.y=t.y,t.y=t.y+t.h,r;if(M&&a)return it(r,e,t.x,void 0,n,c,s)}else return`${t.i}${m.x}${m.y}`,it(r,t,a?m.x:void 0,l?m.y:void 0,n,c,s)}const u=a?t.x+1:void 0,h=l?t.y+1:void 0;return u==null&&h==null?r:it(r,t,a?t.x+1:void 0,l?t.y+1:void 0,n,c,s)}function wa(r){return r*100+"%"}const is=(r,e,t,n)=>r+t>n?e:t,as=(r,e,t)=>r<0?e:t,ls=r=>Math.max(0,r),Tr=r=>Math.max(0,r),Ar=(r,e,t)=>{let{left:n,height:s,width:o}=e;const a=r.top-(s-r.height);return{left:n,width:o,height:as(a,r.height,s),top:Tr(a)}},Lr=(r,e,t)=>{let{top:n,left:s,height:o,width:a}=e;return{top:n,height:o,width:is(r.left,r.width,a,t),left:ls(s)}},qr=(r,e,t)=>{let{top:n,height:s,width:o}=e;const a=r.left-(o-r.width);return{height:s,width:a<0?r.width:is(r.left,r.width,o,t),top:Tr(n),left:ls(a)}},Wr=(r,e,t)=>{let{top:n,left:s,height:o,width:a}=e;return{width:a,left:s,height:as(n,r.height,o),top:Tr(n)}},_a=function(){return Ar(arguments.length<=0?void 0:arguments[0],Lr(...arguments))},Sa=function(){return Ar(arguments.length<=0?void 0:arguments[0],qr(...arguments))},ja=function(){return Wr(arguments.length<=0?void 0:arguments[0],Lr(...arguments))},Pa=function(){return Wr(arguments.length<=0?void 0:arguments[0],qr(...arguments))},Ra={n:Ar,ne:_a,e:Lr,se:ja,s:Wr,sw:Pa,w:qr,nw:Sa};function Ca(r,e,t,n){const s=Ra[r];return s?s(e,{...e,...t},n):t}function Ea(r){let{top:e,left:t,width:n,height:s}=r;const o=`translate(${t}px,${e}px)`;return{transform:o,WebkitTransform:o,MozTransform:o,msTransform:o,OTransform:o,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Da(r){let{top:e,left:t,width:n,height:s}=r;return{top:`${e}px`,left:`${t}px`,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Br(r,e){return e==="horizontal"?us(r):e==="vertical"?cs(r):r}function cs(r){return r.slice(0).sort(function(e,t){return e.y>t.y||e.y===t.y&&e.x>t.x?1:e.y===t.y&&e.x===t.x?0:-1})}function us(r){return r.slice(0).sort(function(e,t){return e.x>t.x||e.x===t.x&&e.y>t.y?1:-1})}function Ma(r,e,t,n,s){r=r||[];const o=[];ot.default.Children.forEach(e,l=>{if(l?.key==null)return;const c=zr(r,String(l.key)),u=l.props["data-grid"];c&&u==null?o.push(Fe(c)):u?o.push(Fe({...u,i:l.key})):o.push(Fe({w:1,h:1,x:0,y:Ir(o),i:String(l.key)}))});const a=ss(o,{cols:t});return s?a:rs(a,n,t)}function Oa(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Layout";const t=["x","y","w","h"];if(!Array.isArray(r))throw new Error(e+" must be an array!");for(let n=0,s=r.length;n<s;n++){const o=r[n];for(let a=0;a<t.length;a++){const l=t[a],c=o[l];if(typeof c!="number"||Number.isNaN(c))throw new Error(`ReactGridLayout: ${e}[${n}].${l} must be a number! Received: ${c} (${typeof c})`)}if(typeof o.i<"u"&&typeof o.i!="string")throw new Error(`ReactGridLayout: ${e}[${n}].i must be a string! Received: ${o.i} (${typeof o.i})`)}}function ka(r){const{verticalCompact:e,compactType:t}=r||{};return e===!1?null:t}const Ia=()=>{};$.noop=Ia;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.calcGridColWidth=Tt;Ee.calcGridItemPosition=za;Ee.calcGridItemWHPx=wr;Ee.calcWH=Ta;Ee.calcXY=Na;Ee.clamp=$e;function Tt(r){const{margin:e,containerPadding:t,containerWidth:n,cols:s}=r;return(n-e[0]*(s-1)-t[0]*2)/s}function wr(r,e,t){return Number.isFinite(r)?Math.round(e*r+Math.max(0,r-1)*t):r}function za(r,e,t,n,s,o){const{margin:a,containerPadding:l,rowHeight:c}=r,u=Tt(r),h={};return o&&o.resizing?(h.width=Math.round(o.resizing.width),h.height=Math.round(o.resizing.height)):(h.width=wr(n,u,a[0]),h.height=wr(s,c,a[1])),o&&o.dragging?(h.top=Math.round(o.dragging.top),h.left=Math.round(o.dragging.left)):o&&o.resizing&&typeof o.resizing.top=="number"&&typeof o.resizing.left=="number"?(h.top=Math.round(o.resizing.top),h.left=Math.round(o.resizing.left)):(h.top=Math.round((c+a[1])*t+l[1]),h.left=Math.round((u+a[0])*e+l[0])),h}function Na(r,e,t,n,s){const{margin:o,containerPadding:a,cols:l,rowHeight:c,maxRows:u}=r,h=Tt(r);let m=Math.round((t-a[0])/(h+o[0])),y=Math.round((e-a[1])/(c+o[1]));return m=$e(m,0,l-n),y=$e(y,0,u-s),{x:m,y}}function Ta(r,e,t,n,s,o){const{margin:a,maxRows:l,cols:c,rowHeight:u}=r,h=Tt(r);let m=Math.round((e+a[0])/(h+a[0])),y=Math.round((t+a[1])/(u+a[1])),_=$e(m,0,c-n),M=$e(y,0,l-s);return["sw","w","nw"].indexOf(o)!==-1&&(_=$e(m,0,c)),["nw","n","ne"].indexOf(o)!==-1&&(M=$e(y,0,l)),{w:_,h:M}}function $e(r,e,t){return Math.max(Math.min(r,t),e)}var At={},Lt={exports:{}},ds={},ae={},De={};Object.defineProperty(De,"__esModule",{value:!0});De.dontSetMe=Ba;De.findInArray=Aa;De.int=Wa;De.isFunction=La;De.isNum=qa;function Aa(r,e){for(let t=0,n=r.length;t<n;t++)if(e.apply(e,[r[t],t,r]))return r[t]}function La(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Function]"}function qa(r){return typeof r=="number"&&!isNaN(r)}function Wa(r){return parseInt(r,10)}function Ba(r,e,t){if(r[e])return new Error(`Invalid prop ${e} passed to ${t} - do not set this, set it on the child.`)}var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.browserPrefixToKey=hs;Ge.browserPrefixToStyle=Ha;Ge.default=void 0;Ge.getPrefix=fs;const nr=["Moz","Webkit","O","ms"];function fs(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const e=window.document?.documentElement?.style;if(!e||r in e)return"";for(let t=0;t<nr.length;t++)if(hs(r,nr[t])in e)return nr[t];return""}function hs(r,e){return e?`${e}${$a(r)}`:r}function Ha(r,e){return e?`-${e.toLowerCase()}-${r}`:r}function $a(r){let e="",t=!0;for(let n=0;n<r.length;n++)t?(e+=r[n].toUpperCase(),t=!1):r[n]==="-"?t=!0:e+=r[n];return e}Ge.default=fs();Object.defineProperty(ae,"__esModule",{value:!0});ae.addClassName=gs;ae.addEvent=Fa;ae.addUserSelectStyles=rl;ae.createCSSTransform=Ja;ae.createSVGTransform=Za;ae.getTouch=el;ae.getTouchIdentifier=tl;ae.getTranslation=Hr;ae.innerHeight=Ka;ae.innerWidth=Xa;ae.matchesSelector=ms;ae.matchesSelectorAndParentsTo=Ua;ae.offsetXYFromParent=Qa;ae.outerHeight=Va;ae.outerWidth=Ya;ae.removeClassName=ys;ae.removeEvent=Ga;ae.scheduleRemoveUserSelectStyles=nl;var Se=De,fn=ps(Ge);function ps(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(ps=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}let ht="";function ms(r,e){return ht||(ht=(0,Se.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(t){return(0,Se.isFunction)(r[t])})),(0,Se.isFunction)(r[ht])?r[ht](e):!1}function Ua(r,e,t){let n=r;do{if(ms(n,e))return!0;if(n===t)return!1;n=n.parentNode}while(n);return!1}function Fa(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.addEventListener?r.addEventListener(e,t,s):r.attachEvent?r.attachEvent("on"+e,t):r["on"+e]=t}function Ga(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.removeEventListener?r.removeEventListener(e,t,s):r.detachEvent?r.detachEvent("on"+e,t):r["on"+e]=null}function Va(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Se.int)(t.borderTopWidth),e+=(0,Se.int)(t.borderBottomWidth),e}function Ya(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Se.int)(t.borderLeftWidth),e+=(0,Se.int)(t.borderRightWidth),e}function Ka(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Se.int)(t.paddingTop),e-=(0,Se.int)(t.paddingBottom),e}function Xa(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Se.int)(t.paddingLeft),e-=(0,Se.int)(t.paddingRight),e}function Qa(r,e,t){const s=e===e.ownerDocument.body?{left:0,top:0}:e.getBoundingClientRect(),o=(r.clientX+e.scrollLeft-s.left)/t,a=(r.clientY+e.scrollTop-s.top)/t;return{x:o,y:a}}function Ja(r,e){const t=Hr(r,e,"px");return{[(0,fn.browserPrefixToKey)("transform",fn.default)]:t}}function Za(r,e){return Hr(r,e,"")}function Hr(r,e,t){let{x:n,y:s}=r,o=`translate(${n}${t},${s}${t})`;if(e){const a=`${typeof e.x=="string"?e.x:e.x+t}`,l=`${typeof e.y=="string"?e.y:e.y+t}`;o=`translate(${a}, ${l})`+o}return o}function el(r,e){return r.targetTouches&&(0,Se.findInArray)(r.targetTouches,t=>e===t.identifier)||r.changedTouches&&(0,Se.findInArray)(r.changedTouches,t=>e===t.identifier)}function tl(r){if(r.targetTouches&&r.targetTouches[0])return r.targetTouches[0].identifier;if(r.changedTouches&&r.changedTouches[0])return r.changedTouches[0].identifier}function rl(r){if(!r)return;let e=r.getElementById("react-draggable-style-el");e||(e=r.createElement("style"),e.type="text/css",e.id="react-draggable-style-el",e.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,e.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,r.getElementsByTagName("head")[0].appendChild(e)),r.body&&gs(r.body,"react-draggable-transparent-selection")}function nl(r){window.requestAnimationFrame?window.requestAnimationFrame(()=>{hn(r)}):hn(r)}function hn(r){if(r)try{if(r.body&&ys(r.body,"react-draggable-transparent-selection"),r.selection)r.selection.empty();else{const e=(r.defaultView||window).getSelection();e&&e.type!=="Caret"&&e.removeAllRanges()}}catch{}}function gs(r,e){r.classList?r.classList.add(e):r.className.match(new RegExp(`(?:^|\\s)${e}(?!\\S)`))||(r.className+=` ${e}`)}function ys(r,e){r.classList?r.classList.remove(e):r.className=r.className.replace(new RegExp(`(?:^|\\s)${e}(?!\\S)`,"g"),"")}var Me={};Object.defineProperty(Me,"__esModule",{value:!0});Me.canDragX=il;Me.canDragY=al;Me.createCoreData=cl;Me.createDraggableData=ul;Me.getBoundPosition=sl;Me.getControlPosition=ll;Me.snapToGrid=ol;var _e=De,Je=ae;function sl(r,e,t){if(!r.props.bounds)return[e,t];let{bounds:n}=r.props;n=typeof n=="string"?n:dl(n);const s=$r(r);if(typeof n=="string"){const{ownerDocument:o}=s,a=o.defaultView;let l;if(n==="parent"?l=s.parentNode:l=s.getRootNode().querySelector(n),!(l instanceof a.HTMLElement))throw new Error('Bounds selector "'+n+'" could not find an element.');const c=l,u=a.getComputedStyle(s),h=a.getComputedStyle(c);n={left:-s.offsetLeft+(0,_e.int)(h.paddingLeft)+(0,_e.int)(u.marginLeft),top:-s.offsetTop+(0,_e.int)(h.paddingTop)+(0,_e.int)(u.marginTop),right:(0,Je.innerWidth)(c)-(0,Je.outerWidth)(s)-s.offsetLeft+(0,_e.int)(h.paddingRight)-(0,_e.int)(u.marginRight),bottom:(0,Je.innerHeight)(c)-(0,Je.outerHeight)(s)-s.offsetTop+(0,_e.int)(h.paddingBottom)-(0,_e.int)(u.marginBottom)}}return(0,_e.isNum)(n.right)&&(e=Math.min(e,n.right)),(0,_e.isNum)(n.bottom)&&(t=Math.min(t,n.bottom)),(0,_e.isNum)(n.left)&&(e=Math.max(e,n.left)),(0,_e.isNum)(n.top)&&(t=Math.max(t,n.top)),[e,t]}function ol(r,e,t){const n=Math.round(e/r[0])*r[0],s=Math.round(t/r[1])*r[1];return[n,s]}function il(r){return r.props.axis==="both"||r.props.axis==="x"}function al(r){return r.props.axis==="both"||r.props.axis==="y"}function ll(r,e,t){const n=typeof e=="number"?(0,Je.getTouch)(r,e):null;if(typeof e=="number"&&!n)return null;const s=$r(t),o=t.props.offsetParent||s.offsetParent||s.ownerDocument.body;return(0,Je.offsetXYFromParent)(n||r,o,t.props.scale)}function cl(r,e,t){const n=!(0,_e.isNum)(r.lastX),s=$r(r);return n?{node:s,deltaX:0,deltaY:0,lastX:e,lastY:t,x:e,y:t}:{node:s,deltaX:e-r.lastX,deltaY:t-r.lastY,lastX:r.lastX,lastY:r.lastY,x:e,y:t}}function ul(r,e){const t=r.props.scale;return{node:e.node,x:r.state.x+e.deltaX/t,y:r.state.y+e.deltaY/t,deltaX:e.deltaX/t,deltaY:e.deltaY/t,lastX:r.state.x,lastY:r.state.y}}function dl(r){return{left:r.left,top:r.top,right:r.right,bottom:r.bottom}}function $r(r){const e=r.findDOMNode();if(!e)throw new Error("<DraggableCore>: Unmounted during event!");return e}var qt={},Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.default=fl;function fl(){}Object.defineProperty(qt,"__esModule",{value:!0});qt.default=void 0;var sr=bs(f),ge=Ur(qe),hl=Ur(Ct),pe=ae,Te=Me,or=De,rt=Ur(Wt);function Ur(r){return r&&r.__esModule?r:{default:r}}function bs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(bs=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function ye(r,e,t){return(e=pl(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function pl(r){var e=ml(r,"string");return typeof e=="symbol"?e:e+""}function ml(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Re={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let Ae=Re.mouse,Bt=class extends sr.Component{constructor(){super(...arguments),ye(this,"dragging",!1),ye(this,"lastX",NaN),ye(this,"lastY",NaN),ye(this,"touchIdentifier",null),ye(this,"mounted",!1),ye(this,"handleDragStart",e=>{if(this.props.onMouseDown(e),!this.props.allowAnyClick&&typeof e.button=="number"&&e.button!==0)return!1;const t=this.findDOMNode();if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:n}=t;if(this.props.disabled||!(e.target instanceof n.defaultView.Node)||this.props.handle&&!(0,pe.matchesSelectorAndParentsTo)(e.target,this.props.handle,t)||this.props.cancel&&(0,pe.matchesSelectorAndParentsTo)(e.target,this.props.cancel,t))return;e.type==="touchstart"&&!this.props.allowMobileScroll&&e.preventDefault();const s=(0,pe.getTouchIdentifier)(e);this.touchIdentifier=s;const o=(0,Te.getControlPosition)(e,s,this);if(o==null)return;const{x:a,y:l}=o,c=(0,Te.createCoreData)(this,a,l);(0,rt.default)("DraggableCore: handleDragStart: %j",c),(0,rt.default)("calling",this.props.onStart),!(this.props.onStart(e,c)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,pe.addUserSelectStyles)(n),this.dragging=!0,this.lastX=a,this.lastY=l,(0,pe.addEvent)(n,Ae.move,this.handleDrag),(0,pe.addEvent)(n,Ae.stop,this.handleDragStop))}),ye(this,"handleDrag",e=>{const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let l=n-this.lastX,c=s-this.lastY;if([l,c]=(0,Te.snapToGrid)(this.props.grid,l,c),!l&&!c)return;n=this.lastX+l,s=this.lastY+c}const o=(0,Te.createCoreData)(this,n,s);if((0,rt.default)("DraggableCore: handleDrag: %j",o),this.props.onDrag(e,o)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const c=document.createEvent("MouseEvents");c.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(c)}return}this.lastX=n,this.lastY=s}),ye(this,"handleDragStop",e=>{if(!this.dragging)return;const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let c=n-this.lastX||0,u=s-this.lastY||0;[c,u]=(0,Te.snapToGrid)(this.props.grid,c,u),n=this.lastX+c,s=this.lastY+u}const o=(0,Te.createCoreData)(this,n,s);if(this.props.onStop(e,o)===!1||this.mounted===!1)return!1;const l=this.findDOMNode();l&&this.props.enableUserSelectHack&&(0,pe.scheduleRemoveUserSelectStyles)(l.ownerDocument),(0,rt.default)("DraggableCore: handleDragStop: %j",o),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,l&&((0,rt.default)("DraggableCore: Removing handlers"),(0,pe.removeEvent)(l.ownerDocument,Ae.move,this.handleDrag),(0,pe.removeEvent)(l.ownerDocument,Ae.stop,this.handleDragStop))}),ye(this,"onMouseDown",e=>(Ae=Re.mouse,this.handleDragStart(e))),ye(this,"onMouseUp",e=>(Ae=Re.mouse,this.handleDragStop(e))),ye(this,"onTouchStart",e=>(Ae=Re.touch,this.handleDragStart(e))),ye(this,"onTouchEnd",e=>(Ae=Re.touch,this.handleDragStop(e)))}componentDidMount(){this.mounted=!0;const e=this.findDOMNode();e&&(0,pe.addEvent)(e,Re.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const e=this.findDOMNode();if(e){const{ownerDocument:t}=e;(0,pe.removeEvent)(t,Re.mouse.move,this.handleDrag),(0,pe.removeEvent)(t,Re.touch.move,this.handleDrag),(0,pe.removeEvent)(t,Re.mouse.stop,this.handleDragStop),(0,pe.removeEvent)(t,Re.touch.stop,this.handleDragStop),(0,pe.removeEvent)(e,Re.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,pe.scheduleRemoveUserSelectStyles)(t)}}findDOMNode(){return this.props?.nodeRef?this.props?.nodeRef?.current:hl.default.findDOMNode(this)}render(){return sr.cloneElement(sr.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};qt.default=Bt;ye(Bt,"displayName","DraggableCore");ye(Bt,"propTypes",{allowAnyClick:ge.default.bool,allowMobileScroll:ge.default.bool,children:ge.default.node.isRequired,disabled:ge.default.bool,enableUserSelectHack:ge.default.bool,offsetParent:function(r,e){if(r[e]&&r[e].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:ge.default.arrayOf(ge.default.number),handle:ge.default.string,cancel:ge.default.string,nodeRef:ge.default.object,onStart:ge.default.func,onDrag:ge.default.func,onStop:ge.default.func,onMouseDown:ge.default.func,scale:ge.default.number,className:or.dontSetMe,style:or.dontSetMe,transform:or.dontSetMe});ye(Bt,"defaultProps",{allowAnyClick:!1,allowMobileScroll:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DraggableCore",{enumerable:!0,get:function(){return c.default}}),r.default=void 0;var e=m(f),t=h(qe),n=h(Ct),s=Et,o=ae,a=Me,l=De,c=h(qt),u=h(Wt);function h(w){return w&&w.__esModule?w:{default:w}}function m(w,P){if(typeof WeakMap=="function")var b=new WeakMap,g=new WeakMap;return(m=function(p,v){if(!v&&p&&p.__esModule)return p;var j,x,D={__proto__:null,default:p};if(p===null||typeof p!="object"&&typeof p!="function")return D;if(j=v?g:b){if(j.has(p))return j.get(p);j.set(p,D)}for(const z in p)z!=="default"&&{}.hasOwnProperty.call(p,z)&&((x=(j=Object.defineProperty)&&Object.getOwnPropertyDescriptor(p,z))&&(x.get||x.set)?j(D,z,x):D[z]=p[z]);return D})(w,P)}function y(){return y=Object.assign?Object.assign.bind():function(w){for(var P=1;P<arguments.length;P++){var b=arguments[P];for(var g in b)({}).hasOwnProperty.call(b,g)&&(w[g]=b[g])}return w},y.apply(null,arguments)}function _(w,P,b){return(P=M(P))in w?Object.defineProperty(w,P,{value:b,enumerable:!0,configurable:!0,writable:!0}):w[P]=b,w}function M(w){var P=R(w,"string");return typeof P=="symbol"?P:P+""}function R(w,P){if(typeof w!="object"||!w)return w;var b=w[Symbol.toPrimitive];if(b!==void 0){var g=b.call(w,P);if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(P==="string"?String:Number)(w)}class C extends e.Component{static getDerivedStateFromProps(P,b){let{position:g}=P,{prevPropsPosition:p}=b;return g&&(!p||g.x!==p.x||g.y!==p.y)?((0,u.default)("Draggable: getDerivedStateFromProps %j",{position:g,prevPropsPosition:p}),{x:g.x,y:g.y,prevPropsPosition:{...g}}):null}constructor(P){super(P),_(this,"onDragStart",(b,g)=>{if((0,u.default)("Draggable: onDragStart: %j",g),this.props.onStart(b,(0,a.createDraggableData)(this,g))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),_(this,"onDrag",(b,g)=>{if(!this.state.dragging)return!1;(0,u.default)("Draggable: onDrag: %j",g);const p=(0,a.createDraggableData)(this,g),v={x:p.x,y:p.y,slackX:0,slackY:0};if(this.props.bounds){const{x,y:D}=v;v.x+=this.state.slackX,v.y+=this.state.slackY;const[z,te]=(0,a.getBoundPosition)(this,v.x,v.y);v.x=z,v.y=te,v.slackX=this.state.slackX+(x-v.x),v.slackY=this.state.slackY+(D-v.y),p.x=v.x,p.y=v.y,p.deltaX=v.x-this.state.x,p.deltaY=v.y-this.state.y}if(this.props.onDrag(b,p)===!1)return!1;this.setState(v)}),_(this,"onDragStop",(b,g)=>{if(!this.state.dragging||this.props.onStop(b,(0,a.createDraggableData)(this,g))===!1)return!1;(0,u.default)("Draggable: onDragStop: %j",g);const v={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x,y:D}=this.props.position;v.x=x,v.y=D}this.setState(v)}),this.state={dragging:!1,dragged:!1,x:P.position?P.position.x:P.defaultPosition.x,y:P.position?P.position.y:P.defaultPosition.y,prevPropsPosition:{...P.position},slackX:0,slackY:0,isElementSVG:!1},P.position&&(P.onDrag||P.onStop)}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.state.dragging&&this.setState({dragging:!1})}findDOMNode(){return this.props?.nodeRef?.current??n.default.findDOMNode(this)}render(){const{axis:P,bounds:b,children:g,defaultPosition:p,defaultClassName:v,defaultClassNameDragging:j,defaultClassNameDragged:x,position:D,positionOffset:z,scale:te,...q}=this.props;let G={},re=null;const O=!!!D||this.state.dragging,U=D||p,ue={x:(0,a.canDragX)(this)&&O?this.state.x:U.x,y:(0,a.canDragY)(this)&&O?this.state.y:U.y};this.state.isElementSVG?re=(0,o.createSVGTransform)(ue,z):G=(0,o.createCSSTransform)(ue,z);const ne=(0,s.clsx)(g.props.className||"",v,{[j]:this.state.dragging,[x]:this.state.dragged});return e.createElement(c.default,y({},q,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),e.cloneElement(e.Children.only(g),{className:ne,style:{...g.props.style,...G},transform:re}))}}r.default=C,_(C,"displayName","Draggable"),_(C,"propTypes",{...c.default.propTypes,axis:t.default.oneOf(["both","x","y","none"]),bounds:t.default.oneOfType([t.default.shape({left:t.default.number,right:t.default.number,top:t.default.number,bottom:t.default.number}),t.default.string,t.default.oneOf([!1])]),defaultClassName:t.default.string,defaultClassNameDragging:t.default.string,defaultClassNameDragged:t.default.string,defaultPosition:t.default.shape({x:t.default.number,y:t.default.number}),positionOffset:t.default.shape({x:t.default.oneOfType([t.default.number,t.default.string]),y:t.default.oneOfType([t.default.number,t.default.string])}),position:t.default.shape({x:t.default.number,y:t.default.number}),className:l.dontSetMe,style:l.dontSetMe,transform:l.dontSetMe}),_(C,"defaultProps",{...c.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(ds);const{default:vs,DraggableCore:gl}=ds;Lt.exports=vs;Lt.exports.default=vs;Lt.exports.DraggableCore=gl;var xs=Lt.exports,Ht={exports:{}},ct={},Fr={};Fr.__esModule=!0;Fr.cloneElement=_l;var yl=bl(f);function bl(r){return r&&r.__esModule?r:{default:r}}function pn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function mn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pn(Object(t),!0).forEach(function(n){vl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):pn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function vl(r,e,t){return e=xl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function xl(r){var e=wl(r,"string");return typeof e=="symbol"?e:String(e)}function wl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function _l(r,e){return e.style&&r.props.style&&(e.style=mn(mn({},r.props.style),e.style)),e.className&&r.props.className&&(e.className=r.props.className+" "+e.className),yl.default.cloneElement(r,e)}var ut={};ut.__esModule=!0;ut.resizableProps=void 0;var A=Sl(qe);function Sl(r){return r&&r.__esModule?r:{default:r}}var jl={axis:A.default.oneOf(["both","x","y","none"]),className:A.default.string,children:A.default.element.isRequired,draggableOpts:A.default.shape({allowAnyClick:A.default.bool,cancel:A.default.string,children:A.default.node,disabled:A.default.bool,enableUserSelectHack:A.default.bool,offsetParent:A.default.node,grid:A.default.arrayOf(A.default.number),handle:A.default.string,nodeRef:A.default.object,onStart:A.default.func,onDrag:A.default.func,onStop:A.default.func,onMouseDown:A.default.func,scale:A.default.number}),height:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="y"){var o;return(o=A.default.number).isRequired.apply(o,t)}return A.default.number.apply(A.default,t)},handle:A.default.oneOfType([A.default.node,A.default.func]),handleSize:A.default.arrayOf(A.default.number),lockAspectRatio:A.default.bool,maxConstraints:A.default.arrayOf(A.default.number),minConstraints:A.default.arrayOf(A.default.number),onResizeStop:A.default.func,onResizeStart:A.default.func,onResize:A.default.func,resizeHandles:A.default.arrayOf(A.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),transformScale:A.default.number,width:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="x"){var o;return(o=A.default.number).isRequired.apply(o,t)}return A.default.number.apply(A.default,t)}};ut.resizableProps=jl;ct.__esModule=!0;ct.default=void 0;var nt=Dl(f),Pl=xs,Rl=Fr,Cl=ut,El=["children","className","draggableOpts","width","height","handle","handleSize","lockAspectRatio","axis","minConstraints","maxConstraints","onResize","onResizeStop","onResizeStart","resizeHandles","transformScale"];function ws(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(ws=function(s){return s?t:e})(r)}function Dl(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=ws(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in r)if(o!=="default"&&Object.prototype.hasOwnProperty.call(r,o)){var a=s?Object.getOwnPropertyDescriptor(r,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=r[o]}return n.default=r,t&&t.set(r,n),n}function _r(){return _r=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_r.apply(this,arguments)}function Ml(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function gn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function ir(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gn(Object(t),!0).forEach(function(n){Ol(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):gn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Ol(r,e,t){return e=kl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function kl(r){var e=Il(r,"string");return typeof e=="symbol"?e:String(e)}function Il(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function zl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Sr(r,e)}function Sr(r,e){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Sr(r,e)}var Gr=function(r){zl(e,r);function e(){for(var n,s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o))||this,n.handleRefs={},n.lastHandleRect=null,n.slack=null,n}var t=e.prototype;return t.componentWillUnmount=function(){this.resetData()},t.resetData=function(){this.lastHandleRect=this.slack=null},t.runConstraints=function(s,o){var a=this.props,l=a.minConstraints,c=a.maxConstraints,u=a.lockAspectRatio;if(!l&&!c&&!u)return[s,o];if(u){var h=this.props.width/this.props.height,m=s-this.props.width,y=o-this.props.height;Math.abs(m)>Math.abs(y*h)?o=s/h:s=o*h}var _=s,M=o,R=this.slack||[0,0],C=R[0],w=R[1];return s+=C,o+=w,l&&(s=Math.max(l[0],s),o=Math.max(l[1],o)),c&&(s=Math.min(c[0],s),o=Math.min(c[1],o)),this.slack=[C+(_-s),w+(M-o)],[s,o]},t.resizeHandler=function(s,o){var a=this;return function(l,c){var u=c.node,h=c.deltaX,m=c.deltaY;s==="onResizeStart"&&a.resetData();var y=(a.props.axis==="both"||a.props.axis==="x")&&o!=="n"&&o!=="s",_=(a.props.axis==="both"||a.props.axis==="y")&&o!=="e"&&o!=="w";if(!(!y&&!_)){var M=o[0],R=o[o.length-1],C=u.getBoundingClientRect();if(a.lastHandleRect!=null){if(R==="w"){var w=C.left-a.lastHandleRect.left;h+=w}if(M==="n"){var P=C.top-a.lastHandleRect.top;m+=P}}a.lastHandleRect=C,R==="w"&&(h=-h),M==="n"&&(m=-m);var b=a.props.width+(y?h/a.props.transformScale:0),g=a.props.height+(_?m/a.props.transformScale:0),p=a.runConstraints(b,g);b=p[0],g=p[1];var v=b!==a.props.width||g!==a.props.height,j=typeof a.props[s]=="function"?a.props[s]:null,x=s==="onResize"&&!v;j&&!x&&(l.persist==null||l.persist(),j(l,{node:u,size:{width:b,height:g},handle:o})),s==="onResizeStop"&&a.resetData()}}},t.renderResizeHandle=function(s,o){var a=this.props.handle;if(!a)return nt.createElement("span",{className:"react-resizable-handle react-resizable-handle-"+s,ref:o});if(typeof a=="function")return a(s,o);var l=typeof a.type=="string",c=ir({ref:o},l?{}:{handleAxis:s});return nt.cloneElement(a,c)},t.render=function(){var s=this,o=this.props,a=o.children,l=o.className,c=o.draggableOpts;o.width,o.height,o.handle,o.handleSize,o.lockAspectRatio,o.axis,o.minConstraints,o.maxConstraints,o.onResize,o.onResizeStop,o.onResizeStart;var u=o.resizeHandles;o.transformScale;var h=Ml(o,El);return(0,Rl.cloneElement)(a,ir(ir({},h),{},{className:(l?l+" ":"")+"react-resizable",children:[].concat(a.props.children,u.map(function(m){var y,_=(y=s.handleRefs[m])!=null?y:s.handleRefs[m]=nt.createRef();return nt.createElement(Pl.DraggableCore,_r({},c,{nodeRef:_,key:"resizableHandle-"+m,onStop:s.resizeHandler("onResizeStop",m),onStart:s.resizeHandler("onResizeStart",m),onDrag:s.resizeHandler("onResize",m)}),s.renderResizeHandle(m,_))}))}))},e}(nt.Component);ct.default=Gr;Gr.propTypes=Cl.resizableProps;Gr.defaultProps={axis:"both",handleSize:[20,20],lockAspectRatio:!1,minConstraints:[20,20],maxConstraints:[1/0,1/0],resizeHandles:["se"],transformScale:1};var $t={};$t.__esModule=!0;$t.default=void 0;var ar=ql(f),Nl=_s(qe),Tl=_s(ct),Al=ut,Ll=["handle","handleSize","onResize","onResizeStart","onResizeStop","draggableOpts","minConstraints","maxConstraints","lockAspectRatio","axis","width","height","resizeHandles","style","transformScale"];function _s(r){return r&&r.__esModule?r:{default:r}}function Ss(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(Ss=function(s){return s?t:e})(r)}function ql(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=Ss(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in r)if(o!=="default"&&Object.prototype.hasOwnProperty.call(r,o)){var a=s?Object.getOwnPropertyDescriptor(r,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=r[o]}return n.default=r,t&&t.set(r,n),n}function jr(){return jr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},jr.apply(this,arguments)}function yn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function _t(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yn(Object(t),!0).forEach(function(n){Wl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):yn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Wl(r,e,t){return e=Bl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Bl(r){var e=Hl(r,"string");return typeof e=="symbol"?e:String(e)}function Hl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function $l(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Ul(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Pr(r,e)}function Pr(r,e){return Pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Pr(r,e)}var js=function(r){Ul(e,r);function e(){for(var n,s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o))||this,n.state={width:n.props.width,height:n.props.height,propsWidth:n.props.width,propsHeight:n.props.height},n.onResize=function(l,c){var u=c.size;n.props.onResize?(l.persist==null||l.persist(),n.setState(u,function(){return n.props.onResize&&n.props.onResize(l,c)})):n.setState(u)},n}e.getDerivedStateFromProps=function(s,o){return o.propsWidth!==s.width||o.propsHeight!==s.height?{width:s.width,height:s.height,propsWidth:s.width,propsHeight:s.height}:null};var t=e.prototype;return t.render=function(){var s=this.props,o=s.handle,a=s.handleSize;s.onResize;var l=s.onResizeStart,c=s.onResizeStop,u=s.draggableOpts,h=s.minConstraints,m=s.maxConstraints,y=s.lockAspectRatio,_=s.axis;s.width,s.height;var M=s.resizeHandles,R=s.style,C=s.transformScale,w=$l(s,Ll);return ar.createElement(Tl.default,{axis:_,draggableOpts:u,handle:o,handleSize:a,height:this.state.height,lockAspectRatio:y,maxConstraints:m,minConstraints:h,onResizeStart:l,onResize:this.onResize,onResizeStop:c,resizeHandles:M,transformScale:C,width:this.state.width},ar.createElement("div",jr({},w,{style:_t(_t({},R),{},{width:this.state.width+"px",height:this.state.height+"px"})})))},e}(ar.Component);$t.default=js;js.propTypes=_t(_t({},Al.resizableProps),{},{children:Nl.default.element});Ht.exports=function(){throw new Error("Don't instantiate Resizable directly! Use require('react-resizable').Resizable")};Ht.exports.Resizable=ct.default;Ht.exports.ResizableBox=$t.default;var Fl=Ht.exports,ze={};Object.defineProperty(ze,"__esModule",{value:!0});ze.resizeHandleType=ze.resizeHandleAxesType=ze.default=void 0;var L=Ps(qe),Gl=Ps(f);function Ps(r){return r&&r.__esModule?r:{default:r}}const Vl=ze.resizeHandleAxesType=L.default.arrayOf(L.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),Yl=ze.resizeHandleType=L.default.oneOfType([L.default.node,L.default.func]);ze.default={className:L.default.string,style:L.default.object,width:L.default.number,autoSize:L.default.bool,cols:L.default.number,draggableCancel:L.default.string,draggableHandle:L.default.string,verticalCompact:function(r){r.verticalCompact},compactType:L.default.oneOf(["vertical","horizontal"]),layout:function(r){var e=r.layout;e!==void 0&&$.validateLayout(e,"layout")},margin:L.default.arrayOf(L.default.number),containerPadding:L.default.arrayOf(L.default.number),rowHeight:L.default.number,maxRows:L.default.number,isBounded:L.default.bool,isDraggable:L.default.bool,isResizable:L.default.bool,allowOverlap:L.default.bool,preventCollision:L.default.bool,useCSSTransforms:L.default.bool,transformScale:L.default.number,isDroppable:L.default.bool,resizeHandles:Vl,resizeHandle:Yl,onLayoutChange:L.default.func,onDragStart:L.default.func,onDrag:L.default.func,onDragStop:L.default.func,onResizeStart:L.default.func,onResize:L.default.func,onResizeStop:L.default.func,onDrop:L.default.func,droppingItem:L.default.shape({i:L.default.string.isRequired,w:L.default.number.isRequired,h:L.default.number.isRequired}),children:function(r,e){const t=r[e],n={};Gl.default.Children.forEach(t,function(s){if(s?.key!=null){if(n[s.key])throw new Error('Duplicate child key "'+s.key+'" found! This will cause problems in ReactGridLayout.');n[s.key]=!0}})},innerRef:L.default.any};Object.defineProperty(At,"__esModule",{value:!0});At.default=void 0;var Ke=Vr(f),bn=Ct,V=Vr(qe),Kl=xs,Xl=Fl,Xe=$,fe=Ee,vn=ze,Ql=Vr(Et);function Vr(r){return r&&r.__esModule?r:{default:r}}function Ce(r,e,t){return(e=Jl(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Jl(r){var e=Zl(r,"string");return typeof e=="symbol"?e:e+""}function Zl(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}class Yr extends Ke.default.Component{constructor(){super(...arguments),Ce(this,"state",{resizing:null,dragging:null,className:""}),Ce(this,"elementRef",Ke.default.createRef()),Ce(this,"onDragStart",(e,t)=>{let{node:n}=t;const{onDragStart:s,transformScale:o}=this.props;if(!s)return;const a={top:0,left:0},{offsetParent:l}=n;if(!l)return;const c=l.getBoundingClientRect(),u=n.getBoundingClientRect(),h=u.left/o,m=c.left/o,y=u.top/o,_=c.top/o;a.left=h-m+l.scrollLeft,a.top=y-_+l.scrollTop,this.setState({dragging:a});const{x:M,y:R}=(0,fe.calcXY)(this.getPositionParams(),a.top,a.left,this.props.w,this.props.h);return s.call(this,this.props.i,M,R,{e,node:n,newPosition:a})}),Ce(this,"onDrag",(e,t,n)=>{let{node:s,deltaX:o,deltaY:a}=t;const{onDrag:l}=this.props;if(!l)return;if(!this.state.dragging)throw new Error("onDrag called before onDragStart.");let c=this.state.dragging.top+a,u=this.state.dragging.left+o;const{isBounded:h,i:m,w:y,h:_,containerWidth:M}=this.props,R=this.getPositionParams();if(h){const{offsetParent:b}=s;if(b){const{margin:g,rowHeight:p}=this.props,v=b.clientHeight-(0,fe.calcGridItemWHPx)(_,p,g[1]);c=(0,fe.clamp)(c,0,v);const j=(0,fe.calcGridColWidth)(R),x=M-(0,fe.calcGridItemWHPx)(y,j,g[0]);u=(0,fe.clamp)(u,0,x)}}const C={top:c,left:u};n?this.setState({dragging:C}):(0,bn.flushSync)(()=>{this.setState({dragging:C})});const{x:w,y:P}=(0,fe.calcXY)(R,c,u,y,_);return l.call(this,m,w,P,{e,node:s,newPosition:C})}),Ce(this,"onDragStop",(e,t)=>{let{node:n}=t;const{onDragStop:s}=this.props;if(!s)return;if(!this.state.dragging)throw new Error("onDragEnd called before onDragStart.");const{w:o,h:a,i:l}=this.props,{left:c,top:u}=this.state.dragging,h={top:u,left:c};this.setState({dragging:null});const{x:m,y}=(0,fe.calcXY)(this.getPositionParams(),u,c,o,a);return s.call(this,l,m,y,{e,node:n,newPosition:h})}),Ce(this,"onResizeStop",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStop")),Ce(this,"onResizeStart",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStart")),Ce(this,"onResize",(e,t,n)=>this.onResizeHandler(e,t,n,"onResize"))}shouldComponentUpdate(e,t){if(this.props.children!==e.children||this.props.droppingPosition!==e.droppingPosition)return!0;const n=(0,fe.calcGridItemPosition)(this.getPositionParams(this.props),this.props.x,this.props.y,this.props.w,this.props.h,this.state),s=(0,fe.calcGridItemPosition)(this.getPositionParams(e),e.x,e.y,e.w,e.h,t);return!(0,Xe.fastPositionEqual)(n,s)||this.props.useCSSTransforms!==e.useCSSTransforms}componentDidMount(){this.moveDroppingItem({})}componentDidUpdate(e){this.moveDroppingItem(e)}moveDroppingItem(e){const{droppingPosition:t}=this.props;if(!t)return;const n=this.elementRef.current;if(!n)return;const s=e.droppingPosition||{left:0,top:0},{dragging:o}=this.state,a=o&&t.left!==s.left||t.top!==s.top;if(!o)this.onDragStart(t.e,{node:n,deltaX:t.left,deltaY:t.top});else if(a){const l=t.left-o.left,c=t.top-o.top;this.onDrag(t.e,{node:n,deltaX:l,deltaY:c},!0)}}getPositionParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props;return{cols:e.cols,containerPadding:e.containerPadding,containerWidth:e.containerWidth,margin:e.margin,maxRows:e.maxRows,rowHeight:e.rowHeight}}createStyle(e){const{usePercentages:t,containerWidth:n,useCSSTransforms:s}=this.props;let o;return s?o=(0,Xe.setTransform)(e):(o=(0,Xe.setTopLeft)(e),t&&(o.left=(0,Xe.perc)(e.left/n),o.width=(0,Xe.perc)(e.width/n))),o}mixinDraggable(e,t){return Ke.default.createElement(Kl.DraggableCore,{disabled:!t,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,handle:this.props.handle,cancel:".react-resizable-handle"+(this.props.cancel?","+this.props.cancel:""),scale:this.props.transformScale,nodeRef:this.elementRef},e)}curryResizeHandler(e,t){return(n,s)=>t(n,s,e)}mixinResizable(e,t,n){const{cols:s,minW:o,minH:a,maxW:l,maxH:c,transformScale:u,resizeHandles:h,resizeHandle:m}=this.props,y=this.getPositionParams(),_=(0,fe.calcGridItemPosition)(y,0,0,s,0).width,M=(0,fe.calcGridItemPosition)(y,0,0,o,a),R=(0,fe.calcGridItemPosition)(y,0,0,l,c),C=[M.width,M.height],w=[Math.min(R.width,_),Math.min(R.height,1/0)];return Ke.default.createElement(Xl.Resizable,{draggableOpts:{disabled:!n},className:n?void 0:"react-resizable-hide",width:t.width,height:t.height,minConstraints:C,maxConstraints:w,onResizeStop:this.curryResizeHandler(t,this.onResizeStop),onResizeStart:this.curryResizeHandler(t,this.onResizeStart),onResize:this.curryResizeHandler(t,this.onResize),transformScale:u,resizeHandles:h,handle:m},e)}onResizeHandler(e,t,n,s){let{node:o,size:a,handle:l}=t;const c=this.props[s];if(!c)return;const{x:u,y:h,i:m,maxH:y,minH:_,containerWidth:M}=this.props,{minW:R,maxW:C}=this.props;let w=a;o&&(w=(0,Xe.resizeItemInDirection)(l,n,a,M),(0,bn.flushSync)(()=>{this.setState({resizing:s==="onResizeStop"?null:w})}));let{w:P,h:b}=(0,fe.calcWH)(this.getPositionParams(),w.width,w.height,u,h,l);P=(0,fe.clamp)(P,Math.max(R,1),C),b=(0,fe.clamp)(b,_,y),c.call(this,m,P,b,{e,node:o,size:w,handle:l})}render(){const{x:e,y:t,w:n,h:s,isDraggable:o,isResizable:a,droppingPosition:l,useCSSTransforms:c}=this.props,u=(0,fe.calcGridItemPosition)(this.getPositionParams(),e,t,n,s,this.state),h=Ke.default.Children.only(this.props.children);let m=Ke.default.cloneElement(h,{ref:this.elementRef,className:(0,Ql.default)("react-grid-item",h.props.className,this.props.className,{static:this.props.static,resizing:!!this.state.resizing,"react-draggable":o,"react-draggable-dragging":!!this.state.dragging,dropping:!!l,cssTransforms:c}),style:{...this.props.style,...h.props.style,...this.createStyle(u)}});return m=this.mixinResizable(m,u,a),m=this.mixinDraggable(m,o),m}}At.default=Yr;Ce(Yr,"propTypes",{children:V.default.element,cols:V.default.number.isRequired,containerWidth:V.default.number.isRequired,rowHeight:V.default.number.isRequired,margin:V.default.array.isRequired,maxRows:V.default.number.isRequired,containerPadding:V.default.array.isRequired,x:V.default.number.isRequired,y:V.default.number.isRequired,w:V.default.number.isRequired,h:V.default.number.isRequired,minW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minWidth not Number");if(t>r.w||t>r.maxW)return new Error("minWidth larger than item width/maxWidth")},maxW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxWidth not Number");if(t<r.w||t<r.minW)return new Error("maxWidth smaller than item width/minWidth")},minH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minHeight not Number");if(t>r.h||t>r.maxH)return new Error("minHeight larger than item height/maxHeight")},maxH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxHeight not Number");if(t<r.h||t<r.minH)return new Error("maxHeight smaller than item height/minHeight")},i:V.default.string.isRequired,resizeHandles:vn.resizeHandleAxesType,resizeHandle:vn.resizeHandleType,onDragStop:V.default.func,onDragStart:V.default.func,onDrag:V.default.func,onResizeStop:V.default.func,onResizeStart:V.default.func,onResize:V.default.func,isDraggable:V.default.bool.isRequired,isResizable:V.default.bool.isRequired,isBounded:V.default.bool.isRequired,static:V.default.bool,useCSSTransforms:V.default.bool.isRequired,transformScale:V.default.number,className:V.default.string,handle:V.default.string,cancel:V.default.string,droppingPosition:V.default.shape({e:V.default.object.isRequired,left:V.default.number.isRequired,top:V.default.number.isRequired})});Ce(Yr,"defaultProps",{className:"",cancel:"",handle:"",minH:1,minW:1,maxH:1/0,maxW:1/0,transformScale:1});Object.defineProperty(lt,"__esModule",{value:!0});lt.default=void 0;var We=Rs(f),lr=kr,ec=Kr(Et),N=$,tc=Ee,xn=Kr(At),rc=Kr(ze);function Kr(r){return r&&r.__esModule?r:{default:r}}function Rs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Rs=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function me(r,e,t){return(e=nc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function nc(r){var e=sc(r,"string");return typeof e=="symbol"?e:e+""}function sc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const wn="react-grid-layout";let Cs=!1;try{Cs=/firefox/i.test(navigator.userAgent)}catch{}class Ut extends We.Component{constructor(){super(...arguments),me(this,"state",{activeDrag:null,layout:(0,N.synchronizeLayoutWithChildren)(this.props.layout,this.props.children,this.props.cols,(0,N.compactType)(this.props),this.props.allowOverlap),mounted:!1,oldDragItem:null,oldLayout:null,oldResizeItem:null,resizing:!1,droppingDOMNode:null,children:[]}),me(this,"dragEnterCounter",0),me(this,"onDragStart",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l}=this.state,c=(0,N.getLayoutItem)(l,e);if(!c)return;const u={w:c.w,h:c.h,x:c.x,y:c.y,placeholder:!0,i:e};return this.setState({oldDragItem:(0,N.cloneLayoutItem)(c),oldLayout:l,activeDrag:u}),this.props.onDragStart(l,c,c,null,o,a)}),me(this,"onDrag",(e,t,n,s)=>{let{e:o,node:a}=s;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,allowOverlap:h,preventCollision:m}=this.props,y=(0,N.getLayoutItem)(c,e);if(!y)return;const _={w:y.w,h:y.h,x:y.x,y:y.y,placeholder:!0,i:e};c=(0,N.moveElement)(c,y,t,n,!0,m,(0,N.compactType)(this.props),u,h),this.props.onDrag(c,l,y,_,o,a),this.setState({layout:h?c:(0,N.compact)(c,(0,N.compactType)(this.props),u),activeDrag:_})}),me(this,"onDragStop",(e,t,n,s)=>{let{e:o,node:a}=s;if(!this.state.activeDrag)return;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,preventCollision:h,allowOverlap:m}=this.props,y=(0,N.getLayoutItem)(c,e);if(!y)return;c=(0,N.moveElement)(c,y,t,n,!0,h,(0,N.compactType)(this.props),u,m);const M=m?c:(0,N.compact)(c,(0,N.compactType)(this.props),u);this.props.onDragStop(M,l,y,null,o,a);const{oldLayout:R}=this.state;this.setState({activeDrag:null,layout:M,oldDragItem:null,oldLayout:null}),this.onLayoutMaybeChanged(M,R)}),me(this,"onResizeStart",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l}=this.state,c=(0,N.getLayoutItem)(l,e);c&&(this.setState({oldResizeItem:(0,N.cloneLayoutItem)(c),oldLayout:this.state.layout,resizing:!0}),this.props.onResizeStart(l,c,c,null,o,a))}),me(this,"onResize",(e,t,n,s)=>{let{e:o,node:a,size:l,handle:c}=s;const{oldResizeItem:u}=this.state,{layout:h}=this.state,{cols:m,preventCollision:y,allowOverlap:_}=this.props;let M=!1,R,C,w;const[P,b]=(0,N.withLayoutItem)(h,e,p=>{let v;return C=p.x,w=p.y,["sw","w","nw","n","ne"].indexOf(c)!==-1&&(["sw","nw","w"].indexOf(c)!==-1&&(C=p.x+(p.w-t),t=p.x!==C&&C<0?p.w:t,C=C<0?0:C),["ne","n","nw"].indexOf(c)!==-1&&(w=p.y+(p.h-n),n=p.y!==w&&w<0?p.h:n,w=w<0?0:w),M=!0),y&&!_&&(v=(0,N.getAllCollisions)(h,{...p,w:t,h:n,x:C,y:w}).filter(x=>x.i!==p.i).length>0,v&&(w=p.y,n=p.h,C=p.x,t=p.w,M=!1)),p.w=t,p.h=n,p});if(!b)return;R=P,M&&(R=(0,N.moveElement)(P,b,C,w,!0,this.props.preventCollision,(0,N.compactType)(this.props),m,_));const g={w:b.w,h:b.h,x:b.x,y:b.y,static:!0,i:e};this.props.onResize(R,u,b,g,o,a),this.setState({layout:_?R:(0,N.compact)(R,(0,N.compactType)(this.props),m),activeDrag:g})}),me(this,"onResizeStop",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l,oldResizeItem:c}=this.state,{cols:u,allowOverlap:h}=this.props,m=(0,N.getLayoutItem)(l,e),y=h?l:(0,N.compact)(l,(0,N.compactType)(this.props),u);this.props.onResizeStop(y,c,m,null,o,a);const{oldLayout:_}=this.state;this.setState({activeDrag:null,layout:y,oldResizeItem:null,oldLayout:null,resizing:!1}),this.onLayoutMaybeChanged(y,_)}),me(this,"onDragOver",e=>{if(e.preventDefault(),e.stopPropagation(),Cs&&!e.nativeEvent.target?.classList.contains(wn))return!1;const{droppingItem:t,onDropDragOver:n,margin:s,cols:o,rowHeight:a,maxRows:l,width:c,containerPadding:u,transformScale:h}=this.props,m=n?.(e);if(m===!1)return this.state.droppingDOMNode&&this.removeDroppingPlaceholder(),!1;const y={...t,...m},{layout:_}=this.state,M=e.currentTarget.getBoundingClientRect(),R=e.clientX-M.left,C=e.clientY-M.top,w={left:R/h,top:C/h,e};if(this.state.droppingDOMNode){if(this.state.droppingPosition){const{left:P,top:b}=this.state.droppingPosition;(P!=R||b!=C)&&this.setState({droppingPosition:w})}}else{const P={cols:o,margin:s,maxRows:l,rowHeight:a,containerWidth:c,containerPadding:u||s},b=(0,tc.calcXY)(P,C,R,y.w,y.h);this.setState({droppingDOMNode:We.createElement("div",{key:y.i}),droppingPosition:w,layout:[..._,{...y,x:b.x,y:b.y,static:!1,isDraggable:!0}]})}}),me(this,"removeDroppingPlaceholder",()=>{const{droppingItem:e,cols:t}=this.props,{layout:n}=this.state,s=(0,N.compact)(n.filter(o=>o.i!==e.i),(0,N.compactType)(this.props),t,this.props.allowOverlap);this.setState({layout:s,droppingDOMNode:null,activeDrag:null,droppingPosition:void 0})}),me(this,"onDragLeave",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter--,this.dragEnterCounter===0&&this.removeDroppingPlaceholder()}),me(this,"onDragEnter",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter++}),me(this,"onDrop",e=>{e.preventDefault(),e.stopPropagation();const{droppingItem:t}=this.props,{layout:n}=this.state,s=n.find(o=>o.i===t.i);this.dragEnterCounter=0,this.removeDroppingPlaceholder(),this.props.onDrop(n,s,e)})}componentDidMount(){this.setState({mounted:!0}),this.onLayoutMaybeChanged(this.state.layout,this.props.layout)}static getDerivedStateFromProps(e,t){let n;return t.activeDrag?null:(!(0,lr.deepEqual)(e.layout,t.propsLayout)||e.compactType!==t.compactType?n=e.layout:(0,N.childrenEqual)(e.children,t.children)||(n=t.layout),n?{layout:(0,N.synchronizeLayoutWithChildren)(n,e.children,e.cols,(0,N.compactType)(e),e.allowOverlap),compactType:e.compactType,children:e.children,propsLayout:e.layout}:null)}shouldComponentUpdate(e,t){return this.props.children!==e.children||!(0,N.fastRGLPropsEqual)(this.props,e,lr.deepEqual)||this.state.activeDrag!==t.activeDrag||this.state.mounted!==t.mounted||this.state.droppingPosition!==t.droppingPosition}componentDidUpdate(e,t){if(!this.state.activeDrag){const n=this.state.layout,s=t.layout;this.onLayoutMaybeChanged(n,s)}}containerHeight(){if(!this.props.autoSize)return;const e=(0,N.bottom)(this.state.layout),t=this.props.containerPadding?this.props.containerPadding[1]:this.props.margin[1];return e*this.props.rowHeight+(e-1)*this.props.margin[1]+t*2+"px"}onLayoutMaybeChanged(e,t){t||(t=this.state.layout),(0,lr.deepEqual)(t,e)||this.props.onLayoutChange(e)}placeholder(){const{activeDrag:e}=this.state;if(!e)return null;const{width:t,cols:n,margin:s,containerPadding:o,rowHeight:a,maxRows:l,useCSSTransforms:c,transformScale:u}=this.props;return We.createElement(xn.default,{w:e.w,h:e.h,x:e.x,y:e.y,i:e.i,className:`react-grid-placeholder ${this.state.resizing?"placeholder-resizing":""}`,containerWidth:t,cols:n,margin:s,containerPadding:o||s,maxRows:l,rowHeight:a,isDraggable:!1,isResizable:!1,isBounded:!1,useCSSTransforms:c,transformScale:u},We.createElement("div",null))}processGridItem(e,t){if(!e||!e.key)return;const n=(0,N.getLayoutItem)(this.state.layout,String(e.key));if(!n)return null;const{width:s,cols:o,margin:a,containerPadding:l,rowHeight:c,maxRows:u,isDraggable:h,isResizable:m,isBounded:y,useCSSTransforms:_,transformScale:M,draggableCancel:R,draggableHandle:C,resizeHandles:w,resizeHandle:P}=this.props,{mounted:b,droppingPosition:g}=this.state,p=typeof n.isDraggable=="boolean"?n.isDraggable:!n.static&&h,v=typeof n.isResizable=="boolean"?n.isResizable:!n.static&&m,j=n.resizeHandles||w,x=p&&y&&n.isBounded!==!1;return We.createElement(xn.default,{containerWidth:s,cols:o,margin:a,containerPadding:l||a,maxRows:u,rowHeight:c,cancel:R,handle:C,onDragStop:this.onDragStop,onDragStart:this.onDragStart,onDrag:this.onDrag,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,isDraggable:p,isResizable:v,isBounded:x,useCSSTransforms:_&&b,usePercentages:!b,transformScale:M,w:n.w,h:n.h,x:n.x,y:n.y,i:n.i,minH:n.minH,minW:n.minW,maxH:n.maxH,maxW:n.maxW,static:n.static,droppingPosition:t?g:void 0,resizeHandles:j,resizeHandle:P},e)}render(){const{className:e,style:t,isDroppable:n,innerRef:s}=this.props,o=(0,ec.default)(wn,e),a={height:this.containerHeight(),...t};return We.createElement("div",{ref:s,className:o,style:a,onDrop:n?this.onDrop:N.noop,onDragLeave:n?this.onDragLeave:N.noop,onDragEnter:n?this.onDragEnter:N.noop,onDragOver:n?this.onDragOver:N.noop},We.Children.map(this.props.children,l=>this.processGridItem(l)),n&&this.state.droppingDOMNode&&this.processGridItem(this.state.droppingDOMNode,!0),this.placeholder())}}lt.default=Ut;me(Ut,"displayName","ReactGridLayout");me(Ut,"propTypes",rc.default);me(Ut,"defaultProps",{autoSize:!0,cols:12,className:"",style:{},draggableHandle:"",draggableCancel:"",containerPadding:null,rowHeight:150,maxRows:1/0,layout:[],margin:[10,10],isBounded:!1,isDraggable:!0,isResizable:!0,allowOverlap:!1,isDroppable:!1,useCSSTransforms:!0,transformScale:1,verticalCompact:!0,compactType:"vertical",preventCollision:!1,droppingItem:{i:"__dropping-elem__",h:1,w:1},resizeHandles:["se"],onLayoutChange:N.noop,onDragStart:N.noop,onDrag:N.noop,onDragStop:N.noop,onResizeStart:N.noop,onResize:N.noop,onResizeStop:N.noop,onDrop:N.noop,onDropDragOver:N.noop});var Ft={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.findOrGenerateResponsiveLayout=ac;Ve.getBreakpointFromWidth=oc;Ve.getColsFromBreakpoint=ic;Ve.sortBreakpoints=Xr;var pt=$;function oc(r,e){const t=Xr(r);let n=t[0];for(let s=1,o=t.length;s<o;s++){const a=t[s];e>r[a]&&(n=a)}return n}function ic(r,e){if(!e[r])throw new Error("ResponsiveReactGridLayout: `cols` entry for breakpoint "+r+" is missing!");return e[r]}function ac(r,e,t,n,s,o){if(r[t])return(0,pt.cloneLayout)(r[t]);let a=r[n];const l=Xr(e),c=l.slice(l.indexOf(t));for(let u=0,h=c.length;u<h;u++){const m=c[u];if(r[m]){a=r[m];break}}return a=(0,pt.cloneLayout)(a||[]),(0,pt.compact)((0,pt.correctBounds)(a,{cols:s}),o,s)}function Xr(r){return Object.keys(r).sort(function(t,n){return r[t]-r[n]})}Object.defineProperty(Ft,"__esModule",{value:!0});Ft.default=void 0;var _n=Ds(f),ve=Es(qe),cr=kr,Ze=$,Be=Ve,lc=Es(lt);function Es(r){return r&&r.__esModule?r:{default:r}}function Ds(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Ds=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function Rr(){return Rr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Rr.apply(null,arguments)}function St(r,e,t){return(e=cc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function cc(r){var e=uc(r,"string");return typeof e=="symbol"?e:e+""}function uc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Sn=r=>Object.prototype.toString.call(r);function mt(r,e){return r==null?null:Array.isArray(r)?r:r[e]}class Qr extends _n.Component{constructor(){super(...arguments),St(this,"state",this.generateInitialState()),St(this,"onLayoutChange",e=>{this.props.onLayoutChange(e,{...this.props.layouts,[this.state.breakpoint]:e})})}generateInitialState(){const{width:e,breakpoints:t,layouts:n,cols:s}=this.props,o=(0,Be.getBreakpointFromWidth)(t,e),a=(0,Be.getColsFromBreakpoint)(o,s),l=this.props.verticalCompact===!1?null:this.props.compactType;return{layout:(0,Be.findOrGenerateResponsiveLayout)(n,t,o,o,a,l),breakpoint:o,cols:a}}static getDerivedStateFromProps(e,t){if(!(0,cr.deepEqual)(e.layouts,t.layouts)){const{breakpoint:n,cols:s}=t;return{layout:(0,Be.findOrGenerateResponsiveLayout)(e.layouts,e.breakpoints,n,n,s,e.compactType),layouts:e.layouts}}return null}componentDidUpdate(e){(this.props.width!=e.width||this.props.breakpoint!==e.breakpoint||!(0,cr.deepEqual)(this.props.breakpoints,e.breakpoints)||!(0,cr.deepEqual)(this.props.cols,e.cols))&&this.onWidthChange(e)}onWidthChange(e){const{breakpoints:t,cols:n,layouts:s,compactType:o}=this.props,a=this.props.breakpoint||(0,Be.getBreakpointFromWidth)(this.props.breakpoints,this.props.width),l=this.state.breakpoint,c=(0,Be.getColsFromBreakpoint)(a,n),u={...s};if(l!==a||e.breakpoints!==t||e.cols!==n){l in u||(u[l]=(0,Ze.cloneLayout)(this.state.layout));let y=(0,Be.findOrGenerateResponsiveLayout)(u,t,a,l,c,o);y=(0,Ze.synchronizeLayoutWithChildren)(y,this.props.children,c,o,this.props.allowOverlap),u[a]=y,this.props.onBreakpointChange(a,c),this.props.onLayoutChange(y,u),this.setState({breakpoint:a,layout:y,cols:c})}const h=mt(this.props.margin,a),m=mt(this.props.containerPadding,a);this.props.onWidthChange(this.props.width,h,c,m)}render(){const{breakpoint:e,breakpoints:t,cols:n,layouts:s,margin:o,containerPadding:a,onBreakpointChange:l,onLayoutChange:c,onWidthChange:u,...h}=this.props;return _n.createElement(lc.default,Rr({},h,{margin:mt(o,this.state.breakpoint),containerPadding:mt(a,this.state.breakpoint),onLayoutChange:this.onLayoutChange,layout:this.state.layout,cols:this.state.cols}))}}Ft.default=Qr;St(Qr,"propTypes",{breakpoint:ve.default.string,breakpoints:ve.default.object,allowOverlap:ve.default.bool,cols:ve.default.object,margin:ve.default.oneOfType([ve.default.array,ve.default.object]),containerPadding:ve.default.oneOfType([ve.default.array,ve.default.object]),layouts(r,e){if(Sn(r[e])!=="[object Object]")throw new Error("Layout property must be an object. Received: "+Sn(r[e]));Object.keys(r[e]).forEach(t=>{if(!(t in r.breakpoints))throw new Error("Each key in layouts must align with a key in breakpoints.");(0,Ze.validateLayout)(r.layouts[t],"layouts."+t)})},width:ve.default.number.isRequired,onBreakpointChange:ve.default.func,onLayoutChange:ve.default.func,onWidthChange:ve.default.func});St(Qr,"defaultProps",{breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},containerPadding:{lg:null,md:null,sm:null,xs:null,xxs:null},layouts:{},margin:[10,10],allowOverlap:!1,onBreakpointChange:Ze.noop,onLayoutChange:Ze.noop,onWidthChange:Ze.noop});var Jr={},Ms=function(){if(typeof Map<"u")return Map;function r(e,t){var n=-1;return e.some(function(s,o){return s[0]===t?(n=o,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var n=r(this.__entries__,t),s=this.__entries__[n];return s&&s[1]},e.prototype.set=function(t,n){var s=r(this.__entries__,t);~s?this.__entries__[s][1]=n:this.__entries__.push([t,n])},e.prototype.delete=function(t){var n=this.__entries__,s=r(n,t);~s&&n.splice(s,1)},e.prototype.has=function(t){return!!~r(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,n){n===void 0&&(n=null);for(var s=0,o=this.__entries__;s<o.length;s++){var a=o[s];t.call(n,a[1],a[0])}},e}()}(),Cr=typeof window<"u"&&typeof document<"u"&&window.document===document,jt=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),dc=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(jt):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),fc=2;function hc(r,e){var t=!1,n=!1,s=0;function o(){t&&(t=!1,r()),n&&l()}function a(){dc(o)}function l(){var c=Date.now();if(t){if(c-s<fc)return;n=!0}else t=!0,n=!1,setTimeout(a,e);s=c}return l}var pc=20,mc=["top","right","bottom","left","width","height","size","weight"],gc=typeof MutationObserver<"u",yc=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=hc(this.refresh.bind(this),pc)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!Cr||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),gc?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!Cr||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=t===void 0?"":t,s=mc.some(function(o){return!!~n.indexOf(o)});s&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),Os=function(r,e){for(var t=0,n=Object.keys(e);t<n.length;t++){var s=n[t];Object.defineProperty(r,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return r},et=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||jt},ks=Gt(0,0,0,0);function Pt(r){return parseFloat(r)||0}function jn(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(n,s){var o=r["border-"+s+"-width"];return n+Pt(o)},0)}function bc(r){for(var e=["top","right","bottom","left"],t={},n=0,s=e;n<s.length;n++){var o=s[n],a=r["padding-"+o];t[o]=Pt(a)}return t}function vc(r){var e=r.getBBox();return Gt(0,0,e.width,e.height)}function xc(r){var e=r.clientWidth,t=r.clientHeight;if(!e&&!t)return ks;var n=et(r).getComputedStyle(r),s=bc(n),o=s.left+s.right,a=s.top+s.bottom,l=Pt(n.width),c=Pt(n.height);if(n.boxSizing==="border-box"&&(Math.round(l+o)!==e&&(l-=jn(n,"left","right")+o),Math.round(c+a)!==t&&(c-=jn(n,"top","bottom")+a)),!_c(r)){var u=Math.round(l+o)-e,h=Math.round(c+a)-t;Math.abs(u)!==1&&(l-=u),Math.abs(h)!==1&&(c-=h)}return Gt(s.left,s.top,l,c)}var wc=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof et(r).SVGGraphicsElement}:function(r){return r instanceof et(r).SVGElement&&typeof r.getBBox=="function"}}();function _c(r){return r===et(r).document.documentElement}function Sc(r){return Cr?wc(r)?vc(r):xc(r):ks}function jc(r){var e=r.x,t=r.y,n=r.width,s=r.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,a=Object.create(o.prototype);return Os(a,{x:e,y:t,width:n,height:s,top:t,right:e+n,bottom:s+t,left:e}),a}function Gt(r,e,t,n){return{x:r,y:e,width:t,height:n}}var Pc=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Gt(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=Sc(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),Rc=function(){function r(e,t){var n=jc(t);Os(this,{target:e,contentRect:n})}return r}(),Cc=function(){function r(e,t,n){if(this.activeObservations_=[],this.observations_=new Ms,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Pc(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new Rc(n.target,n.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),Is=typeof WeakMap<"u"?new WeakMap:new Ms,zs=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=yc.getInstance(),n=new Cc(e,t,this);Is.set(this,n)}return r}();["observe","unobserve","disconnect"].forEach(function(r){zs.prototype[r]=function(){var e;return(e=Is.get(this))[r].apply(e,arguments)}});var Ec=function(){return typeof jt.ResizeObserver<"u"?jt.ResizeObserver:zs}();const Dc=Object.freeze(Object.defineProperty({__proto__:null,default:Ec},Symbol.toStringTag,{value:"Module"})),Mc=ro(Dc);Object.defineProperty(Jr,"__esModule",{value:!0});Jr.default=Ac;var gt=Ns(f),Oc=Zr(qe),kc=Zr(Mc),Ic=Zr(Et);function Zr(r){return r&&r.__esModule?r:{default:r}}function Ns(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Ns=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function Er(){return Er=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Er.apply(null,arguments)}function Qe(r,e,t){return(e=zc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function zc(r){var e=Nc(r,"string");return typeof e=="symbol"?e:e+""}function Nc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Tc="react-grid-layout";function Ac(r){var e;return e=class extends gt.Component{constructor(){super(...arguments),Qe(this,"state",{width:1280}),Qe(this,"elementRef",gt.createRef()),Qe(this,"mounted",!1),Qe(this,"resizeObserver",void 0)}componentDidMount(){this.mounted=!0,this.resizeObserver=new kc.default(s=>{if(this.elementRef.current instanceof HTMLElement){const a=s[0].contentRect.width;this.setState({width:a})}});const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.observe(n)}componentWillUnmount(){this.mounted=!1;const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.unobserve(n),this.resizeObserver.disconnect()}render(){const{measureBeforeMount:n,...s}=this.props;return n&&!this.mounted?gt.createElement("div",{className:(0,Ic.default)(this.props.className,Tc),style:this.props.style,ref:this.elementRef}):gt.createElement(r,Er({innerRef:this.elementRef},s,this.state))}},Qe(e,"defaultProps",{measureBeforeMount:!1}),Qe(e,"propTypes",{measureBeforeMount:Oc.default.bool}),e}(function(r){r.exports=lt.default,r.exports.utils=$,r.exports.calculateUtils=Ee,r.exports.Responsive=Ft.default,r.exports.Responsive.utils=Ve,r.exports.WidthProvider=Jr.default})(Zn);var Pn=Zn.exports;const Lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function qc(r){return r==null?"":typeof r!="string"?String(r):r.replace(/[&<>"'`=\/]/g,e=>Lc[e])}function en(r,e={}){const{maxLength:t=1e4,trim:n=!0,normalizeWhitespace:s=!0}=e;if(r==null)return"";typeof r!="string"&&(r=String(r));let o=r;return o=o.replace(/\0/g,""),o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n&&(o=o.trim()),s&&(o=o.replace(/[ \t]+/g," ")),o.length>t&&(o=o.substring(0,t)),o}function Rt(r,e=255){return r==null?"":(typeof r!="string"&&(r=String(r)),en(r,{maxLength:e}).replace(/[\r\n]/g," ").replace(/\s+/g," ").trim())}function Ts(r,e=1e4){return r==null?"":(typeof r!="string"&&(r=String(r)),en(r,{maxLength:e,normalizeWhitespace:!1}).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`).trim())}function As(r){return r?Rt(r,254).toLowerCase():""}function Vt(r,e={}){const{min:t=-1/0,max:n=1/0,decimals:s=2}=e;if(r==null||r==="")return null;let o=String(r).replace(/[^0-9.\-]/g,""),a=parseFloat(o);return isNaN(a)?null:(a=Math.max(t,Math.min(n,a)),a=Math.round(a*Math.pow(10,s))/Math.pow(10,s),a)}function Wc(r){const e=Vt(r,{min:0,decimals:2});return e!==null?Math.round(e*100)/100:null}function Bc(r){const e=Vt(r,{min:0,max:24,decimals:1});return e===null?null:Math.round(e*2)/2}function Hc(r){return Vt(r,{min:0,max:100,decimals:1})}function $c(r){if(!r)return null;const e=String(r).trim();return/^(javascript|data|vbscript):/i.test(e)?null:/^(https?:\/\/|\/|#)/i.test(e)?e:`https://${e}`}function Uc(r,e={}){if(!r||typeof r!="object")return r;const t={...r};for(const[n,s]of Object.entries(e)){if(t[n]===void 0)continue;const{type:o="text",maxLength:a}=s;switch(o){case"singleLine":t[n]=Rt(t[n],a);break;case"multiLine":t[n]=Ts(t[n],a);break;case"email":t[n]=As(t[n]);break;case"number":t[n]=Vt(t[n],s);break;case"currency":t[n]=Wc(t[n]);break;case"hours":t[n]=Bc(t[n]);break;case"percentage":t[n]=Hc(t[n]);break;case"url":t[n]=$c(t[n]);break;case"html":t[n]=qc(t[n]);break;default:t[n]=en(t[n],{maxLength:a})}}return t}const Fc={timesheet:{description:{type:"multiLine",maxLength:2e3},hours_worked:{type:"hours"}},expense:{reason:{type:"multiLine",maxLength:2e3},amount:{type:"currency"}},resource:{name:{type:"singleLine",maxLength:100},email:{type:"email"},role:{type:"singleLine",maxLength:100},notes:{type:"multiLine",maxLength:5e3}},partner:{name:{type:"singleLine",maxLength:200},contact_name:{type:"singleLine",maxLength:100},contact_email:{type:"email"},notes:{type:"multiLine",maxLength:5e3}},milestone:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},deliverable:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},kpi:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"number",decimals:2},actual_value:{type:"number",decimals:2}},qualityStandard:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"percentage"}}};function Rn(r,e){const t=Fc[r];return t?Uc(e,t):e}class Oe{constructor(e,t={}){this.tableName=e,this.supportsSoftDelete=t.supportsSoftDelete!==!1,this.sanitizeConfig=t.sanitizeConfig||null}getSoftDeleteFilter(){return this.supportsSoftDelete?"is_deleted.is.null,is_deleted.eq.false":null}async getAll(e,t={}){try{let n=S.from(this.tableName).select(t.select||"*").eq("project_id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter())),t.filters&&Array.isArray(t.filters)&&t.filters.forEach(a=>{const{column:l,operator:c,value:u}=a;switch(c){case"eq":n=n.eq(l,u);break;case"neq":n=n.neq(l,u);break;case"gt":n=n.gt(l,u);break;case"gte":n=n.gte(l,u);break;case"lt":n=n.lt(l,u);break;case"lte":n=n.lte(l,u);break;case"like":n=n.like(l,u);break;case"ilike":n=n.ilike(l,u);break;case"in":n=n.in(l,u);break;case"is":n=n.is(l,u);break;default:n=n.eq(l,u)}}),t.orderBy&&(n=n.order(t.orderBy.column,{ascending:t.orderBy.ascending??!0}));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getDeleted(e){if(!this.supportsSoftDelete)return[];try{const{data:t,error:n}=await S.from(this.tableName).select("*").eq("project_id",e).eq("is_deleted",!0).order("deleted_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async getById(e,t={}){try{let n=S.from(this.tableName).select(t.select||"*").eq("id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:o}=await n.single();if(o){if(o.code==="PGRST116")return null;throw o}return s}catch(n){throw n}}async create(e){try{if(!e.project_id)throw new Error("project_id is required");let t=e;this.sanitizeConfig&&(t=Rn(this.sanitizeConfig,e)),this.supportsSoftDelete&&(delete t.is_deleted,delete t.deleted_at,delete t.deleted_by);const{data:n,error:s}=await S.from(this.tableName).insert(t).select().single();if(s)throw s;return n}catch(t){throw t}}async update(e,t){try{let n=t;this.sanitizeConfig&&(n=Rn(this.sanitizeConfig,t));const s={...n,updated_at:new Date().toISOString()};delete s.is_deleted,delete s.deleted_at,delete s.deleted_by;const{data:o,error:a}=await S.from(this.tableName).update(s).eq("id",e).select().single();if(a)throw a;return o}catch(n){throw n}}async delete(e,t=null){try{if(this.supportsSoftDelete){const{error:n}=await S.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e);if(n)throw n}else{const{error:n}=await S.from(this.tableName).delete().eq("id",e);if(n)throw n}return!0}catch(n){throw n}}async hardDelete(e){try{const{error:t}=await S.from(this.tableName).delete().eq("id",e);if(t)throw t;return!0}catch(t){throw t}}async restore(e){if(!this.supportsSoftDelete)throw new Error("This entity does not support soft delete");try{const{data:t,error:n}=await S.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}catch(t){throw t}}async exists(e){try{let t=S.from(this.tableName).select("id",{count:"exact",head:!0}).eq("id",e);this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{count:n,error:s}=await t;if(s)throw s;return n>0}catch(t){throw t}}async count(e,t=[]){try{let n=S.from(this.tableName).select("id",{count:"exact",head:!0}).eq("project_id",e);this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.forEach(a=>{const{column:l,operator:c,value:u}=a;c==="eq"?n=n.eq(l,u):c==="in"&&(n=n.in(l,u))});const{count:s,error:o}=await n;if(o)throw o;return s||0}catch(n){throw n}}}class Gc extends Oe{constructor(){super("partners")}async getAll(e){return super.getAll(e,{orderBy:{column:"name",ascending:!0}})}async getActive(e){return super.getAll(e,{filters:[{column:"is_active",operator:"eq",value:!0}],orderBy:{column:"name",ascending:!0}})}async getWithResources(e){try{const{data:t,error:n}=await S.from("partners").select(`
          *,
          resources (
            id,
            name,
            daily_rate,
            cost_price,
            is_active
          )
        `).eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getSummary(e){try{const{data:t,error:n}=await S.from("partners").select(`
          id,
          name,
          contact_name,
          contact_email,
          payment_terms,
          is_active,
          created_at
        `).eq("project_id",e).order("name",{ascending:!0});if(n)throw n;return t||[]}catch(t){throw t}}async create(e){if(!e.name?.trim())throw new Error("Partner name is required");if(await this.findByName(e.project_id,e.name))throw new Error(`Partner "${e.name}" already exists`);return super.create({...e,name:e.name.trim(),is_active:e.is_active??!0,payment_terms:e.payment_terms||"Net 30"})}async findByName(e,t){try{const{data:n,error:s}=await S.from("partners").select("*").eq("project_id",e).ilike("name",t.trim()).single();if(s){if(s.code==="PGRST116")return null;throw s}return n}catch(n){if(n.code==="PGRST116")return null;throw n}}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Partner not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e,t=!0){return(t?await this.getActive(e):await this.getAll(e)).map(s=>({value:s.id,label:s.name}))}async getDependencyCounts(e){try{const{data:t,error:n}=await S.from("resources").select("id").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(n)throw n;const s=t?.map(u=>u.id)||[];let o=0,a=0;if(s.length>0){const{count:u,error:h}=await S.from("timesheets").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(h)throw h;o=u||0;const{count:m,error:y}=await S.from("expenses").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(y)throw y;a=m||0}const{count:l,error:c}=await S.from("partner_invoices").select("*",{count:"exact",head:!0}).eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(c)throw c;return{resourceCount:t?.length||0,timesheetCount:o,expenseCount:a,invoiceCount:l||0,canDelete:!t?.length&&!l}}catch(t){throw t}}}const jd=new Gc;class Vc extends Oe{constructor(){super("resources",{sanitizeConfig:"resource",supportsSoftDelete:!0})}sanitizeData(e){const t={...e};return t.name&&(t.name=Rt(t.name,100)),t.role&&(t.role=Rt(t.role,100)),t.email&&(t.email=As(t.email)),t.notes&&(t.notes=Ts(t.notes,5e3)),t}async getAll(e,t={}){const{includePartner:n=!0,activeOnly:s=!1,showTestUsers:o=!0,includeDeleted:a=!1}=t;let l="*";n&&(l="*, partner:partners(id, name, is_active)");let c=S.from(this.tableName).select(l).eq("project_id",e).order("name");a||(c=c.or("is_deleted.is.null,is_deleted.eq.false")),s&&(c=c.eq("is_active",!0)),o||(c=c.or("is_test_content.is.null,is_test_content.eq.false"));const{data:u,error:h}=await c;if(h)throw h;return u||[]}async getAllFiltered(e,t=!0){return this.getAll(e,{showTestUsers:t,includePartner:!0})}async getById(e){const{data:t,error:n}=await S.from(this.tableName).select("*, partner:partners(id, name, contact_name, contact_email, is_active)").eq("id",e).or("is_deleted.is.null,is_deleted.eq.false").single();if(n)throw n;return t}async getByType(e,t){const{data:n,error:s}=await S.from(this.tableName).select("*, partner:partners(id, name)").eq("project_id",e).eq("resource_type",t).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(s)throw s;return n||[]}async getByPartner(e){const{data:t,error:n}=await S.from(this.tableName).select("*").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}async getWithTimesheetSummary(e){const t=await this.getById(e);if(!t)return null;const{data:n,error:s}=await S.from("timesheets").select("id, hours_worked, hours, status, was_rejected, date").eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false");let o=0,a=0,l=0;return n&&n.forEach(c=>{const u=parseFloat(c.hours_worked||c.hours||0);o+=u,c.status==="Approved"?a+=u:c.status==="Submitted"&&!c.was_rejected&&(l+=u)}),{...t,timesheetSummary:{totalEntries:n?.length||0,totalHours:o,approvedHours:a,pendingHours:l,daysWorked:o/8}}}async create(e){const t=this.sanitizeData(e);if(!t.name?.trim())throw new Error("Resource name is required");if(!t.project_id)throw new Error("Project ID is required");if(!t.email?.trim())throw new Error("Email is required");t.resource_type==="internal"&&(t.partner_id=null);const{data:n,error:s}=await S.from(this.tableName).insert([t]).select("*, partner:partners(id, name)").single();if(s)throw s;return n}async update(e,t){const n=this.sanitizeData(t);n.resource_type==="internal"&&(n.partner_id=null),n.updated_at=new Date().toISOString();const{data:s,error:o}=await S.from(this.tableName).update(n).eq("id",e).select("*, partner:partners(id, name)").single();if(o)throw o;return s}async delete(e,t=null){const{data:n,error:s}=await S.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e).select().single();if(s)throw s;return n}async restore(e){const{data:t,error:n}=await S.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}async linkToPartner(e,t){const n={partner_id:t,resource_type:t?"third_party":"internal",updated_at:new Date().toISOString()};return this.update(e,n)}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Resource not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e){const{data:t,error:n}=await S.from(this.tableName).select("id, name, resource_type, role").eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}calculateMargin(e,t){if(!e||e===0||!t)return{percent:null,amount:null,status:"unknown"};const n=(e-t)/e*100,s=e-t;let o="critical";return n>=25?o="good":n>=10&&(o="low"),{percent:n,amount:s,status:o}}async getUtilization(e){const t=await this.getWithTimesheetSummary(e);if(!t)return null;const n=t.days_allocated||0,s=t.timesheetSummary.daysWorked,o=Math.max(0,n-s),a=n>0?s/n*100:0;return{resourceId:e,resourceName:t.name,daysAllocated:n,daysUsed:s,remaining:o,utilizationPercent:a,totalValue:(t.daily_rate||0)*n,valueUsed:(t.daily_rate||0)*s}}async getSummary(e){const t=await this.getAll(e,{includePartner:!1});return{total:t.length,internal:t.filter(n=>n.resource_type==="internal").length,thirdParty:t.filter(n=>n.resource_type==="third_party").length,active:t.filter(n=>n.is_active).length,totalBudget:t.reduce((n,s)=>n+(s.daily_rate||0)*(s.days_allocated||0),0)}}async getProfileByEmail(e){try{const{data:t,error:n}=await this.supabase.from("profiles").select("id, email, full_name, role").eq("email",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getAllWithTestFilter(e,t=[]){try{const n=await this.getAll(e,{orderBy:{column:"name",ascending:!0}});return t&&t.length>0?n.filter(s=>!s.user_id||!t.includes(s.user_id)):n}catch(n){throw n}}async getDependencyCounts(e){try{const[t,n]=await Promise.all([this.supabase.from("timesheets").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false"),this.supabase.from("expenses").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false")]);return{timesheetCount:t.count||0,expenseCount:n.count||0,canDelete:(t.count||0)===0&&(n.count||0)===0}}catch(t){throw t}}}const Pd=new Vc;class Yc extends Oe{constructor(){super("timesheets",{supportsSoftDelete:!0,sanitizeConfig:"timesheet"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||`
      *,
      resources(id, name, email, daily_rate, cost_price),
      milestones(id, milestone_ref, name)
    `,orderBy:t.orderBy||{column:"date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=S.from(this.tableName).select(`
          *,
          resources(id, name, email, daily_rate, cost_price),
          milestones(id, milestone_ref, name)
        `).eq("project_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=S.from(this.tableName).select("*, milestones(id, milestone_ref, name)").eq("resource_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("date",t.start)),t.end&&(n=n.lte("date",t.end)),t.status&&(n=n.eq("status",t.status));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await S.from("resources").select("id, name, cost_price").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(!n||n.length===0)return[];const s=n.map(c=>c.id);let o=S.from(this.tableName).select("*, resources(id, name, cost_price), milestones(id, milestone_ref, name)").in("resource_id",s).order("date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("date",t.start)),t.end&&(o=o.lte("date",t.end)),t.status&&(o=o.eq("status",t.status));const{data:a,error:l}=await o;if(l)throw l;return a||[]}catch(n){throw n}}async getApprovedForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,status:"Approved"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={totalHours:0,totalDays:0,approvedHours:0,pendingHours:0,draftHours:0,rejectedHours:0,totalCost:0,approvedCost:0,byStatus:{Draft:{count:0,hours:0},Submitted:{count:0,hours:0},Approved:{count:0,hours:0},Rejected:{count:0,hours:0}},byMilestone:{},count:n.length};return n.forEach(o=>{const a=parseFloat(o.hours_worked||o.hours||0),l=o.resources?.cost_price||0,c=a/8*l;switch(s.totalHours+=a,s.totalCost+=c,s.byStatus[o.status]&&(s.byStatus[o.status].count++,s.byStatus[o.status].hours+=a),o.status){case"Approved":s.approvedHours+=a,s.approvedCost+=c;break;case"Submitted":o.was_rejected||(s.pendingHours+=a);break;case"Draft":s.draftHours+=a;break;case"Rejected":s.rejectedHours+=a;break}if(o.milestone_id){const u=o.milestones?.milestone_ref||"Unknown";s.byMilestone[o.milestone_id]||(s.byMilestone[o.milestone_id]={ref:u,name:o.milestones?.name||"Unknown",hours:0,cost:0}),s.byMilestone[o.milestone_id].hours+=a,s.byMilestone[o.milestone_id].cost+=c}}),s.totalDays=s.totalHours/8,s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.date)throw new Error("date is required");const t=parseFloat(e.hours_worked||e.hours||0);if(!t||t<=0)throw new Error("hours must be greater than 0");const n={...e,hours_worked:t,hours:t,date:e.date||e.work_date,work_date:e.work_date||e.date,description:e.description||e.comments||"",comments:e.comments||e.description||"",status:e.status||"Draft"};return super.create(n)}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected",was_rejected:!0};return t&&(n.rejection_reason=t),this.update(e,n)}calculateCost(e,t){return e/8*t}calculateBillable(e,t){return e/8*t}}const Kc=new Yc;class Xc extends Oe{constructor(){super("expenses",{supportsSoftDelete:!0,sanitizeConfig:"expense"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, expense_files(*)",orderBy:t.orderBy||{column:"expense_date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=S.from(this.tableName).select("*, expense_files(*)").eq("project_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=S.from(this.tableName).select("*, expense_files(*)").eq("resource_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("expense_date",t.start)),t.end&&(n=n.lte("expense_date",t.end));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await S.from("resources").select("id").eq("partner_id",e);if(!n||n.length===0)return[];const s=n.map(c=>c.id);let o=S.from(this.tableName).select("*, expense_files(*)").in("resource_id",s).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("expense_date",t.start)),t.end&&(o=o.lte("expense_date",t.end)),t.procurementMethod&&(o=o.eq("procurement_method",t.procurementMethod));const{data:a,error:l}=await o;if(l)throw l;return a||[]}catch(n){throw n}}async getPartnerProcuredForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,procurementMethod:"partner"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={total:0,chargeable:0,nonChargeable:0,supplierProcured:0,partnerProcured:0,byCategory:{Travel:0,Accommodation:0,Sustenance:0},byStatus:{Draft:0,Submitted:0,Approved:0,Rejected:0,Paid:0},count:n.length};return n.forEach(o=>{const a=parseFloat(o.amount||0);s.total+=a,o.chargeable_to_customer!==!1?s.chargeable+=a:s.nonChargeable+=a,o.procurement_method==="partner"?s.partnerProcured+=a:s.supplierProcured+=a,s.byCategory[o.category]!==void 0&&(s.byCategory[o.category]+=a),s.byStatus[o.status]!==void 0&&(s.byStatus[o.status]+=a)}),s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.category)throw new Error("category is required");if(!e.amount||e.amount<=0)throw new Error("amount must be greater than 0");const t={...e,status:e.status||"Draft",chargeable_to_customer:e.chargeable_to_customer??!0,procurement_method:e.procurement_method||"supplier"};return super.create(t)}async createMany(e){if(!e||e.length===0)return[];try{const t=e.map(o=>{if(!o.resource_id)throw new Error("resource_id is required for all expenses");if(!o.category)throw new Error("category is required for all expenses");if(!o.amount||o.amount<=0)throw new Error("amount must be greater than 0 for all expenses");return{...o,status:o.status||"Draft",chargeable_to_customer:o.chargeable_to_customer??!0,procurement_method:o.procurement_method||"supplier"}}),{data:n,error:s}=await S.from(this.tableName).insert(t).select();if(s)throw s;return n||[]}catch(t){throw t}}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected"};return t&&(n.rejection_reason=t),this.update(e,n)}async markPaid(e){return this.update(e,{status:"Paid"})}async uploadReceipt(e,t,n){try{const s=`${e}/${Date.now()}-${t.name}`,{error:o}=await S.storage.from("receipts").upload(s,t);if(o)throw o;const{data:a,error:l}=await S.from("expense_files").insert({expense_id:e,file_name:t.name,file_path:s,file_size:t.size,file_type:t.type,uploaded_by:n}).select().single();if(l)throw l;return a}catch(s){throw s}}async downloadReceipt(e){try{const{data:t,error:n}=await S.storage.from("receipts").download(e);if(n)throw n;return t}catch(t){throw t}}}const Rd=new Xc;class Qc extends Oe{constructor(){super("partner_invoices")}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, partners(name)",orderBy:t.orderBy||{column:"invoice_date",ascending:!1}})}async getByPartner(e,t={}){try{let n=S.from(this.tableName).select("*").eq("partner_id",e).order("invoice_date",{ascending:!1});t.status&&(n=n.eq("status",t.status));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getWithLines(e){try{const{data:t,error:n}=await S.from(this.tableName).select("*, partners(name, contact_name, contact_email, payment_terms)").eq("id",e).single();if(n)throw n;if(!t)return null;const{data:s,error:o}=await S.from("partner_invoice_lines").select("*").eq("invoice_id",e).order("line_type",{ascending:!0}).order("resource_name",{ascending:!0}).order("line_date",{ascending:!0});if(o)throw o;const a={timesheets:(s||[]).filter(l=>l.line_type==="timesheet"),supplierExpenses:(s||[]).filter(l=>l.line_type==="supplier_expense"),partnerExpenses:(s||[]).filter(l=>l.line_type==="expense")};return{...t,lines:s||[],groupedLines:a}}catch(t){throw t}}async generateInvoiceNumber(e){try{const n=`INV-${new Date().getFullYear()}-`,{data:s,error:o}=await S.from(this.tableName).select("invoice_number").eq("project_id",e).like("invoice_number",`${n}%`).order("invoice_number",{ascending:!1}).limit(1);if(o)throw o;let a=1;if(s&&s.length>0){const l=s[0].invoice_number,c=parseInt(l.replace(n,""),10);isNaN(c)||(a=c+1)}return`${n}${String(a).padStart(3,"0")}`}catch(t){throw t}}async generateInvoice(e){const{projectId:t,partnerId:n,periodStart:s,periodEnd:o,createdBy:a,notes:l,includeSubmitted:c=!0}=e;try{const{data:u,error:h}=await S.from("resources").select("id, name, cost_price").eq("partner_id",n);if(h)throw h;if(!u||u.length===0)throw new Error("No resources linked to this partner");const m=u.map(I=>I.id),y={};u.forEach(I=>{y[I.id]=I});const _=c?["Approved","Submitted"]:["Approved"],{data:M,error:R}=await S.from("timesheets").select("id, date, hours_worked, hours, status, resource_id").in("resource_id",m).gte("date",s).lte("date",o).in("status",_);if(R)throw R;const{data:C,error:w}=await S.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, procurement_method, chargeable_to_customer, status").in("resource_id",m).gte("expense_date",s).lte("expense_date",o).in("status",["Approved","Submitted","Paid"]);if(w)throw w;const P=(C||[]).filter(I=>I.procurement_method==="partner"||!I.procurement_method),b=(C||[]).filter(I=>I.procurement_method==="supplier");let g=0,p=0;const v=[],j={};(M||[]).forEach(I=>{j[I.resource_id]||(j[I.resource_id]=[]),j[I.resource_id].push(I)}),Object.keys(j).forEach(I=>{const ce=y[I];j[I].forEach(Y=>{const se=parseFloat(Y.hours_worked||Y.hours||0),E=ce?.cost_price||0,k=se/8,T=k*E;g+=T,p+=T,v.push({line_type:"timesheet",timesheet_id:Y.id,expense_id:null,description:`${ce?.name||"Unknown"} - ${se}h (${k.toFixed(2)} days)`,quantity:se,unit_price:E,line_total:T,resource_name:ce?.name,line_date:Y.date,hours:se,cost_price:E,source_status:Y.status,chargeable_to_customer:!0,procurement_method:null,expense_category:null})})});let x=0,D=0,z=0;const te=[];P.forEach(I=>{const ce=parseFloat(I.amount||0);x+=ce,I.chargeable_to_customer?D+=ce:z+=ce,te.push({line_type:"expense",timesheet_id:null,expense_id:I.id,description:`${I.resource_name} - ${I.category}: ${I.reason}`,quantity:1,unit_price:ce,line_total:ce,resource_name:I.resource_name,line_date:I.expense_date,hours:null,cost_price:null,source_status:I.status,chargeable_to_customer:I.chargeable_to_customer,procurement_method:"partner",expense_category:I.category})});let q=0,G=0,re=0;const J=[];b.forEach(I=>{const ce=parseFloat(I.amount||0);q+=ce,I.chargeable_to_customer?G+=ce:re+=ce,J.push({line_type:"supplier_expense",timesheet_id:null,expense_id:I.id,description:`${I.resource_name} - ${I.category}: ${I.reason}`,quantity:1,unit_price:ce,line_total:ce,resource_name:I.resource_name,line_date:I.expense_date,hours:null,cost_price:null,source_status:I.status,chargeable_to_customer:I.chargeable_to_customer,procurement_method:"supplier",expense_category:I.category})});const O=g+x,U=p+D+G,ue=z+re,ne=await this.generateInvoiceNumber(t),{data:ke,error:Ie}=await S.from(this.tableName).insert({project_id:t,partner_id:n,invoice_number:ne,invoice_date:new Date().toISOString().split("T")[0],period_start:s,period_end:o,timesheet_total:g,expense_total:x,supplier_expense_total:q,invoice_total:O,chargeable_total:U,non_chargeable_total:ue,status:"Draft",notes:l||null,created_by:a}).select().single();if(Ie)throw Ie;const Ne=[...v,...te,...J].map(I=>({...I,invoice_id:ke.id}));if(Ne.length>0){const{error:I}=await S.from("partner_invoice_lines").insert(Ne);if(I)throw I}return this.getWithLines(ke.id)}catch(u){throw u}}async updateStatus(e,t){const n={status:t};return t==="Sent"?n.sent_at=new Date().toISOString():t==="Paid"&&(n.paid_at=new Date().toISOString()),this.update(e,n)}async markSent(e){return this.updateStatus(e,"Sent")}async markPaid(e){return this.updateStatus(e,"Paid")}async cancel(e){return this.updateStatus(e,"Cancelled")}async getPartnerStats(e){try{const{data:t,error:n}=await S.from(this.tableName).select("status, invoice_total").eq("partner_id",e);if(n)throw n;const s={total:0,draft:0,sent:0,paid:0,cancelled:0,count:t?.length||0};return(t||[]).forEach(o=>{const a=parseFloat(o.invoice_total||0);switch(s.total+=a,o.status){case"Draft":s.draft+=a;break;case"Sent":s.sent+=a;break;case"Paid":s.paid+=a;break;case"Cancelled":s.cancelled+=a;break}}),s}catch(t){throw t}}}const Cd=new Qc;class Jc extends Oe{constructor(){super("milestones",{supportsSoftDelete:!0,sanitizeConfig:"milestone"})}async getAllWithStats(e){try{const t=await this.getAll(e,{orderBy:{column:"start_date",ascending:!0}}),{data:n}=await S.from("timesheets").select("milestone_id, hours_worked").eq("project_id",e).not("milestone_id","is",null).or("is_deleted.is.null,is_deleted.eq.false"),s={};return(n||[]).forEach(o=>{s[o.milestone_id]||(s[o.milestone_id]=0),s[o.milestone_id]+=parseFloat(o.hours_worked||0)}),t.map(o=>({...o,logged_hours:s[o.id]||0,logged_days:(s[o.id]||0)/8}))}catch(t){throw t}}async getWithDeliverables(e){try{const{data:t,error:n}=await S.from(this.tableName).select("*").eq("id",e).or(this.getSoftDeleteFilter()).single();if(n)throw n;const{data:s,error:o}=await S.from("deliverables").select("*").eq("milestone_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(o)throw o;return{...t,deliverables:s||[]}}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"start_date",ascending:!0}})}async getUpcoming(e,t=30){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const o=s.toISOString().split("T")[0];let a=S.from(this.tableName).select("*").eq("project_id",e).gte("end_date",n).lte("end_date",o).neq("status","Completed").order("end_date",{ascending:!0});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await a;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t){return this.update(e,{status:t})}async updateCompletion(e,t){const n={completion_percentage:t};return t>=100&&(n.status="Completed"),this.update(e,n)}async getSummary(e){try{const t=await this.getAll(e),n={total:t.length,completed:0,inProgress:0,notStarted:0,overdue:0,upcoming:0},s=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()+7);const a=o.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Completed"?n.completed++:l.status==="In Progress"?(n.inProgress++,l.end_date<s&&n.overdue++):l.status==="Not Started"&&(n.notStarted++,l.start_date<=a&&n.upcoming++)}),n}catch(t){throw t}}async getCertificates(e){try{const{data:t,error:n}=await S.from("milestone_certificates").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async createCertificate(e){try{const{data:t,error:n}=await S.from("milestone_certificates").insert([e]).select().single();if(n)throw n;return t}catch(t){throw t}}async updateCertificate(e,t){try{const{data:n,error:s}=await S.from("milestone_certificates").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw n}}}const Zc=new Jc;class eu extends Oe{constructor(){super("deliverables",{supportsSoftDelete:!0,sanitizeConfig:"deliverable"})}async getAllWithMilestones(e){return this.getAll(e,{select:"*, milestones(name, milestone_ref)",orderBy:{column:"due_date",ascending:!0}})}async getByMilestone(e){try{let t=S.from(this.tableName).select("*").eq("milestone_id",e).order("due_date",{ascending:!0});this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{data:n,error:s}=await t;if(s)throw s;return n||[]}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"due_date",ascending:!0}})}async getOverdue(e){try{const t=new Date().toISOString().split("T")[0];let n=S.from(this.tableName).select("*, milestones(name)").eq("project_id",e).lt("due_date",t).not("status","in",'("Delivered","Cancelled")').order("due_date",{ascending:!0});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(t){throw t}}async getUpcoming(e,t=14){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const o=s.toISOString().split("T")[0];let a=S.from(this.tableName).select("*, milestones(name)").eq("project_id",e).gte("due_date",n).lte("due_date",o).not("status","eq","Delivered").order("due_date",{ascending:!0});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await a;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t,n){const s={status:t};return t==="Submitted"?(s.submitted_date=new Date().toISOString(),s.submitted_by=n):t==="Delivered"&&(s.delivered_date=new Date().toISOString(),s.delivered_by=n),this.update(e,s)}async submit(e,t){return this.updateStatus(e,"Submitted",t)}async markDelivered(e,t){return this.updateStatus(e,"Delivered",t)}async reject(e,t){return this.update(e,{status:"Rejected",rejection_reason:t})}async getSummary(e){try{const t=await this.getAll(e),n=new Date().toISOString().split("T")[0],s={total:t.length,delivered:0,inProgress:0,notStarted:0,overdue:0,dueThisWeek:0},o=new Date;o.setDate(o.getDate()+7);const a=o.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Delivered"?s.delivered++:l.status==="In Progress"?(s.inProgress++,l.due_date<n?s.overdue++:l.due_date<=a&&s.dueThisWeek++):(l.status==="Not Started"||l.status==="Draft")&&(s.notStarted++,l.due_date<n&&s.overdue++)}),s}catch(t){throw t}}async getAllWithRelations(e,t=!1){try{let n=this.supabase.from("deliverables").select(`
          *,
          milestone:milestones(milestone_ref, name),
          assigned_user:profiles!deliverables_assigned_to_fkey(full_name),
          creator:profiles!deliverables_created_by_fkey(full_name)
        `).eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("deliverable_ref");t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async syncKPILinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_kpis").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(a=>({deliverable_id:e,kpi_id:a})),{error:o}=await this.supabase.from("deliverable_kpis").insert(s);if(o)throw o}return!0}catch(n){throw n}}async syncQSLinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_quality_standards").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(a=>({deliverable_id:e,quality_standard_id:a})),{error:o}=await this.supabase.from("deliverable_quality_standards").insert(s);if(o)throw o}return!0}catch(n){throw n}}async upsertKPIAssessments(e,t,n){try{const s=t.map(a=>({deliverable_id:e,kpi_id:a.kpiId,criteria_met:a.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:o}=await this.supabase.from("deliverable_kpi_assessments").upsert(s,{onConflict:"deliverable_id,kpi_id"});if(o)throw o;return!0}catch(s){throw s}}async upsertQSAssessments(e,t,n){try{const s=t.map(a=>({deliverable_id:e,quality_standard_id:a.qsId,criteria_met:a.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:o}=await this.supabase.from("deliverable_qs_assessments").upsert(s,{onConflict:"deliverable_id,quality_standard_id"});if(o)throw o;return!0}catch(s){throw s}}}const tu=new eu;class ru extends Oe{constructor(){super("kpis")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,rag_status:this.calculateRAG(n)}))}catch(t){throw t}}calculateRAG(e){if(!e.target_value||e.actual_value===null||e.actual_value===void 0)return"Unknown";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value),s=parseFloat(e.threshold_amber||10);return e.trend==="higher_better"?t>=n?"Green":t>=n*(1-s/100)?"Amber":"Red":t<=n?"Green":t<=n*(1+s/100)?"Amber":"Red"}async getByRAGStatus(e,t){try{return(await this.getAllWithStatus(e)).filter(s=>s.rag_status===t)}catch(n){throw n}}async getNeedingAttention(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.rag_status==="Amber"||n.rag_status==="Red")}catch(t){throw t}}async updateActualValue(e,t){return this.update(e,{actual_value:t,last_updated:new Date().toISOString()})}async getHistory(e,t=12){try{const{data:n,error:s}=await S.from("kpi_history").select("*").eq("kpi_id",e).order("recorded_at",{ascending:!1}).limit(t);if(s)throw s;return n||[]}catch{return[]}}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,green:t.filter(n=>n.rag_status==="Green").length,amber:t.filter(n=>n.rag_status==="Amber").length,red:t.filter(n=>n.rag_status==="Red").length,unknown:t.filter(n=>n.rag_status==="Unknown").length}}catch(t){throw t}}async getAssessments(e){try{const{data:t,error:n}=await S.from("deliverable_kpi_assessments").select("kpi_id, criteria_met").eq("project_id",e);if(n)throw n;return t||[]}catch(t){throw t}}}const nu=new ru;class su extends Oe{constructor(){super("quality_standards")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,compliance_status:this.calculateCompliance(n)}))}catch(t){throw t}}calculateCompliance(e){if(e.actual_value===null||e.actual_value===void 0)return"Not Measured";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value||0);return t>=n?"Compliant":t>=n*.9?"Near Compliant":"Non-Compliant"}async getNonCompliant(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.compliance_status==="Non-Compliant")}catch(t){throw t}}async updateMeasurement(e,t,n){return this.update(e,{actual_value:t,measurement_notes:n,last_measured:new Date().toISOString()})}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,compliant:t.filter(n=>n.compliance_status==="Compliant").length,nearCompliant:t.filter(n=>n.compliance_status==="Near Compliant").length,nonCompliant:t.filter(n=>n.compliance_status==="Non-Compliant").length,notMeasured:t.filter(n=>n.compliance_status==="Not Measured").length}}catch(t){throw t}}}const ou=new su;class iu extends Oe{constructor(){super("standards",{supportsSoftDelete:!1,sanitizeConfig:"standard"})}async getAll(e){return super.getAll(e,{orderBy:{column:"standard_ref",ascending:!0}})}async getByStatus(e,t){return super.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getByCategory(e,t){return super.getAll(e,{filters:[{column:"category",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getSummary(e){try{const t=await this.getAll(e);return{total:t.length,completed:t.filter(n=>n.status==="Completed").length,inProgress:t.filter(n=>n.status==="In Progress").length,notStarted:t.filter(n=>!n.status||n.status==="Not Started").length}}catch(t){throw t}}}new iu;const au={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},lu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},cu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:6,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:10,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:10,w:6,h:3,minW:4,minH:3,maxH:5}}},Ls={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!1,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:4,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:8,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:8,w:6,h:3,minW:4,minH:3,maxH:5}}},ur={...Ls},qs={"progress-hero":{id:"progress-hero",title:"Project Progress",description:"Overall project completion percentage",icon:"target",category:"overview"},"budget-summary":{id:"budget-summary",title:"Budget Overview",description:"Total budget and spend to date",icon:"dollar-sign",category:"financial"},"pmo-tracking":{id:"pmo-tracking",title:"PMO Cost Tracking",description:"PMO vs Non-PMO budget breakdown",icon:"briefcase",category:"financial"},"stats-grid":{id:"stats-grid",title:"Key Statistics",description:"Milestones, deliverables, resources, KPIs, and quality standards counts",icon:"bar-chart",category:"overview"},certificates:{id:"certificates",title:"Milestone Certificates",description:"Certificate signing status summary",icon:"file-check",category:"compliance"},"milestones-list":{id:"milestones-list",title:"Milestones",description:"Milestone status, progress, and spend by milestone",icon:"clock",category:"delivery"},"kpis-category":{id:"kpis-category",title:"KPIs by Category",description:"KPI performance grouped by category",icon:"trending-up",category:"performance"},"quality-standards":{id:"quality-standards",title:"Quality Standards",description:"Quality standard achievement summary",icon:"award",category:"compliance"}};function bt(r){if(!r)return ur;const e=r.toUpperCase();return e.includes("ADMIN")?au:e.includes("SUPPLIER")&&e.includes("PM")?lu:e.includes("CUSTOMER")&&e.includes("PM")?cu:e.includes("CONTRIBUTOR")?Ls:(e.includes("VIEWER"),ur)}const dr=bt;function uu(r){return Object.keys(qs)}class du{constructor(){this.tableName="dashboard_layouts"}async getLayout(e,t,n){try{const{data:s,error:o}=await S.from(this.tableName).select("layout_config").eq("user_id",e).eq("project_id",t).maybeSingle();if(o)throw o;return s?.layout_config?s.layout_config:dr(n)}catch{return dr(n)}}async saveLayout(e,t,n){try{const{data:s,error:o}=await S.from(this.tableName).upsert({user_id:e,project_id:t,layout_config:n,updated_at:new Date().toISOString()},{onConflict:"user_id,project_id"}).select().single();if(o)throw o;return s}catch(s){throw s}}async deleteLayout(e,t){try{const{error:n}=await S.from(this.tableName).delete().eq("user_id",e).eq("project_id",t);if(n)throw n}catch(n){throw n}}async resetToDefault(e,t,n){try{return await this.deleteLayout(e,t),dr(n)}catch(s){throw s}}}const fr=new du;function fu(r,e,t){const[n,s]=f.useState(null),[o,a]=f.useState(!0),[l,c]=f.useState(!1),[u,h]=f.useState(null),m=f.useCallback(async()=>{if(!r||!e){a(!1);return}try{a(!0);const p=await fr.getLayout(r,e);if(p)s(p);else{const v=bt(t);s(v)}}catch{const v=bt(t);s(v)}finally{a(!1)}},[r,e,t]),y=f.useCallback(async p=>{if(!(!r||!e||!p))try{c(!0),await fr.saveLayout(r,e,p),s(p),h(new Date)}catch(v){throw v}finally{c(!1)}},[r,e]),_=f.useCallback((p,v)=>{s(j=>j&&{...j,widgets:{...j.widgets,[p]:{...j.widgets[p],visible:v}}})},[]),M=f.useCallback(async p=>{const v={...n,widgets:{...n.widgets,...Object.entries(p).reduce((j,[x,D])=>(j[x]={...n.widgets[x],visible:D},j),{})}};await y(v)},[n,y]),R=f.useCallback(p=>{if(!n)return;const v={...n.widgets};p.forEach(x=>{v[x.i]&&(v[x.i]={...v[x.i],x:x.x,y:x.y,w:x.w,h:x.h})});const j={...n,widgets:v};s(j)},[n]),C=f.useCallback(async p=>{if(!n)return;const v={...n.widgets};p.forEach(x=>{v[x.i]&&(v[x.i]={...v[x.i],x:x.x,y:x.y,w:x.w,h:x.h})});const j={...n,widgets:v};await y(j)},[n,y]),w=f.useCallback(async()=>{if(!(!r||!e))try{c(!0),await fr.deleteLayout(r,e);const p=bt(t);s(p),h(new Date)}catch(p){throw p}finally{c(!1)}},[r,e,t]),P=f.useCallback(p=>!n||!n.widgets?!0:n.widgets[p]?.visible!==!1,[n]),b=f.useCallback(()=>!n||!n.widgets?[]:Object.entries(n.widgets).filter(([p,v])=>v.visible!==!1).map(([p,v])=>({i:p,x:v.x||0,y:v.y||0,w:v.w||12,h:v.h||2,minW:v.minW,minH:v.minH,maxH:v.maxH})),[n]),g=f.useCallback(p=>!n||!n.widgets?null:n.widgets[p],[n]);return f.useEffect(()=>{m()},[m]),{layout:n,loading:o,saving:l,lastSaved:u,updateVisibility:_,bulkUpdateVisibility:M,updateLayoutPositions:R,saveLayoutPositions:C,resetToDefault:w,isWidgetVisible:P,getGridLayout:b,getWidgetConfig:g}}function hu({isOpen:r,onClose:e,layout:t,role:n,onUpdateVisibility:s,onReset:o,saving:a,lastSaved:l}){const[c,u]=f.useState({}),[h,m]=f.useState(!1),y=uu(),_=g=>c.hasOwnProperty(g)?c[g]:t?.widgets?.[g]?.visible!==!1,M=g=>{u(p=>({...p,[g]:!_(g)}))},R=async()=>{if(Object.keys(c).length===0){e();return}try{await s(c),u({}),e()}catch{}},C=()=>{u({}),e()},w=async()=>{try{await o(),u({}),m(!1)}catch{}};if(!r)return null;const P=y.filter(g=>_(g)).length,b=Object.keys(c).length>0;return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"dashboard-customize-backdrop",onClick:C,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,opacity:r?1:0,transition:"opacity 0.3s ease"}}),i.jsxs("div",{className:"dashboard-customize-panel",style:{position:"fixed",top:0,right:r?0:"-400px",bottom:0,width:"400px",maxWidth:"90vw",backgroundColor:"white",boxShadow:"-4px 0 20px rgba(0, 0, 0, 0.15)",zIndex:1e3,display:"flex",flexDirection:"column",transition:"right 0.3s ease"},children:[i.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Customize Dashboard"}),i.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.875rem",color:"#64748b"},children:[P," of ",y.length," widgets visible"]})]}),i.jsx("button",{onClick:C,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b",borderRadius:"4px"},onMouseEnter:g=>g.target.style.backgroundColor="#f1f5f9",onMouseLeave:g=>g.target.style.backgroundColor="transparent",children:i.jsx(Ue,{size:20})})]}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.75rem"},children:"Available Widgets"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:y.map(g=>{const p=qs[g],v=_(g),j=c.hasOwnProperty(g);return i.jsx("div",{onClick:()=>M(g),style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer",backgroundColor:v?"#f0f9ff":"white",borderColor:v?"#3b82f6":"#e2e8f0",transition:"all 0.2s ease",position:"relative"},onMouseEnter:x=>{v||(x.target.style.backgroundColor="#f8fafc")},onMouseLeave:x=>{v||(x.target.style.backgroundColor="white")},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:v?"#3b82f6":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",color:v?"white":"#64748b",flexShrink:0},children:v?i.jsx(Mo,{size:20}):i.jsx(Oo,{size:20})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontWeight:"500",fontSize:"0.9375rem",marginBottom:"0.125rem",color:v?"#1e293b":"#64748b"},children:p.title}),i.jsx("div",{style:{fontSize:"0.8125rem",color:"#64748b"},children:p.description})]}),j&&i.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b"}})]})},g)})})]})}),i.jsxs("div",{style:{padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[l&&!b&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8125rem",color:"#10b981"},children:[i.jsx(kn,{size:16}),"Saved ",new Date(l).toLocaleTimeString()]}),i.jsx("div",{style:{display:"flex",gap:"0.75rem"},children:h?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>m(!1),style:{flex:1,padding:"0.625rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",cursor:"pointer"},children:"Cancel"}),i.jsx("button",{onClick:w,disabled:a,style:{flex:1,padding:"0.625rem",border:"none",borderRadius:"6px",backgroundColor:"#ef4444",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"Resetting...":"Confirm Reset"})]}):i.jsxs("button",{onClick:()=>m(!0),style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},onMouseEnter:g=>{g.target.style.backgroundColor="#f8fafc",g.target.style.borderColor="#cbd5e1"},onMouseLeave:g=>{g.target.style.backgroundColor="white",g.target.style.borderColor="#e2e8f0"},children:[i.jsx(Tn,{size:16}),"Reset to Default"]})}),i.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[i.jsx("button",{onClick:C,style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},onMouseEnter:g=>{g.target.style.backgroundColor="#f8fafc"},onMouseLeave:g=>{g.target.style.backgroundColor="white"},children:"Cancel"}),i.jsx("button",{onClick:R,disabled:a||!b,style:{flex:1,padding:"0.625rem 1rem",border:"none",borderRadius:"6px",backgroundColor:b?"#3b82f6":"#94a3b8",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:a||!b?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:a?"Saving...":i.jsxs(i.Fragment,{children:[i.jsx(ko,{size:16}),"Apply Changes"]})})]})]})]})]})}const pu=Pn.WidthProvider(Pn.Responsive);function Cn(r){if(!r)return!1;const e=r.toLowerCase();return e.includes("pmo")||e.includes("project manager")}function mu(){const{showTestUsers:r,testUserIds:e}=gi(),{projectId:t,projectName:n,projectRef:s}=Un(),{user:o,role:a}=Mt(),{layout:l,loading:c,saving:u,lastSaved:h,bulkUpdateVisibility:m,saveLayoutPositions:y,resetToDefault:_,getGridLayout:M}=fu(o?.id,t,a),[R,C]=f.useState(!1),[w,P]=f.useState(!0),[b,g]=f.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[p,v]=f.useState({signed:0,pending:0,awaitingGeneration:0}),[j,x]=f.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0,pmoResources:[],nonPmoResources:[]}),[D,z]=f.useState([]),[te,q]=f.useState({}),[G,re]=f.useState({}),[J,O]=f.useState([]),[U,ue]=f.useState(0),ne=f.useRef(null),ke=f.useCallback(async()=>{if(t){P(!0);try{const de=await Zc.getAll(t,{orderBy:{column:"milestone_ref",ascending:!0}});z(de);const Y=await tu.getSummary(t),se=await nu.getAll(t,{orderBy:{column:"kpi_ref",ascending:!0}}),E=await ou.getAll(t,{orderBy:{column:"qs_ref",ascending:!0}});O(E);const{data:k}=await S.from("resources").select("*"),T=await Kc.getAllFiltered(t,r);let W=0,F=0;const Z=[],le=[];k&&k.forEach(B=>{const we=(B.daily_rate||0)*(B.days_allocated||0);Cn(B.role)?(W+=we,Z.push({name:B.name,role:B.role,budget:we})):(F+=we,le.push({name:B.name,role:B.role,budget:we}))});const he={};let ee=0,xe=0,K=0;T&&k&&T.forEach(B=>{if(!(B.status==="Approved"||B.status==="Submitted"&&!B.was_rejected))return;const Xs=parseFloat(B.hours_worked||B.hours||0),Kt=B.resources||k.find(Ye=>Ye.id===B.resource_id);if(Kt){const Ye=Xs/8*(Kt.daily_rate||0);B.milestone_id&&(he[B.milestone_id]=(he[B.milestone_id]||0)+Ye),ee+=Ye,Cn(Kt.role)?xe+=Ye:K+=Ye}}),q(he),x({pmoBudget:W,pmoSpend:xe,nonPmoBudget:F,nonPmoSpend:K,pmoResources:Z,nonPmoResources:le});const X={};se.forEach(B=>{const we=B.category||"Other";X[we]||(X[we]=[]),X[we].push(B)}),re(X);const be=de.length,tt=de.filter(B=>B.status==="Completed").length,dt=Y.total,je=Y.delivered,Ws=k?.length||0,Bs=se.length,Hs=se.filter(B=>(B.current_value||0)>=(B.target||90)).length,$s=E.length,Us=E.filter(B=>(B.current_value||0)>=(B.target||100)).length,{data:Yt}=await S.from("milestone_certificates").select("*").eq("project_id",t),Fs=Yt?.filter(B=>B.status==="Signed").length||0,Gs=Yt?.filter(B=>B.status==="Pending Customer Signature"||B.status==="Pending Supplier Signature").length||0,Vs=Math.max(0,tt-(Yt?.length||0));v({signed:Fs,pending:Gs,awaitingGeneration:Vs});const Ys=de.reduce((B,we)=>B+(we.budget||0),0),Ks=be>0?Math.round(de.reduce((B,we)=>B+(we.progress||0),0)/be):0;ue(Ks),g({totalMilestones:be,completedMilestones:tt,totalDeliverables:dt,deliveredCount:je,totalResources:Ws,totalKPIs:Bs,achievedKPIs:Hs,totalQS:$s,achievedQS:Us,totalBudget:Ys,spendToDate:ee})}catch{}finally{P(!1)}}},[t,r]);f.useEffect(()=>{ke()},[ke]);function Ie(de){switch(de){case"Time Performance":return"#3b82f6";case"Quality of Collaboration":return"#8b5cf6";case"Delivery Performance":return"#10b981";default:return"#64748b"}}const Ne=f.useCallback(de=>{ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{y(de)},1e3)},[y]),I=de=>{switch(de){case"progress-hero":return i.jsx("div",{className:"card",style:{height:"100%",background:"linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%)",color:"white",display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[i.jsxs("div",{children:[i.jsxs("h2",{style:{fontSize:"2.5rem",fontWeight:"700",margin:0},children:[U,"%"]}),i.jsx("p",{style:{opacity:.9,margin:0},children:"Overall Progress"})]}),i.jsx("div",{style:{width:"120px",height:"120px",position:"relative"},children:i.jsxs("svg",{viewBox:"0 0 100 100",style:{transform:"rotate(-90deg)"},children:[i.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"10"}),i.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"white",strokeWidth:"10",strokeDasharray:`${U*2.51} 251`,strokeLinecap:"round"})]})})]})});case"budget-summary":return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",height:"100%"},children:[i.jsx("div",{className:"card",style:{borderLeft:"4px solid #3b82f6",height:"100%"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total Budget"}),i.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:["£",b.totalBudget.toLocaleString()]})]}),i.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px"},children:i.jsx(No,{size:24,style:{color:"#3b82f6"}})})]})}),i.jsx("div",{className:"card",style:{borderLeft:"4px solid #10b981",height:"100%"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Spend to Date"}),i.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#10b981"},children:["£",Math.round(b.spendToDate).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:[b.totalBudget>0?Math.round(b.spendToDate/b.totalBudget*100):0,"% of budget"]})]}),i.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px"},children:i.jsx(yt,{size:24,style:{color:"#10b981"}})})]})})]});case"pmo-tracking":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsx(zo,{size:20})," PMO Cost Tracking"]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.75rem",marginBottom:"1rem"},children:[i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"8px",borderLeft:"4px solid #f59e0b"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#92400e",marginBottom:"0.25rem"},children:"PMO Budget"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#d97706"},children:["£",Math.round(j.pmoBudget/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#ffedd5",borderRadius:"8px",borderLeft:"4px solid #ea580c"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#9a3412",marginBottom:"0.25rem"},children:"PMO Spend"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#ea580c"},children:["£",Math.round(j.pmoSpend/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#1e40af",marginBottom:"0.25rem"},children:"Non-PMO Budget"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#2563eb"},children:["£",Math.round(j.nonPmoBudget/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px",borderLeft:"4px solid #16a34a"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Non-PMO Spend"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#16a34a"},children:["£",Math.round(j.nonPmoSpend/1e3),"k"]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[i.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:"Spend Distribution"}),i.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["PMO: ",b.spendToDate>0?Math.round(j.pmoSpend/b.spendToDate*100):0,"% | Non-PMO: ",b.spendToDate>0?Math.round(j.nonPmoSpend/b.spendToDate*100):0,"%"]})]}),i.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#e2e8f0"},children:[i.jsx("div",{style:{width:`${b.spendToDate>0?j.pmoSpend/b.spendToDate*100:0}%`,backgroundColor:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:j.pmoSpend>0?"40px":"0"},children:j.pmoSpend>0&&"PMO"}),i.jsx("div",{style:{width:`${b.spendToDate>0?j.nonPmoSpend/b.spendToDate*100:0}%`,backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:j.nonPmoSpend>0?"60px":"0"},children:j.nonPmoSpend>0&&"Non-PMO"})]})]})]});case"stats-grid":return i.jsxs("div",{style:{height:"100%",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[i.jsx(ft,{icon:at,label:"Milestones",value:`${b.completedMilestones} / ${b.totalMilestones}`,subtext:`${b.totalMilestones>0?Math.round(b.completedMilestones/b.totalMilestones*100):0}% Complete`,color:"#3b82f6"}),i.jsx(ft,{icon:pr,label:"Deliverables",value:`${b.deliveredCount} / ${b.totalDeliverables}`,subtext:`${b.totalDeliverables>0?Math.round(b.deliveredCount/b.totalDeliverables*100):0}% Delivered`,color:"#10b981"}),i.jsx(ft,{icon:yt,label:"KPIs",value:`${b.achievedKPIs} / ${b.totalKPIs}`,subtext:`${b.totalKPIs>0?Math.round(b.achievedKPIs/b.totalKPIs*100):0}% Achieved`,color:"#3b82f6"}),i.jsx(ft,{icon:xt,label:"Quality Standards",value:`${b.achievedQS} / ${b.totalQS}`,subtext:`${b.totalQS>0?Math.round(b.achievedQS/b.totalQS*100):0}% Achieved`,color:"#8b5cf6"})]});case"certificates":return i.jsx("div",{className:"card",style:{height:"100%",backgroundColor:"#fefce8",borderLeft:"4px solid #eab308"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx(Io,{size:28,style:{color:"#ca8a04"}}),i.jsx("div",{children:i.jsx("h4",{style:{margin:0,color:"#854d0e"},children:"Milestone Certificates"})})]}),i.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#16a34a"},children:p.signed}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#166534"},children:"Signed"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#d97706"},children:p.pending}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e"},children:"Pending"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:p.awaitingGeneration>0?"#dc2626":"#64748b"},children:p.awaitingGeneration}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Awaiting"})]})]}),i.jsx(Le,{to:"/milestones",style:{padding:"0.5rem 1rem",backgroundColor:"#ca8a04",color:"white",textDecoration:"none",borderRadius:"6px",fontWeight:"500"},children:"View →"})]})});case"milestones-list":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Billable vs Spend by Milestone"}),i.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"1rem"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem",marginRight:"1rem"},children:[i.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),"Billable"]}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem"},children:[i.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"2px"}}),"Spend"]})]}),i.jsx("div",{style:{display:"flex",gap:"0.5rem",height:"calc(100% - 80px)",alignItems:"flex-end"},children:D.map(Y=>{const se=Math.max(...D.map(W=>W.budget||0)),E=te[Y.id]||0,k=se>0?(Y.budget||0)/se*100:0,T=se>0?E/se*100:0;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[i.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"flex-end",height:"100%",width:"100%",justifyContent:"center"},children:[i.jsx("div",{style:{width:"45%",height:`${k}%`,backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",minHeight:Y.budget>0?"20px":"0",position:"relative"},title:`Billable: £${(Y.budget||0).toLocaleString()}`,children:k>15&&i.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round((Y.budget||0)/1e3),"k"]})}),i.jsx("div",{style:{width:"45%",height:`${T}%`,backgroundColor:"#10b981",borderRadius:"4px 4px 0 0",minHeight:E>0?"20px":"0",position:"relative"},title:`Spend: £${Math.round(E).toLocaleString()}`,children:T>15&&i.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round(E/1e3),"k"]})})]}),i.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"600",color:"#64748b"},children:Y.milestone_ref})]},Y.id)})})]});case"kpis-category":return i.jsxs("div",{className:"card",style:{height:"100%"},children:[i.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Performance"}),i.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end",height:"calc(100% - 50px)"},children:Object.entries(G).map(([Y,se])=>{const E=se.length,k=se.filter(W=>(W.current_value||0)>=(W.target||90)).length,T=E>0?k/E*100:0;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem",height:"100%"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[i.jsx("div",{style:{height:`${100-T}%`,backgroundColor:"#e2e8f0",borderRadius:T>0?"4px 4px 0 0":"4px"}}),i.jsxs("div",{style:{height:`${T}%`,backgroundColor:Ie(Y),borderRadius:T<100?"0 0 4px 4px":"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"700"},children:[k,"/",E]})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontWeight:"600",fontSize:"0.75rem"},children:Y.split(" ")[0]}),i.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[Math.round(T),"%"]})]})]},Y)})})]});case"quality-standards":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsx("h3",{style:{marginBottom:"1rem"},children:"Quality Standards"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:J.map(Y=>{const se=Y.current_value||0,E=se>=(Y.target||100);return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600",minWidth:"45px",color:"#8b5cf6"},children:Y.qs_ref}),i.jsx("div",{style:{flex:1},children:i.jsx("div",{style:{height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:i.jsx("div",{style:{width:`${se}%`,height:"100%",backgroundColor:E?"#10b981":"#8b5cf6"}})})}),i.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"45px",color:E?"#10b981":"#64748b"},children:[se,"%"]})]},Y.id)})})]});default:return null}};if(w||c)return i.jsx(Mr,{message:"Loading dashboard...",size:"large",fullPage:!0});const ce=M();return i.jsxs("div",{className:"page-container",children:[i.jsx(Pi,{icon:tn,title:`${s||"Project"} Dashboard`,subtitle:n||"Project Tracker",children:i.jsxs("button",{onClick:()=>C(!0),className:"btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1rem"},children:[i.jsx(Nn,{size:18}),"Customize"]})}),i.jsx(pu,{className:"layout",layouts:{lg:ce},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,onLayoutChange:Ne,draggableHandle:".drag-handle",margin:[16,16],containerPadding:[0,0],children:ce.map(de=>i.jsxs("div",{style:{position:"relative"},children:[i.jsx("div",{className:"drag-handle",style:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",cursor:"move",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},title:"Drag to move",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[i.jsx("circle",{cx:"4",cy:"4",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"4",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"4",cy:"8",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"8",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"4",cy:"12",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"#64748b"})]})}),I(de.i)]},de.i))}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"1rem",marginTop:"2rem"},children:[i.jsxs(Le,{to:"/milestones",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(at,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Milestones"})]}),i.jsxs(Le,{to:"/deliverables",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(pr,{size:32,style:{color:"#10b981",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Deliverables"})]}),i.jsxs(Le,{to:"/kpis",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(yt,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"KPIs"})]}),i.jsxs(Le,{to:"/quality-standards",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(xt,{size:32,style:{color:"#8b5cf6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Quality"})]}),i.jsxs(Le,{to:"/reports",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(tn,{size:32,style:{color:"#f59e0b",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Reports"})]})]}),i.jsx(hu,{isOpen:R,onClose:()=>C(!1),layout:l,role:a,onUpdateVisibility:m,onReset:_,saving:u,lastSaved:h})]})}const gu=f.lazy(()=>ie(()=>import("./ResetPassword-CW30N-r4.js"),__vite__mapDeps([0,1,2,3,4]))),yu=f.lazy(()=>ie(()=>import("./Milestones-D_dX0DCm.js"),__vite__mapDeps([5,1,6,7,2,3,4]))),bu=f.lazy(()=>ie(()=>import("./MilestoneDetail-CtCGcCxT.js"),__vite__mapDeps([8,1,2,3,4]))),vu=f.lazy(()=>ie(()=>import("./Gantt-BzWowR8g.js"),__vite__mapDeps([9,1,6,2,3,4]))),xu=f.lazy(()=>ie(()=>import("./Deliverables-COG3x1AJ.js"),__vite__mapDeps([10,1,6,2,3,4]))),wu=f.lazy(()=>ie(()=>import("./Resources-BuQXLRab.js"),__vite__mapDeps([11,1,6,7,2,3,4]))),_u=f.lazy(()=>ie(()=>import("./ResourceDetail-CcRA2u5E.js"),__vite__mapDeps([12,1,6,2,3,4]))),Su=f.lazy(()=>ie(()=>import("./Partners-M3Xecgjx.js"),__vite__mapDeps([13,1,6,7,2,3,4]))),ju=f.lazy(()=>ie(()=>import("./PartnerDetail-BFLTK3TK.js"),__vite__mapDeps([14,1,6,2,3,4]))),Pu=f.lazy(()=>ie(()=>import("./Timesheets-BBGbTHwV.js"),__vite__mapDeps([15,1,6,7,2,3,4]))),Ru=f.lazy(()=>ie(()=>import("./Expenses-BlDeJrZO.js"),__vite__mapDeps([16,1,6,7,2,3,4,17]))),Cu=f.lazy(()=>ie(()=>import("./KPIs-Cy7qUYH1.js"),__vite__mapDeps([18,1,6,7,2,3,4]))),Eu=f.lazy(()=>ie(()=>import("./KPIDetail-DnNHDfMP.js"),__vite__mapDeps([19,1,6,2,3,4]))),Du=f.lazy(()=>ie(()=>import("./QualityStandards-iBe3Dtcg.js"),__vite__mapDeps([20,1,6,7,2,3,4]))),Mu=f.lazy(()=>ie(()=>import("./QualityStandardDetail-Bp8L6t-k.js"),__vite__mapDeps([21,1,2,3,4]))),Ou=f.lazy(()=>ie(()=>import("./Reports-DjBspiyn.js"),__vite__mapDeps([22,2,1,3,4]))),ku=f.lazy(()=>ie(()=>import("./Users-CF50tLz_.js"),__vite__mapDeps([23,1,2,3,4]))),Iu=f.lazy(()=>ie(()=>import("./Settings-m_dD-RNw.js"),__vite__mapDeps([24,1,6,2,3,4]))),zu=f.lazy(()=>ie(()=>import("./AccountSettings-D_BxBp2Q.js"),__vite__mapDeps([25,1,2,3,4]))),Nu=f.lazy(()=>ie(()=>import("./WorkflowSummary-CE7L2px4.js"),__vite__mapDeps([26,1,2,3,4]))),Tu=f.lazy(()=>ie(()=>import("./AuditLog-D0KPB2VU.js"),__vite__mapDeps([27,1,2,3,4]))),Au=f.lazy(()=>ie(()=>import("./DeletedItems-Dk-1W2pq.js"),__vite__mapDeps([28,1,7,2,3,4])));function Lu(){return i.jsx("div",{className:"page-container",children:i.jsx(st,{type:"page"})})}function oe({children:r}){const{user:e,isLoading:t}=Mt();return t?i.jsx(Mr,{message:"Loading...",size:"large",fullPage:!0}):e?i.jsx(ha,{children:i.jsx(f.Suspense,{fallback:i.jsx(Lu,{}),children:r||i.jsx(oo,{})})}):i.jsx(hr,{to:"/login",replace:!0})}function qu(){return i.jsx(no,{children:i.jsx(wi,{children:i.jsx(Di,{children:i.jsx(hi,{children:i.jsx(pi,{children:i.jsx(mi,{children:i.jsx(bi,{children:i.jsxs(vi,{children:[i.jsxs(so,{children:[i.jsx(Q,{path:"/login",element:i.jsx(pa,{})}),i.jsx(Q,{path:"/reset-password",element:i.jsx(f.Suspense,{fallback:i.jsx(Mr,{fullPage:!0}),children:i.jsx(gu,{})})}),i.jsx(Q,{path:"/",element:i.jsx(hr,{to:"/dashboard",replace:!0})}),i.jsx(Q,{path:"/dashboard",element:i.jsx(oe,{children:i.jsx(mu,{})})}),i.jsx(Q,{path:"/milestones",element:i.jsx(oe,{children:i.jsx(yu,{})})}),i.jsx(Q,{path:"/milestones/:id",element:i.jsx(oe,{children:i.jsx(bu,{})})}),i.jsx(Q,{path:"/gantt",element:i.jsx(oe,{children:i.jsx(vu,{})})}),i.jsx(Q,{path:"/deliverables",element:i.jsx(oe,{children:i.jsx(xu,{})})}),i.jsx(Q,{path:"/resources",element:i.jsx(oe,{children:i.jsx(wu,{})})}),i.jsx(Q,{path:"/resources/:id",element:i.jsx(oe,{children:i.jsx(_u,{})})}),i.jsx(Q,{path:"/partners",element:i.jsx(oe,{children:i.jsx(Su,{})})}),i.jsx(Q,{path:"/partners/:id",element:i.jsx(oe,{children:i.jsx(ju,{})})}),i.jsx(Q,{path:"/timesheets",element:i.jsx(oe,{children:i.jsx(Pu,{})})}),i.jsx(Q,{path:"/expenses",element:i.jsx(oe,{children:i.jsx(Ru,{})})}),i.jsx(Q,{path:"/kpis",element:i.jsx(oe,{children:i.jsx(Cu,{})})}),i.jsx(Q,{path:"/kpis/:id",element:i.jsx(oe,{children:i.jsx(Eu,{})})}),i.jsx(Q,{path:"/quality-standards",element:i.jsx(oe,{children:i.jsx(Du,{})})}),i.jsx(Q,{path:"/quality-standards/:id",element:i.jsx(oe,{children:i.jsx(Mu,{})})}),i.jsx(Q,{path:"/reports",element:i.jsx(oe,{children:i.jsx(Ou,{})})}),i.jsx(Q,{path:"/users",element:i.jsx(oe,{children:i.jsx(ku,{})})}),i.jsx(Q,{path:"/settings",element:i.jsx(oe,{children:i.jsx(Iu,{})})}),i.jsx(Q,{path:"/account",element:i.jsx(oe,{children:i.jsx(zu,{})})}),i.jsx(Q,{path:"/workflow-summary",element:i.jsx(oe,{children:i.jsx(Nu,{})})}),i.jsx(Q,{path:"/audit-log",element:i.jsx(oe,{children:i.jsx(Tu,{})})}),i.jsx(Q,{path:"/deleted-items",element:i.jsx(oe,{children:i.jsx(Au,{})})}),i.jsx(Q,{path:"*",element:i.jsx(hr,{to:"/dashboard",replace:!0})})]}),i.jsx(Oi,{}),i.jsx(Zo,{}),i.jsx(li,{})]})})})})})})})})}mr.createRoot(document.getElementById("root")).render(i.jsx(En.StrictMode,{children:i.jsx(qu,{})}));export{$i as $,Ki as A,fd as B,dd as C,ud as D,It as E,Yi as F,Qn as G,cd as H,Vi as I,ld as J,ad as K,Mr as L,Or as M,id as N,od as O,Pi as P,sd as Q,kt as R,ft as S,nd as T,rd as U,td as V,Ot as W,ed as X,Fi as Y,Ju as Z,Ui as _,Un as a,Hi as a0,Wi as a1,qi as a2,Li as a3,Ai as a4,Ti as a5,Ni as a6,zi as a7,Xn as a8,Kn as a9,H as aa,xd as ab,d as ac,oa as ad,sa as ae,wd as af,vd as ag,na as ah,bd as ai,ra as aj,Zu as ak,Qu as al,Xu as am,Ku as an,Yu as ao,Vu as ap,Gu as aq,Ji as ar,Gi as as,Bi as at,Mi as b,gi as c,tu as d,Rd as e,Fu as f,yd as g,gd as h,Cd as i,i as j,nu as k,ta as l,Zc as m,ea as n,Zi as o,jd as p,ou as q,Pd as r,S as s,Kc as t,Mt as u,md as v,pd as w,Qi as x,hd as y,Xi as z};
