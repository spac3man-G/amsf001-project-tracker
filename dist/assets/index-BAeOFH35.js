const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-sEf0y8rZ.js","assets/vendor-react-CaXNtsgv.js","assets/vendor-icons-BB9jpMgd.js","assets/vendor-supabase-qY1sfceY.js","assets/vendor-charts-_mIYJ_kN.js","assets/Milestones-qsIAkSgR.js","assets/usePermissions-SdW04b9_.js","assets/ConfirmDialog-CLo-gYP-.js","assets/MilestoneDetail-Bj3L7XMf.js","assets/Gantt-CuFHitQE.js","assets/Deliverables-DwkYCpXk.js","assets/Resources-Dw-4mDCQ.js","assets/ResourceDetail-uBUtijxq.js","assets/Partners-CRo26NPJ.js","assets/PartnerDetail-DWB6BVgz.js","assets/Timesheets-yHqb0vj8.js","assets/Expenses-DqOgCP-w.js","assets/Expenses-ByQ6LnGd.css","assets/KPIs-tgBF3KIZ.js","assets/KPIDetail-BKL8V8Mt.js","assets/QualityStandards-C7_yDa2f.js","assets/QualityStandardDetail-c5M_ub9L.js","assets/Reports-DchVAW4P.js","assets/Users-Ccy6kcLa.js","assets/Settings-DjpRWnU7.js","assets/AccountSettings-DBkaEx-p.js","assets/WorkflowSummary-CX485S_M.js","assets/AuditLog-DUgxe7fu.js","assets/DeletedItems-C8sA7eGa.js"])))=>i.map(i=>d[i]);
var Ks=Object.defineProperty;var Xs=(r,e,t)=>e in r?Ks(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Kt=(r,e,t)=>Xs(r,typeof e!="symbol"?e+"":e,t);import{r as f,a as Rt,R as Cn,u as Er,b as Qs,L as Le,c as Js,d as Zs,g as eo,B as to,e as ro,f as Z,N as dr,O as no}from"./vendor-react-CaXNtsgv.js";import{c as so}from"./vendor-supabase-qY1sfceY.js";import{A as En,R as fr,L as Dn,I as oo,X as io,C as ao,a as Ze,M as lo,S as co,B as Xt,T as uo,U as fo,b as ho,c as Qt,d as po,e as Mn,f as vt,F as On,g as kn,h as at,i as mo,H as go,j as In,k as yo,l as bo,m as vo,n as yt,P as hr,o as xo,G as wo,p as _o,q as So,r as jo,s as Po,t as zn,u as Ro,K as Co,v as Jt,w as Zt,E as Eo,x as Do,y as Mo,z as en,D as Oo,J as ko,N as Io}from"./vendor-icons-BB9jpMgd.js";import{p as qe,c as Ct}from"./vendor-charts-_mIYJ_kN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var Nn={exports:{}},Et={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zo=f,No=Symbol.for("react.element"),To=Symbol.for("react.fragment"),Ao=Object.prototype.hasOwnProperty,Lo=zo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qo={key:!0,ref:!0,__self:!0,__source:!0};function Tn(r,e,t){var n,s={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Ao.call(e,n)&&!qo.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:No,type:r,key:o,ref:a,props:s,_owner:Lo.current}}Et.Fragment=To;Et.jsx=Tn;Et.jsxs=Tn;Nn.exports=Et;var i=Nn.exports,pr={},tn=Rt;pr.createRoot=tn.createRoot,pr.hydrateRoot=tn.hydrateRoot;const Wo="modulepreload",$o=function(r){return"/"+r},rn={},oe=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=Promise.allSettled(t.map(c=>{if(c=$o(c),c in rn)return;rn[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Wo,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((y,j)=>{m.addEventListener("load",y),m.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};var nn={},Bo="@vercel/analytics",Ho="1.6.0",Uo=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function An(){return typeof window<"u"}function Ln(){try{const r="production"}catch{}return"production"}function Fo(r="auto"){if(r==="auto"){window.vam=Ln();return}window.vam=r}function Go(){return(An()?window.vam:Ln())||"production"}function mr(){return Go()==="development"}function Vo(r){return r.scriptSrc?r.scriptSrc:mr()?"https://va.vercel-scripts.com/v1/script.debug.js":r.basePath?`${r.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Yo(r={debug:!0}){var e;if(!An())return;Fo(r.mode),Uo(),r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend));const t=Vo(r);if(document.head.querySelector(`script[src*="${t}"]`))return;const n=document.createElement("script");n.src=t,n.defer=!0,n.dataset.sdkn=Bo+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=Ho,r.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/insights`),r.dsn&&(n.dataset.dsn=r.dsn),n.onerror=()=>{const s=mr()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information."},mr()&&r.debug===!1&&(n.dataset.debug="false"),document.head.appendChild(n)}function Ko({route:r,path:e}){var t;(t=window.va)==null||t.call(window,"pageview",{route:r,path:e})}function Xo(){if(!(typeof process>"u"||typeof nn>"u"))return nn.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Qo(r){return f.useEffect(()=>{var e;r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]),f.useEffect(()=>{Yo({framework:r.framework||"react",basePath:r.basePath??Xo(),...r.route!==void 0&&{disableAutoTrack:!0},...r})},[]),f.useEffect(()=>{r.route&&r.path&&Ko({route:r.route,path:r.path})},[r.route,r.path]),null}var sn={},Jo="@vercel/speed-insights",Zo="1.2.0",ei=()=>{window.si||(window.si=function(...e){(window.siq=window.siq||[]).push(e)})};function ti(){return typeof window<"u"}function ri(){try{const r="production"}catch{}return"production"}function qn(){return ri()==="development"}function ni(r){return r.scriptSrc?r.scriptSrc:qn()?"https://va.vercel-scripts.com/v1/speed-insights/script.debug.js":r.dsn?"https://va.vercel-scripts.com/v1/speed-insights/script.js":r.basePath?`${r.basePath}/speed-insights/script.js`:"/_vercel/speed-insights/script.js"}function si(r={}){var e;if(!ti()||r.route===null)return null;ei();const t=ni(r);if(document.head.querySelector(`script[src*="${t}"]`))return null;r.beforeSend&&((e=window.si)==null||e.call(window,"beforeSend",r.beforeSend));const n=document.createElement("script");return n.src=t,n.defer=!0,n.dataset.sdkn=Jo+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=Zo,r.sampleRate&&(n.dataset.sampleRate=r.sampleRate.toString()),r.route&&(n.dataset.route=r.route),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/speed-insights/vitals`),r.dsn&&(n.dataset.dsn=r.dsn),qn()&&r.debug===!1&&(n.dataset.debug="false"),n.onerror=()=>{},document.head.appendChild(n),{setRoute:s=>{n.dataset.route=s??void 0}}}function oi(){if(!(typeof process>"u"||typeof sn>"u"))return sn.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function ii(r){f.useEffect(()=>{var t;r.beforeSend&&((t=window.si)==null||t.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]);const e=f.useRef(null);return f.useEffect(()=>{if(e.current)r.route&&e.current(r.route);else{const t=si({framework:r.framework??"react",basePath:r.basePath??oi(),...r});t&&(e.current=t.setRoute)}},[r.route]),null}const ai=void 0,li=void 0;throw new Error("Missing Supabase environment variables");const w=so(ai,li),Wn=f.createContext(null),ci=60*1e3,ui=5*60*1e3;function di({children:r}){const[e,t]=f.useState(null),[n,s]=f.useState(null),[o,a]=f.useState(null),[l,c]=f.useState(!0),[u,h]=f.useState(null),[m,y]=f.useState(!1),j=f.useRef(null),M=f.useRef(Date.now()),_=f.useCallback(()=>{M.current=Date.now()},[]);async function C(b){if(!b){s(null),a(null);return}try{const{data:R,error:I}=await w.from("profiles").select("*").eq("id",b.id).single();if(I){h(I);return}s(R);const{data:Y}=await w.from("resources").select("*").eq("user_id",b.id).maybeSingle();a(Y),h(null)}catch(R){h(R)}}const S=f.useCallback(async()=>{try{const{data:{session:b},error:R}=await w.auth.getSession();if(R)return;if(!b){await D();return}const I=b.expires_at*1e3,Y=Date.now(),k=I-Y;if(k<=0)await D();else if(k<=ui){y(!0);const{data:q,error:K}=await w.auth.refreshSession();K||!q.session||y(!1)}else y(!1)}catch{}},[]);async function D(){t(null),s(null),a(null),y(!1),await w.auth.signOut();const b=window.location.pathname;b!=="/login"&&b!=="/register"&&(window.location.href="/login?expired=true")}const x=f.useCallback(()=>{j.current&&clearInterval(j.current),j.current=setInterval(()=>{S()},ci);const b=()=>{document.visibilityState==="visible"&&S()};document.addEventListener("visibilitychange",b);const R=["mousedown","keydown","touchstart","scroll"];return R.forEach(I=>{document.addEventListener(I,_,{passive:!0})}),()=>{j.current&&clearInterval(j.current),document.removeEventListener("visibilitychange",b),R.forEach(I=>{document.removeEventListener(I,_)})}},[S,_]);f.useEffect(()=>{let b=!0,R=null;async function I(){try{const{data:{session:k},error:q}=await w.auth.getSession();q&&b&&h(q),b&&(t(k?.user??null),c(!1),k?.user&&(C(k.user),R=x()))}catch(k){b&&(h(k),c(!1))}}I();const{data:{subscription:Y}}=w.auth.onAuthStateChange(async(k,q)=>{b&&(t(q?.user??null),c(!1),q?.user?(C(q.user),R&&R(),R=x()):(s(null),a(null),R&&(R(),R=null)),(k==="SIGNED_OUT"||k==="TOKEN_REFRESHED")&&y(!1))});return()=>{b=!1,Y.unsubscribe(),R&&R()}},[x]);async function g(){try{await w.auth.signOut(),t(null),s(null),a(null),y(!1)}catch(b){h(b)}}async function p(){e&&await C(e)}async function v(){try{const{data:b,error:R}=await w.auth.refreshSession();return R?!1:b.session?(y(!1),!0):!1}catch{return!1}}const P={user:e,profile:n,role:n?.role||"viewer",linkedResource:o,isLoading:l,error:u,signOut:g,refreshUserData:p,refreshSession:v,isAuthenticated:!!e,sessionExpiring:m};return i.jsx(Wn.Provider,{value:P,children:r})}function Dt(){const r=f.useContext(Wn);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r}const $n=f.createContext(null);function fi({children:r}){const[e,t]=f.useState(null),[n,s]=f.useState(!0),[o,a]=f.useState(null);f.useEffect(()=>{let h=!0;async function m(){try{const{data:y,error:j}=await w.from("projects").select("*").eq("reference","AMSF001").single();j?h&&a(j):h&&(t(y),a(null))}catch(y){h&&a(y)}finally{h&&s(!1)}}return m(),()=>{h=!1}},[]);async function l(h){s(!0),a(null);try{const{data:m,error:y}=await w.from("projects").select("*").eq("reference",h).single();y?a(y):t(m)}catch(m){a(m)}finally{s(!1)}}async function c(){if(e)try{const{data:h,error:m}=await w.from("projects").select("*").eq("id",e.id).single();m?a(m):t(h)}catch(h){a(h)}}const u={currentProject:e,projectId:e?.id||null,projectRef:e?.reference||null,projectName:e?.name||null,isLoading:n,error:o,switchProject:l,refreshProject:c};return i.jsx($n.Provider,{value:u,children:r})}function Bn(){const r=f.useContext($n);if(!r)throw new Error("useProject must be used within a ProjectProvider");return r}const Hn=f.createContext();function hi({children:r}){const[e,t]=f.useState(!1),[n,s]=f.useState(null),[o,a]=f.useState([]);f.useEffect(()=>{l(),c()},[]);async function l(){const{data:{user:_}}=await w.auth.getUser();if(_){const{data:C}=await w.from("profiles").select("role").eq("id",_.id).single();C&&s(C.role)}}async function c(){const{data:_}=await w.from("profiles").select("id").eq("is_test_user",!0);_&&a(_.map(C=>C.id))}const u=n==="admin"||n==="supplier_pm";function h(){u&&t(_=>!_)}function m(_){return o.includes(_)}function y(_,C="user_id"){return!_||e?_:_.filter(S=>!o.includes(S[C]))}function j(_){return!_||e?_:_.filter(C=>!C.is_test_content)}const M={showTestUsers:e,setShowTestUsers:t,toggleTestUsers:h,canToggleTestUsers:u,testUserIds:o,isTestUser:m,filterTestContent:y,filterByTestFlag:j,userRole:n};return i.jsx(Hn.Provider,{value:M,children:r})}function pi(){const r=f.useContext(Hn);if(!r)throw new Error("useTestUsers must be used within a TestUserProvider");return r}const Un=f.createContext();function mi(){return f.useContext(Un)}function gi({children:r}){const[e,t]=f.useState([]),[n,s]=f.useState(0),[o,a]=f.useState(0),[l,c]=f.useState(!0),[u,h]=f.useState(null),[m,y]=f.useState(null),j=p=>["admin","supplier_pm","customer_pm"].includes(p),M=f.useCallback(async(p,v)=>{try{let P=[];if(j(v)){const{data:b}=await w.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:R}=await w.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:I}=await w.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:Y}=await w.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");b&&b.forEach(k=>{P.push({id:`ts-${k.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${k.hours_worked||k.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),R&&R.forEach(k=>{const q=k.chargeable_to_customer!==!1;P.push({id:`exp-${k.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${k.resource_name||"Unknown"} expense (£${parseFloat(k.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:q})}),I&&I.forEach(k=>{P.push({id:`del-${k.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${k.deliverable_ref}: ${k.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),Y&&Y.forEach(k=>{P.push({id:`cert-${k.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:b}=await w.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",p),{data:R}=await w.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",p);b&&b.forEach(I=>{P.push({id:`ts-${I.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${I.hours_worked||I.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),R&&R.forEach(I=>{P.push({id:`exp-${I.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (£${parseFloat(I.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:P.length,items:P}}catch{return{count:0,items:[]}}},[]),_=f.useCallback(async()=>{try{const{data:{user:p}}=await w.auth.getUser();if(!p){t([]),s(0),a(0),c(!1);return}h(p.id);const{data:v}=await w.from("profiles").select("role").eq("id",p.id).single(),P=v?.role||"viewer";y(P);const{count:b,items:R}=await M(p.id,P);t(R),s(b),a(b)}catch{}finally{c(!1)}},[M]),C=f.useCallback(async p=>{t(v=>v.map(P=>P.id===p?{...P,is_read:!0}:P)),s(v=>Math.max(0,v-1))},[]),S=f.useCallback(async p=>{t(v=>v.map(P=>P.id===p?{...P,is_actioned:!0,is_read:!0}:P)),s(v=>Math.max(0,v-1)),a(v=>Math.max(0,v-1))},[]),D=f.useCallback(async()=>{t(p=>p.map(v=>({...v,is_read:!0}))),s(0)},[]),x=f.useCallback(async p=>{const v=e.find(P=>P.id===p);v&&(t(P=>P.filter(b=>b.id!==p)),v.is_read||s(P=>Math.max(0,P-1)),v.notification_type==="action"&&!v.is_actioned&&a(P=>Math.max(0,P-1)))},[e]);f.useEffect(()=>{_();const p=setInterval(()=>{_()},3e4);return()=>clearInterval(p)},[_]),f.useEffect(()=>{const{data:{subscription:p}}=w.auth.onAuthStateChange((v,P)=>{v==="SIGNED_IN"?_():v==="SIGNED_OUT"&&(t([]),s(0),a(0),h(null),y(null))});return()=>p.unsubscribe()},[_]);const g={notifications:e,unreadCount:n,actionCount:o,loading:l,fetchNotifications:_,markAsRead:C,markAsActioned:S,markAllAsRead:D,dismissNotification:x};return i.jsx(Un.Provider,{value:g,children:r})}const Fn=f.createContext(null);function yi({children:r}){const{user:e,profile:t,linkedResource:n,role:s}=Dt(),{projectId:o,projectName:a,projectRef:l,currentProject:c}=Bn(),[u,h]=f.useState(!1),[m,y]=f.useState([]),[j,M]=f.useState(!1),[_,C]=f.useState(null),S=f.useCallback(()=>c?{reference:l||c?.reference,name:a||c?.name,description:c?.description||null}:null,[c,l,a]),D=f.useCallback(()=>({name:t?.full_name||e?.email?.split("@")[0]||"User",email:e?.email,role:s||t?.role||"unknown",linkedResourceName:n?.name||null,linkedResourceId:n?.id||null}),[e,t,n,s]),x=f.useCallback(async()=>{if(!o)return null;const b=[];try{const{data:R}=await w.from("projects").select("name, code, total_budget, start_date, end_date").eq("id",o).single();R&&b.push(`Project: ${R.name} (${R.code})
Budget: £${R.total_budget?.toLocaleString()||0}
Timeline: ${R.start_date} to ${R.end_date}`);const{data:I}=await w.from("milestones").select("id, name, status, progress_percent, planned_end_date").eq("project_id",o).order("planned_end_date",{ascending:!0});if(I?.length>0){const k=I.filter(W=>W.status==="Completed").length,q=I.filter(W=>W.status==="In Progress").length,K=Math.round(I.reduce((W,pe)=>W+(pe.progress_percent||0),0)/I.length);b.push(`Milestones: ${I.length} total (${k} completed, ${q} in progress)
Average Progress: ${K}%`);const ee=new Date().toISOString().split("T")[0],O=I.filter(W=>W.planned_end_date<ee&&W.status!=="Completed");O.length>0&&b.push(`Overdue Milestones: ${O.map(W=>W.name).join(", ")}`)}const{data:Y}=await w.from("deliverables").select("id, status").eq("project_id",o);if(Y?.length>0){const k={};Y.forEach(q=>{k[q.status]=(k[q.status]||0)+1}),b.push(`Deliverables: ${Y.length} total
Status breakdown: ${Object.entries(k).map(([q,K])=>`${q}: ${K}`).join(", ")}`)}if(s==="admin"||s==="supplier_pm"){const{data:k}=await w.from("timesheets").select("hours_worked, status").eq("project_id",o);if(k?.length>0){const q=k.reduce((ee,O)=>ee+(O.hours_worked||0),0),K=k.filter(ee=>ee.status==="Submitted").length;b.push(`Timesheets: ${q.toFixed(1)} total hours logged
Pending approval: ${K} entries`)}}else if(n?.id){const{data:k}=await w.from("timesheets").select("hours_worked, status").eq("resource_id",n.id);if(k?.length>0){const q=k.reduce((K,ee)=>K+(ee.hours_worked||0),0);b.push(`Your Timesheets: ${q.toFixed(1)} hours logged`)}}if(s==="admin"||s==="supplier_pm"){const{data:k}=await w.from("expenses").select("amount, status, is_chargeable").eq("project_id",o);if(k?.length>0){const q=k.reduce((ee,O)=>ee+(O.amount||0),0),K=k.filter(ee=>ee.status==="Submitted").length;b.push(`Expenses: £${q.toLocaleString()} total claimed
Pending validation: ${K} entries`)}}if(s==="admin"||s==="supplier_pm"||s==="customer_pm"){const{data:k}=await w.from("resources").select("id, name, days_allocated, days_used").eq("project_id",o);if(k?.length>0){const q=k.reduce((K,ee)=>K+(ee.days_allocated||0),0);b.push(`Resources: ${k.length} team members
Total days allocated: ${q}`)}}return b.join(`

`)}catch{return null}},[o,s,n]),g=f.useCallback(async b=>{if(!b.trim()||j)return;const R={role:"user",content:b.trim()};y(I=>[...I,R]),M(!0),C(null);try{const I=S(),Y=D(),k=await x(),q=[...m.slice(-9),R].map(O=>({role:O.role,content:O.content})),K=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:q,projectContext:I,userContext:Y,dataContext:k})});if(!K.ok)throw new Error("Failed to get response");const ee=await K.json();y(O=>[...O,{role:"assistant",content:ee.message}])}catch{C("Failed to send message. Please try again."),y(Y=>Y.slice(0,-1))}finally{M(!1)}},[m,j,S,D,x]),p=f.useCallback(()=>{y([]),C(null)},[]),v=f.useCallback(()=>{h(b=>!b)},[]),P={isOpen:u,setIsOpen:h,toggleChat:v,messages:m,isLoading:j,error:_,sendMessage:g,clearChat:p};return i.jsx(Fn.Provider,{value:P,children:r})}function bi(){const r=f.useContext(Fn);if(!r)throw new Error("useChat must be used within a ChatProvider");return r}class vi extends Cn.Component{constructor(t){super(t);Kt(this,"handleReload",()=>{window.location.reload()});Kt(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){this.setState({errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[i.jsx(En,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),i.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),i.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),i.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[i.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),i.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[i.jsx(fr,{size:16}),"Reload Page"]})]})]}):this.props.children}}function Dr({message:r,size:e="medium",fullPage:t=!1}){const n={small:{icon:16,text:"0.75rem",padding:"0.5rem"},medium:{icon:24,text:"0.875rem",padding:"1.5rem"},large:{icon:40,text:"1rem",padding:"3rem"}},s=n[e]||n.medium,o={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:s.padding,...t&&{minHeight:"60vh"}},a={animation:"spin 1s linear infinite",color:"#3b82f6"},l={marginTop:"0.75rem",color:"#64748b",fontSize:s.text};return i.jsxs("div",{style:o,children:[i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}),i.jsx(Dn,{size:s.icon,style:a}),r&&i.jsx("p",{style:l,children:r})]})}const xi={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function Pe({width:r="100%",height:e="1rem",style:t={},className:n=""}){return i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),i.jsx("div",{className:n,style:{width:r,height:e,borderRadius:"4px",...xi,...t}})]})}function gr({width:r="100%",lines:e=1}){return i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:e}).map((t,n)=>i.jsx(Pe,{width:n===e-1&&e>1?"70%":r,height:"1rem"},n))})}function wi(){return i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx(Pe,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Pe,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),i.jsx(Pe,{width:"40%",height:"1.5rem"})]})]})}function _i({columns:r=6}){return i.jsx("tr",{children:Array.from({length:r}).map((e,t)=>i.jsx("td",{style:{padding:"0.75rem 1rem"},children:i.jsx(Pe,{width:t===0?"80%":t===r-1?"60px":"70%",height:"1rem"})},t))})}function er({hasHeader:r=!0}){return i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[r&&i.jsx(Pe,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),i.jsx(gr,{lines:3})]})}function st({type:r="text",count:e=1,...t}){return(()=>{switch(r){case"text":return i.jsx(gr,{...t});case"stat-card":case"stats":return i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:e}).map((s,o)=>i.jsx(wi,{},o))});case"table":return i.jsx("div",{className:"card",children:i.jsxs("table",{children:[i.jsx("thead",{children:i.jsx("tr",{children:Array.from({length:t.columns||6}).map((s,o)=>i.jsx("th",{style:{padding:"0.75rem 1rem"},children:i.jsx(Pe,{width:"60%",height:"0.875rem"})},o))})}),i.jsx("tbody",{children:Array.from({length:t.rows||5}).map((s,o)=>i.jsx(_i,{columns:t.columns||6},o))})]})});case"card":return i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:e}).map((s,o)=>i.jsx(er,{...t},o))});case"page":return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx(Pe,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),i.jsx(Pe,{width:"300px",height:"1rem"})]}),i.jsx(Pe,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),i.jsx(st,{type:"stats",count:4}),i.jsx(st,{type:"table",rows:8,columns:6})]});case"detail":return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx(Pe,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),i.jsx(Pe,{width:"250px",height:"1.75rem"})]}),i.jsx(st,{type:"stats",count:4}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[i.jsx(er,{}),i.jsx(er,{})]}),i.jsx(st,{type:"table",rows:5,columns:5})]});default:return i.jsx(gr,{...t})}})()}function ft({icon:r,label:e,value:t,subtext:n,color:s="#3b82f6",borderColor:o,backgroundColor:a,style:l={},onClick:c}){const u={...o&&{borderLeft:`4px solid ${o}`},...a&&{backgroundColor:a},...c&&{cursor:"pointer"},...l};return i.jsxs("div",{className:"stat-card",style:u,onClick:c,role:c?"button":void 0,tabIndex:c?0:void 0,children:[i.jsxs("div",{className:"stat-label",children:[r&&i.jsx(r,{size:20,style:{color:s}}),e]}),i.jsx("div",{className:"stat-value",style:{color:s},children:t}),n&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:n})]})}function Si({icon:r,title:e,subtitle:t,children:n,style:s={}}){return i.jsxs("div",{className:"page-header",style:s,children:[i.jsxs("div",{className:"page-title",children:[r&&i.jsx(r,{size:28}),i.jsxs("div",{children:[i.jsx("h1",{children:e}),t&&i.jsx("p",{children:t})]})]}),n&&i.jsx("div",{className:"page-actions",children:n})]})}const on={success:{icon:ao,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:io,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:En,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:oo,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function ji({id:r,message:e,type:t="info",duration:n=4e3,onClose:s}){const o=on[t]||on.info,a=o.icon;return f.useEffect(()=>{if(n>0){const l=setTimeout(()=>{s(r)},n);return()=>clearTimeout(l)}},[r,n,s]),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:o.bgColor,border:`1px solid ${o.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[i.jsx(a,{size:20,style:{color:o.iconColor,flexShrink:0}}),i.jsx("span",{style:{color:o.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:e}),i.jsx("button",{onClick:()=>s(r),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:o.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:l=>l.target.style.opacity=1,onMouseLeave:l=>l.target.style.opacity=.7,children:i.jsx(Ze,{size:16})})]})}function Pi({toasts:r,removeToast:e}){return r.length===0?null:i.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),r.map(t=>i.jsx(ji,{id:t.id,message:t.message,type:t.type,duration:t.duration,onClose:e},t.id))]})}const Gn=f.createContext(null),Ri=4e3;function Ci({children:r}){const[e,t]=f.useState([]),n=f.useCallback(h=>{t(m=>m.filter(y=>y.id!==h))},[]),s=f.useCallback((h,m="info",y=Ri)=>{const j=Date.now()+Math.random(),M={id:j,message:h,type:m,duration:y};return t(_=>[..._,M]),j},[]),o=f.useCallback((h,m)=>s(h,"success",m),[s]),a=f.useCallback((h,m)=>s(h,"error",m||6e3),[s]),l=f.useCallback((h,m)=>s(h,"warning",m),[s]),c=f.useCallback((h,m)=>s(h,"info",m),[s]),u={showToast:s,showSuccess:o,showError:a,showWarning:l,showInfo:c,removeToast:n};return i.jsxs(Gn.Provider,{value:u,children:[r,i.jsx(Pi,{toasts:e,removeToast:n})]})}function Ei(){const r=f.useContext(Gn);if(!r)throw new Error("useToast must be used within a ToastProvider");return r}function Di(){const{isOpen:r,toggleChat:e,messages:t,isLoading:n,error:s,sendMessage:o,clearChat:a}=bi(),[l,c]=f.useState(""),u=f.useRef(null),h=f.useRef(null);f.useEffect(()=>{u.current?.scrollIntoView({behavior:"smooth"})},[t]),f.useEffect(()=>{r&&setTimeout(()=>h.current?.focus(),100)},[r]);const m=_=>{_.preventDefault(),l.trim()&&!n&&(o(l),c(""))},y=_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),m(_))},j={role:"assistant",content:`Hello! I'm your AMSF001 Project Assistant. I can help you with:

• **Using the app** - How to navigate, submit timesheets, review deliverables, etc.
• **Your project data** - Ask about milestones, budgets, team utilization, and more
• **Your permissions** - What actions you can perform in your role

How can I help you today?`},M=t.length===0?[j]:t;return i.jsxs(i.Fragment,{children:[i.jsx("button",{className:`chat-toggle-btn ${r?"chat-open":""}`,onClick:e,"aria-label":r?"Close chat":"Open AI assistant",children:r?i.jsx(Ze,{size:24}):i.jsxs(i.Fragment,{children:[i.jsx(lo,{size:24}),i.jsx(co,{className:"chat-sparkle",size:12})]})}),i.jsxs("div",{className:`chat-panel ${r?"chat-panel-open":""}`,children:[i.jsxs("div",{className:"chat-header",children:[i.jsxs("div",{className:"chat-header-title",children:[i.jsx(Xt,{size:20}),i.jsx("span",{children:"Project Assistant"})]}),i.jsxs("div",{className:"chat-header-actions",children:[t.length>0&&i.jsx("button",{className:"chat-clear-btn",onClick:a,title:"Clear chat",children:i.jsx(uo,{size:16})}),i.jsx("button",{className:"chat-close-btn",onClick:e,"aria-label":"Close chat",children:i.jsx(Ze,{size:20})})]})]}),i.jsxs("div",{className:"chat-messages",children:[M.map((_,C)=>i.jsxs("div",{className:`chat-message ${_.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[i.jsx("div",{className:"chat-message-avatar",children:_.role==="user"?i.jsx(fo,{size:16}):i.jsx(Xt,{size:16})}),i.jsx("div",{className:"chat-message-content",children:i.jsx(Mi,{content:_.content})})]},C)),n&&i.jsxs("div",{className:"chat-message chat-message-assistant",children:[i.jsx("div",{className:"chat-message-avatar",children:i.jsx(Xt,{size:16})}),i.jsxs("div",{className:"chat-message-content chat-typing",children:[i.jsx(Dn,{className:"chat-typing-icon",size:16}),i.jsx("span",{children:"Thinking..."})]})]}),s&&i.jsx("div",{className:"chat-error",children:s}),i.jsx("div",{ref:u})]}),i.jsxs("form",{className:"chat-input-form",onSubmit:m,children:[i.jsx("textarea",{ref:h,className:"chat-input",value:l,onChange:_=>c(_.target.value),onKeyDown:y,placeholder:"Ask me anything about the project...",rows:1,disabled:n}),i.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!l.trim()||n,"aria-label":"Send message",children:i.jsx(ho,{size:18})})]}),i.jsx("div",{className:"chat-footer",children:"Powered by Claude AI"})]})]})}function Mi({content:r}){const e=r.split(`
`);return i.jsx("div",{className:"chat-message-text",children:e.map((t,n)=>{if(t.startsWith("• ")||t.startsWith("- ")){const s=t.substring(2);return i.jsxs("div",{className:"chat-bullet",children:[i.jsx("span",{className:"chat-bullet-dot",children:"•"}),i.jsx("span",{dangerouslySetInnerHTML:{__html:an(s)}})]},n)}return t.trim()===""?i.jsx("div",{className:"chat-line-break"},n):i.jsx("p",{dangerouslySetInnerHTML:{__html:an(t)}},n)})})}function an(r){return r.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function Oi(){const[r,e]=f.useState(!1),t=f.useRef(null),n=Er(),{notifications:s,unreadCount:o,actionCount:a,loading:l,markAsRead:c,markAsActioned:u,markAllAsRead:h,dismissNotification:m}=mi();f.useEffect(()=>{function g(p){t.current&&!t.current.contains(p.target)&&e(!1)}return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const y=g=>{switch(g){case"timesheet":return i.jsx(at,{size:16});case"expense":return i.jsx(kn,{size:16});case"deliverable":return i.jsx(On,{size:16});case"certificate":return i.jsx(vt,{size:16});default:return i.jsx(Qt,{size:16})}},j=g=>g.notification_type==="action"?g.is_actioned?"#10b981":"#f59e0b":"#3b82f6",M=async g=>{g.is_read||await c(g.id),g.action_url&&(n(g.action_url),e(!1))},_=async(g,p)=>{g.stopPropagation(),await u(p.id),p.action_url&&(n(p.action_url),e(!1))},C=async(g,p)=>{g.stopPropagation(),await m(p.id)},S=g=>{const p=new Date(g),P=new Date-p,b=Math.floor(P/6e4),R=Math.floor(P/36e5),I=Math.floor(P/864e5);return b<1?"Just now":b<60?`${b}m ago`:R<24?`${R}h ago`:I<7?`${I}d ago`:p.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},D=s.slice(0,10),x=s.filter(g=>g.notification_type==="action"&&!g.is_actioned);return i.jsxs("div",{className:"notification-bell-container",ref:t,style:{position:"relative"},children:[i.jsxs("button",{onClick:()=>e(!r),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:r?"#f1f5f9":"transparent"},onMouseEnter:g=>g.target.style.backgroundColor="#f1f5f9",onMouseLeave:g=>g.target.style.backgroundColor=r?"#f1f5f9":"transparent",title:`${a} actions pending`,children:[i.jsx(Qt,{size:22,color:"#64748b"}),(o>0||a>0)&&i.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:a>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:a>0?a:o})]}),r&&i.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),a>0&&i.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[a," action",a!==1?"s":""," required"]})]}),o>0&&i.jsx("button",{onClick:h,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),x.length>0&&i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),i.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),i.jsxs("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",i.jsx(po,{size:16})]})]}),i.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:l?i.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):D.length===0?i.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[i.jsx(Qt,{size:32,style:{marginBottom:"8px",opacity:.5}}),i.jsx("p",{style:{margin:0},children:"No notifications"})]}):D.map(g=>i.jsx("div",{onClick:()=>M(g),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:g.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:p=>p.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:p=>p.currentTarget.style.backgroundColor=g.is_read?"white":"#f8fafc",children:i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:g.notification_type==="action"&&!g.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:j(g),flexShrink:0},children:y(g.category)}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[i.jsx("span",{style:{fontWeight:g.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:g.title}),i.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:S(g.created_at)})]}),i.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:g.message}),i.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[g.notification_type==="action"&&!g.is_actioned&&g.action_label&&i.jsx("button",{onClick:p=>_(p,g),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:g.action_label}),g.notification_type==="info"&&i.jsxs("button",{onClick:p=>C(p,g),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ze,{size:12}),"Dismiss"]}),g.is_actioned&&i.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Mn,{size:12}),"Completed"]})]})]})]})},g.id))}),s.length>10&&i.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:i.jsx("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),i.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const d={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"};function U(r,e){return e.includes(r)}function Hu(r){return U(r,[d.ADMIN,d.SUPPLIER_PM])}function Vn(r){return U(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function Yn(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function ki(r){return U(r,[d.CUSTOMER_PM,d.ADMIN])}function Uu(r,e,t,n){if(U(r,[d.ADMIN,d.SUPPLIER_PM]))return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),o===a&&(s==="Draft"||s==="Rejected")}function Fu(r,e,t,n){if(r===d.ADMIN||r===d.SUPPLIER_PM)return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),o===a&&s==="Draft"}function Gu(r,e,t,n){let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by||e.resource?.user_id,a=t):(s=e,o=t,a=n),s!=="Draft"&&s!=="Rejected"?!1:U(r,[d.ADMIN,d.SUPPLIER_PM])?!0:o===a&&Vn(r)}function Ii(r){return U(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function zi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Vu(r,e,t){let n,s;return typeof e=="object"&&e!==null?(n=e.status,s=e.chargeable||e.chargeable_to_customer):(n=e,s=t),n!=="Submitted"?!1:r===d.ADMIN?!0:s?r===d.CUSTOMER_PM:r===d.SUPPLIER_PM}function Ni(r){return U(r,[d.CUSTOMER_PM,d.ADMIN])}function Ti(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Yu(r,e,t,n){if(U(r,[d.ADMIN,d.SUPPLIER_PM]))return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by,a=t):(s=e,o=t,a=n),o===a&&(s==="Draft"||s==="Rejected")}function Ku(r,e,t,n){if(r===d.ADMIN||r===d.SUPPLIER_PM)return!0;let s,o,a;return typeof e=="object"&&e!==null?(s=e.status,o=e.created_by,a=t):(s=e,o=t,a=n),o===a&&s==="Draft"}function Ai(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Li(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function qi(r){return r===d.ADMIN}function Wi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function $i(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Bi(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Xu(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Qu(r,e,t){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])?!0:r===d.CONTRIBUTOR?e?.assigned_to===t||e?.resource?.user_id===t:!1}function Hi(r){return U(r,[d.CUSTOMER_PM,d.ADMIN])}function Ju(r){return U(r,[d.CONTRIBUTOR,d.SUPPLIER_PM,d.ADMIN])}function Mt(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Zu(r){return Mt(r)}function ed(r){return Mt(r)}function td(r){return Mt(r)}function Ot(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function rd(r){return Ot(r)}function nd(r){return Ot(r)}function sd(r){return Ot(r)}function Mr(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function od(r){return Mr(r)}function id(r){return Mr(r)}function Ui(r){return r===d.ADMIN}function Fi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function ad(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Kn(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Gi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function kt(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function ld(r){return kt(r)}function cd(r){return kt(r)}function ud(r){return kt(r)}function Vi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Yi(r){return U(r,[d.CUSTOMER_PM,d.ADMIN])}function dd(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Ki(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function fd(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Xi(r){return r===d.ADMIN}function hd(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function Qi(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Ji(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function Zi(r){return U(r,[d.SUPPLIER_PM,d.ADMIN])}function pd(r){return Kn(r)}function md(r){return U(r,[d.CUSTOMER_PM,d.SUPPLIER_PM,d.ADMIN])}function ea(r,e,t){return!e||!Array.isArray(e)?[]:Yn(r)?e:e.filter(n=>n.user_id===t)}function gd(r,e){return!r||!Array.isArray(r)?null:r.find(t=>t.user_id===e)||null}function ta(r,e,t){const n=ea(r,e,t);return n.length===0?null:n.find(o=>o.user_id===t)||n[0]}function yd(r,e,t){return ta(r,e,t)?.id||null}function ra(r){const e={admin:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},supplier_pm:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},customer_pm:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},contributor:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},viewer:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}};return e[r]||e.viewer}function na(r){return ra(r).label}const bd=[{value:"viewer",label:"Viewer",color:"#64748b",bg:"#f1f5f9"},{value:"contributor",label:"Contributor",color:"#2563eb",bg:"#dbeafe"},{value:"customer_pm",label:"Customer PM",color:"#d97706",bg:"#fef3c7"},{value:"supplier_pm",label:"Supplier PM",color:"#059669",bg:"#d1fae5"},{value:"admin",label:"Admin",color:"#7c3aed",bg:"#f3e8ff"}];function vd(r){return{role:r,roleLabel:na(r),timesheets:{canAdd:Vn(r),canAddForOthers:Yn(r),canApprove:ki(r)},expenses:{canAdd:Ii(r),canAddForOthers:zi(r),canValidateChargeable:Ni(r),canValidateNonChargeable:Ti(r)},milestones:{canCreate:Ai(r),canEdit:Li(r),canDelete:qi(r),canUseGantt:Wi(r)},deliverables:{canCreate:$i(r),canEdit:Bi(r),canReview:Hi(r)},kpis:{canManage:Mt(r)},qualityStandards:{canManage:Ot(r)},resources:{canManage:Mr(r),canDelete:Ui(r),canSeeCostPrice:Fi(r),canSeeMargins:Kn(r)},partners:{canView:Gi(r),canManage:kt(r)},certificates:{canSignAsSupplier:Vi(r),canSignAsCustomer:Yi(r)},admin:{canAccessSettings:Ki(r),canManageUsers:Xi(r),canViewWorkflowSummary:Qi(r)},invoicing:{canGenerateCustomerInvoice:Ji(r),canGenerateThirdPartyInvoice:Zi(r)}}}const It={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:So,label:"Workflow Summary",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:_o,label:"Dashboard",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER]},reports:{id:"reports",path:"/reports",icon:On,label:"Reports",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:wo,label:"Gantt Chart",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:xo,label:"Milestones",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:hr,label:"Deliverables",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR,d.VIEWER],readOnlyRoles:[d.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:yt,label:"KPIs",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:vt,label:"Quality Standards",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.VIEWER],readOnlyRoles:[d.VIEWER,d.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:vo,label:"Resources",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:at,label:"Timesheets",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:kn,label:"Expenses",allowedRoles:[d.ADMIN,d.SUPPLIER_PM,d.CUSTOMER_PM,d.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:bo,label:"Partners",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:yo,label:"Users",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[d.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:In,label:"Settings",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},auditLog:{id:"auditLog",path:"/audit-log",icon:go,label:"Audit Log",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]},deletedItems:{id:"deletedItems",path:"/deleted-items",icon:mo,label:"Deleted Items",allowedRoles:[d.ADMIN,d.SUPPLIER_PM],readOnlyRoles:[]}},xt={[d.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[d.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[d.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[d.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[d.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function sa(r){return(xt[r]||xt[d.VIEWER]).map(t=>It[t]?.path).filter(Boolean)}function Xn(r){return(xt[r]||xt[d.VIEWER]).map(t=>It[t]).filter(t=>t&&t.allowedRoles.includes(r))}function ln(r,e){const t=It[e];return t?t.readOnlyRoles?.includes(r)||!1:!0}function oa(r){return r!==d.VIEWER}function ia(r){return Object.values(It).find(e=>e.path===r)||null}function aa(r){return ia(r)?.id||null}function la(r,e){const t=Xn(r);if(!e||!Array.isArray(e)||e.length===0)return t;const n={};t.forEach(o=>{n[o.path]=o});const s=[];return e.forEach(o=>{n[o]&&(s.push(n[o]),delete n[o])}),Object.values(n).forEach(o=>{s.push(o)}),s}function ca(r,e){if(!e||e.length===0)return!0;const t=sa(r);return e.length!==t.length?!1:e.every((n,s)=>n===t[s])}const cn={[d.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[d.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[d.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[d.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[d.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function ua(r){return cn[r]||cn[d.VIEWER]}function da({children:r}){const e=Qs(),t=Er(),{showSuccess:n,showError:s}=Ei(),{user:o,profile:a,role:l,signOut:c}=Dt(),[u,h]=f.useState(!0),[m,y]=f.useState(null),[j,M]=f.useState(null),[_,C]=f.useState(null),S=f.useRef(null),D=f.useMemo(()=>ua(l),[l]),x=f.useMemo(()=>a&&(a.full_name||a.email||o?.email)||"User",[a,o]),g=f.useMemo(()=>{if(!a)return"U";if(a.full_name){const O=a.full_name.split(" ");return O.length>=2?O[0][0]+O[O.length-1][0]:a.full_name[0].toUpperCase()}return x[0].toUpperCase()},[a,x]);f.useEffect(()=>{a?.nav_order&&Array.isArray(a.nav_order)&&y(a.nav_order)},[a]);async function p(){await c(),t("/login")}const v=f.useMemo(()=>oa(l),[l]),P=f.useMemo(()=>m&&!ca(l,m),[l,m]),b=f.useMemo(()=>{const O=Xn(l);return m&&m.length>0?la(l,m):O},[l,m]),R=f.useMemo(()=>{const O=aa(e.pathname);return O?ln(l,O):!1},[l,e.pathname]);function I(O,W){v&&(S.current=O.target,M(W),setTimeout(()=>{S.current&&(S.current.style.opacity="0.5")},0))}function Y(O,W){v&&W!==j&&C(W)}function k(O){v&&O.preventDefault()}function q(){if(v){if(S.current&&(S.current.style.opacity="1"),j!==null&&_!==null&&j!==_){const O=[...b],W=O[j];O.splice(j,1),O.splice(_,0,W);const pe=O.map(me=>me.path);y(pe),K(pe)}M(null),C(null),S.current=null}}async function K(O){if(o)try{const{error:W}=await w.from("profiles").update({nav_order:O}).eq("id",o.id);W&&s("Failed to save menu order")}catch{s("Failed to save menu order")}}async function ee(){if(o)try{const{error:O}=await w.from("profiles").update({nav_order:null}).eq("id",o.id);if(O){s("Failed to reset menu order");return}y(null),n("Menu order reset to default")}catch{s("Failed to reset menu order")}}return i.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[i.jsxs("aside",{style:{width:u?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[i.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[u&&i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),i.jsx("button",{onClick:()=>h(!u),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u?i.jsx(Ze,{size:20}):i.jsx(jo,{size:20})})]}),i.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:b.map((O,W)=>{const pe=O.icon,me=e.pathname===O.path||O.path!=="/dashboard"&&e.pathname.startsWith(O.path),ke=j===W,Ie=_===W,Ne=ln(l,O.id);return i.jsx("div",{draggable:v,onDragStart:N=>I(N,W),onDragEnter:N=>Y(N,W),onDragOver:k,onDragEnd:q,style:{position:"relative",marginBottom:"0.25rem",borderTop:Ie&&j>W?"2px solid #10b981":"2px solid transparent",borderBottom:Ie&&j<W?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:i.jsxs(Le,{to:O.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:u?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:me?"#10b981":"#64748b",backgroundColor:me?"#f0fdf4":ke?"#f1f5f9":"transparent",fontWeight:me?"600":"500",justifyContent:u?"flex-start":"center",transition:"all 0.15s ease",cursor:v?"grab":"pointer"},children:[u&&v&&i.jsx(Po,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),i.jsx(pe,{size:20}),u&&i.jsx("span",{style:{flex:1},children:O.label}),u&&Ne&&i.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},O.path)})}),u&&v&&P&&i.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:i.jsxs("button",{onClick:ee,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:O=>{O.currentTarget.style.backgroundColor="#f1f5f9",O.currentTarget.style.color="#475569"},onMouseLeave:O=>{O.currentTarget.style.backgroundColor="#f8fafc",O.currentTarget.style.color="#64748b"},children:[i.jsx(zn,{size:14}),"Reset Menu Order"]})}),i.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:i.jsxs("button",{onClick:p,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:u?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[i.jsx(Ro,{size:20}),u&&i.jsx("span",{children:"Logout"})]})})]}),i.jsxs("main",{style:{flex:1,marginLeft:u?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[i.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[i.jsxs(Le,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:O=>O.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:O=>O.currentTarget.style.backgroundColor="transparent",children:[i.jsxs("div",{style:{textAlign:"right"},children:[i.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:x}),i.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:D.bg,color:D.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:D.shortLabel})]}),i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:D.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:g})]}),i.jsx(Oi,{})]}),R&&i.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),i.jsx("span",{children:"You have read-only access to this page"})]}),i.jsx("div",{style:{flex:1},children:r})]})]})}function fa(){const r=Er(),[e]=Js(),[t,n]=f.useState(!1),[s,o]=f.useState(""),[a,l]=f.useState(""),[c,u]=f.useState(null),[h,m]=f.useState(null),[y,j]=f.useState(!1),[M,_]=f.useState(!1),[C,S]=f.useState(!1),[D,x]=f.useState(!1);f.useEffect(()=>{e.get("expired")==="true"&&(x(!0),window.history.replaceState({},document.title,"/login")),w.auth.getSession().then(({data:{session:R}})=>{R&&r("/dashboard",{replace:!0})});const{data:{subscription:b}}=w.auth.onAuthStateChange((R,I)=>{R==="SIGNED_IN"&&I&&r("/dashboard",{replace:!0})});return()=>b.unsubscribe()},[r,e]);const g=async b=>{b.preventDefault(),n(!0),u(null),m(null),x(!1);try{if(y){const{error:R}=await w.auth.signUp({email:s,password:a,options:{data:{full_name:s.split("@")[0]}}});if(R)throw R;m("Check your email for confirmation link!")}else{const{error:R}=await w.auth.signInWithPassword({email:s,password:a});if(R)throw R}}catch(R){u(R.message)}finally{n(!1)}},p=async b=>{if(b.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),m(null);try{const{error:R}=await w.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/reset-password`});if(R)throw R;m("Password reset email sent! Check your inbox.")}catch(R){u(R.message)}finally{n(!1)}},v=async b=>{if(b.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),m(null);try{const{error:R}=await w.auth.resend({type:"signup",email:s});if(R)throw R;m("Verification email resent! Check your inbox.")}catch(R){u(R.message)}finally{n(!1)}},P=()=>{_(!1),S(!1),u(null),m(null),x(!1)};return M?i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx(Co,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),i.jsx("h1",{className:"auth-title",children:"Reset Password"}),i.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),i.jsxs("form",{onSubmit:p,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:b=>o(b.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Jt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Send Reset Link"})]}),i.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:i.jsx("button",{onClick:P,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):C?i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx(fr,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),i.jsx("h1",{className:"auth-title",children:"Resend Verification"}),i.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),i.jsxs("form",{onSubmit:v,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:b=>o(b.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Jt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Resend Verification Email"})]}),i.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:i.jsx("button",{onClick:P,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):i.jsx("div",{className:"auth-container",children:i.jsxs("div",{className:"auth-box",children:[i.jsxs("div",{className:"auth-logo",children:[i.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),i.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),D&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[i.jsx(at,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),i.jsxs("form",{onSubmit:g,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:b=>o(b.target.value),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),i.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"••••••••",value:a,onChange:b=>l(b.target.value),required:!0})]}),c&&i.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[i.jsx(Jt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),h&&i.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[i.jsx(Zt,{size:20}),i.jsx("span",{style:{fontSize:"0.875rem"},children:h})]}),i.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Loading...":y?"Sign Up":"Sign In"})]}),!y&&i.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:i.jsx("button",{onClick:()=>{_(!0),u(null),m(null),x(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),i.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:i.jsx("button",{onClick:()=>{j(!y),u(null),m(null),x(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:y?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),i.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[i.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),i.jsxs("button",{onClick:()=>{S(!0),u(null),m(null),x(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx(fr,{size:14})," Resend Verification Email"]})]})]})})}var Qn={exports:{}},lt={},yr={exports:{}};(function(r,e){(function(t,n){n(e)})(Zs,function(t){function n(E){return function(A,B,G,te,ae,de,re){return E(A,B,re)}}function s(E){return function(A,B,G,te){if(!A||!B||typeof A!="object"||typeof B!="object")return E(A,B,G,te);var ae=te.get(A),de=te.get(B);if(ae&&de)return ae===B&&de===A;te.set(A,B),te.set(B,A);var re=E(A,B,G,te);return te.delete(A),te.delete(B),re}}function o(E,z){var A={};for(var B in E)A[B]=E[B];for(var B in z)A[B]=z[B];return A}function a(E){return E.constructor===Object||E.constructor==null}function l(E){return typeof E.then=="function"}function c(E,z){return E===z||E!==E&&z!==z}var u="[object Arguments]",h="[object Boolean]",m="[object Date]",y="[object RegExp]",j="[object Map]",M="[object Number]",_="[object Object]",C="[object Set]",S="[object String]",D=Object.prototype.toString;function x(E){var z=E.areArraysEqual,A=E.areDatesEqual,B=E.areMapsEqual,G=E.areObjectsEqual,te=E.areRegExpsEqual,ae=E.areSetsEqual,de=E.createIsNestedEqual,re=de(xe);function xe(Q,J,be){if(Q===J)return!0;if(!Q||!J||typeof Q!="object"||typeof J!="object")return Q!==Q&&J!==J;if(a(Q)&&a(J))return G(Q,J,re,be);var tt=Array.isArray(Q),dt=Array.isArray(J);if(tt||dt)return tt===dt&&z(Q,J,re,be);var je=D.call(Q);return je!==D.call(J)?!1:je===m?A(Q,J,re,be):je===y?te(Q,J,re,be):je===j?B(Q,J,re,be):je===C?ae(Q,J,re,be):je===_||je===u?l(Q)||l(J)?!1:G(Q,J,re,be):je===h||je===M||je===S?c(Q.valueOf(),J.valueOf()):!1}return xe}function g(E,z,A,B){var G=E.length;if(z.length!==G)return!1;for(;G-- >0;)if(!A(E[G],z[G],G,G,E,z,B))return!1;return!0}var p=s(g);function v(E,z){return c(E.valueOf(),z.valueOf())}function P(E,z,A,B){var G=E.size===z.size;if(!G)return!1;if(!E.size)return!0;var te={},ae=0;return E.forEach(function(de,re){if(G){var xe=!1,Q=0;z.forEach(function(J,be){!xe&&!te[Q]&&(xe=A(re,be,ae,Q,E,z,B)&&A(de,J,re,be,E,z,B))&&(te[Q]=!0),Q++}),ae++,G=xe}}),G}var b=s(P),R="_owner",I=Object.prototype.hasOwnProperty;function Y(E,z,A,B){var G=Object.keys(E),te=G.length;if(Object.keys(z).length!==te)return!1;for(var ae;te-- >0;){if(ae=G[te],ae===R){var de=!!E.$$typeof,re=!!z.$$typeof;if((de||re)&&de!==re)return!1}if(!I.call(z,ae)||!A(E[ae],z[ae],ae,ae,E,z,B))return!1}return!0}var k=s(Y);function q(E,z){return E.source===z.source&&E.flags===z.flags}function K(E,z,A,B){var G=E.size===z.size;if(!G)return!1;if(!E.size)return!0;var te={};return E.forEach(function(ae,de){if(G){var re=!1,xe=0;z.forEach(function(Q,J){!re&&!te[xe]&&(re=A(ae,Q,de,J,E,z,B))&&(te[xe]=!0),xe++}),G=re}}),G}var ee=s(K),O=Object.freeze({areArraysEqual:g,areDatesEqual:v,areMapsEqual:P,areObjectsEqual:Y,areRegExpsEqual:q,areSetsEqual:K,createIsNestedEqual:n}),W=Object.freeze({areArraysEqual:p,areDatesEqual:v,areMapsEqual:b,areObjectsEqual:k,areRegExpsEqual:q,areSetsEqual:ee,createIsNestedEqual:n}),pe=x(O);function me(E,z){return pe(E,z,void 0)}var ke=x(o(O,{createIsNestedEqual:function(){return c}}));function Ie(E,z){return ke(E,z,void 0)}var Ne=x(W);function N(E,z){return Ne(E,z,new WeakMap)}var le=x(o(W,{createIsNestedEqual:function(){return c}}));function ce(E,z){return le(E,z,new WeakMap)}function X(E){return x(o(O,E(O)))}function ne(E){var z=x(o(W,E(W)));return function(A,B,G){return G===void 0&&(G=new WeakMap),z(A,B,G)}}t.circularDeepEqual=N,t.circularShallowEqual=ce,t.createCustomCircularEqual=ne,t.createCustomEqual=X,t.deepEqual=me,t.sameValueZeroEqual=c,t.shallowEqual=Ie,Object.defineProperty(t,"__esModule",{value:!0})})})(yr,yr.exports);var Or=yr.exports,F={},ha=function(e,t,n){return e===t?!0:e.className===t.className&&n(e.style,t.style)&&e.width===t.width&&e.autoSize===t.autoSize&&e.cols===t.cols&&e.draggableCancel===t.draggableCancel&&e.draggableHandle===t.draggableHandle&&n(e.verticalCompact,t.verticalCompact)&&n(e.compactType,t.compactType)&&n(e.layout,t.layout)&&n(e.margin,t.margin)&&n(e.containerPadding,t.containerPadding)&&e.rowHeight===t.rowHeight&&e.maxRows===t.maxRows&&e.isBounded===t.isBounded&&e.isDraggable===t.isDraggable&&e.isResizable===t.isResizable&&e.allowOverlap===t.allowOverlap&&e.preventCollision===t.preventCollision&&e.useCSSTransforms===t.useCSSTransforms&&e.transformScale===t.transformScale&&e.isDroppable===t.isDroppable&&n(e.resizeHandles,t.resizeHandles)&&n(e.resizeHandle,t.resizeHandle)&&e.onLayoutChange===t.onLayoutChange&&e.onDragStart===t.onDragStart&&e.onDrag===t.onDrag&&e.onDragStop===t.onDragStop&&e.onResizeStart===t.onResizeStart&&e.onResize===t.onResize&&e.onResizeStop===t.onResizeStop&&e.onDrop===t.onDrop&&n(e.droppingItem,t.droppingItem)&&n(e.innerRef,t.innerRef)};Object.defineProperty(F,"__esModule",{value:!0});F.bottom=kr;F.childrenEqual=ga;F.cloneLayout=Jn;F.cloneLayoutItem=Ue;F.collides=zt;F.compact=es;F.compactItem=ts;F.compactType=Ma;F.correctBounds=rs;F.fastPositionEqual=ya;F.fastRGLPropsEqual=void 0;F.getAllCollisions=ns;F.getFirstCollision=Be;F.getLayoutItem=Ir;F.getStatics=zr;F.modifyLayout=Zn;F.moveElement=it;F.moveElementAwayFromCollision=vr;F.noop=void 0;F.perc=va;F.resizeItemInDirection=Pa;F.setTopLeft=Ca;F.setTransform=Ra;F.sortLayoutItems=Wr;F.sortLayoutItemsByColRow=ls;F.sortLayoutItemsByRowCol=as;F.synchronizeLayoutWithChildren=Ea;F.validateLayout=Da;F.withLayoutItem=ma;var un=Or,ot=pa(f);function pa(r){return r&&r.__esModule?r:{default:r}}function kr(r){let e=0,t;for(let n=0,s=r.length;n<s;n++)t=r[n].y+r[n].h,t>e&&(e=t);return e}function Jn(r){const e=Array(r.length);for(let t=0,n=r.length;t<n;t++)e[t]=Ue(r[t]);return e}function Zn(r,e){const t=Array(r.length);for(let n=0,s=r.length;n<s;n++)e.i===r[n].i?t[n]=e:t[n]=r[n];return t}function ma(r,e,t){let n=Ir(r,e);return n?(n=t(Ue(n)),r=Zn(r,n),[r,n]):[r,null]}function Ue(r){return{w:r.w,h:r.h,x:r.x,y:r.y,i:r.i,minW:r.minW,maxW:r.maxW,minH:r.minH,maxH:r.maxH,moved:!!r.moved,static:!!r.static,isDraggable:r.isDraggable,isResizable:r.isResizable,resizeHandles:r.resizeHandles,isBounded:r.isBounded}}function ga(r,e){return(0,un.deepEqual)(ot.default.Children.map(r,t=>t?.key),ot.default.Children.map(e,t=>t?.key))&&(0,un.deepEqual)(ot.default.Children.map(r,t=>t?.props["data-grid"]),ot.default.Children.map(e,t=>t?.props["data-grid"]))}F.fastRGLPropsEqual=ha;function ya(r,e){return r.left===e.left&&r.top===e.top&&r.width===e.width&&r.height===e.height}function zt(r,e){return!(r.i===e.i||r.x+r.w<=e.x||r.x>=e.x+e.w||r.y+r.h<=e.y||r.y>=e.y+e.h)}function es(r,e,t,n){const s=zr(r),o=Wr(r,e),a=Array(r.length);for(let l=0,c=o.length;l<c;l++){let u=Ue(o[l]);u.static||(u=ts(s,u,e,t,o,n),s.push(u)),a[r.indexOf(o[l])]=u,u.moved=!1}return a}const ba={x:"w",y:"h"};function br(r,e,t,n){const s=ba[n];e[n]+=1;const o=r.map(a=>a.i).indexOf(e.i);for(let a=o+1;a<r.length;a++){const l=r[a];if(!l.static){if(l.y>e.y+e.h)break;zt(e,l)&&br(r,l,t+e[s],n)}}e[n]=t}function ts(r,e,t,n,s,o){const a=t==="vertical",l=t==="horizontal";if(a)for(e.y=Math.min(kr(r),e.y);e.y>0&&!Be(r,e);)e.y--;else if(l)for(;e.x>0&&!Be(r,e);)e.x--;let c;for(;(c=Be(r,e))&&!(t===null&&o);)if(l?br(s,e,c.x+c.w,"x"):br(s,e,c.y+c.h,"y"),l&&e.x+e.w>n)for(e.x=n-e.w,e.y++;e.x>0&&!Be(r,e);)e.x--;return e.y=Math.max(e.y,0),e.x=Math.max(e.x,0),e}function rs(r,e){const t=zr(r);for(let n=0,s=r.length;n<s;n++){const o=r[n];if(o.x+o.w>e.cols&&(o.x=e.cols-o.w),o.x<0&&(o.x=0,o.w=e.cols),!o.static)t.push(o);else for(;Be(t,o);)o.y++}return r}function Ir(r,e){for(let t=0,n=r.length;t<n;t++)if(r[t].i===e)return r[t]}function Be(r,e){for(let t=0,n=r.length;t<n;t++)if(zt(r[t],e))return r[t]}function ns(r,e){return r.filter(t=>zt(t,e))}function zr(r){return r.filter(e=>e.static)}function it(r,e,t,n,s,o,a,l,c){if(e.static&&e.isDraggable!==!0||e.y===n&&e.x===t)return r;`${e.i}${String(t)}${String(n)}${e.x}${e.y}`;const u=e.x,h=e.y;typeof t=="number"&&(e.x=t),typeof n=="number"&&(e.y=n),e.moved=!0;let m=Wr(r,a);(a==="vertical"&&typeof n=="number"?h>=n:a==="horizontal"&&typeof t=="number"?u>=t:!1)&&(m=m.reverse());const j=ns(m,e),M=j.length>0;if(M&&c)return Jn(r);if(M&&o)return`${e.i}`,e.x=u,e.y=h,e.moved=!1,r;for(let _=0,C=j.length;_<C;_++){const S=j[_];`${e.i}${e.x}${e.y}${S.i}${S.x}${S.y}`,!S.moved&&(S.static?r=vr(r,S,e,s,a):r=vr(r,e,S,s,a))}return r}function vr(r,e,t,n,s,o){const a=s==="horizontal",l=s==="vertical",c=e.static;if(n){n=!1;const m={x:a?Math.max(e.x-t.w,0):t.x,y:l?Math.max(e.y-t.h,0):t.y,w:t.w,h:t.h,i:"-1"},y=Be(r,m),j=y&&y.y+y.h>e.y,M=y&&e.x+e.w>y.x;if(y){if(j&&l)return it(r,t,void 0,e.y+1,n,c,s);if(j&&s==null)return e.y=t.y,t.y=t.y+t.h,r;if(M&&a)return it(r,e,t.x,void 0,n,c,s)}else return`${t.i}${m.x}${m.y}`,it(r,t,a?m.x:void 0,l?m.y:void 0,n,c,s)}const u=a?t.x+1:void 0,h=l?t.y+1:void 0;return u==null&&h==null?r:it(r,t,a?t.x+1:void 0,l?t.y+1:void 0,n,c,s)}function va(r){return r*100+"%"}const ss=(r,e,t,n)=>r+t>n?e:t,os=(r,e,t)=>r<0?e:t,is=r=>Math.max(0,r),Nr=r=>Math.max(0,r),Tr=(r,e,t)=>{let{left:n,height:s,width:o}=e;const a=r.top-(s-r.height);return{left:n,width:o,height:os(a,r.height,s),top:Nr(a)}},Ar=(r,e,t)=>{let{top:n,left:s,height:o,width:a}=e;return{top:n,height:o,width:ss(r.left,r.width,a,t),left:is(s)}},Lr=(r,e,t)=>{let{top:n,height:s,width:o}=e;const a=r.left-(o-r.width);return{height:s,width:a<0?r.width:ss(r.left,r.width,o,t),top:Nr(n),left:is(a)}},qr=(r,e,t)=>{let{top:n,left:s,height:o,width:a}=e;return{width:a,left:s,height:os(n,r.height,o),top:Nr(n)}},xa=function(){return Tr(arguments.length<=0?void 0:arguments[0],Ar(...arguments))},wa=function(){return Tr(arguments.length<=0?void 0:arguments[0],Lr(...arguments))},_a=function(){return qr(arguments.length<=0?void 0:arguments[0],Ar(...arguments))},Sa=function(){return qr(arguments.length<=0?void 0:arguments[0],Lr(...arguments))},ja={n:Tr,ne:xa,e:Ar,se:_a,s:qr,sw:Sa,w:Lr,nw:wa};function Pa(r,e,t,n){const s=ja[r];return s?s(e,{...e,...t},n):t}function Ra(r){let{top:e,left:t,width:n,height:s}=r;const o=`translate(${t}px,${e}px)`;return{transform:o,WebkitTransform:o,MozTransform:o,msTransform:o,OTransform:o,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Ca(r){let{top:e,left:t,width:n,height:s}=r;return{top:`${e}px`,left:`${t}px`,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Wr(r,e){return e==="horizontal"?ls(r):e==="vertical"?as(r):r}function as(r){return r.slice(0).sort(function(e,t){return e.y>t.y||e.y===t.y&&e.x>t.x?1:e.y===t.y&&e.x===t.x?0:-1})}function ls(r){return r.slice(0).sort(function(e,t){return e.x>t.x||e.x===t.x&&e.y>t.y?1:-1})}function Ea(r,e,t,n,s){r=r||[];const o=[];ot.default.Children.forEach(e,l=>{if(l?.key==null)return;const c=Ir(r,String(l.key)),u=l.props["data-grid"];c&&u==null?o.push(Ue(c)):u?o.push(Ue({...u,i:l.key})):o.push(Ue({w:1,h:1,x:0,y:kr(o),i:String(l.key)}))});const a=rs(o,{cols:t});return s?a:es(a,n,t)}function Da(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Layout";const t=["x","y","w","h"];if(!Array.isArray(r))throw new Error(e+" must be an array!");for(let n=0,s=r.length;n<s;n++){const o=r[n];for(let a=0;a<t.length;a++){const l=t[a],c=o[l];if(typeof c!="number"||Number.isNaN(c))throw new Error(`ReactGridLayout: ${e}[${n}].${l} must be a number! Received: ${c} (${typeof c})`)}if(typeof o.i<"u"&&typeof o.i!="string")throw new Error(`ReactGridLayout: ${e}[${n}].i must be a string! Received: ${o.i} (${typeof o.i})`)}}function Ma(r){const{verticalCompact:e,compactType:t}=r||{};return e===!1?null:t}const Oa=()=>{};F.noop=Oa;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.calcGridColWidth=Nt;Ee.calcGridItemPosition=ka;Ee.calcGridItemWHPx=xr;Ee.calcWH=za;Ee.calcXY=Ia;Ee.clamp=He;function Nt(r){const{margin:e,containerPadding:t,containerWidth:n,cols:s}=r;return(n-e[0]*(s-1)-t[0]*2)/s}function xr(r,e,t){return Number.isFinite(r)?Math.round(e*r+Math.max(0,r-1)*t):r}function ka(r,e,t,n,s,o){const{margin:a,containerPadding:l,rowHeight:c}=r,u=Nt(r),h={};return o&&o.resizing?(h.width=Math.round(o.resizing.width),h.height=Math.round(o.resizing.height)):(h.width=xr(n,u,a[0]),h.height=xr(s,c,a[1])),o&&o.dragging?(h.top=Math.round(o.dragging.top),h.left=Math.round(o.dragging.left)):o&&o.resizing&&typeof o.resizing.top=="number"&&typeof o.resizing.left=="number"?(h.top=Math.round(o.resizing.top),h.left=Math.round(o.resizing.left)):(h.top=Math.round((c+a[1])*t+l[1]),h.left=Math.round((u+a[0])*e+l[0])),h}function Ia(r,e,t,n,s){const{margin:o,containerPadding:a,cols:l,rowHeight:c,maxRows:u}=r,h=Nt(r);let m=Math.round((t-a[0])/(h+o[0])),y=Math.round((e-a[1])/(c+o[1]));return m=He(m,0,l-n),y=He(y,0,u-s),{x:m,y}}function za(r,e,t,n,s,o){const{margin:a,maxRows:l,cols:c,rowHeight:u}=r,h=Nt(r);let m=Math.round((e+a[0])/(h+a[0])),y=Math.round((t+a[1])/(u+a[1])),j=He(m,0,c-n),M=He(y,0,l-s);return["sw","w","nw"].indexOf(o)!==-1&&(j=He(m,0,c)),["nw","n","ne"].indexOf(o)!==-1&&(M=He(y,0,l)),{w:j,h:M}}function He(r,e,t){return Math.max(Math.min(r,t),e)}var Tt={},At={exports:{}},cs={},ie={},De={};Object.defineProperty(De,"__esModule",{value:!0});De.dontSetMe=qa;De.findInArray=Na;De.int=La;De.isFunction=Ta;De.isNum=Aa;function Na(r,e){for(let t=0,n=r.length;t<n;t++)if(e.apply(e,[r[t],t,r]))return r[t]}function Ta(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Function]"}function Aa(r){return typeof r=="number"&&!isNaN(r)}function La(r){return parseInt(r,10)}function qa(r,e,t){if(r[e])return new Error(`Invalid prop ${e} passed to ${t} - do not set this, set it on the child.`)}var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.browserPrefixToKey=ds;Fe.browserPrefixToStyle=Wa;Fe.default=void 0;Fe.getPrefix=us;const tr=["Moz","Webkit","O","ms"];function us(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const e=window.document?.documentElement?.style;if(!e||r in e)return"";for(let t=0;t<tr.length;t++)if(ds(r,tr[t])in e)return tr[t];return""}function ds(r,e){return e?`${e}${$a(r)}`:r}function Wa(r,e){return e?`-${e.toLowerCase()}-${r}`:r}function $a(r){let e="",t=!0;for(let n=0;n<r.length;n++)t?(e+=r[n].toUpperCase(),t=!1):r[n]==="-"?t=!0:e+=r[n];return e}Fe.default=us();Object.defineProperty(ie,"__esModule",{value:!0});ie.addClassName=ps;ie.addEvent=Ha;ie.addUserSelectStyles=el;ie.createCSSTransform=Xa;ie.createSVGTransform=Qa;ie.getTouch=Ja;ie.getTouchIdentifier=Za;ie.getTranslation=$r;ie.innerHeight=Va;ie.innerWidth=Ya;ie.matchesSelector=hs;ie.matchesSelectorAndParentsTo=Ba;ie.offsetXYFromParent=Ka;ie.outerHeight=Fa;ie.outerWidth=Ga;ie.removeClassName=ms;ie.removeEvent=Ua;ie.scheduleRemoveUserSelectStyles=tl;var Se=De,dn=fs(Fe);function fs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(fs=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}let ht="";function hs(r,e){return ht||(ht=(0,Se.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(t){return(0,Se.isFunction)(r[t])})),(0,Se.isFunction)(r[ht])?r[ht](e):!1}function Ba(r,e,t){let n=r;do{if(hs(n,e))return!0;if(n===t)return!1;n=n.parentNode}while(n);return!1}function Ha(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.addEventListener?r.addEventListener(e,t,s):r.attachEvent?r.attachEvent("on"+e,t):r["on"+e]=t}function Ua(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.removeEventListener?r.removeEventListener(e,t,s):r.detachEvent?r.detachEvent("on"+e,t):r["on"+e]=null}function Fa(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Se.int)(t.borderTopWidth),e+=(0,Se.int)(t.borderBottomWidth),e}function Ga(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Se.int)(t.borderLeftWidth),e+=(0,Se.int)(t.borderRightWidth),e}function Va(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Se.int)(t.paddingTop),e-=(0,Se.int)(t.paddingBottom),e}function Ya(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Se.int)(t.paddingLeft),e-=(0,Se.int)(t.paddingRight),e}function Ka(r,e,t){const s=e===e.ownerDocument.body?{left:0,top:0}:e.getBoundingClientRect(),o=(r.clientX+e.scrollLeft-s.left)/t,a=(r.clientY+e.scrollTop-s.top)/t;return{x:o,y:a}}function Xa(r,e){const t=$r(r,e,"px");return{[(0,dn.browserPrefixToKey)("transform",dn.default)]:t}}function Qa(r,e){return $r(r,e,"")}function $r(r,e,t){let{x:n,y:s}=r,o=`translate(${n}${t},${s}${t})`;if(e){const a=`${typeof e.x=="string"?e.x:e.x+t}`,l=`${typeof e.y=="string"?e.y:e.y+t}`;o=`translate(${a}, ${l})`+o}return o}function Ja(r,e){return r.targetTouches&&(0,Se.findInArray)(r.targetTouches,t=>e===t.identifier)||r.changedTouches&&(0,Se.findInArray)(r.changedTouches,t=>e===t.identifier)}function Za(r){if(r.targetTouches&&r.targetTouches[0])return r.targetTouches[0].identifier;if(r.changedTouches&&r.changedTouches[0])return r.changedTouches[0].identifier}function el(r){if(!r)return;let e=r.getElementById("react-draggable-style-el");e||(e=r.createElement("style"),e.type="text/css",e.id="react-draggable-style-el",e.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,e.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,r.getElementsByTagName("head")[0].appendChild(e)),r.body&&ps(r.body,"react-draggable-transparent-selection")}function tl(r){window.requestAnimationFrame?window.requestAnimationFrame(()=>{fn(r)}):fn(r)}function fn(r){if(r)try{if(r.body&&ms(r.body,"react-draggable-transparent-selection"),r.selection)r.selection.empty();else{const e=(r.defaultView||window).getSelection();e&&e.type!=="Caret"&&e.removeAllRanges()}}catch{}}function ps(r,e){r.classList?r.classList.add(e):r.className.match(new RegExp(`(?:^|\\s)${e}(?!\\S)`))||(r.className+=` ${e}`)}function ms(r,e){r.classList?r.classList.remove(e):r.className=r.className.replace(new RegExp(`(?:^|\\s)${e}(?!\\S)`,"g"),"")}var Me={};Object.defineProperty(Me,"__esModule",{value:!0});Me.canDragX=sl;Me.canDragY=ol;Me.createCoreData=al;Me.createDraggableData=ll;Me.getBoundPosition=rl;Me.getControlPosition=il;Me.snapToGrid=nl;var _e=De,Qe=ie;function rl(r,e,t){if(!r.props.bounds)return[e,t];let{bounds:n}=r.props;n=typeof n=="string"?n:cl(n);const s=Br(r);if(typeof n=="string"){const{ownerDocument:o}=s,a=o.defaultView;let l;if(n==="parent"?l=s.parentNode:l=s.getRootNode().querySelector(n),!(l instanceof a.HTMLElement))throw new Error('Bounds selector "'+n+'" could not find an element.');const c=l,u=a.getComputedStyle(s),h=a.getComputedStyle(c);n={left:-s.offsetLeft+(0,_e.int)(h.paddingLeft)+(0,_e.int)(u.marginLeft),top:-s.offsetTop+(0,_e.int)(h.paddingTop)+(0,_e.int)(u.marginTop),right:(0,Qe.innerWidth)(c)-(0,Qe.outerWidth)(s)-s.offsetLeft+(0,_e.int)(h.paddingRight)-(0,_e.int)(u.marginRight),bottom:(0,Qe.innerHeight)(c)-(0,Qe.outerHeight)(s)-s.offsetTop+(0,_e.int)(h.paddingBottom)-(0,_e.int)(u.marginBottom)}}return(0,_e.isNum)(n.right)&&(e=Math.min(e,n.right)),(0,_e.isNum)(n.bottom)&&(t=Math.min(t,n.bottom)),(0,_e.isNum)(n.left)&&(e=Math.max(e,n.left)),(0,_e.isNum)(n.top)&&(t=Math.max(t,n.top)),[e,t]}function nl(r,e,t){const n=Math.round(e/r[0])*r[0],s=Math.round(t/r[1])*r[1];return[n,s]}function sl(r){return r.props.axis==="both"||r.props.axis==="x"}function ol(r){return r.props.axis==="both"||r.props.axis==="y"}function il(r,e,t){const n=typeof e=="number"?(0,Qe.getTouch)(r,e):null;if(typeof e=="number"&&!n)return null;const s=Br(t),o=t.props.offsetParent||s.offsetParent||s.ownerDocument.body;return(0,Qe.offsetXYFromParent)(n||r,o,t.props.scale)}function al(r,e,t){const n=!(0,_e.isNum)(r.lastX),s=Br(r);return n?{node:s,deltaX:0,deltaY:0,lastX:e,lastY:t,x:e,y:t}:{node:s,deltaX:e-r.lastX,deltaY:t-r.lastY,lastX:r.lastX,lastY:r.lastY,x:e,y:t}}function ll(r,e){const t=r.props.scale;return{node:e.node,x:r.state.x+e.deltaX/t,y:r.state.y+e.deltaY/t,deltaX:e.deltaX/t,deltaY:e.deltaY/t,lastX:r.state.x,lastY:r.state.y}}function cl(r){return{left:r.left,top:r.top,right:r.right,bottom:r.bottom}}function Br(r){const e=r.findDOMNode();if(!e)throw new Error("<DraggableCore>: Unmounted during event!");return e}var Lt={},qt={};Object.defineProperty(qt,"__esModule",{value:!0});qt.default=ul;function ul(){}Object.defineProperty(Lt,"__esModule",{value:!0});Lt.default=void 0;var rr=gs(f),ge=Hr(qe),dl=Hr(Rt),fe=ie,Te=Me,nr=De,rt=Hr(qt);function Hr(r){return r&&r.__esModule?r:{default:r}}function gs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(gs=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function ye(r,e,t){return(e=fl(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function fl(r){var e=hl(r,"string");return typeof e=="symbol"?e:e+""}function hl(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Re={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let Ae=Re.mouse,Wt=class extends rr.Component{constructor(){super(...arguments),ye(this,"dragging",!1),ye(this,"lastX",NaN),ye(this,"lastY",NaN),ye(this,"touchIdentifier",null),ye(this,"mounted",!1),ye(this,"handleDragStart",e=>{if(this.props.onMouseDown(e),!this.props.allowAnyClick&&typeof e.button=="number"&&e.button!==0)return!1;const t=this.findDOMNode();if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:n}=t;if(this.props.disabled||!(e.target instanceof n.defaultView.Node)||this.props.handle&&!(0,fe.matchesSelectorAndParentsTo)(e.target,this.props.handle,t)||this.props.cancel&&(0,fe.matchesSelectorAndParentsTo)(e.target,this.props.cancel,t))return;e.type==="touchstart"&&!this.props.allowMobileScroll&&e.preventDefault();const s=(0,fe.getTouchIdentifier)(e);this.touchIdentifier=s;const o=(0,Te.getControlPosition)(e,s,this);if(o==null)return;const{x:a,y:l}=o,c=(0,Te.createCoreData)(this,a,l);(0,rt.default)("DraggableCore: handleDragStart: %j",c),(0,rt.default)("calling",this.props.onStart),!(this.props.onStart(e,c)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,fe.addUserSelectStyles)(n),this.dragging=!0,this.lastX=a,this.lastY=l,(0,fe.addEvent)(n,Ae.move,this.handleDrag),(0,fe.addEvent)(n,Ae.stop,this.handleDragStop))}),ye(this,"handleDrag",e=>{const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let l=n-this.lastX,c=s-this.lastY;if([l,c]=(0,Te.snapToGrid)(this.props.grid,l,c),!l&&!c)return;n=this.lastX+l,s=this.lastY+c}const o=(0,Te.createCoreData)(this,n,s);if((0,rt.default)("DraggableCore: handleDrag: %j",o),this.props.onDrag(e,o)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const c=document.createEvent("MouseEvents");c.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(c)}return}this.lastX=n,this.lastY=s}),ye(this,"handleDragStop",e=>{if(!this.dragging)return;const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let c=n-this.lastX||0,u=s-this.lastY||0;[c,u]=(0,Te.snapToGrid)(this.props.grid,c,u),n=this.lastX+c,s=this.lastY+u}const o=(0,Te.createCoreData)(this,n,s);if(this.props.onStop(e,o)===!1||this.mounted===!1)return!1;const l=this.findDOMNode();l&&this.props.enableUserSelectHack&&(0,fe.scheduleRemoveUserSelectStyles)(l.ownerDocument),(0,rt.default)("DraggableCore: handleDragStop: %j",o),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,l&&((0,rt.default)("DraggableCore: Removing handlers"),(0,fe.removeEvent)(l.ownerDocument,Ae.move,this.handleDrag),(0,fe.removeEvent)(l.ownerDocument,Ae.stop,this.handleDragStop))}),ye(this,"onMouseDown",e=>(Ae=Re.mouse,this.handleDragStart(e))),ye(this,"onMouseUp",e=>(Ae=Re.mouse,this.handleDragStop(e))),ye(this,"onTouchStart",e=>(Ae=Re.touch,this.handleDragStart(e))),ye(this,"onTouchEnd",e=>(Ae=Re.touch,this.handleDragStop(e)))}componentDidMount(){this.mounted=!0;const e=this.findDOMNode();e&&(0,fe.addEvent)(e,Re.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const e=this.findDOMNode();if(e){const{ownerDocument:t}=e;(0,fe.removeEvent)(t,Re.mouse.move,this.handleDrag),(0,fe.removeEvent)(t,Re.touch.move,this.handleDrag),(0,fe.removeEvent)(t,Re.mouse.stop,this.handleDragStop),(0,fe.removeEvent)(t,Re.touch.stop,this.handleDragStop),(0,fe.removeEvent)(e,Re.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,fe.scheduleRemoveUserSelectStyles)(t)}}findDOMNode(){return this.props?.nodeRef?this.props?.nodeRef?.current:dl.default.findDOMNode(this)}render(){return rr.cloneElement(rr.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};Lt.default=Wt;ye(Wt,"displayName","DraggableCore");ye(Wt,"propTypes",{allowAnyClick:ge.default.bool,allowMobileScroll:ge.default.bool,children:ge.default.node.isRequired,disabled:ge.default.bool,enableUserSelectHack:ge.default.bool,offsetParent:function(r,e){if(r[e]&&r[e].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:ge.default.arrayOf(ge.default.number),handle:ge.default.string,cancel:ge.default.string,nodeRef:ge.default.object,onStart:ge.default.func,onDrag:ge.default.func,onStop:ge.default.func,onMouseDown:ge.default.func,scale:ge.default.number,className:nr.dontSetMe,style:nr.dontSetMe,transform:nr.dontSetMe});ye(Wt,"defaultProps",{allowAnyClick:!1,allowMobileScroll:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DraggableCore",{enumerable:!0,get:function(){return c.default}}),r.default=void 0;var e=m(f),t=h(qe),n=h(Rt),s=Ct,o=ie,a=Me,l=De,c=h(Lt),u=h(qt);function h(S){return S&&S.__esModule?S:{default:S}}function m(S,D){if(typeof WeakMap=="function")var x=new WeakMap,g=new WeakMap;return(m=function(p,v){if(!v&&p&&p.__esModule)return p;var P,b,R={__proto__:null,default:p};if(p===null||typeof p!="object"&&typeof p!="function")return R;if(P=v?g:x){if(P.has(p))return P.get(p);P.set(p,R)}for(const I in p)I!=="default"&&{}.hasOwnProperty.call(p,I)&&((b=(P=Object.defineProperty)&&Object.getOwnPropertyDescriptor(p,I))&&(b.get||b.set)?P(R,I,b):R[I]=p[I]);return R})(S,D)}function y(){return y=Object.assign?Object.assign.bind():function(S){for(var D=1;D<arguments.length;D++){var x=arguments[D];for(var g in x)({}).hasOwnProperty.call(x,g)&&(S[g]=x[g])}return S},y.apply(null,arguments)}function j(S,D,x){return(D=M(D))in S?Object.defineProperty(S,D,{value:x,enumerable:!0,configurable:!0,writable:!0}):S[D]=x,S}function M(S){var D=_(S,"string");return typeof D=="symbol"?D:D+""}function _(S,D){if(typeof S!="object"||!S)return S;var x=S[Symbol.toPrimitive];if(x!==void 0){var g=x.call(S,D);if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(D==="string"?String:Number)(S)}class C extends e.Component{static getDerivedStateFromProps(D,x){let{position:g}=D,{prevPropsPosition:p}=x;return g&&(!p||g.x!==p.x||g.y!==p.y)?((0,u.default)("Draggable: getDerivedStateFromProps %j",{position:g,prevPropsPosition:p}),{x:g.x,y:g.y,prevPropsPosition:{...g}}):null}constructor(D){super(D),j(this,"onDragStart",(x,g)=>{if((0,u.default)("Draggable: onDragStart: %j",g),this.props.onStart(x,(0,a.createDraggableData)(this,g))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),j(this,"onDrag",(x,g)=>{if(!this.state.dragging)return!1;(0,u.default)("Draggable: onDrag: %j",g);const p=(0,a.createDraggableData)(this,g),v={x:p.x,y:p.y,slackX:0,slackY:0};if(this.props.bounds){const{x:b,y:R}=v;v.x+=this.state.slackX,v.y+=this.state.slackY;const[I,Y]=(0,a.getBoundPosition)(this,v.x,v.y);v.x=I,v.y=Y,v.slackX=this.state.slackX+(b-v.x),v.slackY=this.state.slackY+(R-v.y),p.x=v.x,p.y=v.y,p.deltaX=v.x-this.state.x,p.deltaY=v.y-this.state.y}if(this.props.onDrag(x,p)===!1)return!1;this.setState(v)}),j(this,"onDragStop",(x,g)=>{if(!this.state.dragging||this.props.onStop(x,(0,a.createDraggableData)(this,g))===!1)return!1;(0,u.default)("Draggable: onDragStop: %j",g);const v={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:b,y:R}=this.props.position;v.x=b,v.y=R}this.setState(v)}),this.state={dragging:!1,dragged:!1,x:D.position?D.position.x:D.defaultPosition.x,y:D.position?D.position.y:D.defaultPosition.y,prevPropsPosition:{...D.position},slackX:0,slackY:0,isElementSVG:!1},D.position&&(D.onDrag||D.onStop)}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.state.dragging&&this.setState({dragging:!1})}findDOMNode(){return this.props?.nodeRef?.current??n.default.findDOMNode(this)}render(){const{axis:D,bounds:x,children:g,defaultPosition:p,defaultClassName:v,defaultClassNameDragging:P,defaultClassNameDragged:b,position:R,positionOffset:I,scale:Y,...k}=this.props;let q={},K=null;const O=!!!R||this.state.dragging,W=R||p,pe={x:(0,a.canDragX)(this)&&O?this.state.x:W.x,y:(0,a.canDragY)(this)&&O?this.state.y:W.y};this.state.isElementSVG?K=(0,o.createSVGTransform)(pe,I):q=(0,o.createCSSTransform)(pe,I);const me=(0,s.clsx)(g.props.className||"",v,{[P]:this.state.dragging,[b]:this.state.dragged});return e.createElement(c.default,y({},k,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),e.cloneElement(e.Children.only(g),{className:me,style:{...g.props.style,...q},transform:K}))}}r.default=C,j(C,"displayName","Draggable"),j(C,"propTypes",{...c.default.propTypes,axis:t.default.oneOf(["both","x","y","none"]),bounds:t.default.oneOfType([t.default.shape({left:t.default.number,right:t.default.number,top:t.default.number,bottom:t.default.number}),t.default.string,t.default.oneOf([!1])]),defaultClassName:t.default.string,defaultClassNameDragging:t.default.string,defaultClassNameDragged:t.default.string,defaultPosition:t.default.shape({x:t.default.number,y:t.default.number}),positionOffset:t.default.shape({x:t.default.oneOfType([t.default.number,t.default.string]),y:t.default.oneOfType([t.default.number,t.default.string])}),position:t.default.shape({x:t.default.number,y:t.default.number}),className:l.dontSetMe,style:l.dontSetMe,transform:l.dontSetMe}),j(C,"defaultProps",{...c.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(cs);const{default:ys,DraggableCore:pl}=cs;At.exports=ys;At.exports.default=ys;At.exports.DraggableCore=pl;var bs=At.exports,$t={exports:{}},ct={},Ur={};Ur.__esModule=!0;Ur.cloneElement=xl;var ml=gl(f);function gl(r){return r&&r.__esModule?r:{default:r}}function hn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function pn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hn(Object(t),!0).forEach(function(n){yl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):hn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function yl(r,e,t){return e=bl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function bl(r){var e=vl(r,"string");return typeof e=="symbol"?e:String(e)}function vl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function xl(r,e){return e.style&&r.props.style&&(e.style=pn(pn({},r.props.style),e.style)),e.className&&r.props.className&&(e.className=r.props.className+" "+e.className),ml.default.cloneElement(r,e)}var ut={};ut.__esModule=!0;ut.resizableProps=void 0;var L=wl(qe);function wl(r){return r&&r.__esModule?r:{default:r}}var _l={axis:L.default.oneOf(["both","x","y","none"]),className:L.default.string,children:L.default.element.isRequired,draggableOpts:L.default.shape({allowAnyClick:L.default.bool,cancel:L.default.string,children:L.default.node,disabled:L.default.bool,enableUserSelectHack:L.default.bool,offsetParent:L.default.node,grid:L.default.arrayOf(L.default.number),handle:L.default.string,nodeRef:L.default.object,onStart:L.default.func,onDrag:L.default.func,onStop:L.default.func,onMouseDown:L.default.func,scale:L.default.number}),height:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="y"){var o;return(o=L.default.number).isRequired.apply(o,t)}return L.default.number.apply(L.default,t)},handle:L.default.oneOfType([L.default.node,L.default.func]),handleSize:L.default.arrayOf(L.default.number),lockAspectRatio:L.default.bool,maxConstraints:L.default.arrayOf(L.default.number),minConstraints:L.default.arrayOf(L.default.number),onResizeStop:L.default.func,onResizeStart:L.default.func,onResize:L.default.func,resizeHandles:L.default.arrayOf(L.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),transformScale:L.default.number,width:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="x"){var o;return(o=L.default.number).isRequired.apply(o,t)}return L.default.number.apply(L.default,t)}};ut.resizableProps=_l;ct.__esModule=!0;ct.default=void 0;var nt=Cl(f),Sl=bs,jl=Ur,Pl=ut,Rl=["children","className","draggableOpts","width","height","handle","handleSize","lockAspectRatio","axis","minConstraints","maxConstraints","onResize","onResizeStop","onResizeStart","resizeHandles","transformScale"];function vs(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(vs=function(s){return s?t:e})(r)}function Cl(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=vs(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in r)if(o!=="default"&&Object.prototype.hasOwnProperty.call(r,o)){var a=s?Object.getOwnPropertyDescriptor(r,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=r[o]}return n.default=r,t&&t.set(r,n),n}function wr(){return wr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},wr.apply(this,arguments)}function El(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function mn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function sr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mn(Object(t),!0).forEach(function(n){Dl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):mn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Dl(r,e,t){return e=Ml(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ml(r){var e=Ol(r,"string");return typeof e=="symbol"?e:String(e)}function Ol(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function kl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,_r(r,e)}function _r(r,e){return _r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},_r(r,e)}var Fr=function(r){kl(e,r);function e(){for(var n,s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o))||this,n.handleRefs={},n.lastHandleRect=null,n.slack=null,n}var t=e.prototype;return t.componentWillUnmount=function(){this.resetData()},t.resetData=function(){this.lastHandleRect=this.slack=null},t.runConstraints=function(s,o){var a=this.props,l=a.minConstraints,c=a.maxConstraints,u=a.lockAspectRatio;if(!l&&!c&&!u)return[s,o];if(u){var h=this.props.width/this.props.height,m=s-this.props.width,y=o-this.props.height;Math.abs(m)>Math.abs(y*h)?o=s/h:s=o*h}var j=s,M=o,_=this.slack||[0,0],C=_[0],S=_[1];return s+=C,o+=S,l&&(s=Math.max(l[0],s),o=Math.max(l[1],o)),c&&(s=Math.min(c[0],s),o=Math.min(c[1],o)),this.slack=[C+(j-s),S+(M-o)],[s,o]},t.resizeHandler=function(s,o){var a=this;return function(l,c){var u=c.node,h=c.deltaX,m=c.deltaY;s==="onResizeStart"&&a.resetData();var y=(a.props.axis==="both"||a.props.axis==="x")&&o!=="n"&&o!=="s",j=(a.props.axis==="both"||a.props.axis==="y")&&o!=="e"&&o!=="w";if(!(!y&&!j)){var M=o[0],_=o[o.length-1],C=u.getBoundingClientRect();if(a.lastHandleRect!=null){if(_==="w"){var S=C.left-a.lastHandleRect.left;h+=S}if(M==="n"){var D=C.top-a.lastHandleRect.top;m+=D}}a.lastHandleRect=C,_==="w"&&(h=-h),M==="n"&&(m=-m);var x=a.props.width+(y?h/a.props.transformScale:0),g=a.props.height+(j?m/a.props.transformScale:0),p=a.runConstraints(x,g);x=p[0],g=p[1];var v=x!==a.props.width||g!==a.props.height,P=typeof a.props[s]=="function"?a.props[s]:null,b=s==="onResize"&&!v;P&&!b&&(l.persist==null||l.persist(),P(l,{node:u,size:{width:x,height:g},handle:o})),s==="onResizeStop"&&a.resetData()}}},t.renderResizeHandle=function(s,o){var a=this.props.handle;if(!a)return nt.createElement("span",{className:"react-resizable-handle react-resizable-handle-"+s,ref:o});if(typeof a=="function")return a(s,o);var l=typeof a.type=="string",c=sr({ref:o},l?{}:{handleAxis:s});return nt.cloneElement(a,c)},t.render=function(){var s=this,o=this.props,a=o.children,l=o.className,c=o.draggableOpts;o.width,o.height,o.handle,o.handleSize,o.lockAspectRatio,o.axis,o.minConstraints,o.maxConstraints,o.onResize,o.onResizeStop,o.onResizeStart;var u=o.resizeHandles;o.transformScale;var h=El(o,Rl);return(0,jl.cloneElement)(a,sr(sr({},h),{},{className:(l?l+" ":"")+"react-resizable",children:[].concat(a.props.children,u.map(function(m){var y,j=(y=s.handleRefs[m])!=null?y:s.handleRefs[m]=nt.createRef();return nt.createElement(Sl.DraggableCore,wr({},c,{nodeRef:j,key:"resizableHandle-"+m,onStop:s.resizeHandler("onResizeStop",m),onStart:s.resizeHandler("onResizeStart",m),onDrag:s.resizeHandler("onResize",m)}),s.renderResizeHandle(m,j))}))}))},e}(nt.Component);ct.default=Fr;Fr.propTypes=Pl.resizableProps;Fr.defaultProps={axis:"both",handleSize:[20,20],lockAspectRatio:!1,minConstraints:[20,20],maxConstraints:[1/0,1/0],resizeHandles:["se"],transformScale:1};var Bt={};Bt.__esModule=!0;Bt.default=void 0;var or=Al(f),Il=xs(qe),zl=xs(ct),Nl=ut,Tl=["handle","handleSize","onResize","onResizeStart","onResizeStop","draggableOpts","minConstraints","maxConstraints","lockAspectRatio","axis","width","height","resizeHandles","style","transformScale"];function xs(r){return r&&r.__esModule?r:{default:r}}function ws(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(ws=function(s){return s?t:e})(r)}function Al(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=ws(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in r)if(o!=="default"&&Object.prototype.hasOwnProperty.call(r,o)){var a=s?Object.getOwnPropertyDescriptor(r,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=r[o]}return n.default=r,t&&t.set(r,n),n}function Sr(){return Sr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Sr.apply(this,arguments)}function gn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function wt(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gn(Object(t),!0).forEach(function(n){Ll(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):gn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Ll(r,e,t){return e=ql(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ql(r){var e=Wl(r,"string");return typeof e=="symbol"?e:String(e)}function Wl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function $l(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Bl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,jr(r,e)}function jr(r,e){return jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},jr(r,e)}var _s=function(r){Bl(e,r);function e(){for(var n,s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o))||this,n.state={width:n.props.width,height:n.props.height,propsWidth:n.props.width,propsHeight:n.props.height},n.onResize=function(l,c){var u=c.size;n.props.onResize?(l.persist==null||l.persist(),n.setState(u,function(){return n.props.onResize&&n.props.onResize(l,c)})):n.setState(u)},n}e.getDerivedStateFromProps=function(s,o){return o.propsWidth!==s.width||o.propsHeight!==s.height?{width:s.width,height:s.height,propsWidth:s.width,propsHeight:s.height}:null};var t=e.prototype;return t.render=function(){var s=this.props,o=s.handle,a=s.handleSize;s.onResize;var l=s.onResizeStart,c=s.onResizeStop,u=s.draggableOpts,h=s.minConstraints,m=s.maxConstraints,y=s.lockAspectRatio,j=s.axis;s.width,s.height;var M=s.resizeHandles,_=s.style,C=s.transformScale,S=$l(s,Tl);return or.createElement(zl.default,{axis:j,draggableOpts:u,handle:o,handleSize:a,height:this.state.height,lockAspectRatio:y,maxConstraints:m,minConstraints:h,onResizeStart:l,onResize:this.onResize,onResizeStop:c,resizeHandles:M,transformScale:C,width:this.state.width},or.createElement("div",Sr({},S,{style:wt(wt({},_),{},{width:this.state.width+"px",height:this.state.height+"px"})})))},e}(or.Component);Bt.default=_s;_s.propTypes=wt(wt({},Nl.resizableProps),{},{children:Il.default.element});$t.exports=function(){throw new Error("Don't instantiate Resizable directly! Use require('react-resizable').Resizable")};$t.exports.Resizable=ct.default;$t.exports.ResizableBox=Bt.default;var Hl=$t.exports,ze={};Object.defineProperty(ze,"__esModule",{value:!0});ze.resizeHandleType=ze.resizeHandleAxesType=ze.default=void 0;var $=Ss(qe),Ul=Ss(f);function Ss(r){return r&&r.__esModule?r:{default:r}}const Fl=ze.resizeHandleAxesType=$.default.arrayOf($.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),Gl=ze.resizeHandleType=$.default.oneOfType([$.default.node,$.default.func]);ze.default={className:$.default.string,style:$.default.object,width:$.default.number,autoSize:$.default.bool,cols:$.default.number,draggableCancel:$.default.string,draggableHandle:$.default.string,verticalCompact:function(r){r.verticalCompact},compactType:$.default.oneOf(["vertical","horizontal"]),layout:function(r){var e=r.layout;e!==void 0&&F.validateLayout(e,"layout")},margin:$.default.arrayOf($.default.number),containerPadding:$.default.arrayOf($.default.number),rowHeight:$.default.number,maxRows:$.default.number,isBounded:$.default.bool,isDraggable:$.default.bool,isResizable:$.default.bool,allowOverlap:$.default.bool,preventCollision:$.default.bool,useCSSTransforms:$.default.bool,transformScale:$.default.number,isDroppable:$.default.bool,resizeHandles:Fl,resizeHandle:Gl,onLayoutChange:$.default.func,onDragStart:$.default.func,onDrag:$.default.func,onDragStop:$.default.func,onResizeStart:$.default.func,onResize:$.default.func,onResizeStop:$.default.func,onDrop:$.default.func,droppingItem:$.default.shape({i:$.default.string.isRequired,w:$.default.number.isRequired,h:$.default.number.isRequired}),children:function(r,e){const t=r[e],n={};Ul.default.Children.forEach(t,function(s){if(s?.key!=null){if(n[s.key])throw new Error('Duplicate child key "'+s.key+'" found! This will cause problems in ReactGridLayout.');n[s.key]=!0}})},innerRef:$.default.any};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.default=void 0;var Ye=Gr(f),yn=Rt,V=Gr(qe),Vl=bs,Yl=Hl,Ke=F,ue=Ee,bn=ze,Kl=Gr(Ct);function Gr(r){return r&&r.__esModule?r:{default:r}}function Ce(r,e,t){return(e=Xl(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Xl(r){var e=Ql(r,"string");return typeof e=="symbol"?e:e+""}function Ql(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}class Vr extends Ye.default.Component{constructor(){super(...arguments),Ce(this,"state",{resizing:null,dragging:null,className:""}),Ce(this,"elementRef",Ye.default.createRef()),Ce(this,"onDragStart",(e,t)=>{let{node:n}=t;const{onDragStart:s,transformScale:o}=this.props;if(!s)return;const a={top:0,left:0},{offsetParent:l}=n;if(!l)return;const c=l.getBoundingClientRect(),u=n.getBoundingClientRect(),h=u.left/o,m=c.left/o,y=u.top/o,j=c.top/o;a.left=h-m+l.scrollLeft,a.top=y-j+l.scrollTop,this.setState({dragging:a});const{x:M,y:_}=(0,ue.calcXY)(this.getPositionParams(),a.top,a.left,this.props.w,this.props.h);return s.call(this,this.props.i,M,_,{e,node:n,newPosition:a})}),Ce(this,"onDrag",(e,t,n)=>{let{node:s,deltaX:o,deltaY:a}=t;const{onDrag:l}=this.props;if(!l)return;if(!this.state.dragging)throw new Error("onDrag called before onDragStart.");let c=this.state.dragging.top+a,u=this.state.dragging.left+o;const{isBounded:h,i:m,w:y,h:j,containerWidth:M}=this.props,_=this.getPositionParams();if(h){const{offsetParent:x}=s;if(x){const{margin:g,rowHeight:p}=this.props,v=x.clientHeight-(0,ue.calcGridItemWHPx)(j,p,g[1]);c=(0,ue.clamp)(c,0,v);const P=(0,ue.calcGridColWidth)(_),b=M-(0,ue.calcGridItemWHPx)(y,P,g[0]);u=(0,ue.clamp)(u,0,b)}}const C={top:c,left:u};n?this.setState({dragging:C}):(0,yn.flushSync)(()=>{this.setState({dragging:C})});const{x:S,y:D}=(0,ue.calcXY)(_,c,u,y,j);return l.call(this,m,S,D,{e,node:s,newPosition:C})}),Ce(this,"onDragStop",(e,t)=>{let{node:n}=t;const{onDragStop:s}=this.props;if(!s)return;if(!this.state.dragging)throw new Error("onDragEnd called before onDragStart.");const{w:o,h:a,i:l}=this.props,{left:c,top:u}=this.state.dragging,h={top:u,left:c};this.setState({dragging:null});const{x:m,y}=(0,ue.calcXY)(this.getPositionParams(),u,c,o,a);return s.call(this,l,m,y,{e,node:n,newPosition:h})}),Ce(this,"onResizeStop",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStop")),Ce(this,"onResizeStart",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStart")),Ce(this,"onResize",(e,t,n)=>this.onResizeHandler(e,t,n,"onResize"))}shouldComponentUpdate(e,t){if(this.props.children!==e.children||this.props.droppingPosition!==e.droppingPosition)return!0;const n=(0,ue.calcGridItemPosition)(this.getPositionParams(this.props),this.props.x,this.props.y,this.props.w,this.props.h,this.state),s=(0,ue.calcGridItemPosition)(this.getPositionParams(e),e.x,e.y,e.w,e.h,t);return!(0,Ke.fastPositionEqual)(n,s)||this.props.useCSSTransforms!==e.useCSSTransforms}componentDidMount(){this.moveDroppingItem({})}componentDidUpdate(e){this.moveDroppingItem(e)}moveDroppingItem(e){const{droppingPosition:t}=this.props;if(!t)return;const n=this.elementRef.current;if(!n)return;const s=e.droppingPosition||{left:0,top:0},{dragging:o}=this.state,a=o&&t.left!==s.left||t.top!==s.top;if(!o)this.onDragStart(t.e,{node:n,deltaX:t.left,deltaY:t.top});else if(a){const l=t.left-o.left,c=t.top-o.top;this.onDrag(t.e,{node:n,deltaX:l,deltaY:c},!0)}}getPositionParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props;return{cols:e.cols,containerPadding:e.containerPadding,containerWidth:e.containerWidth,margin:e.margin,maxRows:e.maxRows,rowHeight:e.rowHeight}}createStyle(e){const{usePercentages:t,containerWidth:n,useCSSTransforms:s}=this.props;let o;return s?o=(0,Ke.setTransform)(e):(o=(0,Ke.setTopLeft)(e),t&&(o.left=(0,Ke.perc)(e.left/n),o.width=(0,Ke.perc)(e.width/n))),o}mixinDraggable(e,t){return Ye.default.createElement(Vl.DraggableCore,{disabled:!t,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,handle:this.props.handle,cancel:".react-resizable-handle"+(this.props.cancel?","+this.props.cancel:""),scale:this.props.transformScale,nodeRef:this.elementRef},e)}curryResizeHandler(e,t){return(n,s)=>t(n,s,e)}mixinResizable(e,t,n){const{cols:s,minW:o,minH:a,maxW:l,maxH:c,transformScale:u,resizeHandles:h,resizeHandle:m}=this.props,y=this.getPositionParams(),j=(0,ue.calcGridItemPosition)(y,0,0,s,0).width,M=(0,ue.calcGridItemPosition)(y,0,0,o,a),_=(0,ue.calcGridItemPosition)(y,0,0,l,c),C=[M.width,M.height],S=[Math.min(_.width,j),Math.min(_.height,1/0)];return Ye.default.createElement(Yl.Resizable,{draggableOpts:{disabled:!n},className:n?void 0:"react-resizable-hide",width:t.width,height:t.height,minConstraints:C,maxConstraints:S,onResizeStop:this.curryResizeHandler(t,this.onResizeStop),onResizeStart:this.curryResizeHandler(t,this.onResizeStart),onResize:this.curryResizeHandler(t,this.onResize),transformScale:u,resizeHandles:h,handle:m},e)}onResizeHandler(e,t,n,s){let{node:o,size:a,handle:l}=t;const c=this.props[s];if(!c)return;const{x:u,y:h,i:m,maxH:y,minH:j,containerWidth:M}=this.props,{minW:_,maxW:C}=this.props;let S=a;o&&(S=(0,Ke.resizeItemInDirection)(l,n,a,M),(0,yn.flushSync)(()=>{this.setState({resizing:s==="onResizeStop"?null:S})}));let{w:D,h:x}=(0,ue.calcWH)(this.getPositionParams(),S.width,S.height,u,h,l);D=(0,ue.clamp)(D,Math.max(_,1),C),x=(0,ue.clamp)(x,j,y),c.call(this,m,D,x,{e,node:o,size:S,handle:l})}render(){const{x:e,y:t,w:n,h:s,isDraggable:o,isResizable:a,droppingPosition:l,useCSSTransforms:c}=this.props,u=(0,ue.calcGridItemPosition)(this.getPositionParams(),e,t,n,s,this.state),h=Ye.default.Children.only(this.props.children);let m=Ye.default.cloneElement(h,{ref:this.elementRef,className:(0,Kl.default)("react-grid-item",h.props.className,this.props.className,{static:this.props.static,resizing:!!this.state.resizing,"react-draggable":o,"react-draggable-dragging":!!this.state.dragging,dropping:!!l,cssTransforms:c}),style:{...this.props.style,...h.props.style,...this.createStyle(u)}});return m=this.mixinResizable(m,u,a),m=this.mixinDraggable(m,o),m}}Tt.default=Vr;Ce(Vr,"propTypes",{children:V.default.element,cols:V.default.number.isRequired,containerWidth:V.default.number.isRequired,rowHeight:V.default.number.isRequired,margin:V.default.array.isRequired,maxRows:V.default.number.isRequired,containerPadding:V.default.array.isRequired,x:V.default.number.isRequired,y:V.default.number.isRequired,w:V.default.number.isRequired,h:V.default.number.isRequired,minW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minWidth not Number");if(t>r.w||t>r.maxW)return new Error("minWidth larger than item width/maxWidth")},maxW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxWidth not Number");if(t<r.w||t<r.minW)return new Error("maxWidth smaller than item width/minWidth")},minH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minHeight not Number");if(t>r.h||t>r.maxH)return new Error("minHeight larger than item height/maxHeight")},maxH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxHeight not Number");if(t<r.h||t<r.minH)return new Error("maxHeight smaller than item height/minHeight")},i:V.default.string.isRequired,resizeHandles:bn.resizeHandleAxesType,resizeHandle:bn.resizeHandleType,onDragStop:V.default.func,onDragStart:V.default.func,onDrag:V.default.func,onResizeStop:V.default.func,onResizeStart:V.default.func,onResize:V.default.func,isDraggable:V.default.bool.isRequired,isResizable:V.default.bool.isRequired,isBounded:V.default.bool.isRequired,static:V.default.bool,useCSSTransforms:V.default.bool.isRequired,transformScale:V.default.number,className:V.default.string,handle:V.default.string,cancel:V.default.string,droppingPosition:V.default.shape({e:V.default.object.isRequired,left:V.default.number.isRequired,top:V.default.number.isRequired})});Ce(Vr,"defaultProps",{className:"",cancel:"",handle:"",minH:1,minW:1,maxH:1/0,maxW:1/0,transformScale:1});Object.defineProperty(lt,"__esModule",{value:!0});lt.default=void 0;var We=js(f),ir=Or,Jl=Yr(Ct),T=F,Zl=Ee,vn=Yr(Tt),ec=Yr(ze);function Yr(r){return r&&r.__esModule?r:{default:r}}function js(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(js=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function he(r,e,t){return(e=tc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function tc(r){var e=rc(r,"string");return typeof e=="symbol"?e:e+""}function rc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const xn="react-grid-layout";let Ps=!1;try{Ps=/firefox/i.test(navigator.userAgent)}catch{}class Ht extends We.Component{constructor(){super(...arguments),he(this,"state",{activeDrag:null,layout:(0,T.synchronizeLayoutWithChildren)(this.props.layout,this.props.children,this.props.cols,(0,T.compactType)(this.props),this.props.allowOverlap),mounted:!1,oldDragItem:null,oldLayout:null,oldResizeItem:null,resizing:!1,droppingDOMNode:null,children:[]}),he(this,"dragEnterCounter",0),he(this,"onDragStart",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l}=this.state,c=(0,T.getLayoutItem)(l,e);if(!c)return;const u={w:c.w,h:c.h,x:c.x,y:c.y,placeholder:!0,i:e};return this.setState({oldDragItem:(0,T.cloneLayoutItem)(c),oldLayout:l,activeDrag:u}),this.props.onDragStart(l,c,c,null,o,a)}),he(this,"onDrag",(e,t,n,s)=>{let{e:o,node:a}=s;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,allowOverlap:h,preventCollision:m}=this.props,y=(0,T.getLayoutItem)(c,e);if(!y)return;const j={w:y.w,h:y.h,x:y.x,y:y.y,placeholder:!0,i:e};c=(0,T.moveElement)(c,y,t,n,!0,m,(0,T.compactType)(this.props),u,h),this.props.onDrag(c,l,y,j,o,a),this.setState({layout:h?c:(0,T.compact)(c,(0,T.compactType)(this.props),u),activeDrag:j})}),he(this,"onDragStop",(e,t,n,s)=>{let{e:o,node:a}=s;if(!this.state.activeDrag)return;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,preventCollision:h,allowOverlap:m}=this.props,y=(0,T.getLayoutItem)(c,e);if(!y)return;c=(0,T.moveElement)(c,y,t,n,!0,h,(0,T.compactType)(this.props),u,m);const M=m?c:(0,T.compact)(c,(0,T.compactType)(this.props),u);this.props.onDragStop(M,l,y,null,o,a);const{oldLayout:_}=this.state;this.setState({activeDrag:null,layout:M,oldDragItem:null,oldLayout:null}),this.onLayoutMaybeChanged(M,_)}),he(this,"onResizeStart",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l}=this.state,c=(0,T.getLayoutItem)(l,e);c&&(this.setState({oldResizeItem:(0,T.cloneLayoutItem)(c),oldLayout:this.state.layout,resizing:!0}),this.props.onResizeStart(l,c,c,null,o,a))}),he(this,"onResize",(e,t,n,s)=>{let{e:o,node:a,size:l,handle:c}=s;const{oldResizeItem:u}=this.state,{layout:h}=this.state,{cols:m,preventCollision:y,allowOverlap:j}=this.props;let M=!1,_,C,S;const[D,x]=(0,T.withLayoutItem)(h,e,p=>{let v;return C=p.x,S=p.y,["sw","w","nw","n","ne"].indexOf(c)!==-1&&(["sw","nw","w"].indexOf(c)!==-1&&(C=p.x+(p.w-t),t=p.x!==C&&C<0?p.w:t,C=C<0?0:C),["ne","n","nw"].indexOf(c)!==-1&&(S=p.y+(p.h-n),n=p.y!==S&&S<0?p.h:n,S=S<0?0:S),M=!0),y&&!j&&(v=(0,T.getAllCollisions)(h,{...p,w:t,h:n,x:C,y:S}).filter(b=>b.i!==p.i).length>0,v&&(S=p.y,n=p.h,C=p.x,t=p.w,M=!1)),p.w=t,p.h=n,p});if(!x)return;_=D,M&&(_=(0,T.moveElement)(D,x,C,S,!0,this.props.preventCollision,(0,T.compactType)(this.props),m,j));const g={w:x.w,h:x.h,x:x.x,y:x.y,static:!0,i:e};this.props.onResize(_,u,x,g,o,a),this.setState({layout:j?_:(0,T.compact)(_,(0,T.compactType)(this.props),m),activeDrag:g})}),he(this,"onResizeStop",(e,t,n,s)=>{let{e:o,node:a}=s;const{layout:l,oldResizeItem:c}=this.state,{cols:u,allowOverlap:h}=this.props,m=(0,T.getLayoutItem)(l,e),y=h?l:(0,T.compact)(l,(0,T.compactType)(this.props),u);this.props.onResizeStop(y,c,m,null,o,a);const{oldLayout:j}=this.state;this.setState({activeDrag:null,layout:y,oldResizeItem:null,oldLayout:null,resizing:!1}),this.onLayoutMaybeChanged(y,j)}),he(this,"onDragOver",e=>{if(e.preventDefault(),e.stopPropagation(),Ps&&!e.nativeEvent.target?.classList.contains(xn))return!1;const{droppingItem:t,onDropDragOver:n,margin:s,cols:o,rowHeight:a,maxRows:l,width:c,containerPadding:u,transformScale:h}=this.props,m=n?.(e);if(m===!1)return this.state.droppingDOMNode&&this.removeDroppingPlaceholder(),!1;const y={...t,...m},{layout:j}=this.state,M=e.currentTarget.getBoundingClientRect(),_=e.clientX-M.left,C=e.clientY-M.top,S={left:_/h,top:C/h,e};if(this.state.droppingDOMNode){if(this.state.droppingPosition){const{left:D,top:x}=this.state.droppingPosition;(D!=_||x!=C)&&this.setState({droppingPosition:S})}}else{const D={cols:o,margin:s,maxRows:l,rowHeight:a,containerWidth:c,containerPadding:u||s},x=(0,Zl.calcXY)(D,C,_,y.w,y.h);this.setState({droppingDOMNode:We.createElement("div",{key:y.i}),droppingPosition:S,layout:[...j,{...y,x:x.x,y:x.y,static:!1,isDraggable:!0}]})}}),he(this,"removeDroppingPlaceholder",()=>{const{droppingItem:e,cols:t}=this.props,{layout:n}=this.state,s=(0,T.compact)(n.filter(o=>o.i!==e.i),(0,T.compactType)(this.props),t,this.props.allowOverlap);this.setState({layout:s,droppingDOMNode:null,activeDrag:null,droppingPosition:void 0})}),he(this,"onDragLeave",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter--,this.dragEnterCounter===0&&this.removeDroppingPlaceholder()}),he(this,"onDragEnter",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter++}),he(this,"onDrop",e=>{e.preventDefault(),e.stopPropagation();const{droppingItem:t}=this.props,{layout:n}=this.state,s=n.find(o=>o.i===t.i);this.dragEnterCounter=0,this.removeDroppingPlaceholder(),this.props.onDrop(n,s,e)})}componentDidMount(){this.setState({mounted:!0}),this.onLayoutMaybeChanged(this.state.layout,this.props.layout)}static getDerivedStateFromProps(e,t){let n;return t.activeDrag?null:(!(0,ir.deepEqual)(e.layout,t.propsLayout)||e.compactType!==t.compactType?n=e.layout:(0,T.childrenEqual)(e.children,t.children)||(n=t.layout),n?{layout:(0,T.synchronizeLayoutWithChildren)(n,e.children,e.cols,(0,T.compactType)(e),e.allowOverlap),compactType:e.compactType,children:e.children,propsLayout:e.layout}:null)}shouldComponentUpdate(e,t){return this.props.children!==e.children||!(0,T.fastRGLPropsEqual)(this.props,e,ir.deepEqual)||this.state.activeDrag!==t.activeDrag||this.state.mounted!==t.mounted||this.state.droppingPosition!==t.droppingPosition}componentDidUpdate(e,t){if(!this.state.activeDrag){const n=this.state.layout,s=t.layout;this.onLayoutMaybeChanged(n,s)}}containerHeight(){if(!this.props.autoSize)return;const e=(0,T.bottom)(this.state.layout),t=this.props.containerPadding?this.props.containerPadding[1]:this.props.margin[1];return e*this.props.rowHeight+(e-1)*this.props.margin[1]+t*2+"px"}onLayoutMaybeChanged(e,t){t||(t=this.state.layout),(0,ir.deepEqual)(t,e)||this.props.onLayoutChange(e)}placeholder(){const{activeDrag:e}=this.state;if(!e)return null;const{width:t,cols:n,margin:s,containerPadding:o,rowHeight:a,maxRows:l,useCSSTransforms:c,transformScale:u}=this.props;return We.createElement(vn.default,{w:e.w,h:e.h,x:e.x,y:e.y,i:e.i,className:`react-grid-placeholder ${this.state.resizing?"placeholder-resizing":""}`,containerWidth:t,cols:n,margin:s,containerPadding:o||s,maxRows:l,rowHeight:a,isDraggable:!1,isResizable:!1,isBounded:!1,useCSSTransforms:c,transformScale:u},We.createElement("div",null))}processGridItem(e,t){if(!e||!e.key)return;const n=(0,T.getLayoutItem)(this.state.layout,String(e.key));if(!n)return null;const{width:s,cols:o,margin:a,containerPadding:l,rowHeight:c,maxRows:u,isDraggable:h,isResizable:m,isBounded:y,useCSSTransforms:j,transformScale:M,draggableCancel:_,draggableHandle:C,resizeHandles:S,resizeHandle:D}=this.props,{mounted:x,droppingPosition:g}=this.state,p=typeof n.isDraggable=="boolean"?n.isDraggable:!n.static&&h,v=typeof n.isResizable=="boolean"?n.isResizable:!n.static&&m,P=n.resizeHandles||S,b=p&&y&&n.isBounded!==!1;return We.createElement(vn.default,{containerWidth:s,cols:o,margin:a,containerPadding:l||a,maxRows:u,rowHeight:c,cancel:_,handle:C,onDragStop:this.onDragStop,onDragStart:this.onDragStart,onDrag:this.onDrag,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,isDraggable:p,isResizable:v,isBounded:b,useCSSTransforms:j&&x,usePercentages:!x,transformScale:M,w:n.w,h:n.h,x:n.x,y:n.y,i:n.i,minH:n.minH,minW:n.minW,maxH:n.maxH,maxW:n.maxW,static:n.static,droppingPosition:t?g:void 0,resizeHandles:P,resizeHandle:D},e)}render(){const{className:e,style:t,isDroppable:n,innerRef:s}=this.props,o=(0,Jl.default)(xn,e),a={height:this.containerHeight(),...t};return We.createElement("div",{ref:s,className:o,style:a,onDrop:n?this.onDrop:T.noop,onDragLeave:n?this.onDragLeave:T.noop,onDragEnter:n?this.onDragEnter:T.noop,onDragOver:n?this.onDragOver:T.noop},We.Children.map(this.props.children,l=>this.processGridItem(l)),n&&this.state.droppingDOMNode&&this.processGridItem(this.state.droppingDOMNode,!0),this.placeholder())}}lt.default=Ht;he(Ht,"displayName","ReactGridLayout");he(Ht,"propTypes",ec.default);he(Ht,"defaultProps",{autoSize:!0,cols:12,className:"",style:{},draggableHandle:"",draggableCancel:"",containerPadding:null,rowHeight:150,maxRows:1/0,layout:[],margin:[10,10],isBounded:!1,isDraggable:!0,isResizable:!0,allowOverlap:!1,isDroppable:!1,useCSSTransforms:!0,transformScale:1,verticalCompact:!0,compactType:"vertical",preventCollision:!1,droppingItem:{i:"__dropping-elem__",h:1,w:1},resizeHandles:["se"],onLayoutChange:T.noop,onDragStart:T.noop,onDrag:T.noop,onDragStop:T.noop,onResizeStart:T.noop,onResize:T.noop,onResizeStop:T.noop,onDrop:T.noop,onDropDragOver:T.noop});var Ut={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.findOrGenerateResponsiveLayout=oc;Ge.getBreakpointFromWidth=nc;Ge.getColsFromBreakpoint=sc;Ge.sortBreakpoints=Kr;var pt=F;function nc(r,e){const t=Kr(r);let n=t[0];for(let s=1,o=t.length;s<o;s++){const a=t[s];e>r[a]&&(n=a)}return n}function sc(r,e){if(!e[r])throw new Error("ResponsiveReactGridLayout: `cols` entry for breakpoint "+r+" is missing!");return e[r]}function oc(r,e,t,n,s,o){if(r[t])return(0,pt.cloneLayout)(r[t]);let a=r[n];const l=Kr(e),c=l.slice(l.indexOf(t));for(let u=0,h=c.length;u<h;u++){const m=c[u];if(r[m]){a=r[m];break}}return a=(0,pt.cloneLayout)(a||[]),(0,pt.compact)((0,pt.correctBounds)(a,{cols:s}),o,s)}function Kr(r){return Object.keys(r).sort(function(t,n){return r[t]-r[n]})}Object.defineProperty(Ut,"__esModule",{value:!0});Ut.default=void 0;var wn=Cs(f),ve=Rs(qe),ar=Or,Je=F,$e=Ge,ic=Rs(lt);function Rs(r){return r&&r.__esModule?r:{default:r}}function Cs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Cs=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function Pr(){return Pr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Pr.apply(null,arguments)}function _t(r,e,t){return(e=ac(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ac(r){var e=lc(r,"string");return typeof e=="symbol"?e:e+""}function lc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const _n=r=>Object.prototype.toString.call(r);function mt(r,e){return r==null?null:Array.isArray(r)?r:r[e]}class Xr extends wn.Component{constructor(){super(...arguments),_t(this,"state",this.generateInitialState()),_t(this,"onLayoutChange",e=>{this.props.onLayoutChange(e,{...this.props.layouts,[this.state.breakpoint]:e})})}generateInitialState(){const{width:e,breakpoints:t,layouts:n,cols:s}=this.props,o=(0,$e.getBreakpointFromWidth)(t,e),a=(0,$e.getColsFromBreakpoint)(o,s),l=this.props.verticalCompact===!1?null:this.props.compactType;return{layout:(0,$e.findOrGenerateResponsiveLayout)(n,t,o,o,a,l),breakpoint:o,cols:a}}static getDerivedStateFromProps(e,t){if(!(0,ar.deepEqual)(e.layouts,t.layouts)){const{breakpoint:n,cols:s}=t;return{layout:(0,$e.findOrGenerateResponsiveLayout)(e.layouts,e.breakpoints,n,n,s,e.compactType),layouts:e.layouts}}return null}componentDidUpdate(e){(this.props.width!=e.width||this.props.breakpoint!==e.breakpoint||!(0,ar.deepEqual)(this.props.breakpoints,e.breakpoints)||!(0,ar.deepEqual)(this.props.cols,e.cols))&&this.onWidthChange(e)}onWidthChange(e){const{breakpoints:t,cols:n,layouts:s,compactType:o}=this.props,a=this.props.breakpoint||(0,$e.getBreakpointFromWidth)(this.props.breakpoints,this.props.width),l=this.state.breakpoint,c=(0,$e.getColsFromBreakpoint)(a,n),u={...s};if(l!==a||e.breakpoints!==t||e.cols!==n){l in u||(u[l]=(0,Je.cloneLayout)(this.state.layout));let y=(0,$e.findOrGenerateResponsiveLayout)(u,t,a,l,c,o);y=(0,Je.synchronizeLayoutWithChildren)(y,this.props.children,c,o,this.props.allowOverlap),u[a]=y,this.props.onBreakpointChange(a,c),this.props.onLayoutChange(y,u),this.setState({breakpoint:a,layout:y,cols:c})}const h=mt(this.props.margin,a),m=mt(this.props.containerPadding,a);this.props.onWidthChange(this.props.width,h,c,m)}render(){const{breakpoint:e,breakpoints:t,cols:n,layouts:s,margin:o,containerPadding:a,onBreakpointChange:l,onLayoutChange:c,onWidthChange:u,...h}=this.props;return wn.createElement(ic.default,Pr({},h,{margin:mt(o,this.state.breakpoint),containerPadding:mt(a,this.state.breakpoint),onLayoutChange:this.onLayoutChange,layout:this.state.layout,cols:this.state.cols}))}}Ut.default=Xr;_t(Xr,"propTypes",{breakpoint:ve.default.string,breakpoints:ve.default.object,allowOverlap:ve.default.bool,cols:ve.default.object,margin:ve.default.oneOfType([ve.default.array,ve.default.object]),containerPadding:ve.default.oneOfType([ve.default.array,ve.default.object]),layouts(r,e){if(_n(r[e])!=="[object Object]")throw new Error("Layout property must be an object. Received: "+_n(r[e]));Object.keys(r[e]).forEach(t=>{if(!(t in r.breakpoints))throw new Error("Each key in layouts must align with a key in breakpoints.");(0,Je.validateLayout)(r.layouts[t],"layouts."+t)})},width:ve.default.number.isRequired,onBreakpointChange:ve.default.func,onLayoutChange:ve.default.func,onWidthChange:ve.default.func});_t(Xr,"defaultProps",{breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},containerPadding:{lg:null,md:null,sm:null,xs:null,xxs:null},layouts:{},margin:[10,10],allowOverlap:!1,onBreakpointChange:Je.noop,onLayoutChange:Je.noop,onWidthChange:Je.noop});var Qr={},Es=function(){if(typeof Map<"u")return Map;function r(e,t){var n=-1;return e.some(function(s,o){return s[0]===t?(n=o,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var n=r(this.__entries__,t),s=this.__entries__[n];return s&&s[1]},e.prototype.set=function(t,n){var s=r(this.__entries__,t);~s?this.__entries__[s][1]=n:this.__entries__.push([t,n])},e.prototype.delete=function(t){var n=this.__entries__,s=r(n,t);~s&&n.splice(s,1)},e.prototype.has=function(t){return!!~r(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,n){n===void 0&&(n=null);for(var s=0,o=this.__entries__;s<o.length;s++){var a=o[s];t.call(n,a[1],a[0])}},e}()}(),Rr=typeof window<"u"&&typeof document<"u"&&window.document===document,St=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),cc=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(St):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),uc=2;function dc(r,e){var t=!1,n=!1,s=0;function o(){t&&(t=!1,r()),n&&l()}function a(){cc(o)}function l(){var c=Date.now();if(t){if(c-s<uc)return;n=!0}else t=!0,n=!1,setTimeout(a,e);s=c}return l}var fc=20,hc=["top","right","bottom","left","width","height","size","weight"],pc=typeof MutationObserver<"u",mc=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=dc(this.refresh.bind(this),fc)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!Rr||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),pc?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!Rr||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=t===void 0?"":t,s=hc.some(function(o){return!!~n.indexOf(o)});s&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),Ds=function(r,e){for(var t=0,n=Object.keys(e);t<n.length;t++){var s=n[t];Object.defineProperty(r,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return r},et=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||St},Ms=Ft(0,0,0,0);function jt(r){return parseFloat(r)||0}function Sn(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(n,s){var o=r["border-"+s+"-width"];return n+jt(o)},0)}function gc(r){for(var e=["top","right","bottom","left"],t={},n=0,s=e;n<s.length;n++){var o=s[n],a=r["padding-"+o];t[o]=jt(a)}return t}function yc(r){var e=r.getBBox();return Ft(0,0,e.width,e.height)}function bc(r){var e=r.clientWidth,t=r.clientHeight;if(!e&&!t)return Ms;var n=et(r).getComputedStyle(r),s=gc(n),o=s.left+s.right,a=s.top+s.bottom,l=jt(n.width),c=jt(n.height);if(n.boxSizing==="border-box"&&(Math.round(l+o)!==e&&(l-=Sn(n,"left","right")+o),Math.round(c+a)!==t&&(c-=Sn(n,"top","bottom")+a)),!xc(r)){var u=Math.round(l+o)-e,h=Math.round(c+a)-t;Math.abs(u)!==1&&(l-=u),Math.abs(h)!==1&&(c-=h)}return Ft(s.left,s.top,l,c)}var vc=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof et(r).SVGGraphicsElement}:function(r){return r instanceof et(r).SVGElement&&typeof r.getBBox=="function"}}();function xc(r){return r===et(r).document.documentElement}function wc(r){return Rr?vc(r)?yc(r):bc(r):Ms}function _c(r){var e=r.x,t=r.y,n=r.width,s=r.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,a=Object.create(o.prototype);return Ds(a,{x:e,y:t,width:n,height:s,top:t,right:e+n,bottom:s+t,left:e}),a}function Ft(r,e,t,n){return{x:r,y:e,width:t,height:n}}var Sc=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Ft(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=wc(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),jc=function(){function r(e,t){var n=_c(t);Ds(this,{target:e,contentRect:n})}return r}(),Pc=function(){function r(e,t,n){if(this.activeObservations_=[],this.observations_=new Es,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Sc(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new jc(n.target,n.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),Os=typeof WeakMap<"u"?new WeakMap:new Es,ks=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=mc.getInstance(),n=new Pc(e,t,this);Os.set(this,n)}return r}();["observe","unobserve","disconnect"].forEach(function(r){ks.prototype[r]=function(){var e;return(e=Os.get(this))[r].apply(e,arguments)}});var Rc=function(){return typeof St.ResizeObserver<"u"?St.ResizeObserver:ks}();const Cc=Object.freeze(Object.defineProperty({__proto__:null,default:Rc},Symbol.toStringTag,{value:"Module"})),Ec=eo(Cc);Object.defineProperty(Qr,"__esModule",{value:!0});Qr.default=Nc;var gt=Is(f),Dc=Jr(qe),Mc=Jr(Ec),Oc=Jr(Ct);function Jr(r){return r&&r.__esModule?r:{default:r}}function Is(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Is=function(s,o){if(!o&&s&&s.__esModule)return s;var a,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(a=o?n:t){if(a.has(s))return a.get(s);a.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?a(c,u,l):c[u]=s[u]);return c})(r,e)}function Cr(){return Cr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Cr.apply(null,arguments)}function Xe(r,e,t){return(e=kc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function kc(r){var e=Ic(r,"string");return typeof e=="symbol"?e:e+""}function Ic(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const zc="react-grid-layout";function Nc(r){var e;return e=class extends gt.Component{constructor(){super(...arguments),Xe(this,"state",{width:1280}),Xe(this,"elementRef",gt.createRef()),Xe(this,"mounted",!1),Xe(this,"resizeObserver",void 0)}componentDidMount(){this.mounted=!0,this.resizeObserver=new Mc.default(s=>{if(this.elementRef.current instanceof HTMLElement){const a=s[0].contentRect.width;this.setState({width:a})}});const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.observe(n)}componentWillUnmount(){this.mounted=!1;const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.unobserve(n),this.resizeObserver.disconnect()}render(){const{measureBeforeMount:n,...s}=this.props;return n&&!this.mounted?gt.createElement("div",{className:(0,Oc.default)(this.props.className,zc),style:this.props.style,ref:this.elementRef}):gt.createElement(r,Cr({innerRef:this.elementRef},s,this.state))}},Xe(e,"defaultProps",{measureBeforeMount:!1}),Xe(e,"propTypes",{measureBeforeMount:Dc.default.bool}),e}(function(r){r.exports=lt.default,r.exports.utils=F,r.exports.calculateUtils=Ee,r.exports.Responsive=Ut.default,r.exports.Responsive.utils=Ge,r.exports.WidthProvider=Qr.default})(Qn);var jn=Qn.exports;const Tc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ac(r){return r==null?"":typeof r!="string"?String(r):r.replace(/[&<>"'`=\/]/g,e=>Tc[e])}function Zr(r,e={}){const{maxLength:t=1e4,trim:n=!0,normalizeWhitespace:s=!0}=e;if(r==null)return"";typeof r!="string"&&(r=String(r));let o=r;return o=o.replace(/\0/g,""),o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n&&(o=o.trim()),s&&(o=o.replace(/[ \t]+/g," ")),o.length>t&&(o=o.substring(0,t)),o}function Pt(r,e=255){return r==null?"":(typeof r!="string"&&(r=String(r)),Zr(r,{maxLength:e}).replace(/[\r\n]/g," ").replace(/\s+/g," ").trim())}function zs(r,e=1e4){return r==null?"":(typeof r!="string"&&(r=String(r)),Zr(r,{maxLength:e,normalizeWhitespace:!1}).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`).trim())}function Ns(r){return r?Pt(r,254).toLowerCase():""}function Gt(r,e={}){const{min:t=-1/0,max:n=1/0,decimals:s=2}=e;if(r==null||r==="")return null;let o=String(r).replace(/[^0-9.\-]/g,""),a=parseFloat(o);return isNaN(a)?null:(a=Math.max(t,Math.min(n,a)),a=Math.round(a*Math.pow(10,s))/Math.pow(10,s),a)}function Lc(r){const e=Gt(r,{min:0,decimals:2});return e!==null?Math.round(e*100)/100:null}function qc(r){const e=Gt(r,{min:0,max:24,decimals:1});return e===null?null:Math.round(e*2)/2}function Wc(r){return Gt(r,{min:0,max:100,decimals:1})}function $c(r){if(!r)return null;const e=String(r).trim();return/^(javascript|data|vbscript):/i.test(e)?null:/^(https?:\/\/|\/|#)/i.test(e)?e:`https://${e}`}function Bc(r,e={}){if(!r||typeof r!="object")return r;const t={...r};for(const[n,s]of Object.entries(e)){if(t[n]===void 0)continue;const{type:o="text",maxLength:a}=s;switch(o){case"singleLine":t[n]=Pt(t[n],a);break;case"multiLine":t[n]=zs(t[n],a);break;case"email":t[n]=Ns(t[n]);break;case"number":t[n]=Gt(t[n],s);break;case"currency":t[n]=Lc(t[n]);break;case"hours":t[n]=qc(t[n]);break;case"percentage":t[n]=Wc(t[n]);break;case"url":t[n]=$c(t[n]);break;case"html":t[n]=Ac(t[n]);break;default:t[n]=Zr(t[n],{maxLength:a})}}return t}const Hc={timesheet:{description:{type:"multiLine",maxLength:2e3},hours_worked:{type:"hours"}},expense:{reason:{type:"multiLine",maxLength:2e3},amount:{type:"currency"}},resource:{name:{type:"singleLine",maxLength:100},email:{type:"email"},role:{type:"singleLine",maxLength:100},notes:{type:"multiLine",maxLength:5e3}},partner:{name:{type:"singleLine",maxLength:200},contact_name:{type:"singleLine",maxLength:100},contact_email:{type:"email"},notes:{type:"multiLine",maxLength:5e3}},milestone:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},deliverable:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},kpi:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"number",decimals:2},actual_value:{type:"number",decimals:2}},qualityStandard:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"percentage"}}};function Pn(r,e){const t=Hc[r];return t?Bc(e,t):e}class Oe{constructor(e,t={}){this.tableName=e,this.supportsSoftDelete=t.supportsSoftDelete!==!1,this.sanitizeConfig=t.sanitizeConfig||null}getSoftDeleteFilter(){return this.supportsSoftDelete?"is_deleted.is.null,is_deleted.eq.false":null}async getAll(e,t={}){try{let n=w.from(this.tableName).select(t.select||"*").eq("project_id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter())),t.filters&&Array.isArray(t.filters)&&t.filters.forEach(a=>{const{column:l,operator:c,value:u}=a;switch(c){case"eq":n=n.eq(l,u);break;case"neq":n=n.neq(l,u);break;case"gt":n=n.gt(l,u);break;case"gte":n=n.gte(l,u);break;case"lt":n=n.lt(l,u);break;case"lte":n=n.lte(l,u);break;case"like":n=n.like(l,u);break;case"ilike":n=n.ilike(l,u);break;case"in":n=n.in(l,u);break;case"is":n=n.is(l,u);break;default:n=n.eq(l,u)}}),t.orderBy&&(n=n.order(t.orderBy.column,{ascending:t.orderBy.ascending??!0}));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getDeleted(e){if(!this.supportsSoftDelete)return[];try{const{data:t,error:n}=await w.from(this.tableName).select("*").eq("project_id",e).eq("is_deleted",!0).order("deleted_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async getById(e,t={}){try{let n=w.from(this.tableName).select(t.select||"*").eq("id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:o}=await n.single();if(o){if(o.code==="PGRST116")return null;throw o}return s}catch(n){throw n}}async create(e){try{if(!e.project_id)throw new Error("project_id is required");let t=e;this.sanitizeConfig&&(t=Pn(this.sanitizeConfig,e)),this.supportsSoftDelete&&(delete t.is_deleted,delete t.deleted_at,delete t.deleted_by);const{data:n,error:s}=await w.from(this.tableName).insert(t).select().single();if(s)throw s;return n}catch(t){throw t}}async update(e,t){try{let n=t;this.sanitizeConfig&&(n=Pn(this.sanitizeConfig,t));const s={...n,updated_at:new Date().toISOString()};delete s.is_deleted,delete s.deleted_at,delete s.deleted_by;const{data:o,error:a}=await w.from(this.tableName).update(s).eq("id",e).select().single();if(a)throw a;return o}catch(n){throw n}}async delete(e,t=null){try{if(this.supportsSoftDelete){const{error:n}=await w.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e);if(n)throw n}else{const{error:n}=await w.from(this.tableName).delete().eq("id",e);if(n)throw n}return!0}catch(n){throw n}}async hardDelete(e){try{const{error:t}=await w.from(this.tableName).delete().eq("id",e);if(t)throw t;return!0}catch(t){throw t}}async restore(e){if(!this.supportsSoftDelete)throw new Error("This entity does not support soft delete");try{const{data:t,error:n}=await w.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}catch(t){throw t}}async exists(e){try{let t=w.from(this.tableName).select("id",{count:"exact",head:!0}).eq("id",e);this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{count:n,error:s}=await t;if(s)throw s;return n>0}catch(t){throw t}}async count(e,t=[]){try{let n=w.from(this.tableName).select("id",{count:"exact",head:!0}).eq("project_id",e);this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.forEach(a=>{const{column:l,operator:c,value:u}=a;c==="eq"?n=n.eq(l,u):c==="in"&&(n=n.in(l,u))});const{count:s,error:o}=await n;if(o)throw o;return s||0}catch(n){throw n}}}class Uc extends Oe{constructor(){super("partners")}async getAll(e){return super.getAll(e,{orderBy:{column:"name",ascending:!0}})}async getActive(e){return super.getAll(e,{filters:[{column:"is_active",operator:"eq",value:!0}],orderBy:{column:"name",ascending:!0}})}async getWithResources(e){try{const{data:t,error:n}=await w.from("partners").select(`
          *,
          resources (
            id,
            name,
            daily_rate,
            cost_price,
            is_active
          )
        `).eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getSummary(e){try{const{data:t,error:n}=await w.from("partners").select(`
          id,
          name,
          contact_name,
          contact_email,
          payment_terms,
          is_active,
          created_at
        `).eq("project_id",e).order("name",{ascending:!0});if(n)throw n;return t||[]}catch(t){throw t}}async create(e){if(!e.name?.trim())throw new Error("Partner name is required");if(await this.findByName(e.project_id,e.name))throw new Error(`Partner "${e.name}" already exists`);return super.create({...e,name:e.name.trim(),is_active:e.is_active??!0,payment_terms:e.payment_terms||"Net 30"})}async findByName(e,t){try{const{data:n,error:s}=await w.from("partners").select("*").eq("project_id",e).ilike("name",t.trim()).single();if(s){if(s.code==="PGRST116")return null;throw s}return n}catch(n){if(n.code==="PGRST116")return null;throw n}}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Partner not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e,t=!0){return(t?await this.getActive(e):await this.getAll(e)).map(s=>({value:s.id,label:s.name}))}async getDependencyCounts(e){try{const{data:t,error:n}=await w.from("resources").select("id").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(n)throw n;const s=t?.map(u=>u.id)||[];let o=0,a=0;if(s.length>0){const{count:u,error:h}=await w.from("timesheets").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(h)throw h;o=u||0;const{count:m,error:y}=await w.from("expenses").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(y)throw y;a=m||0}const{count:l,error:c}=await w.from("partner_invoices").select("*",{count:"exact",head:!0}).eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(c)throw c;return{resourceCount:t?.length||0,timesheetCount:o,expenseCount:a,invoiceCount:l||0,canDelete:!t?.length&&!l}}catch(t){throw t}}}const _d=new Uc;class Fc extends Oe{constructor(){super("resources",{sanitizeConfig:"resource",supportsSoftDelete:!0})}sanitizeData(e){const t={...e};return t.name&&(t.name=Pt(t.name,100)),t.role&&(t.role=Pt(t.role,100)),t.email&&(t.email=Ns(t.email)),t.notes&&(t.notes=zs(t.notes,5e3)),t}async getAll(e,t={}){const{includePartner:n=!0,activeOnly:s=!1,showTestUsers:o=!0,includeDeleted:a=!1}=t;let l="*";n&&(l="*, partner:partners(id, name, is_active)");let c=w.from(this.tableName).select(l).eq("project_id",e).order("name");a||(c=c.or("is_deleted.is.null,is_deleted.eq.false")),s&&(c=c.eq("is_active",!0)),o||(c=c.or("is_test_content.is.null,is_test_content.eq.false"));const{data:u,error:h}=await c;if(h)throw h;return u||[]}async getAllFiltered(e,t=!0){return this.getAll(e,{showTestUsers:t,includePartner:!0})}async getById(e){const{data:t,error:n}=await w.from(this.tableName).select("*, partner:partners(id, name, contact_name, contact_email, is_active)").eq("id",e).or("is_deleted.is.null,is_deleted.eq.false").single();if(n)throw n;return t}async getByType(e,t){const{data:n,error:s}=await w.from(this.tableName).select("*, partner:partners(id, name)").eq("project_id",e).eq("resource_type",t).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(s)throw s;return n||[]}async getByPartner(e){const{data:t,error:n}=await w.from(this.tableName).select("*").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}async getWithTimesheetSummary(e){const t=await this.getById(e);if(!t)return null;const{data:n,error:s}=await w.from("timesheets").select("id, hours_worked, hours, status, was_rejected, date").eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false");let o=0,a=0,l=0;return n&&n.forEach(c=>{const u=parseFloat(c.hours_worked||c.hours||0);o+=u,c.status==="Approved"?a+=u:c.status==="Submitted"&&!c.was_rejected&&(l+=u)}),{...t,timesheetSummary:{totalEntries:n?.length||0,totalHours:o,approvedHours:a,pendingHours:l,daysWorked:o/8}}}async create(e){const t=this.sanitizeData(e);if(!t.name?.trim())throw new Error("Resource name is required");if(!t.project_id)throw new Error("Project ID is required");if(!t.email?.trim())throw new Error("Email is required");t.resource_type==="internal"&&(t.partner_id=null);const{data:n,error:s}=await w.from(this.tableName).insert([t]).select("*, partner:partners(id, name)").single();if(s)throw s;return n}async update(e,t){const n=this.sanitizeData(t);n.resource_type==="internal"&&(n.partner_id=null),n.updated_at=new Date().toISOString();const{data:s,error:o}=await w.from(this.tableName).update(n).eq("id",e).select("*, partner:partners(id, name)").single();if(o)throw o;return s}async delete(e,t=null){const{data:n,error:s}=await w.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e).select().single();if(s)throw s;return n}async restore(e){const{data:t,error:n}=await w.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}async linkToPartner(e,t){const n={partner_id:t,resource_type:t?"third_party":"internal",updated_at:new Date().toISOString()};return this.update(e,n)}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Resource not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e){const{data:t,error:n}=await w.from(this.tableName).select("id, name, resource_type, role").eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}calculateMargin(e,t){if(!e||e===0||!t)return{percent:null,amount:null,status:"unknown"};const n=(e-t)/e*100,s=e-t;let o="critical";return n>=25?o="good":n>=10&&(o="low"),{percent:n,amount:s,status:o}}async getUtilization(e){const t=await this.getWithTimesheetSummary(e);if(!t)return null;const n=t.days_allocated||0,s=t.timesheetSummary.daysWorked,o=Math.max(0,n-s),a=n>0?s/n*100:0;return{resourceId:e,resourceName:t.name,daysAllocated:n,daysUsed:s,remaining:o,utilizationPercent:a,totalValue:(t.daily_rate||0)*n,valueUsed:(t.daily_rate||0)*s}}async getSummary(e){const t=await this.getAll(e,{includePartner:!1});return{total:t.length,internal:t.filter(n=>n.resource_type==="internal").length,thirdParty:t.filter(n=>n.resource_type==="third_party").length,active:t.filter(n=>n.is_active).length,totalBudget:t.reduce((n,s)=>n+(s.daily_rate||0)*(s.days_allocated||0),0)}}async getProfileByEmail(e){try{const{data:t,error:n}=await this.supabase.from("profiles").select("id, email, full_name, role").eq("email",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getAllWithTestFilter(e,t=[]){try{const n=await this.getAll(e,{orderBy:{column:"name",ascending:!0}});return t&&t.length>0?n.filter(s=>!s.user_id||!t.includes(s.user_id)):n}catch(n){throw n}}async getDependencyCounts(e){try{const[t,n]=await Promise.all([this.supabase.from("timesheets").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false"),this.supabase.from("expenses").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false")]);return{timesheetCount:t.count||0,expenseCount:n.count||0,canDelete:(t.count||0)===0&&(n.count||0)===0}}catch(t){throw t}}}const Sd=new Fc;class Gc extends Oe{constructor(){super("timesheets",{supportsSoftDelete:!0,sanitizeConfig:"timesheet"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||`
      *,
      resources(id, name, email, daily_rate, cost_price),
      milestones(id, milestone_ref, name)
    `,orderBy:t.orderBy||{column:"date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=w.from(this.tableName).select(`
          *,
          resources(id, name, email, daily_rate, cost_price),
          milestones(id, milestone_ref, name)
        `).eq("project_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=w.from(this.tableName).select("*, milestones(id, milestone_ref, name)").eq("resource_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("date",t.start)),t.end&&(n=n.lte("date",t.end)),t.status&&(n=n.eq("status",t.status));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await w.from("resources").select("id, name, cost_price").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(!n||n.length===0)return[];const s=n.map(c=>c.id);let o=w.from(this.tableName).select("*, resources(id, name, cost_price), milestones(id, milestone_ref, name)").in("resource_id",s).order("date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("date",t.start)),t.end&&(o=o.lte("date",t.end)),t.status&&(o=o.eq("status",t.status));const{data:a,error:l}=await o;if(l)throw l;return a||[]}catch(n){throw n}}async getApprovedForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,status:"Approved"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={totalHours:0,totalDays:0,approvedHours:0,pendingHours:0,draftHours:0,rejectedHours:0,totalCost:0,approvedCost:0,byStatus:{Draft:{count:0,hours:0},Submitted:{count:0,hours:0},Approved:{count:0,hours:0},Rejected:{count:0,hours:0}},byMilestone:{},count:n.length};return n.forEach(o=>{const a=parseFloat(o.hours_worked||o.hours||0),l=o.resources?.cost_price||0,c=a/8*l;switch(s.totalHours+=a,s.totalCost+=c,s.byStatus[o.status]&&(s.byStatus[o.status].count++,s.byStatus[o.status].hours+=a),o.status){case"Approved":s.approvedHours+=a,s.approvedCost+=c;break;case"Submitted":o.was_rejected||(s.pendingHours+=a);break;case"Draft":s.draftHours+=a;break;case"Rejected":s.rejectedHours+=a;break}if(o.milestone_id){const u=o.milestones?.milestone_ref||"Unknown";s.byMilestone[o.milestone_id]||(s.byMilestone[o.milestone_id]={ref:u,name:o.milestones?.name||"Unknown",hours:0,cost:0}),s.byMilestone[o.milestone_id].hours+=a,s.byMilestone[o.milestone_id].cost+=c}}),s.totalDays=s.totalHours/8,s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.date)throw new Error("date is required");const t=parseFloat(e.hours_worked||e.hours||0);if(!t||t<=0)throw new Error("hours must be greater than 0");const n={...e,hours_worked:t,hours:t,date:e.date||e.work_date,work_date:e.work_date||e.date,description:e.description||e.comments||"",comments:e.comments||e.description||"",status:e.status||"Draft"};return super.create(n)}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected",was_rejected:!0};return t&&(n.rejection_reason=t),this.update(e,n)}calculateCost(e,t){return e/8*t}calculateBillable(e,t){return e/8*t}}const Vc=new Gc;class Yc extends Oe{constructor(){super("expenses",{supportsSoftDelete:!0,sanitizeConfig:"expense"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, expense_files(*)",orderBy:t.orderBy||{column:"expense_date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=w.from(this.tableName).select("*, expense_files(*)").eq("project_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=w.from(this.tableName).select("*, expense_files(*)").eq("resource_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("expense_date",t.start)),t.end&&(n=n.lte("expense_date",t.end));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await w.from("resources").select("id").eq("partner_id",e);if(!n||n.length===0)return[];const s=n.map(c=>c.id);let o=w.from(this.tableName).select("*, expense_files(*)").in("resource_id",s).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter())),t.start&&(o=o.gte("expense_date",t.start)),t.end&&(o=o.lte("expense_date",t.end)),t.procurementMethod&&(o=o.eq("procurement_method",t.procurementMethod));const{data:a,error:l}=await o;if(l)throw l;return a||[]}catch(n){throw n}}async getPartnerProcuredForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,procurementMethod:"partner"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={total:0,chargeable:0,nonChargeable:0,supplierProcured:0,partnerProcured:0,byCategory:{Travel:0,Accommodation:0,Sustenance:0},byStatus:{Draft:0,Submitted:0,Approved:0,Rejected:0,Paid:0},count:n.length};return n.forEach(o=>{const a=parseFloat(o.amount||0);s.total+=a,o.chargeable_to_customer!==!1?s.chargeable+=a:s.nonChargeable+=a,o.procurement_method==="partner"?s.partnerProcured+=a:s.supplierProcured+=a,s.byCategory[o.category]!==void 0&&(s.byCategory[o.category]+=a),s.byStatus[o.status]!==void 0&&(s.byStatus[o.status]+=a)}),s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.category)throw new Error("category is required");if(!e.amount||e.amount<=0)throw new Error("amount must be greater than 0");const t={...e,status:e.status||"Draft",chargeable_to_customer:e.chargeable_to_customer??!0,procurement_method:e.procurement_method||"supplier"};return super.create(t)}async createMany(e){if(!e||e.length===0)return[];try{const t=e.map(o=>{if(!o.resource_id)throw new Error("resource_id is required for all expenses");if(!o.category)throw new Error("category is required for all expenses");if(!o.amount||o.amount<=0)throw new Error("amount must be greater than 0 for all expenses");return{...o,status:o.status||"Draft",chargeable_to_customer:o.chargeable_to_customer??!0,procurement_method:o.procurement_method||"supplier"}}),{data:n,error:s}=await w.from(this.tableName).insert(t).select();if(s)throw s;return n||[]}catch(t){throw t}}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected"};return t&&(n.rejection_reason=t),this.update(e,n)}async markPaid(e){return this.update(e,{status:"Paid"})}async uploadReceipt(e,t,n){try{const s=`${e}/${Date.now()}-${t.name}`,{error:o}=await w.storage.from("receipts").upload(s,t);if(o)throw o;const{data:a,error:l}=await w.from("expense_files").insert({expense_id:e,file_name:t.name,file_path:s,file_size:t.size,file_type:t.type,uploaded_by:n}).select().single();if(l)throw l;return a}catch(s){throw s}}async downloadReceipt(e){try{const{data:t,error:n}=await w.storage.from("receipts").download(e);if(n)throw n;return t}catch(t){throw t}}}const jd=new Yc;class Kc extends Oe{constructor(){super("partner_invoices")}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, partners(name)",orderBy:t.orderBy||{column:"invoice_date",ascending:!1}})}async getByPartner(e,t={}){try{let n=w.from(this.tableName).select("*").eq("partner_id",e).order("invoice_date",{ascending:!1});t.status&&(n=n.eq("status",t.status));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async getWithLines(e){try{const{data:t,error:n}=await w.from(this.tableName).select("*, partners(name, contact_name, contact_email, payment_terms)").eq("id",e).single();if(n)throw n;if(!t)return null;const{data:s,error:o}=await w.from("partner_invoice_lines").select("*").eq("invoice_id",e).order("line_type",{ascending:!0}).order("resource_name",{ascending:!0}).order("line_date",{ascending:!0});if(o)throw o;const a={timesheets:(s||[]).filter(l=>l.line_type==="timesheet"),supplierExpenses:(s||[]).filter(l=>l.line_type==="supplier_expense"),partnerExpenses:(s||[]).filter(l=>l.line_type==="expense")};return{...t,lines:s||[],groupedLines:a}}catch(t){throw t}}async generateInvoiceNumber(e){try{const n=`INV-${new Date().getFullYear()}-`,{data:s,error:o}=await w.from(this.tableName).select("invoice_number").eq("project_id",e).like("invoice_number",`${n}%`).order("invoice_number",{ascending:!1}).limit(1);if(o)throw o;let a=1;if(s&&s.length>0){const l=s[0].invoice_number,c=parseInt(l.replace(n,""),10);isNaN(c)||(a=c+1)}return`${n}${String(a).padStart(3,"0")}`}catch(t){throw t}}async generateInvoice(e){const{projectId:t,partnerId:n,periodStart:s,periodEnd:o,createdBy:a,notes:l,includeSubmitted:c=!0}=e;try{const{data:u,error:h}=await w.from("resources").select("id, name, cost_price").eq("partner_id",n);if(h)throw h;if(!u||u.length===0)throw new Error("No resources linked to this partner");const m=u.map(N=>N.id),y={};u.forEach(N=>{y[N.id]=N});const j=c?["Approved","Submitted"]:["Approved"],{data:M,error:_}=await w.from("timesheets").select("id, date, hours_worked, hours, status, resource_id").in("resource_id",m).gte("date",s).lte("date",o).in("status",j);if(_)throw _;const{data:C,error:S}=await w.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, procurement_method, chargeable_to_customer, status").in("resource_id",m).gte("expense_date",s).lte("expense_date",o).in("status",["Approved","Submitted","Paid"]);if(S)throw S;const D=(C||[]).filter(N=>N.procurement_method==="partner"),x=(C||[]).filter(N=>N.procurement_method==="supplier");let g=0,p=0;const v=[],P={};(M||[]).forEach(N=>{P[N.resource_id]||(P[N.resource_id]=[]),P[N.resource_id].push(N)}),Object.keys(P).forEach(N=>{const le=y[N];P[N].forEach(X=>{const ne=parseFloat(X.hours_worked||X.hours||0),E=le?.cost_price||0,z=ne/8,A=z*E;g+=A,p+=A,v.push({line_type:"timesheet",timesheet_id:X.id,expense_id:null,description:`${le?.name||"Unknown"} - ${ne}h (${z.toFixed(2)} days)`,quantity:ne,unit_price:E,line_total:A,resource_name:le?.name,line_date:X.date,hours:ne,cost_price:E,source_status:X.status,chargeable_to_customer:!0,procurement_method:null,expense_category:null})})});let b=0,R=0,I=0;const Y=[];D.forEach(N=>{const le=parseFloat(N.amount||0);b+=le,N.chargeable_to_customer?R+=le:I+=le,Y.push({line_type:"expense",timesheet_id:null,expense_id:N.id,description:`${N.resource_name} - ${N.category}: ${N.reason}`,quantity:1,unit_price:le,line_total:le,resource_name:N.resource_name,line_date:N.expense_date,hours:null,cost_price:null,source_status:N.status,chargeable_to_customer:N.chargeable_to_customer,procurement_method:"partner",expense_category:N.category})});let k=0,q=0,K=0;const ee=[];x.forEach(N=>{const le=parseFloat(N.amount||0);k+=le,N.chargeable_to_customer?q+=le:K+=le,ee.push({line_type:"supplier_expense",timesheet_id:null,expense_id:N.id,description:`${N.resource_name} - ${N.category}: ${N.reason}`,quantity:1,unit_price:le,line_total:le,resource_name:N.resource_name,line_date:N.expense_date,hours:null,cost_price:null,source_status:N.status,chargeable_to_customer:N.chargeable_to_customer,procurement_method:"supplier",expense_category:N.category})});const O=g+b,W=p+R+q,pe=I+K,me=await this.generateInvoiceNumber(t),{data:ke,error:Ie}=await w.from(this.tableName).insert({project_id:t,partner_id:n,invoice_number:me,invoice_date:new Date().toISOString().split("T")[0],period_start:s,period_end:o,timesheet_total:g,expense_total:b,supplier_expense_total:k,invoice_total:O,chargeable_total:W,non_chargeable_total:pe,status:"Draft",notes:l||null,created_by:a}).select().single();if(Ie)throw Ie;const Ne=[...v,...Y,...ee].map(N=>({...N,invoice_id:ke.id}));if(Ne.length>0){const{error:N}=await w.from("partner_invoice_lines").insert(Ne);if(N)throw N}return this.getWithLines(ke.id)}catch(u){throw u}}async updateStatus(e,t){const n={status:t};return t==="Sent"?n.sent_at=new Date().toISOString():t==="Paid"&&(n.paid_at=new Date().toISOString()),this.update(e,n)}async markSent(e){return this.updateStatus(e,"Sent")}async markPaid(e){return this.updateStatus(e,"Paid")}async cancel(e){return this.updateStatus(e,"Cancelled")}async getPartnerStats(e){try{const{data:t,error:n}=await w.from(this.tableName).select("status, invoice_total").eq("partner_id",e);if(n)throw n;const s={total:0,draft:0,sent:0,paid:0,cancelled:0,count:t?.length||0};return(t||[]).forEach(o=>{const a=parseFloat(o.invoice_total||0);switch(s.total+=a,o.status){case"Draft":s.draft+=a;break;case"Sent":s.sent+=a;break;case"Paid":s.paid+=a;break;case"Cancelled":s.cancelled+=a;break}}),s}catch(t){throw t}}}const Pd=new Kc;class Xc extends Oe{constructor(){super("milestones",{supportsSoftDelete:!0,sanitizeConfig:"milestone"})}async getAllWithStats(e){try{const t=await this.getAll(e,{orderBy:{column:"start_date",ascending:!0}}),{data:n}=await w.from("timesheets").select("milestone_id, hours_worked").eq("project_id",e).not("milestone_id","is",null).or("is_deleted.is.null,is_deleted.eq.false"),s={};return(n||[]).forEach(o=>{s[o.milestone_id]||(s[o.milestone_id]=0),s[o.milestone_id]+=parseFloat(o.hours_worked||0)}),t.map(o=>({...o,logged_hours:s[o.id]||0,logged_days:(s[o.id]||0)/8}))}catch(t){throw t}}async getWithDeliverables(e){try{const{data:t,error:n}=await w.from(this.tableName).select("*").eq("id",e).or(this.getSoftDeleteFilter()).single();if(n)throw n;const{data:s,error:o}=await w.from("deliverables").select("*").eq("milestone_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(o)throw o;return{...t,deliverables:s||[]}}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"start_date",ascending:!0}})}async getUpcoming(e,t=30){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const o=s.toISOString().split("T")[0];let a=w.from(this.tableName).select("*").eq("project_id",e).gte("end_date",n).lte("end_date",o).neq("status","Completed").order("end_date",{ascending:!0});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await a;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t){return this.update(e,{status:t})}async updateCompletion(e,t){const n={completion_percentage:t};return t>=100&&(n.status="Completed"),this.update(e,n)}async getSummary(e){try{const t=await this.getAll(e),n={total:t.length,completed:0,inProgress:0,notStarted:0,overdue:0,upcoming:0},s=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()+7);const a=o.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Completed"?n.completed++:l.status==="In Progress"?(n.inProgress++,l.end_date<s&&n.overdue++):l.status==="Not Started"&&(n.notStarted++,l.start_date<=a&&n.upcoming++)}),n}catch(t){throw t}}async getCertificates(e){try{const{data:t,error:n}=await w.from("milestone_certificates").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async createCertificate(e){try{const{data:t,error:n}=await w.from("milestone_certificates").insert([e]).select().single();if(n)throw n;return t}catch(t){throw t}}async updateCertificate(e,t){try{const{data:n,error:s}=await w.from("milestone_certificates").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw n}}}const Qc=new Xc;class Jc extends Oe{constructor(){super("deliverables",{supportsSoftDelete:!0,sanitizeConfig:"deliverable"})}async getAllWithMilestones(e){return this.getAll(e,{select:"*, milestones(name, milestone_ref)",orderBy:{column:"due_date",ascending:!0}})}async getByMilestone(e){try{let t=w.from(this.tableName).select("*").eq("milestone_id",e).order("due_date",{ascending:!0});this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{data:n,error:s}=await t;if(s)throw s;return n||[]}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"due_date",ascending:!0}})}async getOverdue(e){try{const t=new Date().toISOString().split("T")[0];let n=w.from(this.tableName).select("*, milestones(name)").eq("project_id",e).lt("due_date",t).not("status","in",'("Delivered","Cancelled")').order("due_date",{ascending:!0});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(t){throw t}}async getUpcoming(e,t=14){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const o=s.toISOString().split("T")[0];let a=w.from(this.tableName).select("*, milestones(name)").eq("project_id",e).gte("due_date",n).lte("due_date",o).not("status","eq","Delivered").order("due_date",{ascending:!0});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await a;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t,n){const s={status:t};return t==="Submitted"?(s.submitted_date=new Date().toISOString(),s.submitted_by=n):t==="Delivered"&&(s.delivered_date=new Date().toISOString(),s.delivered_by=n),this.update(e,s)}async submit(e,t){return this.updateStatus(e,"Submitted",t)}async markDelivered(e,t){return this.updateStatus(e,"Delivered",t)}async reject(e,t){return this.update(e,{status:"Rejected",rejection_reason:t})}async getSummary(e){try{const t=await this.getAll(e),n=new Date().toISOString().split("T")[0],s={total:t.length,delivered:0,inProgress:0,notStarted:0,overdue:0,dueThisWeek:0},o=new Date;o.setDate(o.getDate()+7);const a=o.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Delivered"?s.delivered++:l.status==="In Progress"?(s.inProgress++,l.due_date<n?s.overdue++:l.due_date<=a&&s.dueThisWeek++):(l.status==="Not Started"||l.status==="Draft")&&(s.notStarted++,l.due_date<n&&s.overdue++)}),s}catch(t){throw t}}async getAllWithRelations(e,t=!1){try{let n=this.supabase.from("deliverables").select(`
          *,
          milestone:milestones(milestone_ref, name),
          assigned_user:profiles!deliverables_assigned_to_fkey(full_name),
          creator:profiles!deliverables_created_by_fkey(full_name)
        `).eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("deliverable_ref");t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:o}=await n;if(o)throw o;return s||[]}catch(n){throw n}}async syncKPILinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_kpis").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(a=>({deliverable_id:e,kpi_id:a})),{error:o}=await this.supabase.from("deliverable_kpis").insert(s);if(o)throw o}return!0}catch(n){throw n}}async syncQSLinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_quality_standards").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(a=>({deliverable_id:e,quality_standard_id:a})),{error:o}=await this.supabase.from("deliverable_quality_standards").insert(s);if(o)throw o}return!0}catch(n){throw n}}async upsertKPIAssessments(e,t,n){try{const s=t.map(a=>({deliverable_id:e,kpi_id:a.kpiId,criteria_met:a.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:o}=await this.supabase.from("deliverable_kpi_assessments").upsert(s,{onConflict:"deliverable_id,kpi_id"});if(o)throw o;return!0}catch(s){throw s}}async upsertQSAssessments(e,t,n){try{const s=t.map(a=>({deliverable_id:e,quality_standard_id:a.qsId,criteria_met:a.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:o}=await this.supabase.from("deliverable_qs_assessments").upsert(s,{onConflict:"deliverable_id,quality_standard_id"});if(o)throw o;return!0}catch(s){throw s}}}const Zc=new Jc;class eu extends Oe{constructor(){super("kpis")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,rag_status:this.calculateRAG(n)}))}catch(t){throw t}}calculateRAG(e){if(!e.target_value||e.actual_value===null||e.actual_value===void 0)return"Unknown";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value),s=parseFloat(e.threshold_amber||10);return e.trend==="higher_better"?t>=n?"Green":t>=n*(1-s/100)?"Amber":"Red":t<=n?"Green":t<=n*(1+s/100)?"Amber":"Red"}async getByRAGStatus(e,t){try{return(await this.getAllWithStatus(e)).filter(s=>s.rag_status===t)}catch(n){throw n}}async getNeedingAttention(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.rag_status==="Amber"||n.rag_status==="Red")}catch(t){throw t}}async updateActualValue(e,t){return this.update(e,{actual_value:t,last_updated:new Date().toISOString()})}async getHistory(e,t=12){try{const{data:n,error:s}=await w.from("kpi_history").select("*").eq("kpi_id",e).order("recorded_at",{ascending:!1}).limit(t);if(s)throw s;return n||[]}catch{return[]}}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,green:t.filter(n=>n.rag_status==="Green").length,amber:t.filter(n=>n.rag_status==="Amber").length,red:t.filter(n=>n.rag_status==="Red").length,unknown:t.filter(n=>n.rag_status==="Unknown").length}}catch(t){throw t}}async getAssessments(e){try{const{data:t,error:n}=await w.from("deliverable_kpi_assessments").select("kpi_id, criteria_met").eq("project_id",e);if(n)throw n;return t||[]}catch(t){throw t}}}const tu=new eu;class ru extends Oe{constructor(){super("quality_standards")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,compliance_status:this.calculateCompliance(n)}))}catch(t){throw t}}calculateCompliance(e){if(e.actual_value===null||e.actual_value===void 0)return"Not Measured";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value||0);return t>=n?"Compliant":t>=n*.9?"Near Compliant":"Non-Compliant"}async getNonCompliant(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.compliance_status==="Non-Compliant")}catch(t){throw t}}async updateMeasurement(e,t,n){return this.update(e,{actual_value:t,measurement_notes:n,last_measured:new Date().toISOString()})}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,compliant:t.filter(n=>n.compliance_status==="Compliant").length,nearCompliant:t.filter(n=>n.compliance_status==="Near Compliant").length,nonCompliant:t.filter(n=>n.compliance_status==="Non-Compliant").length,notMeasured:t.filter(n=>n.compliance_status==="Not Measured").length}}catch(t){throw t}}}const nu=new ru;class su extends Oe{constructor(){super("standards",{supportsSoftDelete:!1,sanitizeConfig:"standard"})}async getAll(e){return super.getAll(e,{orderBy:{column:"standard_ref",ascending:!0}})}async getByStatus(e,t){return super.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getByCategory(e,t){return super.getAll(e,{filters:[{column:"category",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getSummary(e){try{const t=await this.getAll(e);return{total:t.length,completed:t.filter(n=>n.status==="Completed").length,inProgress:t.filter(n=>n.status==="In Progress").length,notStarted:t.filter(n=>!n.status||n.status==="Not Started").length}}catch(t){throw t}}}new su;const ou={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},iu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},au={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:6,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:10,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:10,w:6,h:3,minW:4,minH:3,maxH:5}}},Ts={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!1,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:4,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:8,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:8,w:6,h:3,minW:4,minH:3,maxH:5}}},lr={...Ts},As={"progress-hero":{id:"progress-hero",title:"Project Progress",description:"Overall project completion percentage",icon:"target",category:"overview"},"budget-summary":{id:"budget-summary",title:"Budget Overview",description:"Total budget and spend to date",icon:"dollar-sign",category:"financial"},"pmo-tracking":{id:"pmo-tracking",title:"PMO Cost Tracking",description:"PMO vs Non-PMO budget breakdown",icon:"briefcase",category:"financial"},"stats-grid":{id:"stats-grid",title:"Key Statistics",description:"Milestones, deliverables, resources, KPIs, and quality standards counts",icon:"bar-chart",category:"overview"},certificates:{id:"certificates",title:"Milestone Certificates",description:"Certificate signing status summary",icon:"file-check",category:"compliance"},"milestones-list":{id:"milestones-list",title:"Milestones",description:"Milestone status, progress, and spend by milestone",icon:"clock",category:"delivery"},"kpis-category":{id:"kpis-category",title:"KPIs by Category",description:"KPI performance grouped by category",icon:"trending-up",category:"performance"},"quality-standards":{id:"quality-standards",title:"Quality Standards",description:"Quality standard achievement summary",icon:"award",category:"compliance"}};function bt(r){if(!r)return lr;const e=r.toUpperCase();return e.includes("ADMIN")?ou:e.includes("SUPPLIER")&&e.includes("PM")?iu:e.includes("CUSTOMER")&&e.includes("PM")?au:e.includes("CONTRIBUTOR")?Ts:(e.includes("VIEWER"),lr)}const cr=bt;function lu(r){return Object.keys(As)}class cu{constructor(){this.tableName="dashboard_layouts"}async getLayout(e,t,n){try{const{data:s,error:o}=await w.from(this.tableName).select("layout_config").eq("user_id",e).eq("project_id",t).maybeSingle();if(o)throw o;return s?.layout_config?s.layout_config:cr(n)}catch{return cr(n)}}async saveLayout(e,t,n){try{const{data:s,error:o}=await w.from(this.tableName).upsert({user_id:e,project_id:t,layout_config:n,updated_at:new Date().toISOString()},{onConflict:"user_id,project_id"}).select().single();if(o)throw o;return s}catch(s){throw s}}async deleteLayout(e,t){try{const{error:n}=await w.from(this.tableName).delete().eq("user_id",e).eq("project_id",t);if(n)throw n}catch(n){throw n}}async resetToDefault(e,t,n){try{return await this.deleteLayout(e,t),cr(n)}catch(s){throw s}}}const ur=new cu;function uu(r,e,t){const[n,s]=f.useState(null),[o,a]=f.useState(!0),[l,c]=f.useState(!1),[u,h]=f.useState(null),m=f.useCallback(async()=>{if(!r||!e){a(!1);return}try{a(!0);const p=await ur.getLayout(r,e);if(p)s(p);else{const v=bt(t);s(v)}}catch{const v=bt(t);s(v)}finally{a(!1)}},[r,e,t]),y=f.useCallback(async p=>{if(!(!r||!e||!p))try{c(!0),await ur.saveLayout(r,e,p),s(p),h(new Date)}catch(v){throw v}finally{c(!1)}},[r,e]),j=f.useCallback((p,v)=>{s(P=>P&&{...P,widgets:{...P.widgets,[p]:{...P.widgets[p],visible:v}}})},[]),M=f.useCallback(async p=>{const v={...n,widgets:{...n.widgets,...Object.entries(p).reduce((P,[b,R])=>(P[b]={...n.widgets[b],visible:R},P),{})}};await y(v)},[n,y]),_=f.useCallback(p=>{if(!n)return;const v={...n.widgets};p.forEach(b=>{v[b.i]&&(v[b.i]={...v[b.i],x:b.x,y:b.y,w:b.w,h:b.h})});const P={...n,widgets:v};s(P)},[n]),C=f.useCallback(async p=>{if(!n)return;const v={...n.widgets};p.forEach(b=>{v[b.i]&&(v[b.i]={...v[b.i],x:b.x,y:b.y,w:b.w,h:b.h})});const P={...n,widgets:v};await y(P)},[n,y]),S=f.useCallback(async()=>{if(!(!r||!e))try{c(!0),await ur.deleteLayout(r,e);const p=bt(t);s(p),h(new Date)}catch(p){throw p}finally{c(!1)}},[r,e,t]),D=f.useCallback(p=>!n||!n.widgets?!0:n.widgets[p]?.visible!==!1,[n]),x=f.useCallback(()=>!n||!n.widgets?[]:Object.entries(n.widgets).filter(([p,v])=>v.visible!==!1).map(([p,v])=>({i:p,x:v.x||0,y:v.y||0,w:v.w||12,h:v.h||2,minW:v.minW,minH:v.minH,maxH:v.maxH})),[n]),g=f.useCallback(p=>!n||!n.widgets?null:n.widgets[p],[n]);return f.useEffect(()=>{m()},[m]),{layout:n,loading:o,saving:l,lastSaved:u,updateVisibility:j,bulkUpdateVisibility:M,updateLayoutPositions:_,saveLayoutPositions:C,resetToDefault:S,isWidgetVisible:D,getGridLayout:x,getWidgetConfig:g}}function du({isOpen:r,onClose:e,layout:t,role:n,onUpdateVisibility:s,onReset:o,saving:a,lastSaved:l}){const[c,u]=f.useState({}),[h,m]=f.useState(!1),y=lu(),j=g=>c.hasOwnProperty(g)?c[g]:t?.widgets?.[g]?.visible!==!1,M=g=>{u(p=>({...p,[g]:!j(g)}))},_=async()=>{if(Object.keys(c).length===0){e();return}try{await s(c),u({}),e()}catch{}},C=()=>{u({}),e()},S=async()=>{try{await o(),u({}),m(!1)}catch{}};if(!r)return null;const D=y.filter(g=>j(g)).length,x=Object.keys(c).length>0;return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"dashboard-customize-backdrop",onClick:C,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,opacity:r?1:0,transition:"opacity 0.3s ease"}}),i.jsxs("div",{className:"dashboard-customize-panel",style:{position:"fixed",top:0,right:r?0:"-400px",bottom:0,width:"400px",maxWidth:"90vw",backgroundColor:"white",boxShadow:"-4px 0 20px rgba(0, 0, 0, 0.15)",zIndex:1e3,display:"flex",flexDirection:"column",transition:"right 0.3s ease"},children:[i.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Customize Dashboard"}),i.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.875rem",color:"#64748b"},children:[D," of ",y.length," widgets visible"]})]}),i.jsx("button",{onClick:C,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b",borderRadius:"4px"},onMouseEnter:g=>g.target.style.backgroundColor="#f1f5f9",onMouseLeave:g=>g.target.style.backgroundColor="transparent",children:i.jsx(Ze,{size:20})})]}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.75rem"},children:"Available Widgets"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:y.map(g=>{const p=As[g],v=j(g),P=c.hasOwnProperty(g);return i.jsx("div",{onClick:()=>M(g),style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer",backgroundColor:v?"#f0f9ff":"white",borderColor:v?"#3b82f6":"#e2e8f0",transition:"all 0.2s ease",position:"relative"},onMouseEnter:b=>{v||(b.target.style.backgroundColor="#f8fafc")},onMouseLeave:b=>{v||(b.target.style.backgroundColor="white")},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:v?"#3b82f6":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",color:v?"white":"#64748b",flexShrink:0},children:v?i.jsx(Eo,{size:20}):i.jsx(Do,{size:20})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontWeight:"500",fontSize:"0.9375rem",marginBottom:"0.125rem",color:v?"#1e293b":"#64748b"},children:p.title}),i.jsx("div",{style:{fontSize:"0.8125rem",color:"#64748b"},children:p.description})]}),P&&i.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b"}})]})},g)})})]})}),i.jsxs("div",{style:{padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[l&&!x&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8125rem",color:"#10b981"},children:[i.jsx(Mn,{size:16}),"Saved ",new Date(l).toLocaleTimeString()]}),i.jsx("div",{style:{display:"flex",gap:"0.75rem"},children:h?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>m(!1),style:{flex:1,padding:"0.625rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",cursor:"pointer"},children:"Cancel"}),i.jsx("button",{onClick:S,disabled:a,style:{flex:1,padding:"0.625rem",border:"none",borderRadius:"6px",backgroundColor:"#ef4444",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:a?"not-allowed":"pointer",opacity:a?.6:1},children:a?"Resetting...":"Confirm Reset"})]}):i.jsxs("button",{onClick:()=>m(!0),style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},onMouseEnter:g=>{g.target.style.backgroundColor="#f8fafc",g.target.style.borderColor="#cbd5e1"},onMouseLeave:g=>{g.target.style.backgroundColor="white",g.target.style.borderColor="#e2e8f0"},children:[i.jsx(zn,{size:16}),"Reset to Default"]})}),i.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[i.jsx("button",{onClick:C,style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},onMouseEnter:g=>{g.target.style.backgroundColor="#f8fafc"},onMouseLeave:g=>{g.target.style.backgroundColor="white"},children:"Cancel"}),i.jsx("button",{onClick:_,disabled:a||!x,style:{flex:1,padding:"0.625rem 1rem",border:"none",borderRadius:"6px",backgroundColor:x?"#3b82f6":"#94a3b8",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:a||!x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:a?"Saving...":i.jsxs(i.Fragment,{children:[i.jsx(Mo,{size:16}),"Apply Changes"]})})]})]})]})]})}const fu=jn.WidthProvider(jn.Responsive);function Rn(r){if(!r)return!1;const e=r.toLowerCase();return e.includes("pmo")||e.includes("project manager")}function hu(){const{showTestUsers:r,testUserIds:e}=pi(),{projectId:t,projectName:n,projectRef:s}=Bn(),{user:o,role:a}=Dt(),{layout:l,loading:c,saving:u,lastSaved:h,bulkUpdateVisibility:m,saveLayoutPositions:y,resetToDefault:j,getGridLayout:M}=uu(o?.id,t,a),[_,C]=f.useState(!1),[S,D]=f.useState(!0),[x,g]=f.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[p,v]=f.useState({signed:0,pending:0,awaitingGeneration:0}),[P,b]=f.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0,pmoResources:[],nonPmoResources:[]}),[R,I]=f.useState([]),[Y,k]=f.useState({}),[q,K]=f.useState({}),[ee,O]=f.useState([]),[W,pe]=f.useState(0),me=f.useRef(null),ke=f.useCallback(async()=>{if(t){D(!0);try{const ce=await Qc.getAll(t,{orderBy:{column:"milestone_ref",ascending:!0}});I(ce);const X=await Zc.getSummary(t),ne=await tu.getAll(t,{orderBy:{column:"kpi_ref",ascending:!0}}),E=await nu.getAll(t,{orderBy:{column:"qs_ref",ascending:!0}});O(E);const{data:z}=await w.from("resources").select("*"),A=await Vc.getAllFiltered(t,r);let B=0,G=0;const te=[],ae=[];z&&z.forEach(H=>{const we=(H.daily_rate||0)*(H.days_allocated||0);Rn(H.role)?(B+=we,te.push({name:H.name,role:H.role,budget:we})):(G+=we,ae.push({name:H.name,role:H.role,budget:we}))});const de={};let re=0,xe=0,Q=0;A&&z&&A.forEach(H=>{if(!(H.status==="Approved"||H.status==="Submitted"&&!H.was_rejected))return;const Ys=parseFloat(H.hours_worked||H.hours||0),Yt=H.resources||z.find(Ve=>Ve.id===H.resource_id);if(Yt){const Ve=Ys/8*(Yt.daily_rate||0);H.milestone_id&&(de[H.milestone_id]=(de[H.milestone_id]||0)+Ve),re+=Ve,Rn(Yt.role)?xe+=Ve:Q+=Ve}}),k(de),b({pmoBudget:B,pmoSpend:xe,nonPmoBudget:G,nonPmoSpend:Q,pmoResources:te,nonPmoResources:ae});const J={};ne.forEach(H=>{const we=H.category||"Other";J[we]||(J[we]=[]),J[we].push(H)}),K(J);const be=ce.length,tt=ce.filter(H=>H.status==="Completed").length,dt=X.total,je=X.delivered,Ls=z?.length||0,qs=ne.length,Ws=ne.filter(H=>(H.current_value||0)>=(H.target||90)).length,$s=E.length,Bs=E.filter(H=>(H.current_value||0)>=(H.target||100)).length,{data:Vt}=await w.from("milestone_certificates").select("*").eq("project_id",t),Hs=Vt?.filter(H=>H.status==="Signed").length||0,Us=Vt?.filter(H=>H.status==="Pending Customer Signature"||H.status==="Pending Supplier Signature").length||0,Fs=Math.max(0,tt-(Vt?.length||0));v({signed:Hs,pending:Us,awaitingGeneration:Fs});const Gs=ce.reduce((H,we)=>H+(we.budget||0),0),Vs=be>0?Math.round(ce.reduce((H,we)=>H+(we.progress||0),0)/be):0;pe(Vs),g({totalMilestones:be,completedMilestones:tt,totalDeliverables:dt,deliveredCount:je,totalResources:Ls,totalKPIs:qs,achievedKPIs:Ws,totalQS:$s,achievedQS:Bs,totalBudget:Gs,spendToDate:re})}catch{}finally{D(!1)}}},[t,r]);f.useEffect(()=>{ke()},[ke]);function Ie(ce){switch(ce){case"Time Performance":return"#3b82f6";case"Quality of Collaboration":return"#8b5cf6";case"Delivery Performance":return"#10b981";default:return"#64748b"}}const Ne=f.useCallback(ce=>{me.current&&clearTimeout(me.current),me.current=setTimeout(()=>{y(ce)},1e3)},[y]),N=ce=>{switch(ce){case"progress-hero":return i.jsx("div",{className:"card",style:{height:"100%",background:"linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%)",color:"white",display:"flex",alignItems:"center"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[i.jsxs("div",{children:[i.jsxs("h2",{style:{fontSize:"2.5rem",fontWeight:"700",margin:0},children:[W,"%"]}),i.jsx("p",{style:{opacity:.9,margin:0},children:"Overall Progress"})]}),i.jsx("div",{style:{width:"120px",height:"120px",position:"relative"},children:i.jsxs("svg",{viewBox:"0 0 100 100",style:{transform:"rotate(-90deg)"},children:[i.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"10"}),i.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"white",strokeWidth:"10",strokeDasharray:`${W*2.51} 251`,strokeLinecap:"round"})]})})]})});case"budget-summary":return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",height:"100%"},children:[i.jsx("div",{className:"card",style:{borderLeft:"4px solid #3b82f6",height:"100%"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total Budget"}),i.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:["£",x.totalBudget.toLocaleString()]})]}),i.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px"},children:i.jsx(Io,{size:24,style:{color:"#3b82f6"}})})]})}),i.jsx("div",{className:"card",style:{borderLeft:"4px solid #10b981",height:"100%"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Spend to Date"}),i.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#10b981"},children:["£",Math.round(x.spendToDate).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:[x.totalBudget>0?Math.round(x.spendToDate/x.totalBudget*100):0,"% of budget"]})]}),i.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px"},children:i.jsx(yt,{size:24,style:{color:"#10b981"}})})]})})]});case"pmo-tracking":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsx(ko,{size:20})," PMO Cost Tracking"]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.75rem",marginBottom:"1rem"},children:[i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"8px",borderLeft:"4px solid #f59e0b"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#92400e",marginBottom:"0.25rem"},children:"PMO Budget"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#d97706"},children:["£",Math.round(P.pmoBudget/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#ffedd5",borderRadius:"8px",borderLeft:"4px solid #ea580c"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#9a3412",marginBottom:"0.25rem"},children:"PMO Spend"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#ea580c"},children:["£",Math.round(P.pmoSpend/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#1e40af",marginBottom:"0.25rem"},children:"Non-PMO Budget"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#2563eb"},children:["£",Math.round(P.nonPmoBudget/1e3),"k"]})]}),i.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px",borderLeft:"4px solid #16a34a"},children:[i.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Non-PMO Spend"}),i.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#16a34a"},children:["£",Math.round(P.nonPmoSpend/1e3),"k"]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[i.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:"Spend Distribution"}),i.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["PMO: ",x.spendToDate>0?Math.round(P.pmoSpend/x.spendToDate*100):0,"% | Non-PMO: ",x.spendToDate>0?Math.round(P.nonPmoSpend/x.spendToDate*100):0,"%"]})]}),i.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#e2e8f0"},children:[i.jsx("div",{style:{width:`${x.spendToDate>0?P.pmoSpend/x.spendToDate*100:0}%`,backgroundColor:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:P.pmoSpend>0?"40px":"0"},children:P.pmoSpend>0&&"PMO"}),i.jsx("div",{style:{width:`${x.spendToDate>0?P.nonPmoSpend/x.spendToDate*100:0}%`,backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:P.nonPmoSpend>0?"60px":"0"},children:P.nonPmoSpend>0&&"Non-PMO"})]})]})]});case"stats-grid":return i.jsxs("div",{style:{height:"100%",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[i.jsx(ft,{icon:at,label:"Milestones",value:`${x.completedMilestones} / ${x.totalMilestones}`,subtext:`${x.totalMilestones>0?Math.round(x.completedMilestones/x.totalMilestones*100):0}% Complete`,color:"#3b82f6"}),i.jsx(ft,{icon:hr,label:"Deliverables",value:`${x.deliveredCount} / ${x.totalDeliverables}`,subtext:`${x.totalDeliverables>0?Math.round(x.deliveredCount/x.totalDeliverables*100):0}% Delivered`,color:"#10b981"}),i.jsx(ft,{icon:yt,label:"KPIs",value:`${x.achievedKPIs} / ${x.totalKPIs}`,subtext:`${x.totalKPIs>0?Math.round(x.achievedKPIs/x.totalKPIs*100):0}% Achieved`,color:"#3b82f6"}),i.jsx(ft,{icon:vt,label:"Quality Standards",value:`${x.achievedQS} / ${x.totalQS}`,subtext:`${x.totalQS>0?Math.round(x.achievedQS/x.totalQS*100):0}% Achieved`,color:"#8b5cf6"})]});case"certificates":return i.jsx("div",{className:"card",style:{height:"100%",backgroundColor:"#fefce8",borderLeft:"4px solid #eab308"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx(Oo,{size:28,style:{color:"#ca8a04"}}),i.jsx("div",{children:i.jsx("h4",{style:{margin:0,color:"#854d0e"},children:"Milestone Certificates"})})]}),i.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#16a34a"},children:p.signed}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#166534"},children:"Signed"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#d97706"},children:p.pending}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e"},children:"Pending"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:p.awaitingGeneration>0?"#dc2626":"#64748b"},children:p.awaitingGeneration}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Awaiting"})]})]}),i.jsx(Le,{to:"/milestones",style:{padding:"0.5rem 1rem",backgroundColor:"#ca8a04",color:"white",textDecoration:"none",borderRadius:"6px",fontWeight:"500"},children:"View →"})]})});case"milestones-list":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Billable vs Spend by Milestone"}),i.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"1rem"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem",marginRight:"1rem"},children:[i.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),"Billable"]}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem"},children:[i.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"2px"}}),"Spend"]})]}),i.jsx("div",{style:{display:"flex",gap:"0.5rem",height:"calc(100% - 80px)",alignItems:"flex-end"},children:R.map(X=>{const ne=Math.max(...R.map(B=>B.budget||0)),E=Y[X.id]||0,z=ne>0?(X.budget||0)/ne*100:0,A=ne>0?E/ne*100:0;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[i.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"flex-end",height:"100%",width:"100%",justifyContent:"center"},children:[i.jsx("div",{style:{width:"45%",height:`${z}%`,backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",minHeight:X.budget>0?"20px":"0",position:"relative"},title:`Billable: £${(X.budget||0).toLocaleString()}`,children:z>15&&i.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round((X.budget||0)/1e3),"k"]})}),i.jsx("div",{style:{width:"45%",height:`${A}%`,backgroundColor:"#10b981",borderRadius:"4px 4px 0 0",minHeight:E>0?"20px":"0",position:"relative"},title:`Spend: £${Math.round(E).toLocaleString()}`,children:A>15&&i.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["£",Math.round(E/1e3),"k"]})})]}),i.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"600",color:"#64748b"},children:X.milestone_ref})]},X.id)})})]});case"kpis-category":return i.jsxs("div",{className:"card",style:{height:"100%"},children:[i.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Performance"}),i.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end",height:"calc(100% - 50px)"},children:Object.entries(q).map(([X,ne])=>{const E=ne.length,z=ne.filter(B=>(B.current_value||0)>=(B.target||90)).length,A=E>0?z/E*100:0;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem",height:"100%"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[i.jsx("div",{style:{height:`${100-A}%`,backgroundColor:"#e2e8f0",borderRadius:A>0?"4px 4px 0 0":"4px"}}),i.jsxs("div",{style:{height:`${A}%`,backgroundColor:Ie(X),borderRadius:A<100?"0 0 4px 4px":"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"700"},children:[z,"/",E]})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontWeight:"600",fontSize:"0.75rem"},children:X.split(" ")[0]}),i.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[Math.round(A),"%"]})]})]},X)})})]});case"quality-standards":return i.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[i.jsx("h3",{style:{marginBottom:"1rem"},children:"Quality Standards"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:ee.map(X=>{const ne=X.current_value||0,E=ne>=(X.target||100);return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[i.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600",minWidth:"45px",color:"#8b5cf6"},children:X.qs_ref}),i.jsx("div",{style:{flex:1},children:i.jsx("div",{style:{height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:i.jsx("div",{style:{width:`${ne}%`,height:"100%",backgroundColor:E?"#10b981":"#8b5cf6"}})})}),i.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"45px",color:E?"#10b981":"#64748b"},children:[ne,"%"]})]},X.id)})})]});default:return null}};if(S||c)return i.jsx(Dr,{message:"Loading dashboard...",size:"large",fullPage:!0});const le=M();return i.jsxs("div",{className:"page-container",children:[i.jsx(Si,{icon:en,title:`${s||"Project"} Dashboard`,subtitle:n||"Project Tracker",children:i.jsxs("button",{onClick:()=>C(!0),className:"btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1rem"},children:[i.jsx(In,{size:18}),"Customize"]})}),i.jsx(fu,{className:"layout",layouts:{lg:le},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,onLayoutChange:Ne,draggableHandle:".drag-handle",margin:[16,16],containerPadding:[0,0],children:le.map(ce=>i.jsxs("div",{style:{position:"relative"},children:[i.jsx("div",{className:"drag-handle",style:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",cursor:"move",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},title:"Drag to move",children:i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[i.jsx("circle",{cx:"4",cy:"4",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"4",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"4",cy:"8",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"8",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"4",cy:"12",r:"1.5",fill:"#64748b"}),i.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"#64748b"})]})}),N(ce.i)]},ce.i))}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"1rem",marginTop:"2rem"},children:[i.jsxs(Le,{to:"/milestones",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(at,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Milestones"})]}),i.jsxs(Le,{to:"/deliverables",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(hr,{size:32,style:{color:"#10b981",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Deliverables"})]}),i.jsxs(Le,{to:"/kpis",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(yt,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"KPIs"})]}),i.jsxs(Le,{to:"/quality-standards",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(vt,{size:32,style:{color:"#8b5cf6",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Quality"})]}),i.jsxs(Le,{to:"/reports",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[i.jsx(en,{size:32,style:{color:"#f59e0b",marginBottom:"0.5rem"}}),i.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Reports"})]})]}),i.jsx(du,{isOpen:_,onClose:()=>C(!1),layout:l,role:a,onUpdateVisibility:m,onReset:j,saving:u,lastSaved:h})]})}const pu=f.lazy(()=>oe(()=>import("./ResetPassword-sEf0y8rZ.js"),__vite__mapDeps([0,1,2,3,4]))),mu=f.lazy(()=>oe(()=>import("./Milestones-qsIAkSgR.js"),__vite__mapDeps([5,1,6,7,2,3,4]))),gu=f.lazy(()=>oe(()=>import("./MilestoneDetail-Bj3L7XMf.js"),__vite__mapDeps([8,1,2,3,4]))),yu=f.lazy(()=>oe(()=>import("./Gantt-CuFHitQE.js"),__vite__mapDeps([9,1,6,2,3,4]))),bu=f.lazy(()=>oe(()=>import("./Deliverables-DwkYCpXk.js"),__vite__mapDeps([10,1,6,2,3,4]))),vu=f.lazy(()=>oe(()=>import("./Resources-Dw-4mDCQ.js"),__vite__mapDeps([11,1,6,7,2,3,4]))),xu=f.lazy(()=>oe(()=>import("./ResourceDetail-uBUtijxq.js"),__vite__mapDeps([12,1,6,2,3,4]))),wu=f.lazy(()=>oe(()=>import("./Partners-CRo26NPJ.js"),__vite__mapDeps([13,1,6,7,2,3,4]))),_u=f.lazy(()=>oe(()=>import("./PartnerDetail-DWB6BVgz.js"),__vite__mapDeps([14,1,6,2,3,4]))),Su=f.lazy(()=>oe(()=>import("./Timesheets-yHqb0vj8.js"),__vite__mapDeps([15,1,6,7,2,3,4]))),ju=f.lazy(()=>oe(()=>import("./Expenses-DqOgCP-w.js"),__vite__mapDeps([16,1,6,7,2,3,4,17]))),Pu=f.lazy(()=>oe(()=>import("./KPIs-tgBF3KIZ.js"),__vite__mapDeps([18,1,6,7,2,3,4]))),Ru=f.lazy(()=>oe(()=>import("./KPIDetail-BKL8V8Mt.js"),__vite__mapDeps([19,1,6,2,3,4]))),Cu=f.lazy(()=>oe(()=>import("./QualityStandards-C7_yDa2f.js"),__vite__mapDeps([20,1,6,7,2,3,4]))),Eu=f.lazy(()=>oe(()=>import("./QualityStandardDetail-c5M_ub9L.js"),__vite__mapDeps([21,1,2,3,4]))),Du=f.lazy(()=>oe(()=>import("./Reports-DchVAW4P.js"),__vite__mapDeps([22,2,1,3,4]))),Mu=f.lazy(()=>oe(()=>import("./Users-Ccy6kcLa.js"),__vite__mapDeps([23,1,2,3,4]))),Ou=f.lazy(()=>oe(()=>import("./Settings-DjpRWnU7.js"),__vite__mapDeps([24,1,6,2,3,4]))),ku=f.lazy(()=>oe(()=>import("./AccountSettings-DBkaEx-p.js"),__vite__mapDeps([25,1,2,3,4]))),Iu=f.lazy(()=>oe(()=>import("./WorkflowSummary-CX485S_M.js"),__vite__mapDeps([26,1,2,3,4]))),zu=f.lazy(()=>oe(()=>import("./AuditLog-DUgxe7fu.js"),__vite__mapDeps([27,1,2,3,4]))),Nu=f.lazy(()=>oe(()=>import("./DeletedItems-C8sA7eGa.js"),__vite__mapDeps([28,1,7,2,3,4])));function Tu(){return i.jsx("div",{className:"page-container",children:i.jsx(st,{type:"page"})})}function se({children:r}){const{user:e,isLoading:t}=Dt();return t?i.jsx(Dr,{message:"Loading...",size:"large",fullPage:!0}):e?i.jsx(da,{children:i.jsx(f.Suspense,{fallback:i.jsx(Tu,{}),children:r||i.jsx(no,{})})}):i.jsx(dr,{to:"/login",replace:!0})}function Au(){return i.jsx(to,{children:i.jsx(vi,{children:i.jsx(Ci,{children:i.jsx(di,{children:i.jsx(fi,{children:i.jsx(hi,{children:i.jsx(gi,{children:i.jsxs(yi,{children:[i.jsxs(ro,{children:[i.jsx(Z,{path:"/login",element:i.jsx(fa,{})}),i.jsx(Z,{path:"/reset-password",element:i.jsx(f.Suspense,{fallback:i.jsx(Dr,{fullPage:!0}),children:i.jsx(pu,{})})}),i.jsx(Z,{path:"/",element:i.jsx(dr,{to:"/dashboard",replace:!0})}),i.jsx(Z,{path:"/dashboard",element:i.jsx(se,{children:i.jsx(hu,{})})}),i.jsx(Z,{path:"/milestones",element:i.jsx(se,{children:i.jsx(mu,{})})}),i.jsx(Z,{path:"/milestones/:id",element:i.jsx(se,{children:i.jsx(gu,{})})}),i.jsx(Z,{path:"/gantt",element:i.jsx(se,{children:i.jsx(yu,{})})}),i.jsx(Z,{path:"/deliverables",element:i.jsx(se,{children:i.jsx(bu,{})})}),i.jsx(Z,{path:"/resources",element:i.jsx(se,{children:i.jsx(vu,{})})}),i.jsx(Z,{path:"/resources/:id",element:i.jsx(se,{children:i.jsx(xu,{})})}),i.jsx(Z,{path:"/partners",element:i.jsx(se,{children:i.jsx(wu,{})})}),i.jsx(Z,{path:"/partners/:id",element:i.jsx(se,{children:i.jsx(_u,{})})}),i.jsx(Z,{path:"/timesheets",element:i.jsx(se,{children:i.jsx(Su,{})})}),i.jsx(Z,{path:"/expenses",element:i.jsx(se,{children:i.jsx(ju,{})})}),i.jsx(Z,{path:"/kpis",element:i.jsx(se,{children:i.jsx(Pu,{})})}),i.jsx(Z,{path:"/kpis/:id",element:i.jsx(se,{children:i.jsx(Ru,{})})}),i.jsx(Z,{path:"/quality-standards",element:i.jsx(se,{children:i.jsx(Cu,{})})}),i.jsx(Z,{path:"/quality-standards/:id",element:i.jsx(se,{children:i.jsx(Eu,{})})}),i.jsx(Z,{path:"/reports",element:i.jsx(se,{children:i.jsx(Du,{})})}),i.jsx(Z,{path:"/users",element:i.jsx(se,{children:i.jsx(Mu,{})})}),i.jsx(Z,{path:"/settings",element:i.jsx(se,{children:i.jsx(Ou,{})})}),i.jsx(Z,{path:"/account",element:i.jsx(se,{children:i.jsx(ku,{})})}),i.jsx(Z,{path:"/workflow-summary",element:i.jsx(se,{children:i.jsx(Iu,{})})}),i.jsx(Z,{path:"/audit-log",element:i.jsx(se,{children:i.jsx(zu,{})})}),i.jsx(Z,{path:"/deleted-items",element:i.jsx(se,{children:i.jsx(Nu,{})})}),i.jsx(Z,{path:"*",element:i.jsx(dr,{to:"/dashboard",replace:!0})})]}),i.jsx(Di,{}),i.jsx(Qo,{}),i.jsx(ii,{})]})})})})})})})})}pr.createRoot(document.getElementById("root")).render(i.jsx(Cn.StrictMode,{children:i.jsx(Au,{})}));export{$i as $,Vi as A,ud as B,cd as C,ld as D,kt as E,Gi as F,Kn as G,ad as H,Fi as I,id as J,od as K,Dr as L,Mr as M,sd as N,nd as O,Si as P,rd as Q,Ot as R,ft as S,td as T,ed as U,Zu as V,Mt as W,Ju as X,Hi as Y,Xu as Z,Bi as _,Bn as a,Wi as a0,Li as a1,Ai as a2,Ti as a3,Ni as a4,zi as a5,Ii as a6,ki as a7,Yn as a8,Vn as a9,U as aa,bd as ab,d as ac,na as ad,ra as ae,vd as af,yd as ag,ta as ah,gd as ai,ea as aj,Qu as ak,Ku as al,Yu as am,Vu as an,Gu as ao,Fu as ap,Uu as aq,Xi as ar,Ui as as,qi as at,Ei as b,pi as c,Zc as d,jd as e,Hu as f,md as g,pd as h,Pd as i,i as j,tu as k,Zi as l,Qc as m,Ji as n,Qi as o,_d as p,nu as q,Sd as r,w as s,Vc as t,Dt as u,hd as v,fd as w,Ki as x,dd as y,Yi as z};
