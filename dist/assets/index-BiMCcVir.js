const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-BLlXDGck.js","assets/vendor-react-JFEV0ROX.js","assets/vendor-icons-CoFrSbed.js","assets/vendor-supabase-DgEUAXvv.js","assets/Milestones-CIauf_sy.js","assets/usePermissions-tzByz7f2.js","assets/ConfirmDialog-Dx_9nxHd.js","assets/MilestoneDetail-BCcBEd1y.js","assets/Gantt-CfvyZ-hP.js","assets/Deliverables-CaxuNkM_.js","assets/Resources-D2HM0Khy.js","assets/ResourceDetail-BFAM0C3T.js","assets/qualityStandards.service-CdfaH9UL.js","assets/Partners-DIeKuVXW.js","assets/PartnerDetail-86bpNh06.js","assets/Timesheets-D-9hTuVD.js","assets/Expenses-C4_y3Tue.js","assets/KPIs-DLQIW1wA.js","assets/KPIDetail-BSxjkh0G.js","assets/QualityStandards-edUjK1yV.js","assets/QualityStandardDetail-BmjgMWWA.js","assets/Reports-HH2aqk-B.js","assets/Users-tR0c3eDG.js","assets/Settings-Bkx77RMl.js","assets/AccountSettings-DjLxpOc5.js","assets/WorkflowSummary-BIITviNM.js"])))=>i.map(i=>d[i]);
var bt=Object.defineProperty;var jt=(t,s,r)=>s in t?bt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var ge=(t,s,r)=>jt(t,typeof s!="symbol"?s+"":s,r);import{r as i,a as vt,R as We,u as Re,b as St,L as F,c as _t,B as Pt,d as wt,e as z,N as Se,O as Ct}from"./vendor-react-JFEV0ROX.js";import{c as Rt}from"./vendor-supabase-DgEUAXvv.js";import{A as $e,R as _e,L as Ve,I as It,X as Mt,C as Et,a as J,M as kt,S as Dt,B as xe,T as Nt,U as At,b as Tt,c as ye,d as zt,e as Lt,f as oe,F as qe,g as Fe,h as Z,i as Ot,j as Ut,k as Bt,l as Wt,m as ne,P as Pe,n as $t,G as Vt,o as qt,p as Ft,q as Kt,r as Gt,s as Ht,t as Qt,K as Yt,u as be,v as je,w as De,D as Xt,x as Jt,y as Zt}from"./vendor-icons-CoFrSbed.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();var Ke={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var er=i,tr=Symbol.for("react.element"),rr=Symbol.for("react.fragment"),sr=Object.prototype.hasOwnProperty,nr=er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,or={key:!0,ref:!0,__self:!0,__source:!0};function Ge(t,s,r){var l,o={},c=null,a=null;r!==void 0&&(c=""+r),s.key!==void 0&&(c=""+s.key),s.ref!==void 0&&(a=s.ref);for(l in s)sr.call(s,l)&&!or.hasOwnProperty(l)&&(o[l]=s[l]);if(t&&t.defaultProps)for(l in s=t.defaultProps,s)o[l]===void 0&&(o[l]=s[l]);return{$$typeof:tr,type:t,key:c,ref:a,props:o,_owner:nr.current}}ie.Fragment=rr;ie.jsx=Ge;ie.jsxs=Ge;Ke.exports=ie;var e=Ke.exports,we={},Ne=vt;we.createRoot=Ne.createRoot,we.hydrateRoot=Ne.hydrateRoot;const ar="modulepreload",ir=function(t){return"/"+t},Ae={},$=function(s,r,l){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),h=a?.nonce||a?.getAttribute("nonce");o=Promise.allSettled(r.map(j=>{if(j=ir(j),j in Ae)return;Ae[j]=!0;const v=j.endsWith(".css"),y=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${j}"]${y}`))return;const m=document.createElement("link");if(m.rel=v?"stylesheet":ar,v||(m.as="script"),m.crossOrigin="",m.href=j,h&&m.setAttribute("nonce",h),document.head.appendChild(m),v)return new Promise((_,E)=>{m.addEventListener("load",_),m.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${j}`)))})}))}function c(a){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=a,window.dispatchEvent(h),!h.defaultPrevented)throw a}return o.then(a=>{for(const h of a||[])h.status==="rejected"&&c(h.reason);return s().catch(c)})},lr=void 0,cr=void 0;throw new Error("Missing Supabase environment variables");const P=Rt(lr,cr),He=i.createContext(null),dr=60*1e3,ur=5*60*1e3;function fr({children:t}){const[s,r]=i.useState(null),[l,o]=i.useState(null),[c,a]=i.useState(null),[h,j]=i.useState(!0),[v,y]=i.useState(null),[m,_]=i.useState(!1),E=i.useRef(null),O=i.useRef(Date.now()),b=i.useCallback(()=>{O.current=Date.now()},[]);async function D(u){if(!u){o(null),a(null);return}try{const{data:d,error:g}=await P.from("profiles").select("*").eq("id",u.id).single();if(g){y(g);return}o(d);const{data:M}=await P.from("resources").select("*").eq("user_id",u.id).maybeSingle();a(M),y(null)}catch(d){y(d)}}const T=i.useCallback(async()=>{try{const{data:{session:u},error:d}=await P.auth.getSession();if(d)return;if(!u){await B();return}const g=u.expires_at*1e3,M=Date.now(),p=g-M;if(p<=0)await B();else if(p<=ur){_(!0);const{data:C,error:A}=await P.auth.refreshSession();A||!C.session||_(!1)}else _(!1)}catch{}},[]);async function B(){r(null),o(null),a(null),_(!1),await P.auth.signOut();const u=window.location.pathname;u!=="/login"&&u!=="/register"&&(window.location.href="/login?expired=true")}const U=i.useCallback(()=>{E.current&&clearInterval(E.current),E.current=setInterval(()=>{T()},dr);const u=()=>{document.visibilityState==="visible"&&T()};document.addEventListener("visibilitychange",u);const d=["mousedown","keydown","touchstart","scroll"];return d.forEach(g=>{document.addEventListener(g,b,{passive:!0})}),()=>{E.current&&clearInterval(E.current),document.removeEventListener("visibilitychange",u),d.forEach(g=>{document.removeEventListener(g,b)})}},[T,b]);i.useEffect(()=>{let u=!0,d=null;async function g(){try{const{data:{session:p},error:C}=await P.auth.getSession();C&&u&&y(C),u&&(r(p?.user??null),j(!1),p?.user&&(D(p.user),d=U()))}catch(p){u&&(y(p),j(!1))}}g();const{data:{subscription:M}}=P.auth.onAuthStateChange(async(p,C)=>{u&&(r(C?.user??null),j(!1),C?.user?(D(C.user),d&&d(),d=U()):(o(null),a(null),d&&(d(),d=null)),(p==="SIGNED_OUT"||p==="TOKEN_REFRESHED")&&_(!1))});return()=>{u=!1,M.unsubscribe(),d&&d()}},[U]);async function f(){try{await P.auth.signOut(),r(null),o(null),a(null),_(!1)}catch(u){y(u)}}async function S(){s&&await D(s)}async function R(){try{const{data:u,error:d}=await P.auth.refreshSession();return d?!1:u.session?(_(!1),!0):!1}catch{return!1}}const w={user:s,profile:l,role:l?.role||"viewer",linkedResource:c,isLoading:h,error:v,signOut:f,refreshUserData:S,refreshSession:R,isAuthenticated:!!s,sessionExpiring:m};return e.jsx(He.Provider,{value:w,children:t})}function Ie(){const t=i.useContext(He);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}const Qe=i.createContext(null);function mr({children:t}){const[s,r]=i.useState(null),[l,o]=i.useState(!0),[c,a]=i.useState(null);i.useEffect(()=>{let y=!0;async function m(){try{const{data:_,error:E}=await P.from("projects").select("*").eq("reference","AMSF001").single();E?y&&a(E):y&&(r(_),a(null))}catch(_){y&&a(_)}finally{y&&o(!1)}}return m(),()=>{y=!1}},[]);async function h(y){o(!0),a(null);try{const{data:m,error:_}=await P.from("projects").select("*").eq("reference",y).single();_?a(_):r(m)}catch(m){a(m)}finally{o(!1)}}async function j(){if(s)try{const{data:y,error:m}=await P.from("projects").select("*").eq("id",s.id).single();m?a(m):r(y)}catch(y){a(y)}}const v={currentProject:s,projectId:s?.id||null,projectRef:s?.reference||null,projectName:s?.name||null,isLoading:l,error:c,switchProject:h,refreshProject:j};return e.jsx(Qe.Provider,{value:v,children:t})}function Ye(){const t=i.useContext(Qe);if(!t)throw new Error("useProject must be used within a ProjectProvider");return t}const Xe=i.createContext();function pr({children:t}){const[s,r]=i.useState(!1),[l,o]=i.useState(null),[c,a]=i.useState([]);i.useEffect(()=>{h(),j()},[]);async function h(){const{data:{user:b}}=await P.auth.getUser();if(b){const{data:D}=await P.from("profiles").select("role").eq("id",b.id).single();D&&o(D.role)}}async function j(){const{data:b}=await P.from("profiles").select("id").eq("is_test_user",!0);b&&a(b.map(D=>D.id))}const v=l==="admin"||l==="supplier_pm";function y(){v&&r(b=>!b)}function m(b){return c.includes(b)}function _(b,D="user_id"){return!b||s?b:b.filter(T=>!c.includes(T[D]))}function E(b){return!b||s?b:b.filter(D=>!D.is_test_content)}const O={showTestUsers:s,setShowTestUsers:r,toggleTestUsers:y,canToggleTestUsers:v,testUserIds:c,isTestUser:m,filterTestContent:_,filterByTestFlag:E,userRole:l};return e.jsx(Xe.Provider,{value:O,children:t})}function hr(){const t=i.useContext(Xe);if(!t)throw new Error("useTestUsers must be used within a TestUserProvider");return t}const Je=i.createContext();function gr(){return i.useContext(Je)}function xr({children:t}){const[s,r]=i.useState([]),[l,o]=i.useState(0),[c,a]=i.useState(0),[h,j]=i.useState(!0),[v,y]=i.useState(null),[m,_]=i.useState(null),E=S=>["admin","supplier_pm","customer_pm"].includes(S),O=i.useCallback(async(S,R)=>{try{let w=[];if(E(R)){const{data:u}=await P.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:d}=await P.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:g}=await P.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:M}=await P.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");u&&u.forEach(p=>{w.push({id:`ts-${p.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${p.hours_worked||p.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),d&&d.forEach(p=>{const C=p.chargeable_to_customer!==!1;w.push({id:`exp-${p.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${p.resource_name||"Unknown"} expense (£${parseFloat(p.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:C})}),g&&g.forEach(p=>{w.push({id:`del-${p.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${p.deliverable_ref}: ${p.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),M&&M.forEach(p=>{w.push({id:`cert-${p.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:u}=await P.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",S),{data:d}=await P.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",S);u&&u.forEach(g=>{w.push({id:`ts-${g.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${g.hours_worked||g.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),d&&d.forEach(g=>{w.push({id:`exp-${g.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (£${parseFloat(g.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:w.length,items:w}}catch{return{count:0,items:[]}}},[]),b=i.useCallback(async()=>{try{const{data:{user:S}}=await P.auth.getUser();if(!S){r([]),o(0),a(0),j(!1);return}y(S.id);const{data:R}=await P.from("profiles").select("role").eq("id",S.id).single(),w=R?.role||"viewer";_(w);const{count:u,items:d}=await O(S.id,w);r(d),o(u),a(u)}catch{}finally{j(!1)}},[O]),D=i.useCallback(async S=>{r(R=>R.map(w=>w.id===S?{...w,is_read:!0}:w)),o(R=>Math.max(0,R-1))},[]),T=i.useCallback(async S=>{r(R=>R.map(w=>w.id===S?{...w,is_actioned:!0,is_read:!0}:w)),o(R=>Math.max(0,R-1)),a(R=>Math.max(0,R-1))},[]),B=i.useCallback(async()=>{r(S=>S.map(R=>({...R,is_read:!0}))),o(0)},[]),U=i.useCallback(async S=>{const R=s.find(w=>w.id===S);R&&(r(w=>w.filter(u=>u.id!==S)),R.is_read||o(w=>Math.max(0,w-1)),R.notification_type==="action"&&!R.is_actioned&&a(w=>Math.max(0,w-1)))},[s]);i.useEffect(()=>{b();const S=setInterval(()=>{b()},3e4);return()=>clearInterval(S)},[b]),i.useEffect(()=>{const{data:{subscription:S}}=P.auth.onAuthStateChange((R,w)=>{R==="SIGNED_IN"?b():R==="SIGNED_OUT"&&(r([]),o(0),a(0),y(null),_(null))});return()=>S.unsubscribe()},[b]);const f={notifications:s,unreadCount:l,actionCount:c,loading:h,fetchNotifications:b,markAsRead:D,markAsActioned:T,markAllAsRead:B,dismissNotification:U};return e.jsx(Je.Provider,{value:f,children:t})}const Ze=i.createContext(null);function yr({children:t}){const{user:s,profile:r,linkedResource:l,role:o}=Ie(),{projectId:c,projectName:a,projectRef:h,currentProject:j}=Ye(),[v,y]=i.useState(!1),[m,_]=i.useState([]),[E,O]=i.useState(!1),[b,D]=i.useState(null),T=i.useCallback(()=>j?{reference:h||j?.reference,name:a||j?.name,description:j?.description||null}:null,[j,h,a]),B=i.useCallback(()=>({name:r?.full_name||s?.email?.split("@")[0]||"User",email:s?.email,role:o||r?.role||"unknown",linkedResourceName:l?.name||null,linkedResourceId:l?.id||null}),[s,r,l,o]),U=i.useCallback(async()=>{if(!c)return null;const u=[];try{const{data:d}=await P.from("projects").select("name, code, total_budget, start_date, end_date").eq("id",c).single();d&&u.push(`Project: ${d.name} (${d.code})
Budget: £${d.total_budget?.toLocaleString()||0}
Timeline: ${d.start_date} to ${d.end_date}`);const{data:g}=await P.from("milestones").select("id, name, status, progress_percent, planned_end_date").eq("project_id",c).order("planned_end_date",{ascending:!0});if(g?.length>0){const p=g.filter(N=>N.status==="Completed").length,C=g.filter(N=>N.status==="In Progress").length,A=Math.round(g.reduce((N,K)=>N+(K.progress_percent||0),0)/g.length);u.push(`Milestones: ${g.length} total (${p} completed, ${C} in progress)
Average Progress: ${A}%`);const L=new Date().toISOString().split("T")[0],x=g.filter(N=>N.planned_end_date<L&&N.status!=="Completed");x.length>0&&u.push(`Overdue Milestones: ${x.map(N=>N.name).join(", ")}`)}const{data:M}=await P.from("deliverables").select("id, status").eq("project_id",c);if(M?.length>0){const p={};M.forEach(C=>{p[C.status]=(p[C.status]||0)+1}),u.push(`Deliverables: ${M.length} total
Status breakdown: ${Object.entries(p).map(([C,A])=>`${C}: ${A}`).join(", ")}`)}if(o==="admin"||o==="supplier_pm"){const{data:p}=await P.from("timesheets").select("hours_worked, status").eq("project_id",c);if(p?.length>0){const C=p.reduce((L,x)=>L+(x.hours_worked||0),0),A=p.filter(L=>L.status==="Submitted").length;u.push(`Timesheets: ${C.toFixed(1)} total hours logged
Pending approval: ${A} entries`)}}else if(l?.id){const{data:p}=await P.from("timesheets").select("hours_worked, status").eq("resource_id",l.id);if(p?.length>0){const C=p.reduce((A,L)=>A+(L.hours_worked||0),0);u.push(`Your Timesheets: ${C.toFixed(1)} hours logged`)}}if(o==="admin"||o==="supplier_pm"){const{data:p}=await P.from("expenses").select("amount, status, is_chargeable").eq("project_id",c);if(p?.length>0){const C=p.reduce((L,x)=>L+(x.amount||0),0),A=p.filter(L=>L.status==="Submitted").length;u.push(`Expenses: £${C.toLocaleString()} total claimed
Pending validation: ${A} entries`)}}if(o==="admin"||o==="supplier_pm"||o==="customer_pm"){const{data:p}=await P.from("resources").select("id, name, days_allocated, days_used").eq("project_id",c);if(p?.length>0){const C=p.reduce((A,L)=>A+(L.days_allocated||0),0);u.push(`Resources: ${p.length} team members
Total days allocated: ${C}`)}}return u.join(`

`)}catch{return null}},[c,o,l]),f=i.useCallback(async u=>{if(!u.trim()||E)return;const d={role:"user",content:u.trim()};_(g=>[...g,d]),O(!0),D(null);try{const g=T(),M=B(),p=await U(),C=[...m.slice(-9),d].map(x=>({role:x.role,content:x.content})),A=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:C,projectContext:g,userContext:M,dataContext:p})});if(!A.ok)throw new Error("Failed to get response");const L=await A.json();_(x=>[...x,{role:"assistant",content:L.message}])}catch{D("Failed to send message. Please try again."),_(M=>M.slice(0,-1))}finally{O(!1)}},[m,E,T,B,U]),S=i.useCallback(()=>{_([]),D(null)},[]),R=i.useCallback(()=>{y(u=>!u)},[]),w={isOpen:v,setIsOpen:y,toggleChat:R,messages:m,isLoading:E,error:b,sendMessage:f,clearChat:S};return e.jsx(Ze.Provider,{value:w,children:t})}function br(){const t=i.useContext(Ze);if(!t)throw new Error("useChat must be used within a ChatProvider");return t}class jr extends We.Component{constructor(r){super(r);ge(this,"handleReload",()=>{window.location.reload()});ge(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,l){this.setState({errorInfo:l})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[e.jsx($e,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),e.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),e.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),e.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[e.jsx(_e,{size:16}),"Reload Page"]})]})]}):this.props.children}}function Me({message:t,size:s="medium",fullPage:r=!1}){const l={small:{icon:16,text:"0.75rem",padding:"0.5rem"},medium:{icon:24,text:"0.875rem",padding:"1.5rem"},large:{icon:40,text:"1rem",padding:"3rem"}},o=l[s]||l.medium,c={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:o.padding,...r&&{minHeight:"60vh"}},a={animation:"spin 1s linear infinite",color:"#3b82f6"},h={marginTop:"0.75rem",color:"#64748b",fontSize:o.text};return e.jsxs("div",{style:c,children:[e.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}),e.jsx(Ve,{size:o.icon,style:a}),t&&e.jsx("p",{style:h,children:t})]})}const vr={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function q({width:t="100%",height:s="1rem",style:r={},className:l=""}){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),e.jsx("div",{className:l,style:{width:t,height:s,borderRadius:"4px",...vr,...r}})]})}function Ce({width:t="100%",lines:s=1}){return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:s}).map((r,l)=>e.jsx(q,{width:l===s-1&&s>1?"70%":t,height:"1rem"},l))})}function Sr(){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(q,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx(q,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),e.jsx(q,{width:"40%",height:"1.5rem"})]})]})}function _r({columns:t=6}){return e.jsx("tr",{children:Array.from({length:t}).map((s,r)=>e.jsx("td",{style:{padding:"0.75rem 1rem"},children:e.jsx(q,{width:r===0?"80%":r===t-1?"60px":"70%",height:"1rem"})},r))})}function ve({hasHeader:t=!0}){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t&&e.jsx(q,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),e.jsx(Ce,{lines:3})]})}function X({type:t="text",count:s=1,...r}){return(()=>{switch(t){case"text":return e.jsx(Ce,{...r});case"stat-card":case"stats":return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:s}).map((o,c)=>e.jsx(Sr,{},c))});case"table":return e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:r.columns||6}).map((o,c)=>e.jsx("th",{style:{padding:"0.75rem 1rem"},children:e.jsx(q,{width:"60%",height:"0.875rem"})},c))})}),e.jsx("tbody",{children:Array.from({length:r.rows||5}).map((o,c)=>e.jsx(_r,{columns:r.columns||6},c))})]})});case"card":return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:s}).map((o,c)=>e.jsx(ve,{...r},c))});case"page":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(q,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),e.jsx(q,{width:"300px",height:"1rem"})]}),e.jsx(q,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),e.jsx(X,{type:"stats",count:4}),e.jsx(X,{type:"table",rows:8,columns:6})]});case"detail":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(q,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),e.jsx(q,{width:"250px",height:"1.75rem"})]}),e.jsx(X,{type:"stats",count:4}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsx(ve,{}),e.jsx(ve,{})]}),e.jsx(X,{type:"table",rows:5,columns:5})]});default:return e.jsx(Ce,{...r})}})()}function se({icon:t,label:s,value:r,subtext:l,color:o="#3b82f6",borderColor:c,backgroundColor:a,style:h={},onClick:j}){const v={...c&&{borderLeft:`4px solid ${c}`},...a&&{backgroundColor:a},...j&&{cursor:"pointer"},...h};return e.jsxs("div",{className:"stat-card",style:v,onClick:j,role:j?"button":void 0,tabIndex:j?0:void 0,children:[e.jsxs("div",{className:"stat-label",children:[t&&e.jsx(t,{size:20,style:{color:o}}),s]}),e.jsx("div",{className:"stat-value",style:{color:o},children:r}),l&&e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:l})]})}function Pr({icon:t,title:s,subtitle:r,children:l,style:o={}}){return e.jsxs("div",{className:"page-header",style:o,children:[e.jsxs("div",{className:"page-title",children:[t&&e.jsx(t,{size:28}),e.jsxs("div",{children:[e.jsx("h1",{children:s}),r&&e.jsx("p",{children:r})]})]}),l&&e.jsx("div",{className:"page-actions",children:l})]})}const Te={Completed:{bg:"#dcfce7",color:"#16a34a"},"In Progress":{bg:"#dbeafe",color:"#2563eb"},"Not Started":{bg:"#f1f5f9",color:"#64748b"},Approved:{bg:"#dcfce7",color:"#16a34a"},Submitted:{bg:"#fef3c7",color:"#d97706"},Draft:{bg:"#f1f5f9",color:"#64748b"},Rejected:{bg:"#fee2e2",color:"#dc2626"},Validated:{bg:"#dcfce7",color:"#16a34a"},Delivered:{bg:"#dcfce7",color:"#16a34a"},"Under Review":{bg:"#fef3c7",color:"#d97706"},"Rework Required":{bg:"#fee2e2",color:"#dc2626"},Signed:{bg:"#dcfce7",color:"#16a34a"},"Pending Customer Signature":{bg:"#fef3c7",color:"#d97706"},"Pending Supplier Signature":{bg:"#dbeafe",color:"#2563eb"},High:{bg:"#fee2e2",color:"#dc2626"},Medium:{bg:"#fef3c7",color:"#d97706"},Low:{bg:"#dcfce7",color:"#16a34a"},Active:{bg:"#dcfce7",color:"#16a34a"},Inactive:{bg:"#f1f5f9",color:"#64748b"},Yes:{bg:"#dcfce7",color:"#16a34a"},No:{bg:"#f1f5f9",color:"#64748b"}};function wr({status:t,size:s="medium",customStyle:r,style:l={}}){if(!t)return null;const o=r||Te[t]||Te["Not Started"],c={small:{padding:"0.15rem 0.4rem",fontSize:"0.75rem"},medium:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},large:{padding:"0.35rem 0.75rem",fontSize:"0.95rem"}};return e.jsx("span",{style:{display:"inline-block",borderRadius:"4px",fontWeight:"500",whiteSpace:"nowrap",backgroundColor:o.bg,color:o.color,...c[s],...l},children:t})}const ze={success:{icon:Et,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:Mt,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:$e,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:It,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function Cr({id:t,message:s,type:r="info",duration:l=4e3,onClose:o}){const c=ze[r]||ze.info,a=c.icon;return i.useEffect(()=>{if(l>0){const h=setTimeout(()=>{o(t)},l);return()=>clearTimeout(h)}},[t,l,o]),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:c.bgColor,border:`1px solid ${c.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[e.jsx(a,{size:20,style:{color:c.iconColor,flexShrink:0}}),e.jsx("span",{style:{color:c.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:s}),e.jsx("button",{onClick:()=>o(t),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:c.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:h=>h.target.style.opacity=1,onMouseLeave:h=>h.target.style.opacity=.7,children:e.jsx(J,{size:16})})]})}function Rr({toasts:t,removeToast:s}){return t.length===0?null:e.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),t.map(r=>e.jsx(Cr,{id:r.id,message:r.message,type:r.type,duration:r.duration,onClose:s},r.id))]})}const et=i.createContext(null),Ir=4e3;function Mr({children:t}){const[s,r]=i.useState([]),l=i.useCallback(y=>{r(m=>m.filter(_=>_.id!==y))},[]),o=i.useCallback((y,m="info",_=Ir)=>{const E=Date.now()+Math.random(),O={id:E,message:y,type:m,duration:_};return r(b=>[...b,O]),E},[]),c=i.useCallback((y,m)=>o(y,"success",m),[o]),a=i.useCallback((y,m)=>o(y,"error",m||6e3),[o]),h=i.useCallback((y,m)=>o(y,"warning",m),[o]),j=i.useCallback((y,m)=>o(y,"info",m),[o]),v={showToast:o,showSuccess:c,showError:a,showWarning:h,showInfo:j,removeToast:l};return e.jsxs(et.Provider,{value:v,children:[t,e.jsx(Rr,{toasts:s,removeToast:l})]})}function Er(){const t=i.useContext(et);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}function kr(){const{isOpen:t,toggleChat:s,messages:r,isLoading:l,error:o,sendMessage:c,clearChat:a}=br(),[h,j]=i.useState(""),v=i.useRef(null),y=i.useRef(null);i.useEffect(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[r]),i.useEffect(()=>{t&&setTimeout(()=>y.current?.focus(),100)},[t]);const m=b=>{b.preventDefault(),h.trim()&&!l&&(c(h),j(""))},_=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),m(b))},E={role:"assistant",content:`Hello! I'm your AMSF001 Project Assistant. I can help you with:

• **Using the app** - How to navigate, submit timesheets, review deliverables, etc.
• **Your project data** - Ask about milestones, budgets, team utilization, and more
• **Your permissions** - What actions you can perform in your role

How can I help you today?`},O=r.length===0?[E]:r;return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`chat-toggle-btn ${t?"chat-open":""}`,onClick:s,"aria-label":t?"Close chat":"Open AI assistant",children:t?e.jsx(J,{size:24}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{size:24}),e.jsx(Dt,{className:"chat-sparkle",size:12})]})}),e.jsxs("div",{className:`chat-panel ${t?"chat-panel-open":""}`,children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"chat-header-title",children:[e.jsx(xe,{size:20}),e.jsx("span",{children:"Project Assistant"})]}),e.jsxs("div",{className:"chat-header-actions",children:[r.length>0&&e.jsx("button",{className:"chat-clear-btn",onClick:a,title:"Clear chat",children:e.jsx(Nt,{size:16})}),e.jsx("button",{className:"chat-close-btn",onClick:s,"aria-label":"Close chat",children:e.jsx(J,{size:20})})]})]}),e.jsxs("div",{className:"chat-messages",children:[O.map((b,D)=>e.jsxs("div",{className:`chat-message ${b.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[e.jsx("div",{className:"chat-message-avatar",children:b.role==="user"?e.jsx(At,{size:16}):e.jsx(xe,{size:16})}),e.jsx("div",{className:"chat-message-content",children:e.jsx(Dr,{content:b.content})})]},D)),l&&e.jsxs("div",{className:"chat-message chat-message-assistant",children:[e.jsx("div",{className:"chat-message-avatar",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"chat-message-content chat-typing",children:[e.jsx(Ve,{className:"chat-typing-icon",size:16}),e.jsx("span",{children:"Thinking..."})]})]}),o&&e.jsx("div",{className:"chat-error",children:o}),e.jsx("div",{ref:v})]}),e.jsxs("form",{className:"chat-input-form",onSubmit:m,children:[e.jsx("textarea",{ref:y,className:"chat-input",value:h,onChange:b=>j(b.target.value),onKeyDown:_,placeholder:"Ask me anything about the project...",rows:1,disabled:l}),e.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!h.trim()||l,"aria-label":"Send message",children:e.jsx(Tt,{size:18})})]}),e.jsx("div",{className:"chat-footer",children:"Powered by Claude AI"})]})]})}function Dr({content:t}){const s=t.split(`
`);return e.jsx("div",{className:"chat-message-text",children:s.map((r,l)=>{if(r.startsWith("• ")||r.startsWith("- ")){const o=r.substring(2);return e.jsxs("div",{className:"chat-bullet",children:[e.jsx("span",{className:"chat-bullet-dot",children:"•"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:Le(o)}})]},l)}return r.trim()===""?e.jsx("div",{className:"chat-line-break"},l):e.jsx("p",{dangerouslySetInnerHTML:{__html:Le(r)}},l)})})}function Le(t){return t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function Nr(){const[t,s]=i.useState(!1),r=i.useRef(null),l=Re(),{notifications:o,unreadCount:c,actionCount:a,loading:h,markAsRead:j,markAsActioned:v,markAllAsRead:y,dismissNotification:m}=gr();i.useEffect(()=>{function f(S){r.current&&!r.current.contains(S.target)&&s(!1)}return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]);const _=f=>{switch(f){case"timesheet":return e.jsx(Z,{size:16});case"expense":return e.jsx(Fe,{size:16});case"deliverable":return e.jsx(qe,{size:16});case"certificate":return e.jsx(oe,{size:16});default:return e.jsx(ye,{size:16})}},E=f=>f.notification_type==="action"?f.is_actioned?"#10b981":"#f59e0b":"#3b82f6",O=async f=>{f.is_read||await j(f.id),f.action_url&&(l(f.action_url),s(!1))},b=async(f,S)=>{f.stopPropagation(),await v(S.id),S.action_url&&(l(S.action_url),s(!1))},D=async(f,S)=>{f.stopPropagation(),await m(S.id)},T=f=>{const S=new Date(f),w=new Date-S,u=Math.floor(w/6e4),d=Math.floor(w/36e5),g=Math.floor(w/864e5);return u<1?"Just now":u<60?`${u}m ago`:d<24?`${d}h ago`:g<7?`${g}d ago`:S.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},B=o.slice(0,10),U=o.filter(f=>f.notification_type==="action"&&!f.is_actioned);return e.jsxs("div",{className:"notification-bell-container",ref:r,style:{position:"relative"},children:[e.jsxs("button",{onClick:()=>s(!t),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:t?"#f1f5f9":"transparent"},onMouseEnter:f=>f.target.style.backgroundColor="#f1f5f9",onMouseLeave:f=>f.target.style.backgroundColor=t?"#f1f5f9":"transparent",title:`${a} actions pending`,children:[e.jsx(ye,{size:22,color:"#64748b"}),(c>0||a>0)&&e.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:a>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:a>0?a:c})]}),t&&e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),a>0&&e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[a," action",a!==1?"s":""," required"]})]}),c>0&&e.jsx("button",{onClick:y,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),U.length>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),e.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),e.jsxs("button",{onClick:()=>{l("/workflow-summary"),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",e.jsx(zt,{size:16})]})]}),e.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:h?e.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):B.length===0?e.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[e.jsx(ye,{size:32,style:{marginBottom:"8px",opacity:.5}}),e.jsx("p",{style:{margin:0},children:"No notifications"})]}):B.map(f=>e.jsx("div",{onClick:()=>O(f),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:f.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:S=>S.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:S=>S.currentTarget.style.backgroundColor=f.is_read?"white":"#f8fafc",children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:f.notification_type==="action"&&!f.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:E(f),flexShrink:0},children:_(f.category)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[e.jsx("span",{style:{fontWeight:f.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:f.title}),e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:T(f.created_at)})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:f.message}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[f.notification_type==="action"&&!f.is_actioned&&f.action_label&&e.jsx("button",{onClick:S=>b(S,f),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:f.action_label}),f.notification_type==="info"&&e.jsxs("button",{onClick:S=>D(S,f),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(J,{size:12}),"Dismiss"]}),f.is_actioned&&e.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Lt,{size:12}),"Completed"]})]})]})]})},f.id))}),o.length>10&&e.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:e.jsx("button",{onClick:()=>{l("/workflow-summary"),s(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const n={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"};function k(t,s){return s.includes(t)}function $s(t){return k(t,[n.ADMIN,n.SUPPLIER_PM])}function tt(t){return k(t,[n.CONTRIBUTOR,n.SUPPLIER_PM,n.ADMIN])}function rt(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Ar(t){return k(t,[n.CUSTOMER_PM,n.ADMIN])}function Vs(t,s,r,l){if(k(t,[n.ADMIN,n.SUPPLIER_PM]))return!0;let o,c,a;return typeof s=="object"&&s!==null?(o=s.status,c=s.created_by||s.resource?.user_id,a=r):(o=s,c=r,a=l),c===a&&(o==="Draft"||o==="Rejected")}function qs(t,s,r,l){if(t===n.ADMIN||t===n.SUPPLIER_PM)return!0;let o,c,a;return typeof s=="object"&&s!==null?(o=s.status,c=s.created_by||s.resource?.user_id,a=r):(o=s,c=r,a=l),c===a&&o==="Draft"}function Fs(t,s,r,l){let o,c,a;return typeof s=="object"&&s!==null?(o=s.status,c=s.created_by||s.resource?.user_id,a=r):(o=s,c=r,a=l),o!=="Draft"&&o!=="Rejected"?!1:k(t,[n.ADMIN,n.SUPPLIER_PM])?!0:c===a&&tt(t)}function Tr(t){return k(t,[n.CONTRIBUTOR,n.SUPPLIER_PM,n.ADMIN])}function zr(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Ks(t,s,r){let l,o;return typeof s=="object"&&s!==null?(l=s.status,o=s.chargeable||s.chargeable_to_customer):(l=s,o=r),l!=="Submitted"?!1:t===n.ADMIN?!0:o?t===n.CUSTOMER_PM:t===n.SUPPLIER_PM}function Lr(t){return k(t,[n.CUSTOMER_PM,n.ADMIN])}function Or(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Gs(t,s,r,l){if(k(t,[n.ADMIN,n.SUPPLIER_PM]))return!0;let o,c,a;return typeof s=="object"&&s!==null?(o=s.status,c=s.created_by,a=r):(o=s,c=r,a=l),c===a&&(o==="Draft"||o==="Rejected")}function Hs(t,s,r,l){if(t===n.ADMIN||t===n.SUPPLIER_PM)return!0;let o,c,a;return typeof s=="object"&&s!==null?(o=s.status,c=s.created_by,a=r):(o=s,c=r,a=l),c===a&&o==="Draft"}function Ur(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Br(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Wr(t){return t===n.ADMIN}function $r(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Vr(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function qr(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function Qs(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Ys(t,s,r){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])?!0:t===n.CONTRIBUTOR?s?.assigned_to===r||s?.resource?.user_id===r:!1}function Fr(t){return k(t,[n.CUSTOMER_PM,n.ADMIN])}function Xs(t){return k(t,[n.CONTRIBUTOR,n.SUPPLIER_PM,n.ADMIN])}function le(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Js(t){return le(t)}function Zs(t){return le(t)}function en(t){return le(t)}function ce(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function tn(t){return ce(t)}function rn(t){return ce(t)}function sn(t){return ce(t)}function Ee(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function nn(t){return Ee(t)}function on(t){return Ee(t)}function Kr(t){return t===n.ADMIN}function Gr(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function an(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function st(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Hr(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function de(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function ln(t){return de(t)}function cn(t){return de(t)}function dn(t){return de(t)}function Qr(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Yr(t){return k(t,[n.CUSTOMER_PM,n.ADMIN])}function un(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function Xr(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function fn(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Jr(t){return t===n.ADMIN}function mn(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function Zr(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function es(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function ts(t){return k(t,[n.SUPPLIER_PM,n.ADMIN])}function pn(t){return st(t)}function hn(t){return k(t,[n.CUSTOMER_PM,n.SUPPLIER_PM,n.ADMIN])}function rs(t,s,r){return!s||!Array.isArray(s)?[]:rt(t)?s:s.filter(l=>l.user_id===r)}function gn(t,s){return!t||!Array.isArray(t)?null:t.find(r=>r.user_id===s)||null}function ss(t,s,r){const l=rs(t,s,r);return l.length===0?null:l.find(c=>c.user_id===r)||l[0]}function xn(t,s,r){return ss(t,s,r)?.id||null}function ns(t){const s={admin:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},supplier_pm:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},customer_pm:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},contributor:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},viewer:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}};return s[t]||s.viewer}function os(t){return ns(t).label}const yn=[{value:"viewer",label:"Viewer",color:"#64748b",bg:"#f1f5f9"},{value:"contributor",label:"Contributor",color:"#2563eb",bg:"#dbeafe"},{value:"customer_pm",label:"Customer PM",color:"#d97706",bg:"#fef3c7"},{value:"supplier_pm",label:"Supplier PM",color:"#059669",bg:"#d1fae5"},{value:"admin",label:"Admin",color:"#7c3aed",bg:"#f3e8ff"}];function bn(t){return{role:t,roleLabel:os(t),timesheets:{canAdd:tt(t),canAddForOthers:rt(t),canApprove:Ar(t)},expenses:{canAdd:Tr(t),canAddForOthers:zr(t),canValidateChargeable:Lr(t),canValidateNonChargeable:Or(t)},milestones:{canCreate:Ur(t),canEdit:Br(t),canDelete:Wr(t),canUseGantt:$r(t)},deliverables:{canCreate:Vr(t),canEdit:qr(t),canReview:Fr(t)},kpis:{canManage:le(t)},qualityStandards:{canManage:ce(t)},resources:{canManage:Ee(t),canDelete:Kr(t),canSeeCostPrice:Gr(t),canSeeMargins:st(t)},partners:{canView:Hr(t),canManage:de(t)},certificates:{canSignAsSupplier:Qr(t),canSignAsCustomer:Yr(t)},admin:{canAccessSettings:Xr(t),canManageUsers:Jr(t),canViewWorkflowSummary:Zr(t)},invoicing:{canGenerateCustomerInvoice:es(t),canGenerateThirdPartyInvoice:ts(t)}}}const ue={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:Ft,label:"Workflow Summary",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:qt,label:"Dashboard",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.VIEWER],readOnlyRoles:[n.VIEWER]},reports:{id:"reports",path:"/reports",icon:qe,label:"Reports",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:Vt,label:"Gantt Chart",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.VIEWER],readOnlyRoles:[n.VIEWER,n.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:$t,label:"Milestones",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.VIEWER],readOnlyRoles:[n.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:Pe,label:"Deliverables",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.CONTRIBUTOR,n.VIEWER],readOnlyRoles:[n.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:ne,label:"KPIs",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.VIEWER],readOnlyRoles:[n.VIEWER,n.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:oe,label:"Quality Standards",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.VIEWER],readOnlyRoles:[n.VIEWER,n.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:Wt,label:"Resources",allowedRoles:[n.ADMIN,n.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:Z,label:"Timesheets",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:Fe,label:"Expenses",allowedRoles:[n.ADMIN,n.SUPPLIER_PM,n.CUSTOMER_PM,n.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:Bt,label:"Partners",allowedRoles:[n.ADMIN,n.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:Ut,label:"Users",allowedRoles:[n.ADMIN,n.SUPPLIER_PM],readOnlyRoles:[n.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:Ot,label:"Settings",allowedRoles:[n.ADMIN,n.SUPPLIER_PM],readOnlyRoles:[]}},ae={[n.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings"],[n.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings"],[n.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[n.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[n.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function as(t){return(ae[t]||ae[n.VIEWER]).map(r=>ue[r]?.path).filter(Boolean)}function nt(t){return(ae[t]||ae[n.VIEWER]).map(r=>ue[r]).filter(r=>r&&r.allowedRoles.includes(t))}function Oe(t,s){const r=ue[s];return r?r.readOnlyRoles?.includes(t)||!1:!0}function is(t){return t!==n.VIEWER}function ls(t){return Object.values(ue).find(s=>s.path===t)||null}function cs(t){return ls(t)?.id||null}function ds(t,s){const r=nt(t);if(!s||!Array.isArray(s)||s.length===0)return r;const l={};r.forEach(c=>{l[c.path]=c});const o=[];return s.forEach(c=>{l[c]&&(o.push(l[c]),delete l[c])}),Object.values(l).forEach(c=>{o.push(c)}),o}function us(t,s){if(!s||s.length===0)return!0;const r=as(t);return s.length!==r.length?!1:s.every((l,o)=>l===r[o])}const Ue={[n.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[n.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[n.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[n.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[n.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function fs(t){return Ue[t]||Ue[n.VIEWER]}function ms({children:t}){const s=St(),r=Re(),{showSuccess:l,showError:o}=Er(),{user:c,profile:a,role:h,signOut:j}=Ie(),[v,y]=i.useState(!0),[m,_]=i.useState(null),[E,O]=i.useState(null),[b,D]=i.useState(null),T=i.useRef(null),B=i.useMemo(()=>fs(h),[h]),U=i.useMemo(()=>a&&(a.full_name||a.email||c?.email)||"User",[a,c]),f=i.useMemo(()=>{if(!a)return"U";if(a.full_name){const x=a.full_name.split(" ");return x.length>=2?x[0][0]+x[x.length-1][0]:a.full_name[0].toUpperCase()}return U[0].toUpperCase()},[a,U]);i.useEffect(()=>{a?.nav_order&&Array.isArray(a.nav_order)&&_(a.nav_order)},[a]);async function S(){await j(),r("/login")}const R=i.useMemo(()=>is(h),[h]),w=i.useMemo(()=>m&&!us(h,m),[h,m]),u=i.useMemo(()=>{const x=nt(h);return m&&m.length>0?ds(h,m):x},[h,m]),d=i.useMemo(()=>{const x=cs(s.pathname);return x?Oe(h,x):!1},[h,s.pathname]);function g(x,N){R&&(T.current=x.target,O(N),setTimeout(()=>{T.current&&(T.current.style.opacity="0.5")},0))}function M(x,N){R&&N!==E&&D(N)}function p(x){R&&x.preventDefault()}function C(){if(R){if(T.current&&(T.current.style.opacity="1"),E!==null&&b!==null&&E!==b){const x=[...u],N=x[E];x.splice(E,1),x.splice(b,0,N);const K=x.map(G=>G.path);_(K),A(K)}O(null),D(null),T.current=null}}async function A(x){if(c)try{const{error:N}=await P.from("profiles").update({nav_order:x}).eq("id",c.id);N&&o("Failed to save menu order")}catch{o("Failed to save menu order")}}async function L(){if(c)try{const{error:x}=await P.from("profiles").update({nav_order:null}).eq("id",c.id);if(x){o("Failed to reset menu order");return}_(null),l("Menu order reset to default")}catch{o("Failed to reset menu order")}}return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[e.jsxs("aside",{style:{width:v?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[v&&e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),e.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),e.jsx("button",{onClick:()=>y(!v),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:v?e.jsx(J,{size:20}):e.jsx(Kt,{size:20})})]}),e.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:u.map((x,N)=>{const K=x.icon,G=s.pathname===x.path||x.path!=="/dashboard"&&s.pathname.startsWith(x.path),Q=E===N,Y=b===N,ee=Oe(h,x.id);return e.jsx("div",{draggable:R,onDragStart:H=>g(H,N),onDragEnter:H=>M(H,N),onDragOver:p,onDragEnd:C,style:{position:"relative",marginBottom:"0.25rem",borderTop:Y&&E>N?"2px solid #10b981":"2px solid transparent",borderBottom:Y&&E<N?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:e.jsxs(F,{to:x.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:v?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:G?"#10b981":"#64748b",backgroundColor:G?"#f0fdf4":Q?"#f1f5f9":"transparent",fontWeight:G?"600":"500",justifyContent:v?"flex-start":"center",transition:"all 0.15s ease",cursor:R?"grab":"pointer"},children:[v&&R&&e.jsx(Gt,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),e.jsx(K,{size:20}),v&&e.jsx("span",{style:{flex:1},children:x.label}),v&&ee&&e.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},x.path)})}),v&&R&&w&&e.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:e.jsxs("button",{onClick:L,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:x=>{x.currentTarget.style.backgroundColor="#f1f5f9",x.currentTarget.style.color="#475569"},onMouseLeave:x=>{x.currentTarget.style.backgroundColor="#f8fafc",x.currentTarget.style.color="#64748b"},children:[e.jsx(Ht,{size:14}),"Reset Menu Order"]})}),e.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:e.jsxs("button",{onClick:S,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:v?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[e.jsx(Qt,{size:20}),v&&e.jsx("span",{children:"Logout"})]})})]}),e.jsxs("main",{style:{flex:1,marginLeft:v?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[e.jsxs(F,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:x=>x.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:x=>x.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:U}),e.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:B.bg,color:B.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:B.shortLabel})]}),e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:B.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:f})]}),e.jsx(Nr,{})]}),d&&e.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e.jsx("span",{children:"You have read-only access to this page"})]}),e.jsx("div",{style:{flex:1},children:t})]})]})}function ps(){const t=Re(),[s]=_t(),[r,l]=i.useState(!1),[o,c]=i.useState(""),[a,h]=i.useState(""),[j,v]=i.useState(null),[y,m]=i.useState(null),[_,E]=i.useState(!1),[O,b]=i.useState(!1),[D,T]=i.useState(!1),[B,U]=i.useState(!1);i.useEffect(()=>{s.get("expired")==="true"&&(U(!0),window.history.replaceState({},document.title,"/login")),P.auth.getSession().then(({data:{session:d}})=>{d&&t("/dashboard",{replace:!0})});const{data:{subscription:u}}=P.auth.onAuthStateChange((d,g)=>{d==="SIGNED_IN"&&g&&t("/dashboard",{replace:!0})});return()=>u.unsubscribe()},[t,s]);const f=async u=>{u.preventDefault(),l(!0),v(null),m(null),U(!1);try{if(_){const{error:d}=await P.auth.signUp({email:o,password:a,options:{data:{full_name:o.split("@")[0]}}});if(d)throw d;m("Check your email for confirmation link!")}else{const{error:d}=await P.auth.signInWithPassword({email:o,password:a});if(d)throw d}}catch(d){v(d.message)}finally{l(!1)}},S=async u=>{if(u.preventDefault(),!o){v("Please enter your email address");return}l(!0),v(null),m(null);try{const{error:d}=await P.auth.resetPasswordForEmail(o,{redirectTo:`${window.location.origin}/reset-password`});if(d)throw d;m("Password reset email sent! Check your inbox.")}catch(d){v(d.message)}finally{l(!1)}},R=async u=>{if(u.preventDefault(),!o){v("Please enter your email address");return}l(!0),v(null),m(null);try{const{error:d}=await P.auth.resend({type:"signup",email:o});if(d)throw d;m("Verification email resent! Check your inbox.")}catch(d){v(d.message)}finally{l(!1)}},w=()=>{b(!1),T(!1),v(null),m(null),U(!1)};return O?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(Yt,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Reset Password"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:o,onChange:u=>c(u.target.value),required:!0})]}),j&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(be,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:j})]}),y&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(je,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:y})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,style:{width:"100%",justifyContent:"center"},children:r?"Sending...":"Send Reset Link"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:w,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):D?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(_e,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Resend Verification"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:o,onChange:u=>c(u.target.value),required:!0})]}),j&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(be,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:j})]}),y&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(je,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:y})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,style:{width:"100%",justifyContent:"center"},children:r?"Sending...":"Resend Verification Email"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:w,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"← Back to Sign In"})})]})}):e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),e.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),B&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[e.jsx(Z,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:o,onChange:u=>c(u.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"••••••••",value:a,onChange:u=>h(u.target.value),required:!0})]}),j&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(be,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:j})]}),y&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(je,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:y})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,style:{width:"100%",justifyContent:"center"},children:r?"Loading...":_?"Sign Up":"Sign In"})]}),!_&&e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{b(!0),v(null),m(null),U(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{E(!_),v(null),m(null),U(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:_?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),e.jsxs("button",{onClick:()=>{T(!0),v(null),m(null),U(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(_e,{size:14})," Resend Verification Email"]})]})]})})}function Be(t){if(!t)return!1;const s=t.toLowerCase();return s.includes("pmo")||s.includes("project manager")}function hs(){const[t,s]=i.useState(!0),[r,l]=i.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[o,c]=i.useState({signed:0,pending:0,awaitingGeneration:0}),[a,h]=i.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0,pmoResources:[],nonPmoResources:[]}),[j,v]=i.useState([]),[y,m]=i.useState({}),[_,E]=i.useState({}),[O,b]=i.useState([]),[D,T]=i.useState(0),{showTestUsers:B,testUserIds:U}=hr(),{projectId:f,projectName:S,projectRef:R}=Ye();i.useEffect(()=>{f&&w()},[f,B]);async function w(){if(f)try{const{data:d}=await P.from("milestones").select("*").eq("project_id",f).order("milestone_ref");v(d||[]);const{data:g}=await P.from("deliverables").select("*").eq("project_id",f),{data:M}=await P.from("resources").select("*"),{data:p}=await P.from("kpis").select("*").eq("project_id",f).order("kpi_ref"),{data:C}=await P.from("quality_standards").select("*").eq("project_id",f).order("qs_ref");let A=P.from("timesheets").select("*, resources(id, name, role, daily_rate, discount_percent)").eq("project_id",f);B||(A=A.or("is_test_content.is.null,is_test_content.eq.false"));const{data:L}=await A;let x=0,N=0;const K=[],G=[];M&&M.forEach(I=>{const V=(I.daily_rate||0)*(I.days_allocated||0);Be(I.role)?(x+=V,K.push({name:I.name,role:I.role,budget:V})):(N+=V,G.push({name:I.name,role:I.role,budget:V}))});const Q={};let Y=0,ee=0,H=0;L&&M&&L.forEach(I=>{if(!(I.status==="Approved"||I.status==="Submitted"&&!I.was_rejected))return;const yt=parseFloat(I.hours_worked||I.hours||0),pe=I.resources||M.find(he=>he.id===I.resource_id);if(pe){const he=pe.daily_rate||0,re=yt/8*he;I.milestone_id&&(Q[I.milestone_id]=(Q[I.milestone_id]||0)+re),Y+=re,Be(pe.role)?ee+=re:H+=re}}),m(Q),h({pmoBudget:x,pmoSpend:ee,nonPmoBudget:N,nonPmoSpend:H,pmoResources:K,nonPmoResources:G}),b(C||[]);const te={};p&&p.forEach(I=>{const V=I.category||"Other";te[V]||(te[V]=[]),te[V].push(I)}),E(te);const fe=d?.length||0,ke=d?.filter(I=>I.status==="Completed").length||0,ot=g?.length||0,at=g?.filter(I=>I.status==="Delivered").length||0,it=M?.length||0,lt=p?.length||0,ct=p?.filter(I=>(I.current_value||0)>=(I.target||90)).length||0,dt=C?.length||0,ut=C?.filter(I=>(I.current_value||0)>=(I.target||100)).length||0,{data:me}=await P.from("milestone_certificates").select("*").eq("project_id",f),ft=me?.filter(I=>I.status==="Signed").length||0,mt=me?.filter(I=>I.status==="Pending Customer Signature"||I.status==="Pending Supplier Signature").length||0,pt=me?.length||0,ht=Math.max(0,ke-pt);c({signed:ft,pending:mt,awaitingGeneration:ht});const gt=d?.reduce((I,V)=>I+(V.budget||0),0)||0,xt=fe>0?Math.round(d.reduce((I,V)=>I+(V.progress||0),0)/fe):0;T(xt),l({totalMilestones:fe,completedMilestones:ke,totalDeliverables:ot,deliveredCount:at,totalResources:it,totalKPIs:lt,achievedKPIs:ct,totalQS:dt,achievedQS:ut,totalBudget:gt,spendToDate:Y})}catch{}finally{s(!1)}}function u(d){switch(d){case"Time Performance":return"#3b82f6";case"Quality of Collaboration":return"#8b5cf6";case"Delivery Performance":return"#10b981";default:return"#64748b"}}return t?e.jsx(Me,{message:"Loading dashboard...",size:"large",fullPage:!0}):e.jsxs("div",{className:"page-container",children:[e.jsx(Pr,{icon:De,title:`${R||"Project"} Dashboard`,subtitle:S||"Project Tracker"}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",background:"linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%)",color:"white"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{fontSize:"2.5rem",fontWeight:"700",margin:0},children:[D,"%"]}),e.jsx("p",{style:{opacity:.9,margin:0},children:"Overall Project Progress"})]}),e.jsx("div",{style:{width:"120px",height:"120px",position:"relative"},children:e.jsxs("svg",{viewBox:"0 0 100 100",style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"10"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"white",strokeWidth:"10",strokeDasharray:`${D*2.51} 251`,strokeLinecap:"round"})]})})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsx("div",{className:"card",style:{borderLeft:"4px solid #3b82f6"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total Budget"}),e.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:["£",r.totalBudget.toLocaleString()]})]}),e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px"},children:e.jsx(Xt,{size:24,style:{color:"#3b82f6"}})})]})}),e.jsx("div",{className:"card",style:{borderLeft:"4px solid #10b981"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Spend to Date"}),e.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#10b981"},children:["£",Math.round(r.spendToDate).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:[r.totalBudget>0?Math.round(r.spendToDate/r.totalBudget*100):0,"% of budget"]})]}),e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px"},children:e.jsx(ne,{size:24,style:{color:"#10b981"}})})]})})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Jt,{size:20})," PMO Cost Tracking"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",borderRadius:"8px",borderLeft:"4px solid #f59e0b"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e",marginBottom:"0.25rem"},children:"PMO Budget"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#d97706"},children:["£",Math.round(a.pmoBudget).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#92400e"},children:[a.pmoBudget+a.nonPmoBudget>0?Math.round(a.pmoBudget/(a.pmoBudget+a.nonPmoBudget)*100):0,"% of total budget"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#ffedd5",borderRadius:"8px",borderLeft:"4px solid #ea580c"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#9a3412",marginBottom:"0.25rem"},children:"PMO Spend"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#ea580c"},children:["£",Math.round(a.pmoSpend).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#9a3412"},children:[a.pmoBudget>0?Math.round(a.pmoSpend/a.pmoBudget*100):0,"% of PMO budget"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dbeafe",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#1e40af",marginBottom:"0.25rem"},children:"Non-PMO Budget"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#2563eb"},children:["£",Math.round(a.nonPmoBudget).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#1e40af"},children:[a.pmoBudget+a.nonPmoBudget>0?Math.round(a.nonPmoBudget/(a.pmoBudget+a.nonPmoBudget)*100):0,"% of total budget"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dcfce7",borderRadius:"8px",borderLeft:"4px solid #16a34a"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#166534",marginBottom:"0.25rem"},children:"Non-PMO Spend"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#16a34a"},children:["£",Math.round(a.nonPmoSpend).toLocaleString()]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#166534"},children:[a.nonPmoBudget>0?Math.round(a.nonPmoSpend/a.nonPmoBudget*100):0,"% of non-PMO budget"]})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:"Spend Distribution"}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["PMO: ",r.spendToDate>0?Math.round(a.pmoSpend/r.spendToDate*100):0,"% | Non-PMO: ",r.spendToDate>0?Math.round(a.nonPmoSpend/r.spendToDate*100):0,"%"]})]}),e.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#e2e8f0"},children:[e.jsx("div",{style:{width:`${r.spendToDate>0?a.pmoSpend/r.spendToDate*100:0}%`,backgroundColor:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:a.pmoSpend>0?"40px":"0"},children:a.pmoSpend>0&&"PMO"}),e.jsx("div",{style:{width:`${r.spendToDate>0?a.nonPmoSpend/r.spendToDate*100:0}%`,backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:a.nonPmoSpend>0?"60px":"0"},children:a.nonPmoSpend>0&&"Non-PMO"})]})]}),a.pmoResources.length>0&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#fffbeb",borderRadius:"8px"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:"600",color:"#92400e",marginBottom:"0.5rem"},children:["PMO Resources (",a.pmoResources.length,")"]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:a.pmoResources.map((d,g)=>e.jsx("span",{style:{padding:"0.25rem 0.75rem",backgroundColor:"#fef3c7",borderRadius:"4px",fontSize:"0.8rem",color:"#92400e"},children:d.name},g))})]})]}),e.jsxs("div",{className:"stats-grid",style:{marginBottom:"1.5rem"},children:[e.jsx(se,{icon:Z,label:"Milestones",value:`${r.completedMilestones} / ${r.totalMilestones}`,subtext:`${r.totalMilestones>0?Math.round(r.completedMilestones/r.totalMilestones*100):0}% Complete`,color:"#3b82f6"}),e.jsx(se,{icon:Pe,label:"Deliverables",value:`${r.deliveredCount} / ${r.totalDeliverables}`,subtext:`${r.totalDeliverables>0?Math.round(r.deliveredCount/r.totalDeliverables*100):0}% Delivered`,color:"#10b981"}),e.jsx(se,{icon:ne,label:"KPIs",value:`${r.achievedKPIs} / ${r.totalKPIs}`,subtext:`${r.totalKPIs>0?Math.round(r.achievedKPIs/r.totalKPIs*100):0}% Achieved`,color:"#3b82f6"}),e.jsx(se,{icon:oe,label:"Quality Standards",value:`${r.achievedQS} / ${r.totalQS}`,subtext:`${r.totalQS>0?Math.round(r.achievedQS/r.totalQS*100):0}% Achieved`,color:"#8b5cf6"})]}),e.jsx("div",{className:"card",style:{marginBottom:"1.5rem",backgroundColor:"#fefce8",borderLeft:"4px solid #eab308"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Zt,{size:28,style:{color:"#ca8a04"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,color:"#854d0e"},children:"Milestone Acceptance Certificates"}),e.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",color:"#a16207"},children:"Track payment milestone sign-offs"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#16a34a"},children:o.signed}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#166534",fontWeight:"500"},children:"Signed"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#d97706"},children:o.pending}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e",fontWeight:"500"},children:"Pending Signature"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:o.awaitingGeneration>0?"#dc2626":"#64748b"},children:o.awaitingGeneration}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b",fontWeight:"500"},children:"Awaiting Generation"})]})]}),e.jsx(F,{to:"/milestones",style:{padding:"0.5rem 1rem",backgroundColor:"#ca8a04",color:"white",textDecoration:"none",borderRadius:"6px",fontWeight:"500",fontSize:"0.9rem"},children:"View Milestones →"})]})}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Billable vs Spend by Milestone"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"1rem"},children:"Comparing the amount invoiced on completion (billable) against actual cost to date from timesheets"}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"1rem"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem",marginRight:"1rem"},children:[e.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),"Billable on Completion"]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem"},children:[e.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"2px"}}),"Spend to Date (Cost)"]})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",height:"220px",alignItems:"flex-end"},children:j.map(d=>{const g=Math.max(...j.map(A=>A.budget||0)),M=y[d.id]||0,p=g>0?(d.budget||0)/g*100:0,C=g>0?M/g*100:0;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"flex-end",height:"180px",width:"100%",justifyContent:"center"},children:[e.jsx("div",{style:{width:"45%",height:`${p}%`,backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",minHeight:d.budget>0?"20px":"0",position:"relative"},title:`Billable: £${(d.budget||0).toLocaleString()}`,children:p>15&&e.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white",whiteSpace:"nowrap"},children:["£",Math.round((d.budget||0)/1e3),"k"]})}),e.jsx("div",{style:{width:"45%",height:`${C}%`,backgroundColor:"#10b981",borderRadius:"4px 4px 0 0",minHeight:M>0?"20px":"0",position:"relative"},title:`Spend: £${Math.round(M).toLocaleString()}`,children:C>15&&e.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white",whiteSpace:"nowrap"},children:["£",Math.round(M/1e3),"k"]})})]}),e.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"600",color:"#64748b"},children:d.milestone_ref})]},d.id)})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Performance by Category"}),e.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end",height:"200px"},children:Object.entries(_).map(([d,g])=>{const M=g.length,p=g.filter(L=>(L.current_value||0)>=(L.target||90)).length,C=M>0?p/M*100:0,A=u(d);return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"160px",position:"relative"},children:[e.jsx("div",{style:{height:`${100-C}%`,backgroundColor:"#e2e8f0",borderRadius:C>0?"4px 4px 0 0":"4px"}}),e.jsxs("div",{style:{height:`${C}%`,backgroundColor:A,borderRadius:C<100?"0 0 4px 4px":"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"700",fontSize:"1rem"},children:[p,"/",M]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.75rem",marginBottom:"0.25rem"},children:d.split(" ")[0]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[Math.round(C),"%"]})]})]},d)})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Quality Standards Performance"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:O.map(d=>{const g=d.current_value||0,M=g>=(d.target||100);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600",minWidth:"45px",color:"#8b5cf6"},children:d.qs_ref}),e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${g}%`,height:"100%",backgroundColor:M?"#10b981":"#8b5cf6",transition:"width 0.3s"}})})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"45px",color:M?"#10b981":"#64748b"},children:[g,"%"]})]},d.id)})})]})]}),e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0},children:"Milestone Summary"}),e.jsx(F,{to:"/milestones",style:{color:"#3b82f6",textDecoration:"none",fontSize:"0.9rem",fontWeight:"500"},children:"View Details →"})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ref"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Due"}),e.jsx("th",{children:"Budget"}),e.jsx("th",{children:"Spend"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:"No milestones found"})}):j.map(d=>{const g=y[d.id]||0,M=d.budget>0?Math.round(g/d.budget*100):0;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(F,{to:`/milestones/${d.id}`,style:{fontFamily:"monospace",fontWeight:"600",color:"#3b82f6",textDecoration:"none"},children:d.milestone_ref})}),e.jsx("td",{style:{fontWeight:"500"},children:d.name}),e.jsx("td",{children:d.end_date?new Date(d.end_date).toLocaleDateString("en-GB"):"-"}),e.jsxs("td",{children:["£",(d.budget||0).toLocaleString()]}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{color:g>0?"#10b981":"#9ca3af"},children:["£",Math.round(g).toLocaleString()]}),d.budget>0&&e.jsxs("span",{style:{fontSize:"0.75rem",color:M>100?"#dc2626":"#64748b"},children:["(",M,"%)"]})]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"6px",backgroundColor:"#e2e8f0",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${d.progress||0}%`,height:"100%",backgroundColor:d.status==="Completed"?"#10b981":"#3b82f6"}})}),e.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"35px"},children:[d.progress||0,"%"]})]})}),e.jsx("td",{children:e.jsx(wr,{status:d.status||"Not Started"})})]},d.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"1rem"},children:[e.jsxs(F,{to:"/milestones",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(Z,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Milestones"}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"},children:"Track progress"})]}),e.jsxs(F,{to:"/deliverables",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(Pe,{size:32,style:{color:"#10b981",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Deliverables"}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"},children:"Manage deliverables"})]}),e.jsxs(F,{to:"/kpis",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(ne,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"KPIs"}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"},children:"Performance indicators"})]}),e.jsxs(F,{to:"/quality-standards",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(oe,{size:32,style:{color:"#8b5cf6",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Quality"}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"},children:"Quality standards"})]}),e.jsxs(F,{to:"/reports",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[e.jsx(De,{size:32,style:{color:"#f59e0b",marginBottom:"0.5rem"}}),e.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Reports"}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"},children:"Generate reports"})]})]})]})}const gs=i.lazy(()=>$(()=>import("./ResetPassword-BLlXDGck.js"),__vite__mapDeps([0,1,2,3]))),xs=i.lazy(()=>$(()=>import("./Milestones-CIauf_sy.js"),__vite__mapDeps([4,1,5,6,2,3]))),ys=i.lazy(()=>$(()=>import("./MilestoneDetail-BCcBEd1y.js"),__vite__mapDeps([7,1,2,3]))),bs=i.lazy(()=>$(()=>import("./Gantt-CfvyZ-hP.js"),__vite__mapDeps([8,1,5,2,3]))),js=i.lazy(()=>$(()=>import("./Deliverables-CaxuNkM_.js"),__vite__mapDeps([9,1,5,2,3]))),vs=i.lazy(()=>$(()=>import("./Resources-D2HM0Khy.js"),__vite__mapDeps([10,1,5,6,2,3]))),Ss=i.lazy(()=>$(()=>import("./ResourceDetail-BFAM0C3T.js"),__vite__mapDeps([11,1,5,12,2,3]))),_s=i.lazy(()=>$(()=>import("./Partners-DIeKuVXW.js"),__vite__mapDeps([13,1,5,12,6,2,3]))),Ps=i.lazy(()=>$(()=>import("./PartnerDetail-86bpNh06.js"),__vite__mapDeps([14,1,5,12,2,3]))),ws=i.lazy(()=>$(()=>import("./Timesheets-D-9hTuVD.js"),__vite__mapDeps([15,1,5,6,2,12,3]))),Cs=i.lazy(()=>$(()=>import("./Expenses-C4_y3Tue.js"),__vite__mapDeps([16,1,5,6,2,3]))),Rs=i.lazy(()=>$(()=>import("./KPIs-DLQIW1wA.js"),__vite__mapDeps([17,1,5,6,2,3]))),Is=i.lazy(()=>$(()=>import("./KPIDetail-BSxjkh0G.js"),__vite__mapDeps([18,1,5,2,3]))),Ms=i.lazy(()=>$(()=>import("./QualityStandards-edUjK1yV.js"),__vite__mapDeps([19,1,5,6,2,3]))),Es=i.lazy(()=>$(()=>import("./QualityStandardDetail-BmjgMWWA.js"),__vite__mapDeps([20,1,2,3]))),ks=i.lazy(()=>$(()=>import("./Reports-HH2aqk-B.js"),__vite__mapDeps([21,2,1,3]))),Ds=i.lazy(()=>$(()=>import("./Users-tR0c3eDG.js"),__vite__mapDeps([22,1,2,3]))),Ns=i.lazy(()=>$(()=>import("./Settings-Bkx77RMl.js"),__vite__mapDeps([23,1,5,2,3]))),As=i.lazy(()=>$(()=>import("./AccountSettings-DjLxpOc5.js"),__vite__mapDeps([24,1,2,3]))),Ts=i.lazy(()=>$(()=>import("./WorkflowSummary-BIITviNM.js"),__vite__mapDeps([25,1,2,3])));function zs(){return e.jsx("div",{className:"page-container",children:e.jsx(X,{type:"page"})})}function W({children:t}){const{user:s,isLoading:r}=Ie();return r?e.jsx(Me,{message:"Loading...",size:"large",fullPage:!0}):s?e.jsx(ms,{children:e.jsx(i.Suspense,{fallback:e.jsx(zs,{}),children:t||e.jsx(Ct,{})})}):e.jsx(Se,{to:"/login",replace:!0})}function Ls(){return e.jsx(Pt,{children:e.jsx(jr,{children:e.jsx(Mr,{children:e.jsx(fr,{children:e.jsx(mr,{children:e.jsx(pr,{children:e.jsx(xr,{children:e.jsxs(yr,{children:[e.jsxs(wt,{children:[e.jsx(z,{path:"/login",element:e.jsx(ps,{})}),e.jsx(z,{path:"/reset-password",element:e.jsx(i.Suspense,{fallback:e.jsx(Me,{fullPage:!0}),children:e.jsx(gs,{})})}),e.jsx(z,{path:"/",element:e.jsx(Se,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"/dashboard",element:e.jsx(W,{children:e.jsx(hs,{})})}),e.jsx(z,{path:"/milestones",element:e.jsx(W,{children:e.jsx(xs,{})})}),e.jsx(z,{path:"/milestones/:id",element:e.jsx(W,{children:e.jsx(ys,{})})}),e.jsx(z,{path:"/gantt",element:e.jsx(W,{children:e.jsx(bs,{})})}),e.jsx(z,{path:"/deliverables",element:e.jsx(W,{children:e.jsx(js,{})})}),e.jsx(z,{path:"/resources",element:e.jsx(W,{children:e.jsx(vs,{})})}),e.jsx(z,{path:"/resources/:id",element:e.jsx(W,{children:e.jsx(Ss,{})})}),e.jsx(z,{path:"/partners",element:e.jsx(W,{children:e.jsx(_s,{})})}),e.jsx(z,{path:"/partners/:id",element:e.jsx(W,{children:e.jsx(Ps,{})})}),e.jsx(z,{path:"/timesheets",element:e.jsx(W,{children:e.jsx(ws,{})})}),e.jsx(z,{path:"/expenses",element:e.jsx(W,{children:e.jsx(Cs,{})})}),e.jsx(z,{path:"/kpis",element:e.jsx(W,{children:e.jsx(Rs,{})})}),e.jsx(z,{path:"/kpis/:id",element:e.jsx(W,{children:e.jsx(Is,{})})}),e.jsx(z,{path:"/quality-standards",element:e.jsx(W,{children:e.jsx(Ms,{})})}),e.jsx(z,{path:"/quality-standards/:id",element:e.jsx(W,{children:e.jsx(Es,{})})}),e.jsx(z,{path:"/reports",element:e.jsx(W,{children:e.jsx(ks,{})})}),e.jsx(z,{path:"/users",element:e.jsx(W,{children:e.jsx(Ds,{})})}),e.jsx(z,{path:"/settings",element:e.jsx(W,{children:e.jsx(Ns,{})})}),e.jsx(z,{path:"/account",element:e.jsx(W,{children:e.jsx(As,{})})}),e.jsx(z,{path:"/workflow-summary",element:e.jsx(W,{children:e.jsx(Ts,{})})}),e.jsx(z,{path:"*",element:e.jsx(Se,{to:"/dashboard",replace:!0})})]}),e.jsx(kr,{})]})})})})})})})})}we.createRoot(document.getElementById("root")).render(e.jsx(We.StrictMode,{children:e.jsx(Ls,{})}));export{rt as $,on as A,nn as B,Ee as C,sn as D,rn as E,tn as F,ce as G,en as H,Zs as I,Js as J,le as K,Me as L,Xs as M,Fr as N,Qs as O,Pr as P,qr as Q,Vr as R,se as S,$r as T,Br as U,Ur as V,Or as W,Lr as X,zr as Y,Tr as Z,Ar as _,Ye as a,tt as a0,k as a1,yn as a2,n as a3,os as a4,ns as a5,bn as a6,xn as a7,ss as a8,gn as a9,rs as aa,Ys as ab,Hs as ac,Gs as ad,Ks as ae,Fs as af,qs as ag,Vs as ah,Jr as ai,Kr as aj,Wr as ak,Er as b,hr as c,hn as d,pn as e,ts as f,es as g,Zr as h,$s as i,e as j,mn as k,fn as l,Xr as m,un as n,Yr as o,Qr as p,dn as q,cn as r,P as s,ln as t,Ie as u,de as v,Hr as w,st as x,an as y,Gr as z};
