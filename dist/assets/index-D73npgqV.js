const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-y8uwQIoS.js","assets/vendor-react-CaXNtsgv.js","assets/vendor-icons-cI_2Oee6.js","assets/vendor-supabase-qY1sfceY.js","assets/vendor-charts-_mIYJ_kN.js","assets/Milestones-DOkAtZZe.js","assets/usePermissions-Dl3GKB24.js","assets/ConfirmDialog-C52PSqL8.js","assets/MilestoneDetail-BW4yldQL.js","assets/Gantt-CXSkyZYG.js","assets/Deliverables-DuI1Wfis.js","assets/Resources-DyWTfE1a.js","assets/ResourceDetail-CPmnSsmq.js","assets/Partners-MbX4gSma.js","assets/PartnerDetail-Dx2ab1NI.js","assets/Timesheets-DRUqyBKd.js","assets/Expenses-DY8zI816.js","assets/Expenses-BoxYWZca.css","assets/KPIs-B4hcfLXk.js","assets/KPIDetail-DCfXaouU.js","assets/QualityStandards-C6RpVw_T.js","assets/QualityStandardDetail-DeeNNxJo.js","assets/Reports-CzbpdvB7.js","assets/Users-BS2f_Gm7.js","assets/Settings-DMC8pKjW.js","assets/AccountSettings-Bgagd5S9.js","assets/WorkflowSummary-D4djoVTh.js","assets/AuditLog-crVDeJkc.js","assets/DeletedItems-Df3Z6e3F.js"])))=>i.map(i=>d[i]);
var Js=Object.defineProperty;var Zs=(r,e,t)=>e in r?Js(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Xt=(r,e,t)=>Zs(r,typeof e!="symbol"?e+"":e,t);import{r as d,a as Ct,R as Mn,u as Dr,b as eo,L as Le,c as to,d as ro,g as no,B as so,e as oo,f as te,N as hr,O as ao}from"./vendor-react-CaXNtsgv.js";import{c as io}from"./vendor-supabase-qY1sfceY.js";import{A as kn,R as vt,L as On,I as lo,X as In,C as co,a as Ue,M as uo,S as fo,B as Qt,D as ho,T as po,U as mo,b as go,c as Mr,d as yo,e as bo,f as vo,g as Jt,h as xo,i as xt,F as zn,j as Nn,k as it,l as wo,H as _o,m as Tn,n as So,o as jo,p as Po,q as yt,P as pr,r as Ro,G as Co,s as Eo,t as Do,u as Mo,v as ko,w as An,x as Oo,K as Io,y as Zt,z as er,E as zo,J as No,N as To,O as nn,Q as Ao,V as Lo,W as qo}from"./vendor-icons-cI_2Oee6.js";import{p as qe,c as Et}from"./vendor-charts-_mIYJ_kN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var Ln={exports:{}},Dt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wo=d,Bo=Symbol.for("react.element"),$o=Symbol.for("react.fragment"),Ho=Object.prototype.hasOwnProperty,Uo=Wo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fo={key:!0,ref:!0,__self:!0,__source:!0};function qn(r,e,t){var n,s={},a=null,i=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(i=e.ref);for(n in e)Ho.call(e,n)&&!Fo.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Bo,type:r,key:a,ref:i,props:s,_owner:Uo.current}}Dt.Fragment=$o;Dt.jsx=qn;Dt.jsxs=qn;Ln.exports=Dt;var o=Ln.exports,mr={},sn=Ct;mr.createRoot=sn.createRoot,mr.hydrateRoot=sn.hydrateRoot;const Go="modulepreload",Vo=function(r){return"/"+r},on={},le=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");s=Promise.allSettled(t.map(c=>{if(c=Vo(c),c in on)return;on[c]=!0;const u=c.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Go,u||(g.as="script"),g.crossOrigin="",g.href=c,l&&g.setAttribute("nonce",l),document.head.appendChild(g),u)return new Promise((y,S)=>{g.addEventListener("load",y),g.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};var an={},Yo="@vercel/analytics",Ko="1.6.0",Xo=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function Wn(){return typeof window<"u"}function Bn(){try{const r="production"}catch{}return"production"}function Qo(r="auto"){if(r==="auto"){window.vam=Bn();return}window.vam=r}function Jo(){return(Wn()?window.vam:Bn())||"production"}function gr(){return Jo()==="development"}function Zo(r){return r.scriptSrc?r.scriptSrc:gr()?"https://va.vercel-scripts.com/v1/script.debug.js":r.basePath?`${r.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function ea(r={debug:!0}){var e;if(!Wn())return;Qo(r.mode),Xo(),r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend));const t=Zo(r);if(document.head.querySelector(`script[src*="${t}"]`))return;const n=document.createElement("script");n.src=t,n.defer=!0,n.dataset.sdkn=Yo+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=Ko,r.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/insights`),r.dsn&&(n.dataset.dsn=r.dsn),n.onerror=()=>{const s=gr()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information."},gr()&&r.debug===!1&&(n.dataset.debug="false"),document.head.appendChild(n)}function ta({route:r,path:e}){var t;(t=window.va)==null||t.call(window,"pageview",{route:r,path:e})}function ra(){if(!(typeof process>"u"||typeof an>"u"))return an.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function na(r){return d.useEffect(()=>{var e;r.beforeSend&&((e=window.va)==null||e.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]),d.useEffect(()=>{ea({framework:r.framework||"react",basePath:r.basePath??ra(),...r.route!==void 0&&{disableAutoTrack:!0},...r})},[]),d.useEffect(()=>{r.route&&r.path&&ta({route:r.route,path:r.path})},[r.route,r.path]),null}var ln={},sa="@vercel/speed-insights",oa="1.2.0",aa=()=>{window.si||(window.si=function(...e){(window.siq=window.siq||[]).push(e)})};function ia(){return typeof window<"u"}function la(){try{const r="production"}catch{}return"production"}function $n(){return la()==="development"}function ca(r){return r.scriptSrc?r.scriptSrc:$n()?"https://va.vercel-scripts.com/v1/speed-insights/script.debug.js":r.dsn?"https://va.vercel-scripts.com/v1/speed-insights/script.js":r.basePath?`${r.basePath}/speed-insights/script.js`:"/_vercel/speed-insights/script.js"}function ua(r={}){var e;if(!ia()||r.route===null)return null;aa();const t=ca(r);if(document.head.querySelector(`script[src*="${t}"]`))return null;r.beforeSend&&((e=window.si)==null||e.call(window,"beforeSend",r.beforeSend));const n=document.createElement("script");return n.src=t,n.defer=!0,n.dataset.sdkn=sa+(r.framework?`/${r.framework}`:""),n.dataset.sdkv=oa,r.sampleRate&&(n.dataset.sampleRate=r.sampleRate.toString()),r.route&&(n.dataset.route=r.route),r.endpoint?n.dataset.endpoint=r.endpoint:r.basePath&&(n.dataset.endpoint=`${r.basePath}/speed-insights/vitals`),r.dsn&&(n.dataset.dsn=r.dsn),$n()&&r.debug===!1&&(n.dataset.debug="false"),n.onerror=()=>{},document.head.appendChild(n),{setRoute:s=>{n.dataset.route=s??void 0}}}function da(){if(!(typeof process>"u"||typeof ln>"u"))return ln.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function fa(r){d.useEffect(()=>{var t;r.beforeSend&&((t=window.si)==null||t.call(window,"beforeSend",r.beforeSend))},[r.beforeSend]);const e=d.useRef(null);return d.useEffect(()=>{if(e.current)r.route&&e.current(r.route);else{const t=ua({framework:r.framework??"react",basePath:r.basePath??da(),...r});t&&(e.current=t.setRoute)}},[r.route]),null}const ha=void 0,pa=void 0;throw new Error("Missing Supabase environment variables");const j=io(ha,pa),Hn=d.createContext(null),ma=60*1e3,ga=5*60*1e3;function ya({children:r}){const[e,t]=d.useState(null),[n,s]=d.useState(null),[a,i]=d.useState(null),[l,c]=d.useState(!0),[u,p]=d.useState(null),[g,y]=d.useState(!1),S=d.useRef(null),k=d.useRef(Date.now()),P=d.useCallback(()=>{k.current=Date.now()},[]);async function C(x){if(!x){s(null),i(null);return}try{const{data:R,error:z}=await j.from("profiles").select("*").eq("id",x.id).single();if(z){p(z);return}s(R);const{data:A}=await j.from("resources").select("*").eq("user_id",x.id).maybeSingle();i(A),p(null)}catch(R){p(R)}}const w=d.useCallback(async()=>{try{const{data:{session:x},error:R}=await j.auth.getSession();if(R)return;if(!x){await D();return}const z=x.expires_at*1e3,A=Date.now(),N=z-A;if(N<=0)await D();else if(N<=ga){y(!0);const{data:Z,error:he}=await j.auth.refreshSession();he||!Z.session||y(!1)}else y(!1)}catch{}},[]);async function D(){t(null),s(null),i(null),y(!1),await j.auth.signOut();const x=window.location.pathname;x!=="/login"&&x!=="/register"&&(window.location.href="/login?expired=true")}const v=d.useCallback(()=>{S.current&&clearInterval(S.current),S.current=setInterval(()=>{w()},ma);const x=()=>{document.visibilityState==="visible"&&w()};document.addEventListener("visibilitychange",x);const R=["mousedown","keydown","touchstart","scroll"];return R.forEach(z=>{document.addEventListener(z,P,{passive:!0})}),()=>{S.current&&clearInterval(S.current),document.removeEventListener("visibilitychange",x),R.forEach(z=>{document.removeEventListener(z,P)})}},[w,P]);d.useEffect(()=>{let x=!0,R=null;async function z(){try{const{data:{session:N},error:Z}=await j.auth.getSession();Z&&x&&p(Z),x&&(t(N?.user??null),c(!1),N?.user&&(C(N.user),R=v()))}catch(N){x&&(p(N),c(!1))}}z();const{data:{subscription:A}}=j.auth.onAuthStateChange(async(N,Z)=>{x&&(t(Z?.user??null),c(!1),Z?.user?(C(Z.user),R&&R(),R=v()):(s(null),i(null),R&&(R(),R=null)),(N==="SIGNED_OUT"||N==="TOKEN_REFRESHED")&&y(!1))});return()=>{x=!1,A.unsubscribe(),R&&R()}},[v]);async function m(){try{await j.auth.signOut(),t(null),s(null),i(null),y(!1)}catch(x){p(x)}}async function h(){e&&await C(e)}async function b(){try{const{data:x,error:R}=await j.auth.refreshSession();return R?!1:x.session?(y(!1),!0):!1}catch{return!1}}const _={user:e,profile:n,role:n?.role||"viewer",linkedResource:a,isLoading:l,error:u,signOut:m,refreshUserData:h,refreshSession:b,isAuthenticated:!!e,sessionExpiring:g};return o.jsx(Hn.Provider,{value:_,children:r})}function Mt(){const r=d.useContext(Hn);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r}const Un=d.createContext(null);function ba({children:r}){const[e,t]=d.useState(null),[n,s]=d.useState(!0),[a,i]=d.useState(null);d.useEffect(()=>{let p=!0;async function g(){try{const{data:y,error:S}=await j.from("projects").select("*").eq("reference","AMSF001").single();S?p&&i(S):p&&(t(y),i(null))}catch(y){p&&i(y)}finally{p&&s(!1)}}return g(),()=>{p=!1}},[]);async function l(p){s(!0),i(null);try{const{data:g,error:y}=await j.from("projects").select("*").eq("reference",p).single();y?i(y):t(g)}catch(g){i(g)}finally{s(!1)}}async function c(){if(e)try{const{data:p,error:g}=await j.from("projects").select("*").eq("id",e.id).single();g?i(g):t(p)}catch(p){i(p)}}const u={currentProject:e,projectId:e?.id||null,projectRef:e?.reference||null,projectName:e?.name||null,isLoading:n,error:a,switchProject:l,refreshProject:c};return o.jsx(Un.Provider,{value:u,children:r})}function Fn(){const r=d.useContext(Un);if(!r)throw new Error("useProject must be used within a ProjectProvider");return r}const Gn=d.createContext();function va({children:r}){const[e,t]=d.useState(!1),[n,s]=d.useState(null),[a,i]=d.useState([]);d.useEffect(()=>{l(),c()},[]);async function l(){const{data:{user:P}}=await j.auth.getUser();if(P){const{data:C}=await j.from("profiles").select("role").eq("id",P.id).single();C&&s(C.role)}}async function c(){const{data:P}=await j.from("profiles").select("id").eq("is_test_user",!0);P&&i(P.map(C=>C.id))}const u=n==="admin"||n==="supplier_pm";function p(){u&&t(P=>!P)}function g(P){return a.includes(P)}function y(P,C="user_id"){return!P||e?P:P.filter(w=>!a.includes(w[C]))}function S(P){return!P||e?P:P.filter(C=>!C.is_test_content)}const k={showTestUsers:e,setShowTestUsers:t,toggleTestUsers:p,canToggleTestUsers:u,testUserIds:a,isTestUser:g,filterTestContent:y,filterByTestFlag:S,userRole:n};return o.jsx(Gn.Provider,{value:k,children:r})}function xa(){const r=d.useContext(Gn);if(!r)throw new Error("useTestUsers must be used within a TestUserProvider");return r}const Vn=d.createContext();function wa(){return d.useContext(Vn)}function _a({children:r}){const[e,t]=d.useState([]),[n,s]=d.useState(0),[a,i]=d.useState(0),[l,c]=d.useState(!0),[u,p]=d.useState(null),[g,y]=d.useState(null),S=h=>["admin","supplier_pm","customer_pm"].includes(h),k=d.useCallback(async(h,b)=>{try{let _=[];if(S(b)){const{data:x}=await j.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:R}=await j.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:z}=await j.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:A}=await j.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");x&&x.forEach(N=>{_.push({id:`ts-${N.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${N.hours_worked||N.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),R&&R.forEach(N=>{const Z=N.chargeable_to_customer!==!1;_.push({id:`exp-${N.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${N.resource_name||"Unknown"} expense (Â£${parseFloat(N.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:Z})}),z&&z.forEach(N=>{_.push({id:`del-${N.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${N.deliverable_ref}: ${N.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),A&&A.forEach(N=>{_.push({id:`cert-${N.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:x}=await j.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",h),{data:R}=await j.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",h);x&&x.forEach(z=>{_.push({id:`ts-${z.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${z.hours_worked||z.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),R&&R.forEach(z=>{_.push({id:`exp-${z.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (Â£${parseFloat(z.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:_.length,items:_}}catch{return{count:0,items:[]}}},[]),P=d.useCallback(async()=>{try{const{data:{user:h}}=await j.auth.getUser();if(!h){t([]),s(0),i(0),c(!1);return}p(h.id);const{data:b}=await j.from("profiles").select("role").eq("id",h.id).single(),_=b?.role||"viewer";y(_);const{count:x,items:R}=await k(h.id,_);t(R),s(x),i(x)}catch{}finally{c(!1)}},[k]),C=d.useCallback(async h=>{t(b=>b.map(_=>_.id===h?{..._,is_read:!0}:_)),s(b=>Math.max(0,b-1))},[]),w=d.useCallback(async h=>{t(b=>b.map(_=>_.id===h?{..._,is_actioned:!0,is_read:!0}:_)),s(b=>Math.max(0,b-1)),i(b=>Math.max(0,b-1))},[]),D=d.useCallback(async()=>{t(h=>h.map(b=>({...b,is_read:!0}))),s(0)},[]),v=d.useCallback(async h=>{const b=e.find(_=>_.id===h);b&&(t(_=>_.filter(x=>x.id!==h)),b.is_read||s(_=>Math.max(0,_-1)),b.notification_type==="action"&&!b.is_actioned&&i(_=>Math.max(0,_-1)))},[e]);d.useEffect(()=>{P();const h=setInterval(()=>{P()},3e4);return()=>clearInterval(h)},[P]),d.useEffect(()=>{const{data:{subscription:h}}=j.auth.onAuthStateChange((b,_)=>{b==="SIGNED_IN"?P():b==="SIGNED_OUT"&&(t([]),s(0),i(0),p(null),y(null))});return()=>h.unsubscribe()},[P]);const m={notifications:e,unreadCount:n,actionCount:a,loading:l,fetchNotifications:P,markAsRead:C,markAsActioned:w,markAllAsRead:D,dismissNotification:v};return o.jsx(Vn.Provider,{value:m,children:r})}const Yn=d.createContext(null),kr="amsf-chat-history",Sa=50,tr={maxRetries:2,baseDelayMs:1e3,retryableCodes:[429,503,504]};function ja(){try{const r=localStorage.getItem(kr);if(r){const e=JSON.parse(r);return{messages:e.messages||[],tokenUsage:e.tokenUsage||{input:0,output:0,requests:0}}}}catch{}return{messages:[],tokenUsage:{input:0,output:0,requests:0}}}function Pa(r,e){try{const t=r.slice(-Sa);localStorage.setItem(kr,JSON.stringify({messages:t,tokenUsage:e,savedAt:new Date().toISOString()}))}catch{}}function Ra({children:r}){const{user:e,profile:t,linkedResource:n,role:s}=Mt(),{projectId:a,projectName:i,projectRef:l,currentProject:c}=Fn(),u=ja(),[p,g]=d.useState(!1),[y,S]=d.useState(u.messages),[k,P]=d.useState(!1),[C,w]=d.useState(null),[D,v]=d.useState(0),[m,h]=d.useState(u.tokenUsage),b=d.useRef(null);d.useEffect(()=>{(y.length>0||m.requests>0)&&Pa(y,m)},[y,m]);const _=d.useCallback(()=>c?{id:a,reference:l||c?.reference,name:i||c?.name,description:c?.description||null}:null,[c,a,l,i]),x=d.useCallback(()=>({name:t?.full_name||e?.email?.split("@")[0]||"User",email:e?.email,role:s||t?.role||"unknown",linkedResourceName:n?.name||null,linkedResourceId:n?.id||null,partnerId:n?.partner_id||null,partnerName:n?.partners?.name||null}),[e,t,n,s]),R=async(re,ne=1)=>{b.current=new AbortController;try{const $=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re),signal:b.current.signal}),M=await $.json().catch(()=>({}));if(!$.ok){if(tr.retryableCodes.includes($.status)&&ne<=tr.maxRetries&&M.recoverable!==!1){const Y=M.retryAfter?M.retryAfter*1e3:tr.baseDelayMs*Math.pow(2,ne-1);return v(ne),await new Promise(q=>setTimeout(q,Y)),R(re,ne+1)}throw new Error(M.error||`Request failed (${$.status})`)}return v(0),M}catch($){throw $.name==="AbortError"?new Error("Request cancelled"):$}},z=d.useCallback(async re=>{if(!re.trim()||k)return;b.current&&b.current.abort();const ne={role:"user",content:re.trim(),timestamp:new Date().toISOString()};S($=>[...$,ne]),P(!0),w(null),v(0);try{const $=_(),M=x(),Q=[...y.slice(-9),ne].map(q=>({role:q.role,content:q.content})),Y=await R({messages:Q,projectContext:$,userContext:M,projectId:a});Y.usage&&h(q=>({input:q.input+(Y.usage.input_tokens||0),output:q.output+(Y.usage.output_tokens||0),requests:q.requests+1})),S(q=>[...q,{role:"assistant",content:Y.message,toolsUsed:Y.toolsUsed||!1,cached:Y.cached||!1,timestamp:new Date().toISOString(),tokens:Y.usage?{input:Y.usage.input_tokens,output:Y.usage.output_tokens}:null}])}catch($){let M=$.message;$.message==="Request cancelled"?M=null:$.message.includes("Failed to fetch")&&(M="Unable to connect. Please check your internet connection."),M&&(w(M),S(Q=>Q.slice(0,-1)))}finally{P(!1),v(0)}},[y,k,_,x,a]),A=d.useCallback(()=>{b.current&&(b.current.abort(),P(!1),v(0))},[]),N=d.useCallback(()=>{A(),S([]),w(null),localStorage.removeItem(kr)},[A]),Z=d.useCallback(()=>{N(),h({input:0,output:0,requests:0})},[N]),he=d.useCallback(()=>{g(re=>!re)},[]),Ee=d.useCallback(()=>{w(null)},[]),O=d.useCallback(()=>{if(y.length===0)return null;const re=x(),ne=_();let $=`# Chat Export

`;return $+=`**Exported:** ${new Date().toLocaleString("en-GB")}
`,$+=`**User:** ${re.name} (${re.role})
`,ne&&($+=`**Project:** ${ne.name} (${ne.reference})
`),$+=`**Messages:** ${y.length}
`,$+=`**Token Usage:** ${m.input.toLocaleString()} input / ${m.output.toLocaleString()} output

`,$+=`---

`,y.forEach((M,Q)=>{const Y=M.role==="user"?"ðŸ‘¤ You":"ðŸ¤– Assistant",q=M.timestamp?new Date(M.timestamp).toLocaleTimeString("en-GB"):"";$+=`### ${Y}${q?` (${q})`:""}

`,$+=`${M.content}

`,M.toolsUsed&&($+=`*ðŸ“Š Queried project data*

`),Q<y.length-1&&($+=`---

`)}),$},[y,m,x,_]),K=d.useCallback(()=>{const re=O();if(!re)return;const ne=new Blob([re],{type:"text/markdown"}),$=URL.createObjectURL(ne),M=document.createElement("a");M.href=$,M.download=`chat-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL($)},[O]),ye=d.useCallback(async re=>{try{return await navigator.clipboard.writeText(re),!0}catch{return!1}},[]),de={isOpen:p,setIsOpen:g,toggleChat:he,messages:y,isLoading:k,error:C,retryCount:D,tokenUsage:m,sendMessage:z,clearChat:N,resetAllStats:Z,cancelRequest:A,dismissError:Ee,exportChat:O,downloadChat:K,copyMessage:ye};return o.jsx(Yn.Provider,{value:de,children:r})}function Ca(){const r=d.useContext(Yn);if(!r)throw new Error("useChat must be used within a ChatProvider");return r}class Ea extends Mn.Component{constructor(t){super(t);Xt(this,"handleReload",()=>{window.location.reload()});Xt(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){this.setState({errorInfo:n})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[o.jsx(kn,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),o.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),o.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),o.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[o.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),o.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[o.jsx(vt,{size:16}),"Reload Page"]})]})]}):this.props.children}}function Or({message:r,size:e="medium",fullPage:t=!1}){const n={small:{icon:16,text:"0.75rem",padding:"0.5rem"},medium:{icon:24,text:"0.875rem",padding:"1.5rem"},large:{icon:40,text:"1rem",padding:"3rem"}},s=n[e]||n.medium,a={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:s.padding,...t&&{minHeight:"60vh"}},i={animation:"spin 1s linear infinite",color:"#3b82f6"},l={marginTop:"0.75rem",color:"#64748b",fontSize:s.text};return o.jsxs("div",{style:a,children:[o.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}),o.jsx(On,{size:s.icon,style:i}),r&&o.jsx("p",{style:l,children:r})]})}const Da={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function Ce({width:r="100%",height:e="1rem",style:t={},className:n=""}){return o.jsxs(o.Fragment,{children:[o.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),o.jsx("div",{className:n,style:{width:r,height:e,borderRadius:"4px",...Da,...t}})]})}function yr({width:r="100%",lines:e=1}){return o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:e}).map((t,n)=>o.jsx(Ce,{width:n===e-1&&e>1?"70%":r,height:"1rem"},n))})}function Ma(){return o.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[o.jsx(Ce,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),o.jsxs("div",{style:{flex:1},children:[o.jsx(Ce,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),o.jsx(Ce,{width:"40%",height:"1.5rem"})]})]})}function ka({columns:r=6}){return o.jsx("tr",{children:Array.from({length:r}).map((e,t)=>o.jsx("td",{style:{padding:"0.75rem 1rem"},children:o.jsx(Ce,{width:t===0?"80%":t===r-1?"60px":"70%",height:"1rem"})},t))})}function rr({hasHeader:r=!0}){return o.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[r&&o.jsx(Ce,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),o.jsx(yr,{lines:3})]})}function st({type:r="text",count:e=1,...t}){return(()=>{switch(r){case"text":return o.jsx(yr,{...t});case"stat-card":case"stats":return o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:e}).map((s,a)=>o.jsx(Ma,{},a))});case"table":return o.jsx("div",{className:"card",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsx("tr",{children:Array.from({length:t.columns||6}).map((s,a)=>o.jsx("th",{style:{padding:"0.75rem 1rem"},children:o.jsx(Ce,{width:"60%",height:"0.875rem"})},a))})}),o.jsx("tbody",{children:Array.from({length:t.rows||5}).map((s,a)=>o.jsx(ka,{columns:t.columns||6},a))})]})});case"card":return o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:e}).map((s,a)=>o.jsx(rr,{...t},a))});case"page":return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsx(Ce,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),o.jsx(Ce,{width:"300px",height:"1rem"})]}),o.jsx(Ce,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),o.jsx(st,{type:"stats",count:4}),o.jsx(st,{type:"table",rows:8,columns:6})]});case"detail":return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[o.jsx(Ce,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),o.jsx(Ce,{width:"250px",height:"1.75rem"})]}),o.jsx(st,{type:"stats",count:4}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[o.jsx(rr,{}),o.jsx(rr,{})]}),o.jsx(st,{type:"table",rows:5,columns:5})]});default:return o.jsx(yr,{...t})}})()}function ft({icon:r,label:e,value:t,subtext:n,color:s="#3b82f6",borderColor:a,backgroundColor:i,style:l={},onClick:c}){const u={...a&&{borderLeft:`4px solid ${a}`},...i&&{backgroundColor:i},...c&&{cursor:"pointer"},...l};return o.jsxs("div",{className:"stat-card",style:u,onClick:c,role:c?"button":void 0,tabIndex:c?0:void 0,children:[o.jsxs("div",{className:"stat-label",children:[r&&o.jsx(r,{size:20,style:{color:s}}),e]}),o.jsx("div",{className:"stat-value",style:{color:s},children:t}),n&&o.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:n})]})}function Oa({icon:r,title:e,subtitle:t,children:n,style:s={}}){return o.jsxs("div",{className:"page-header",style:s,children:[o.jsxs("div",{className:"page-title",children:[r&&o.jsx(r,{size:28}),o.jsxs("div",{children:[o.jsx("h1",{children:e}),t&&o.jsx("p",{children:t})]})]}),n&&o.jsx("div",{className:"page-actions",children:n})]})}const cn={success:{icon:co,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:In,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:kn,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:lo,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function Ia({id:r,message:e,type:t="info",duration:n=4e3,onClose:s}){const a=cn[t]||cn.info,i=a.icon;return d.useEffect(()=>{if(n>0){const l=setTimeout(()=>{s(r)},n);return()=>clearTimeout(l)}},[r,n,s]),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:a.bgColor,border:`1px solid ${a.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[o.jsx(i,{size:20,style:{color:a.iconColor,flexShrink:0}}),o.jsx("span",{style:{color:a.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:e}),o.jsx("button",{onClick:()=>s(r),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:a.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:l=>l.target.style.opacity=1,onMouseLeave:l=>l.target.style.opacity=.7,children:o.jsx(Ue,{size:16})})]})}function za({toasts:r,removeToast:e}){return r.length===0?null:o.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[o.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),r.map(t=>o.jsx(Ia,{id:t.id,message:t.message,type:t.type,duration:t.duration,onClose:e},t.id))]})}const Kn=d.createContext(null),Na=4e3;function Ta({children:r}){const[e,t]=d.useState([]),n=d.useCallback(p=>{t(g=>g.filter(y=>y.id!==p))},[]),s=d.useCallback((p,g="info",y=Na)=>{const S=Date.now()+Math.random(),k={id:S,message:p,type:g,duration:y};return t(P=>[...P,k]),S},[]),a=d.useCallback((p,g)=>s(p,"success",g),[s]),i=d.useCallback((p,g)=>s(p,"error",g||6e3),[s]),l=d.useCallback((p,g)=>s(p,"warning",g),[s]),c=d.useCallback((p,g)=>s(p,"info",g),[s]),u={showToast:s,showSuccess:a,showError:i,showWarning:l,showInfo:c,removeToast:n};return o.jsxs(Kn.Provider,{value:u,children:[r,o.jsx(za,{toasts:e,removeToast:n})]})}function Aa(){const r=d.useContext(Kn);if(!r)throw new Error("useToast must be used within a ToastProvider");return r}function La(){const{isOpen:r,toggleChat:e,messages:t,isLoading:n,error:s,retryCount:a,tokenUsage:i,sendMessage:l,clearChat:c,cancelRequest:u,dismissError:p,downloadChat:g,copyMessage:y}=Ca(),[S,k]=d.useState(""),[P,C]=d.useState(null),[w,D]=d.useState(!1),v=d.useRef(null),m=d.useRef(null);d.useEffect(()=>{v.current?.scrollIntoView({behavior:"smooth"})},[t]),d.useEffect(()=>{r&&setTimeout(()=>m.current?.focus(),100)},[r]),d.useEffect(()=>{if(P!==null){const A=setTimeout(()=>C(null),2e3);return()=>clearTimeout(A)}},[P]);const h=A=>{A.preventDefault(),S.trim()&&!n&&(l(S),k(""))},b=A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),h(A))},_=async(A,N)=>{await y(A)&&C(N)},x={role:"assistant",content:`Hello! I'm your Project Assistant. I can query your project data and help you understand what's happening. Try asking:

â€¢ **"What do I need to do?"** - See your pending actions
â€¢ **"Show my timesheets this month"** - Query your time entries
â€¢ **"What milestones are at risk?"** - Check project progress
â€¢ **"What's the budget status?"** - View spend vs forecast
â€¢ **"What can my role do?"** - Understand your permissions

All data is scoped to your role, so just ask naturally!`},R=t.length===0?[x]:t,z=(i.input*.25/1e6+i.output*1.25/1e6).toFixed(4);return o.jsxs(o.Fragment,{children:[o.jsx("button",{className:`chat-toggle-btn ${r?"chat-open":""}`,onClick:e,"aria-label":r?"Close chat":"Open AI assistant",children:r?o.jsx(Ue,{size:24}):o.jsxs(o.Fragment,{children:[o.jsx(uo,{size:24}),o.jsx(fo,{className:"chat-sparkle",size:12})]})}),o.jsxs("div",{className:`chat-panel ${r?"chat-panel-open":""}`,children:[o.jsxs("div",{className:"chat-header",children:[o.jsxs("div",{className:"chat-header-title",children:[o.jsx(Qt,{size:20}),o.jsx("span",{children:"Project Assistant"})]}),o.jsxs("div",{className:"chat-header-actions",children:[t.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"chat-action-btn",onClick:g,title:"Export chat as Markdown",children:o.jsx(ho,{size:16})}),o.jsx("button",{className:"chat-action-btn",onClick:c,title:"Clear chat",children:o.jsx(po,{size:16})})]}),o.jsx("button",{className:"chat-close-btn",onClick:e,"aria-label":"Close chat",children:o.jsx(Ue,{size:20})})]})]}),o.jsxs("div",{className:"chat-messages",children:[R.map((A,N)=>o.jsxs("div",{className:`chat-message ${A.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[o.jsx("div",{className:"chat-message-avatar",children:A.role==="user"?o.jsx(mo,{size:16}):o.jsx(Qt,{size:16})}),o.jsxs("div",{className:"chat-message-content",children:[o.jsx(qa,{content:A.content}),o.jsxs("div",{className:"chat-message-actions",children:[A.toolsUsed&&o.jsx("span",{className:"chat-tools-indicator",title:"Queried project data",children:o.jsx(go,{size:12})}),o.jsx("button",{className:"chat-copy-btn",onClick:()=>_(A.content,N),title:P===N?"Copied!":"Copy message",children:P===N?o.jsx(Mr,{size:12,className:"chat-copy-success"}):o.jsx(yo,{size:12})})]})]})]},N)),n&&o.jsxs("div",{className:"chat-message chat-message-assistant",children:[o.jsx("div",{className:"chat-message-avatar",children:o.jsx(Qt,{size:16})}),o.jsxs("div",{className:"chat-message-content chat-typing",children:[a>0?o.jsxs(o.Fragment,{children:[o.jsx(vt,{className:"chat-typing-icon",size:16}),o.jsxs("span",{children:["Retrying (",a,"/2)..."]})]}):o.jsxs(o.Fragment,{children:[o.jsx(On,{className:"chat-typing-icon",size:16}),o.jsx("span",{children:"Querying data..."})]}),o.jsx("button",{className:"chat-cancel-btn",onClick:u,title:"Cancel request",children:o.jsx(In,{size:14})})]})]}),s&&o.jsxs("div",{className:"chat-error",children:[o.jsx("span",{children:s}),o.jsx("button",{className:"chat-error-dismiss",onClick:p,title:"Dismiss",children:o.jsx(Ue,{size:14})})]}),o.jsx("div",{ref:v})]}),o.jsxs("form",{className:"chat-input-form",onSubmit:h,children:[o.jsx("textarea",{ref:m,className:"chat-input",value:S,onChange:A=>k(A.target.value),onKeyDown:b,placeholder:"Ask me anything about the project...",rows:1,disabled:n}),o.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!S.trim()||n,"aria-label":"Send message",children:o.jsx(bo,{size:18})})]}),o.jsxs("div",{className:"chat-footer",children:[o.jsx("button",{className:"chat-stats-toggle",onClick:()=>D(!w),title:"Toggle usage stats",children:o.jsx(vo,{size:12})}),w?o.jsxs("div",{className:"chat-stats",children:[o.jsxs("span",{title:"Total requests",children:[i.requests," req"]}),o.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),o.jsxs("span",{title:"Input tokens",children:[i.input.toLocaleString()," in"]}),o.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),o.jsxs("span",{title:"Output tokens",children:[i.output.toLocaleString()," out"]}),o.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),o.jsxs("span",{title:"Estimated cost",children:["$",z]})]}):o.jsx("span",{children:"Powered by Claude AI"})]})]})]})}function qa({content:r}){const e=r.split(`
`);return o.jsx("div",{className:"chat-message-text",children:e.map((t,n)=>{if(t.startsWith("â€¢ ")||t.startsWith("- ")){const s=t.substring(2);return o.jsxs("div",{className:"chat-bullet",children:[o.jsx("span",{className:"chat-bullet-dot",children:"â€¢"}),o.jsx("span",{dangerouslySetInnerHTML:{__html:un(s)}})]},n)}return t.trim()===""?o.jsx("div",{className:"chat-line-break"},n):o.jsx("p",{dangerouslySetInnerHTML:{__html:un(t)}},n)})})}function un(r){return r.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function Wa(){const[r,e]=d.useState(!1),t=d.useRef(null),n=Dr(),{notifications:s,unreadCount:a,actionCount:i,loading:l,markAsRead:c,markAsActioned:u,markAllAsRead:p,dismissNotification:g}=wa();d.useEffect(()=>{function m(h){t.current&&!t.current.contains(h.target)&&e(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const y=m=>{switch(m){case"timesheet":return o.jsx(it,{size:16});case"expense":return o.jsx(Nn,{size:16});case"deliverable":return o.jsx(zn,{size:16});case"certificate":return o.jsx(xt,{size:16});default:return o.jsx(Jt,{size:16})}},S=m=>m.notification_type==="action"?m.is_actioned?"#10b981":"#f59e0b":"#3b82f6",k=async m=>{m.is_read||await c(m.id),m.action_url&&(n(m.action_url),e(!1))},P=async(m,h)=>{m.stopPropagation(),await u(h.id),h.action_url&&(n(h.action_url),e(!1))},C=async(m,h)=>{m.stopPropagation(),await g(h.id)},w=m=>{const h=new Date(m),_=new Date-h,x=Math.floor(_/6e4),R=Math.floor(_/36e5),z=Math.floor(_/864e5);return x<1?"Just now":x<60?`${x}m ago`:R<24?`${R}h ago`:z<7?`${z}d ago`:h.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},D=s.slice(0,10),v=s.filter(m=>m.notification_type==="action"&&!m.is_actioned);return o.jsxs("div",{className:"notification-bell-container",ref:t,style:{position:"relative"},children:[o.jsxs("button",{onClick:()=>e(!r),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:r?"#f1f5f9":"transparent"},onMouseEnter:m=>m.target.style.backgroundColor="#f1f5f9",onMouseLeave:m=>m.target.style.backgroundColor=r?"#f1f5f9":"transparent",title:`${i} actions pending`,children:[o.jsx(Jt,{size:22,color:"#64748b"}),(a>0||i>0)&&o.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:i>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:i>0?i:a})]}),r&&o.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[o.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),i>0&&o.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[i," action",i!==1?"s":""," required"]})]}),a>0&&o.jsx("button",{onClick:p,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),v.length>0&&o.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[o.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),o.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),o.jsxs("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",o.jsx(xo,{size:16})]})]}),o.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:l?o.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):D.length===0?o.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[o.jsx(Jt,{size:32,style:{marginBottom:"8px",opacity:.5}}),o.jsx("p",{style:{margin:0},children:"No notifications"})]}):D.map(m=>o.jsx("div",{onClick:()=>k(m),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:m.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:h=>h.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:h=>h.currentTarget.style.backgroundColor=m.is_read?"white":"#f8fafc",children:o.jsxs("div",{style:{display:"flex",gap:"12px"},children:[o.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:m.notification_type==="action"&&!m.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:S(m),flexShrink:0},children:y(m.category)}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[o.jsx("span",{style:{fontWeight:m.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:m.title}),o.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:w(m.created_at)})]}),o.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.message}),o.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[m.notification_type==="action"&&!m.is_actioned&&m.action_label&&o.jsx("button",{onClick:h=>P(h,m),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:m.action_label}),m.notification_type==="info"&&o.jsxs("button",{onClick:h=>C(h,m),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx(Ue,{size:12}),"Dismiss"]}),m.is_actioned&&o.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx(Mr,{size:12}),"Completed"]})]})]})]})},m.id))}),s.length>10&&o.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:o.jsx("button",{onClick:()=>{n("/workflow-summary"),e(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),o.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const f={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"};function F(r,e){return e.includes(r)}function Ju(r){return F(r,[f.ADMIN,f.SUPPLIER_PM])}function Xn(r){return F(r,[f.CONTRIBUTOR,f.SUPPLIER_PM,f.ADMIN])}function Qn(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Ba(r){return F(r,[f.CUSTOMER_PM,f.ADMIN])}function Zu(r,e,t,n){if(F(r,[f.ADMIN,f.SUPPLIER_PM]))return!0;let s,a,i;return typeof e=="object"&&e!==null?(s=e.status,a=e.created_by||e.resource?.user_id,i=t):(s=e,a=t,i=n),a===i&&(s==="Draft"||s==="Rejected")}function ed(r,e,t,n){if(r===f.ADMIN||r===f.SUPPLIER_PM)return!0;let s,a,i;return typeof e=="object"&&e!==null?(s=e.status,a=e.created_by||e.resource?.user_id,i=t):(s=e,a=t,i=n),a===i&&s==="Draft"}function td(r,e,t,n){let s,a,i;return typeof e=="object"&&e!==null?(s=e.status,a=e.created_by||e.resource?.user_id,i=t):(s=e,a=t,i=n),s!=="Draft"&&s!=="Rejected"?!1:F(r,[f.ADMIN,f.SUPPLIER_PM])?!0:a===i&&Xn(r)}function $a(r){return F(r,[f.CONTRIBUTOR,f.SUPPLIER_PM,f.ADMIN])}function Ha(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function rd(r,e,t){let n,s;return typeof e=="object"&&e!==null?(n=e.status,s=e.chargeable||e.chargeable_to_customer):(n=e,s=t),n!=="Submitted"?!1:r===f.ADMIN?!0:s?r===f.CUSTOMER_PM:r===f.SUPPLIER_PM}function Ua(r){return F(r,[f.CUSTOMER_PM,f.ADMIN])}function Fa(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function nd(r,e,t,n){if(F(r,[f.ADMIN,f.SUPPLIER_PM]))return!0;let s,a,i;return typeof e=="object"&&e!==null?(s=e.status,a=e.created_by,i=t):(s=e,a=t,i=n),a===i&&(s==="Draft"||s==="Rejected")}function sd(r,e,t,n){if(r===f.ADMIN||r===f.SUPPLIER_PM)return!0;let s,a,i;return typeof e=="object"&&e!==null?(s=e.status,a=e.created_by,i=t):(s=e,a=t,i=n),a===i&&s==="Draft"}function Ga(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Va(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Ya(r){return r===f.ADMIN}function Ka(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Xa(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function Qa(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function od(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function ad(r,e,t){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])?!0:r===f.CONTRIBUTOR?e?.assigned_to===t||e?.resource?.user_id===t:!1}function Ja(r){return F(r,[f.CUSTOMER_PM,f.ADMIN])}function id(r){return F(r,[f.CONTRIBUTOR,f.SUPPLIER_PM,f.ADMIN])}function kt(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function ld(r){return kt(r)}function cd(r){return kt(r)}function ud(r){return kt(r)}function Ot(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function dd(r){return Ot(r)}function fd(r){return Ot(r)}function hd(r){return Ot(r)}function Ir(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function pd(r){return Ir(r)}function md(r){return Ir(r)}function Za(r){return r===f.ADMIN}function ei(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function gd(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Jn(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function ti(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function It(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function yd(r){return It(r)}function bd(r){return It(r)}function vd(r){return It(r)}function ri(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function ni(r){return F(r,[f.CUSTOMER_PM,f.ADMIN])}function xd(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function si(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function wd(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function oi(r){return r===f.ADMIN}function _d(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function ai(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function ii(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function li(r){return F(r,[f.SUPPLIER_PM,f.ADMIN])}function Sd(r){return Jn(r)}function jd(r){return F(r,[f.CUSTOMER_PM,f.SUPPLIER_PM,f.ADMIN])}function ci(r,e,t){return!e||!Array.isArray(e)?[]:Qn(r)?e:e.filter(n=>n.user_id===t)}function Pd(r,e){return!r||!Array.isArray(r)?null:r.find(t=>t.user_id===e)||null}function ui(r,e,t){const n=ci(r,e,t);return n.length===0?null:n.find(a=>a.user_id===t)||n[0]}function Rd(r,e,t){return ui(r,e,t)?.id||null}function di(r){const e={admin:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},supplier_pm:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},customer_pm:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},contributor:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},viewer:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}};return e[r]||e.viewer}function fi(r){return di(r).label}const Cd=[{value:"viewer",label:"Viewer",color:"#64748b",bg:"#f1f5f9"},{value:"contributor",label:"Contributor",color:"#2563eb",bg:"#dbeafe"},{value:"customer_pm",label:"Customer PM",color:"#d97706",bg:"#fef3c7"},{value:"supplier_pm",label:"Supplier PM",color:"#059669",bg:"#d1fae5"},{value:"admin",label:"Admin",color:"#7c3aed",bg:"#f3e8ff"}];function Ed(r){return{role:r,roleLabel:fi(r),timesheets:{canAdd:Xn(r),canAddForOthers:Qn(r),canApprove:Ba(r)},expenses:{canAdd:$a(r),canAddForOthers:Ha(r),canValidateChargeable:Ua(r),canValidateNonChargeable:Fa(r)},milestones:{canCreate:Ga(r),canEdit:Va(r),canDelete:Ya(r),canUseGantt:Ka(r)},deliverables:{canCreate:Xa(r),canEdit:Qa(r),canReview:Ja(r)},kpis:{canManage:kt(r)},qualityStandards:{canManage:Ot(r)},resources:{canManage:Ir(r),canDelete:Za(r),canSeeCostPrice:ei(r),canSeeMargins:Jn(r)},partners:{canView:ti(r),canManage:It(r)},certificates:{canSignAsSupplier:ri(r),canSignAsCustomer:ni(r)},admin:{canAccessSettings:si(r),canManageUsers:oi(r),canViewWorkflowSummary:ai(r)},invoicing:{canGenerateCustomerInvoice:ii(r),canGenerateThirdPartyInvoice:li(r)}}}const zt={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:Do,label:"Workflow Summary",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:Eo,label:"Dashboard",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.VIEWER],readOnlyRoles:[f.VIEWER]},reports:{id:"reports",path:"/reports",icon:zn,label:"Reports",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:Co,label:"Gantt Chart",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.VIEWER],readOnlyRoles:[f.VIEWER,f.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:Ro,label:"Milestones",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.VIEWER],readOnlyRoles:[f.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:pr,label:"Deliverables",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.CONTRIBUTOR,f.VIEWER],readOnlyRoles:[f.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:yt,label:"KPIs",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.VIEWER],readOnlyRoles:[f.VIEWER,f.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:xt,label:"Quality Standards",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.VIEWER],readOnlyRoles:[f.VIEWER,f.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:Po,label:"Resources",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:it,label:"Timesheets",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:Nn,label:"Expenses",allowedRoles:[f.ADMIN,f.SUPPLIER_PM,f.CUSTOMER_PM,f.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:jo,label:"Partners",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:So,label:"Users",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[f.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:Tn,label:"Settings",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[]},auditLog:{id:"auditLog",path:"/audit-log",icon:_o,label:"Audit Log",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[]},deletedItems:{id:"deletedItems",path:"/deleted-items",icon:wo,label:"Deleted Items",allowedRoles:[f.ADMIN,f.SUPPLIER_PM],readOnlyRoles:[]}},wt={[f.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[f.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[f.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[f.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[f.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function hi(r){return(wt[r]||wt[f.VIEWER]).map(t=>zt[t]?.path).filter(Boolean)}function Zn(r){return(wt[r]||wt[f.VIEWER]).map(t=>zt[t]).filter(t=>t&&t.allowedRoles.includes(r))}function dn(r,e){const t=zt[e];return t?t.readOnlyRoles?.includes(r)||!1:!0}function pi(r){return r!==f.VIEWER}function mi(r){return Object.values(zt).find(e=>e.path===r)||null}function gi(r){return mi(r)?.id||null}function yi(r,e){const t=Zn(r);if(!e||!Array.isArray(e)||e.length===0)return t;const n={};t.forEach(a=>{n[a.path]=a});const s=[];return e.forEach(a=>{n[a]&&(s.push(n[a]),delete n[a])}),Object.values(n).forEach(a=>{s.push(a)}),s}function bi(r,e){if(!e||e.length===0)return!0;const t=hi(r);return e.length!==t.length?!1:e.every((n,s)=>n===t[s])}const fn={[f.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[f.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[f.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[f.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[f.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function vi(r){return fn[r]||fn[f.VIEWER]}function xi({children:r}){const e=eo(),t=Dr(),{showSuccess:n,showError:s}=Aa(),{user:a,profile:i,role:l,signOut:c}=Mt(),[u,p]=d.useState(!0),[g,y]=d.useState(null),[S,k]=d.useState(null),[P,C]=d.useState(null),w=d.useRef(null),D=d.useMemo(()=>vi(l),[l]),v=d.useMemo(()=>i&&(i.full_name||i.email||a?.email)||"User",[i,a]),m=d.useMemo(()=>{if(!i)return"U";if(i.full_name){const O=i.full_name.split(" ");return O.length>=2?O[0][0]+O[O.length-1][0]:i.full_name[0].toUpperCase()}return v[0].toUpperCase()},[i,v]);d.useEffect(()=>{i?.nav_order&&Array.isArray(i.nav_order)&&y(i.nav_order)},[i]);async function h(){await c(),t("/login")}const b=d.useMemo(()=>pi(l),[l]),_=d.useMemo(()=>g&&!bi(l,g),[l,g]),x=d.useMemo(()=>{const O=Zn(l);return g&&g.length>0?yi(l,g):O},[l,g]),R=d.useMemo(()=>{const O=gi(e.pathname);return O?dn(l,O):!1},[l,e.pathname]);function z(O,K){b&&(w.current=O.target,k(K),setTimeout(()=>{w.current&&(w.current.style.opacity="0.5")},0))}function A(O,K){b&&K!==S&&C(K)}function N(O){b&&O.preventDefault()}function Z(){if(b){if(w.current&&(w.current.style.opacity="1"),S!==null&&P!==null&&S!==P){const O=[...x],K=O[S];O.splice(S,1),O.splice(P,0,K);const ye=O.map(de=>de.path);y(ye),he(ye)}k(null),C(null),w.current=null}}async function he(O){if(a)try{const{error:K}=await j.from("profiles").update({nav_order:O}).eq("id",a.id);K&&s("Failed to save menu order")}catch{s("Failed to save menu order")}}async function Ee(){if(a)try{const{error:O}=await j.from("profiles").update({nav_order:null}).eq("id",a.id);if(O){s("Failed to reset menu order");return}y(null),n("Menu order reset to default")}catch{s("Failed to reset menu order")}}return o.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[o.jsxs("aside",{style:{width:u?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[o.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[u&&o.jsxs("div",{children:[o.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),o.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),o.jsx("button",{onClick:()=>p(!u),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u?o.jsx(Ue,{size:20}):o.jsx(Mo,{size:20})})]}),o.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:x.map((O,K)=>{const ye=O.icon,de=e.pathname===O.path||O.path!=="/dashboard"&&e.pathname.startsWith(O.path),re=S===K,ne=P===K,$=dn(l,O.id);return o.jsx("div",{draggable:b,onDragStart:M=>z(M,K),onDragEnter:M=>A(M,K),onDragOver:N,onDragEnd:Z,style:{position:"relative",marginBottom:"0.25rem",borderTop:ne&&S>K?"2px solid #10b981":"2px solid transparent",borderBottom:ne&&S<K?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:o.jsxs(Le,{to:O.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:u?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:de?"#10b981":"#64748b",backgroundColor:de?"#f0fdf4":re?"#f1f5f9":"transparent",fontWeight:de?"600":"500",justifyContent:u?"flex-start":"center",transition:"all 0.15s ease",cursor:b?"grab":"pointer"},children:[u&&b&&o.jsx(ko,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),o.jsx(ye,{size:20}),u&&o.jsx("span",{style:{flex:1},children:O.label}),u&&$&&o.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},O.path)})}),u&&b&&_&&o.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:o.jsxs("button",{onClick:Ee,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:O=>{O.currentTarget.style.backgroundColor="#f1f5f9",O.currentTarget.style.color="#475569"},onMouseLeave:O=>{O.currentTarget.style.backgroundColor="#f8fafc",O.currentTarget.style.color="#64748b"},children:[o.jsx(An,{size:14}),"Reset Menu Order"]})}),o.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:o.jsxs("button",{onClick:h,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:u?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[o.jsx(Oo,{size:20}),u&&o.jsx("span",{children:"Logout"})]})})]}),o.jsxs("main",{style:{flex:1,marginLeft:u?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[o.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[o.jsxs(Le,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:O=>O.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:O=>O.currentTarget.style.backgroundColor="transparent",children:[o.jsxs("div",{style:{textAlign:"right"},children:[o.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:v}),o.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:D.bg,color:D.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:D.shortLabel})]}),o.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:D.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:m})]}),o.jsx(Wa,{})]}),R&&o.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),o.jsx("span",{children:"You have read-only access to this page"})]}),o.jsx("div",{style:{flex:1},children:r})]})]})}function wi(){const r=Dr(),[e]=to(),[t,n]=d.useState(!1),[s,a]=d.useState(""),[i,l]=d.useState(""),[c,u]=d.useState(null),[p,g]=d.useState(null),[y,S]=d.useState(!1),[k,P]=d.useState(!1),[C,w]=d.useState(!1),[D,v]=d.useState(!1);d.useEffect(()=>{e.get("expired")==="true"&&(v(!0),window.history.replaceState({},document.title,"/login")),j.auth.getSession().then(({data:{session:R}})=>{R&&r("/dashboard",{replace:!0})});const{data:{subscription:x}}=j.auth.onAuthStateChange((R,z)=>{R==="SIGNED_IN"&&z&&r("/dashboard",{replace:!0})});return()=>x.unsubscribe()},[r,e]);const m=async x=>{x.preventDefault(),n(!0),u(null),g(null),v(!1);try{if(y){const{error:R}=await j.auth.signUp({email:s,password:i,options:{data:{full_name:s.split("@")[0]}}});if(R)throw R;g("Check your email for confirmation link!")}else{const{error:R}=await j.auth.signInWithPassword({email:s,password:i});if(R)throw R}}catch(R){u(R.message)}finally{n(!1)}},h=async x=>{if(x.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),g(null);try{const{error:R}=await j.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/reset-password`});if(R)throw R;g("Password reset email sent! Check your inbox.")}catch(R){u(R.message)}finally{n(!1)}},b=async x=>{if(x.preventDefault(),!s){u("Please enter your email address");return}n(!0),u(null),g(null);try{const{error:R}=await j.auth.resend({type:"signup",email:s});if(R)throw R;g("Verification email resent! Check your inbox.")}catch(R){u(R.message)}finally{n(!1)}},_=()=>{P(!1),w(!1),u(null),g(null),v(!1)};return k?o.jsx("div",{className:"auth-container",children:o.jsxs("div",{className:"auth-box",children:[o.jsxs("div",{className:"auth-logo",children:[o.jsx(Io,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),o.jsx("h1",{className:"auth-title",children:"Reset Password"}),o.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),o.jsxs("form",{onSubmit:h,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),o.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>a(x.target.value),required:!0})]}),c&&o.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[o.jsx(Zt,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),p&&o.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[o.jsx(er,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:p})]}),o.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Send Reset Link"})]}),o.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:o.jsx("button",{onClick:_,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"â† Back to Sign In"})})]})}):C?o.jsx("div",{className:"auth-container",children:o.jsxs("div",{className:"auth-box",children:[o.jsxs("div",{className:"auth-logo",children:[o.jsx(vt,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),o.jsx("h1",{className:"auth-title",children:"Resend Verification"}),o.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),o.jsxs("form",{onSubmit:b,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),o.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>a(x.target.value),required:!0})]}),c&&o.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[o.jsx(Zt,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),p&&o.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[o.jsx(er,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:p})]}),o.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Resend Verification Email"})]}),o.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:o.jsx("button",{onClick:_,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"â† Back to Sign In"})})]})}):o.jsx("div",{className:"auth-container",children:o.jsxs("div",{className:"auth-box",children:[o.jsxs("div",{className:"auth-logo",children:[o.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),o.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),D&&o.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[o.jsx(it,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),o.jsxs("form",{onSubmit:m,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),o.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:s,onChange:x=>a(x.target.value),required:!0})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),o.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:i,onChange:x=>l(x.target.value),required:!0})]}),c&&o.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[o.jsx(Zt,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),p&&o.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[o.jsx(er,{size:20}),o.jsx("span",{style:{fontSize:"0.875rem"},children:p})]}),o.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Loading...":y?"Sign Up":"Sign In"})]}),!y&&o.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:o.jsx("button",{onClick:()=>{P(!0),u(null),g(null),v(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),o.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:o.jsx("button",{onClick:()=>{S(!y),u(null),g(null),v(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:y?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),o.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[o.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),o.jsxs("button",{onClick:()=>{w(!0),u(null),g(null),v(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[o.jsx(vt,{size:14})," Resend Verification Email"]})]})]})})}var es={exports:{}},lt={},br={exports:{}};(function(r,e){(function(t,n){n(e)})(ro,function(t){function n(E){return function(L,H,V,se,ue,pe,oe){return E(L,H,oe)}}function s(E){return function(L,H,V,se){if(!L||!H||typeof L!="object"||typeof H!="object")return E(L,H,V,se);var ue=se.get(L),pe=se.get(H);if(ue&&pe)return ue===H&&pe===L;se.set(L,H),se.set(H,L);var oe=E(L,H,V,se);return se.delete(L),se.delete(H),oe}}function a(E,I){var L={};for(var H in E)L[H]=E[H];for(var H in I)L[H]=I[H];return L}function i(E){return E.constructor===Object||E.constructor==null}function l(E){return typeof E.then=="function"}function c(E,I){return E===I||E!==E&&I!==I}var u="[object Arguments]",p="[object Boolean]",g="[object Date]",y="[object RegExp]",S="[object Map]",k="[object Number]",P="[object Object]",C="[object Set]",w="[object String]",D=Object.prototype.toString;function v(E){var I=E.areArraysEqual,L=E.areDatesEqual,H=E.areMapsEqual,V=E.areObjectsEqual,se=E.areRegExpsEqual,ue=E.areSetsEqual,pe=E.createIsNestedEqual,oe=pe(_e);function _e(J,ee,xe){if(J===ee)return!0;if(!J||!ee||typeof J!="object"||typeof ee!="object")return J!==J&&ee!==ee;if(i(J)&&i(ee))return V(J,ee,oe,xe);var tt=Array.isArray(J),dt=Array.isArray(ee);if(tt||dt)return tt===dt&&I(J,ee,oe,xe);var Re=D.call(J);return Re!==D.call(ee)?!1:Re===g?L(J,ee,oe,xe):Re===y?se(J,ee,oe,xe):Re===S?H(J,ee,oe,xe):Re===C?ue(J,ee,oe,xe):Re===P||Re===u?l(J)||l(ee)?!1:V(J,ee,oe,xe):Re===p||Re===k||Re===w?c(J.valueOf(),ee.valueOf()):!1}return _e}function m(E,I,L,H){var V=E.length;if(I.length!==V)return!1;for(;V-- >0;)if(!L(E[V],I[V],V,V,E,I,H))return!1;return!0}var h=s(m);function b(E,I){return c(E.valueOf(),I.valueOf())}function _(E,I,L,H){var V=E.size===I.size;if(!V)return!1;if(!E.size)return!0;var se={},ue=0;return E.forEach(function(pe,oe){if(V){var _e=!1,J=0;I.forEach(function(ee,xe){!_e&&!se[J]&&(_e=L(oe,xe,ue,J,E,I,H)&&L(pe,ee,oe,xe,E,I,H))&&(se[J]=!0),J++}),ue++,V=_e}}),V}var x=s(_),R="_owner",z=Object.prototype.hasOwnProperty;function A(E,I,L,H){var V=Object.keys(E),se=V.length;if(Object.keys(I).length!==se)return!1;for(var ue;se-- >0;){if(ue=V[se],ue===R){var pe=!!E.$$typeof,oe=!!I.$$typeof;if((pe||oe)&&pe!==oe)return!1}if(!z.call(I,ue)||!L(E[ue],I[ue],ue,ue,E,I,H))return!1}return!0}var N=s(A);function Z(E,I){return E.source===I.source&&E.flags===I.flags}function he(E,I,L,H){var V=E.size===I.size;if(!V)return!1;if(!E.size)return!0;var se={};return E.forEach(function(ue,pe){if(V){var oe=!1,_e=0;I.forEach(function(J,ee){!oe&&!se[_e]&&(oe=L(ue,J,pe,ee,E,I,H))&&(se[_e]=!0),_e++}),V=oe}}),V}var Ee=s(he),O=Object.freeze({areArraysEqual:m,areDatesEqual:b,areMapsEqual:_,areObjectsEqual:A,areRegExpsEqual:Z,areSetsEqual:he,createIsNestedEqual:n}),K=Object.freeze({areArraysEqual:h,areDatesEqual:b,areMapsEqual:x,areObjectsEqual:N,areRegExpsEqual:Z,areSetsEqual:Ee,createIsNestedEqual:n}),ye=v(O);function de(E,I){return ye(E,I,void 0)}var re=v(a(O,{createIsNestedEqual:function(){return c}}));function ne(E,I){return re(E,I,void 0)}var $=v(K);function M(E,I){return $(E,I,new WeakMap)}var Q=v(a(K,{createIsNestedEqual:function(){return c}}));function Y(E,I){return Q(E,I,new WeakMap)}function q(E){return v(a(O,E(O)))}function ae(E){var I=v(a(K,E(K)));return function(L,H,V){return V===void 0&&(V=new WeakMap),I(L,H,V)}}t.circularDeepEqual=M,t.circularShallowEqual=Y,t.createCustomCircularEqual=ae,t.createCustomEqual=q,t.deepEqual=de,t.sameValueZeroEqual=c,t.shallowEqual=ne,Object.defineProperty(t,"__esModule",{value:!0})})})(br,br.exports);var zr=br.exports,G={},_i=function(e,t,n){return e===t?!0:e.className===t.className&&n(e.style,t.style)&&e.width===t.width&&e.autoSize===t.autoSize&&e.cols===t.cols&&e.draggableCancel===t.draggableCancel&&e.draggableHandle===t.draggableHandle&&n(e.verticalCompact,t.verticalCompact)&&n(e.compactType,t.compactType)&&n(e.layout,t.layout)&&n(e.margin,t.margin)&&n(e.containerPadding,t.containerPadding)&&e.rowHeight===t.rowHeight&&e.maxRows===t.maxRows&&e.isBounded===t.isBounded&&e.isDraggable===t.isDraggable&&e.isResizable===t.isResizable&&e.allowOverlap===t.allowOverlap&&e.preventCollision===t.preventCollision&&e.useCSSTransforms===t.useCSSTransforms&&e.transformScale===t.transformScale&&e.isDroppable===t.isDroppable&&n(e.resizeHandles,t.resizeHandles)&&n(e.resizeHandle,t.resizeHandle)&&e.onLayoutChange===t.onLayoutChange&&e.onDragStart===t.onDragStart&&e.onDrag===t.onDrag&&e.onDragStop===t.onDragStop&&e.onResizeStart===t.onResizeStart&&e.onResize===t.onResize&&e.onResizeStop===t.onResizeStop&&e.onDrop===t.onDrop&&n(e.droppingItem,t.droppingItem)&&n(e.innerRef,t.innerRef)};Object.defineProperty(G,"__esModule",{value:!0});G.bottom=Nr;G.childrenEqual=Pi;G.cloneLayout=ts;G.cloneLayoutItem=Fe;G.collides=Nt;G.compact=ns;G.compactItem=ss;G.compactType=qi;G.correctBounds=os;G.fastPositionEqual=Ri;G.fastRGLPropsEqual=void 0;G.getAllCollisions=as;G.getFirstCollision=$e;G.getLayoutItem=Tr;G.getStatics=Ar;G.modifyLayout=rs;G.moveElement=at;G.moveElementAwayFromCollision=xr;G.noop=void 0;G.perc=Ei;G.resizeItemInDirection=zi;G.setTopLeft=Ti;G.setTransform=Ni;G.sortLayoutItems=Hr;G.sortLayoutItemsByColRow=ds;G.sortLayoutItemsByRowCol=us;G.synchronizeLayoutWithChildren=Ai;G.validateLayout=Li;G.withLayoutItem=ji;var hn=zr,ot=Si(d);function Si(r){return r&&r.__esModule?r:{default:r}}function Nr(r){let e=0,t;for(let n=0,s=r.length;n<s;n++)t=r[n].y+r[n].h,t>e&&(e=t);return e}function ts(r){const e=Array(r.length);for(let t=0,n=r.length;t<n;t++)e[t]=Fe(r[t]);return e}function rs(r,e){const t=Array(r.length);for(let n=0,s=r.length;n<s;n++)e.i===r[n].i?t[n]=e:t[n]=r[n];return t}function ji(r,e,t){let n=Tr(r,e);return n?(n=t(Fe(n)),r=rs(r,n),[r,n]):[r,null]}function Fe(r){return{w:r.w,h:r.h,x:r.x,y:r.y,i:r.i,minW:r.minW,maxW:r.maxW,minH:r.minH,maxH:r.maxH,moved:!!r.moved,static:!!r.static,isDraggable:r.isDraggable,isResizable:r.isResizable,resizeHandles:r.resizeHandles,isBounded:r.isBounded}}function Pi(r,e){return(0,hn.deepEqual)(ot.default.Children.map(r,t=>t?.key),ot.default.Children.map(e,t=>t?.key))&&(0,hn.deepEqual)(ot.default.Children.map(r,t=>t?.props["data-grid"]),ot.default.Children.map(e,t=>t?.props["data-grid"]))}G.fastRGLPropsEqual=_i;function Ri(r,e){return r.left===e.left&&r.top===e.top&&r.width===e.width&&r.height===e.height}function Nt(r,e){return!(r.i===e.i||r.x+r.w<=e.x||r.x>=e.x+e.w||r.y+r.h<=e.y||r.y>=e.y+e.h)}function ns(r,e,t,n){const s=Ar(r),a=Hr(r,e),i=Array(r.length);for(let l=0,c=a.length;l<c;l++){let u=Fe(a[l]);u.static||(u=ss(s,u,e,t,a,n),s.push(u)),i[r.indexOf(a[l])]=u,u.moved=!1}return i}const Ci={x:"w",y:"h"};function vr(r,e,t,n){const s=Ci[n];e[n]+=1;const a=r.map(i=>i.i).indexOf(e.i);for(let i=a+1;i<r.length;i++){const l=r[i];if(!l.static){if(l.y>e.y+e.h)break;Nt(e,l)&&vr(r,l,t+e[s],n)}}e[n]=t}function ss(r,e,t,n,s,a){const i=t==="vertical",l=t==="horizontal";if(i)for(e.y=Math.min(Nr(r),e.y);e.y>0&&!$e(r,e);)e.y--;else if(l)for(;e.x>0&&!$e(r,e);)e.x--;let c;for(;(c=$e(r,e))&&!(t===null&&a);)if(l?vr(s,e,c.x+c.w,"x"):vr(s,e,c.y+c.h,"y"),l&&e.x+e.w>n)for(e.x=n-e.w,e.y++;e.x>0&&!$e(r,e);)e.x--;return e.y=Math.max(e.y,0),e.x=Math.max(e.x,0),e}function os(r,e){const t=Ar(r);for(let n=0,s=r.length;n<s;n++){const a=r[n];if(a.x+a.w>e.cols&&(a.x=e.cols-a.w),a.x<0&&(a.x=0,a.w=e.cols),!a.static)t.push(a);else for(;$e(t,a);)a.y++}return r}function Tr(r,e){for(let t=0,n=r.length;t<n;t++)if(r[t].i===e)return r[t]}function $e(r,e){for(let t=0,n=r.length;t<n;t++)if(Nt(r[t],e))return r[t]}function as(r,e){return r.filter(t=>Nt(t,e))}function Ar(r){return r.filter(e=>e.static)}function at(r,e,t,n,s,a,i,l,c){if(e.static&&e.isDraggable!==!0||e.y===n&&e.x===t)return r;`${e.i}${String(t)}${String(n)}${e.x}${e.y}`;const u=e.x,p=e.y;typeof t=="number"&&(e.x=t),typeof n=="number"&&(e.y=n),e.moved=!0;let g=Hr(r,i);(i==="vertical"&&typeof n=="number"?p>=n:i==="horizontal"&&typeof t=="number"?u>=t:!1)&&(g=g.reverse());const S=as(g,e),k=S.length>0;if(k&&c)return ts(r);if(k&&a)return`${e.i}`,e.x=u,e.y=p,e.moved=!1,r;for(let P=0,C=S.length;P<C;P++){const w=S[P];`${e.i}${e.x}${e.y}${w.i}${w.x}${w.y}`,!w.moved&&(w.static?r=xr(r,w,e,s,i):r=xr(r,e,w,s,i))}return r}function xr(r,e,t,n,s,a){const i=s==="horizontal",l=s==="vertical",c=e.static;if(n){n=!1;const g={x:i?Math.max(e.x-t.w,0):t.x,y:l?Math.max(e.y-t.h,0):t.y,w:t.w,h:t.h,i:"-1"},y=$e(r,g),S=y&&y.y+y.h>e.y,k=y&&e.x+e.w>y.x;if(y){if(S&&l)return at(r,t,void 0,e.y+1,n,c,s);if(S&&s==null)return e.y=t.y,t.y=t.y+t.h,r;if(k&&i)return at(r,e,t.x,void 0,n,c,s)}else return`${t.i}${g.x}${g.y}`,at(r,t,i?g.x:void 0,l?g.y:void 0,n,c,s)}const u=i?t.x+1:void 0,p=l?t.y+1:void 0;return u==null&&p==null?r:at(r,t,i?t.x+1:void 0,l?t.y+1:void 0,n,c,s)}function Ei(r){return r*100+"%"}const is=(r,e,t,n)=>r+t>n?e:t,ls=(r,e,t)=>r<0?e:t,cs=r=>Math.max(0,r),Lr=r=>Math.max(0,r),qr=(r,e,t)=>{let{left:n,height:s,width:a}=e;const i=r.top-(s-r.height);return{left:n,width:a,height:ls(i,r.height,s),top:Lr(i)}},Wr=(r,e,t)=>{let{top:n,left:s,height:a,width:i}=e;return{top:n,height:a,width:is(r.left,r.width,i,t),left:cs(s)}},Br=(r,e,t)=>{let{top:n,height:s,width:a}=e;const i=r.left-(a-r.width);return{height:s,width:i<0?r.width:is(r.left,r.width,a,t),top:Lr(n),left:cs(i)}},$r=(r,e,t)=>{let{top:n,left:s,height:a,width:i}=e;return{width:i,left:s,height:ls(n,r.height,a),top:Lr(n)}},Di=function(){return qr(arguments.length<=0?void 0:arguments[0],Wr(...arguments))},Mi=function(){return qr(arguments.length<=0?void 0:arguments[0],Br(...arguments))},ki=function(){return $r(arguments.length<=0?void 0:arguments[0],Wr(...arguments))},Oi=function(){return $r(arguments.length<=0?void 0:arguments[0],Br(...arguments))},Ii={n:qr,ne:Di,e:Wr,se:ki,s:$r,sw:Oi,w:Br,nw:Mi};function zi(r,e,t,n){const s=Ii[r];return s?s(e,{...e,...t},n):t}function Ni(r){let{top:e,left:t,width:n,height:s}=r;const a=`translate(${t}px,${e}px)`;return{transform:a,WebkitTransform:a,MozTransform:a,msTransform:a,OTransform:a,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Ti(r){let{top:e,left:t,width:n,height:s}=r;return{top:`${e}px`,left:`${t}px`,width:`${n}px`,height:`${s}px`,position:"absolute"}}function Hr(r,e){return e==="horizontal"?ds(r):e==="vertical"?us(r):r}function us(r){return r.slice(0).sort(function(e,t){return e.y>t.y||e.y===t.y&&e.x>t.x?1:e.y===t.y&&e.x===t.x?0:-1})}function ds(r){return r.slice(0).sort(function(e,t){return e.x>t.x||e.x===t.x&&e.y>t.y?1:-1})}function Ai(r,e,t,n,s){r=r||[];const a=[];ot.default.Children.forEach(e,l=>{if(l?.key==null)return;const c=Tr(r,String(l.key)),u=l.props["data-grid"];c&&u==null?a.push(Fe(c)):u?a.push(Fe({...u,i:l.key})):a.push(Fe({w:1,h:1,x:0,y:Nr(a),i:String(l.key)}))});const i=os(a,{cols:t});return s?i:ns(i,n,t)}function Li(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Layout";const t=["x","y","w","h"];if(!Array.isArray(r))throw new Error(e+" must be an array!");for(let n=0,s=r.length;n<s;n++){const a=r[n];for(let i=0;i<t.length;i++){const l=t[i],c=a[l];if(typeof c!="number"||Number.isNaN(c))throw new Error(`ReactGridLayout: ${e}[${n}].${l} must be a number! Received: ${c} (${typeof c})`)}if(typeof a.i<"u"&&typeof a.i!="string")throw new Error(`ReactGridLayout: ${e}[${n}].i must be a string! Received: ${a.i} (${typeof a.i})`)}}function qi(r){const{verticalCompact:e,compactType:t}=r||{};return e===!1?null:t}const Wi=()=>{};G.noop=Wi;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});ke.calcGridColWidth=Tt;ke.calcGridItemPosition=Bi;ke.calcGridItemWHPx=wr;ke.calcWH=Hi;ke.calcXY=$i;ke.clamp=He;function Tt(r){const{margin:e,containerPadding:t,containerWidth:n,cols:s}=r;return(n-e[0]*(s-1)-t[0]*2)/s}function wr(r,e,t){return Number.isFinite(r)?Math.round(e*r+Math.max(0,r-1)*t):r}function Bi(r,e,t,n,s,a){const{margin:i,containerPadding:l,rowHeight:c}=r,u=Tt(r),p={};return a&&a.resizing?(p.width=Math.round(a.resizing.width),p.height=Math.round(a.resizing.height)):(p.width=wr(n,u,i[0]),p.height=wr(s,c,i[1])),a&&a.dragging?(p.top=Math.round(a.dragging.top),p.left=Math.round(a.dragging.left)):a&&a.resizing&&typeof a.resizing.top=="number"&&typeof a.resizing.left=="number"?(p.top=Math.round(a.resizing.top),p.left=Math.round(a.resizing.left)):(p.top=Math.round((c+i[1])*t+l[1]),p.left=Math.round((u+i[0])*e+l[0])),p}function $i(r,e,t,n,s){const{margin:a,containerPadding:i,cols:l,rowHeight:c,maxRows:u}=r,p=Tt(r);let g=Math.round((t-i[0])/(p+a[0])),y=Math.round((e-i[1])/(c+a[1]));return g=He(g,0,l-n),y=He(y,0,u-s),{x:g,y}}function Hi(r,e,t,n,s,a){const{margin:i,maxRows:l,cols:c,rowHeight:u}=r,p=Tt(r);let g=Math.round((e+i[0])/(p+i[0])),y=Math.round((t+i[1])/(u+i[1])),S=He(g,0,c-n),k=He(y,0,l-s);return["sw","w","nw"].indexOf(a)!==-1&&(S=He(g,0,c)),["nw","n","ne"].indexOf(a)!==-1&&(k=He(y,0,l)),{w:S,h:k}}function He(r,e,t){return Math.max(Math.min(r,t),e)}var At={},Lt={exports:{}},fs={},ce={},Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.dontSetMe=Yi;Oe.findInArray=Ui;Oe.int=Vi;Oe.isFunction=Fi;Oe.isNum=Gi;function Ui(r,e){for(let t=0,n=r.length;t<n;t++)if(e.apply(e,[r[t],t,r]))return r[t]}function Fi(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Function]"}function Gi(r){return typeof r=="number"&&!isNaN(r)}function Vi(r){return parseInt(r,10)}function Yi(r,e,t){if(r[e])return new Error(`Invalid prop ${e} passed to ${t} - do not set this, set it on the child.`)}var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.browserPrefixToKey=ps;Ge.browserPrefixToStyle=Ki;Ge.default=void 0;Ge.getPrefix=hs;const nr=["Moz","Webkit","O","ms"];function hs(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const e=window.document?.documentElement?.style;if(!e||r in e)return"";for(let t=0;t<nr.length;t++)if(ps(r,nr[t])in e)return nr[t];return""}function ps(r,e){return e?`${e}${Xi(r)}`:r}function Ki(r,e){return e?`-${e.toLowerCase()}-${r}`:r}function Xi(r){let e="",t=!0;for(let n=0;n<r.length;n++)t?(e+=r[n].toUpperCase(),t=!1):r[n]==="-"?t=!0:e+=r[n];return e}Ge.default=hs();Object.defineProperty(ce,"__esModule",{value:!0});ce.addClassName=ys;ce.addEvent=Ji;ce.addUserSelectStyles=cl;ce.createCSSTransform=ol;ce.createSVGTransform=al;ce.getTouch=il;ce.getTouchIdentifier=ll;ce.getTranslation=Ur;ce.innerHeight=rl;ce.innerWidth=nl;ce.matchesSelector=gs;ce.matchesSelectorAndParentsTo=Qi;ce.offsetXYFromParent=sl;ce.outerHeight=el;ce.outerWidth=tl;ce.removeClassName=bs;ce.removeEvent=Zi;ce.scheduleRemoveUserSelectStyles=ul;var Pe=Oe,pn=ms(Ge);function ms(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(ms=function(s,a){if(!a&&s&&s.__esModule)return s;var i,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(i=a?n:t){if(i.has(s))return i.get(s);i.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?i(c,u,l):c[u]=s[u]);return c})(r,e)}let ht="";function gs(r,e){return ht||(ht=(0,Pe.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(t){return(0,Pe.isFunction)(r[t])})),(0,Pe.isFunction)(r[ht])?r[ht](e):!1}function Qi(r,e,t){let n=r;do{if(gs(n,e))return!0;if(n===t)return!1;n=n.parentNode}while(n);return!1}function Ji(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.addEventListener?r.addEventListener(e,t,s):r.attachEvent?r.attachEvent("on"+e,t):r["on"+e]=t}function Zi(r,e,t,n){if(!r)return;const s={capture:!0,...n};r.removeEventListener?r.removeEventListener(e,t,s):r.detachEvent?r.detachEvent("on"+e,t):r["on"+e]=null}function el(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Pe.int)(t.borderTopWidth),e+=(0,Pe.int)(t.borderBottomWidth),e}function tl(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e+=(0,Pe.int)(t.borderLeftWidth),e+=(0,Pe.int)(t.borderRightWidth),e}function rl(r){let e=r.clientHeight;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Pe.int)(t.paddingTop),e-=(0,Pe.int)(t.paddingBottom),e}function nl(r){let e=r.clientWidth;const t=r.ownerDocument.defaultView.getComputedStyle(r);return e-=(0,Pe.int)(t.paddingLeft),e-=(0,Pe.int)(t.paddingRight),e}function sl(r,e,t){const s=e===e.ownerDocument.body?{left:0,top:0}:e.getBoundingClientRect(),a=(r.clientX+e.scrollLeft-s.left)/t,i=(r.clientY+e.scrollTop-s.top)/t;return{x:a,y:i}}function ol(r,e){const t=Ur(r,e,"px");return{[(0,pn.browserPrefixToKey)("transform",pn.default)]:t}}function al(r,e){return Ur(r,e,"")}function Ur(r,e,t){let{x:n,y:s}=r,a=`translate(${n}${t},${s}${t})`;if(e){const i=`${typeof e.x=="string"?e.x:e.x+t}`,l=`${typeof e.y=="string"?e.y:e.y+t}`;a=`translate(${i}, ${l})`+a}return a}function il(r,e){return r.targetTouches&&(0,Pe.findInArray)(r.targetTouches,t=>e===t.identifier)||r.changedTouches&&(0,Pe.findInArray)(r.changedTouches,t=>e===t.identifier)}function ll(r){if(r.targetTouches&&r.targetTouches[0])return r.targetTouches[0].identifier;if(r.changedTouches&&r.changedTouches[0])return r.changedTouches[0].identifier}function cl(r){if(!r)return;let e=r.getElementById("react-draggable-style-el");e||(e=r.createElement("style"),e.type="text/css",e.id="react-draggable-style-el",e.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,e.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,r.getElementsByTagName("head")[0].appendChild(e)),r.body&&ys(r.body,"react-draggable-transparent-selection")}function ul(r){window.requestAnimationFrame?window.requestAnimationFrame(()=>{mn(r)}):mn(r)}function mn(r){if(r)try{if(r.body&&bs(r.body,"react-draggable-transparent-selection"),r.selection)r.selection.empty();else{const e=(r.defaultView||window).getSelection();e&&e.type!=="Caret"&&e.removeAllRanges()}}catch{}}function ys(r,e){r.classList?r.classList.add(e):r.className.match(new RegExp(`(?:^|\\s)${e}(?!\\S)`))||(r.className+=` ${e}`)}function bs(r,e){r.classList?r.classList.remove(e):r.className=r.className.replace(new RegExp(`(?:^|\\s)${e}(?!\\S)`,"g"),"")}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.canDragX=hl;Ie.canDragY=pl;Ie.createCoreData=gl;Ie.createDraggableData=yl;Ie.getBoundPosition=dl;Ie.getControlPosition=ml;Ie.snapToGrid=fl;var je=Oe,Je=ce;function dl(r,e,t){if(!r.props.bounds)return[e,t];let{bounds:n}=r.props;n=typeof n=="string"?n:bl(n);const s=Fr(r);if(typeof n=="string"){const{ownerDocument:a}=s,i=a.defaultView;let l;if(n==="parent"?l=s.parentNode:l=s.getRootNode().querySelector(n),!(l instanceof i.HTMLElement))throw new Error('Bounds selector "'+n+'" could not find an element.');const c=l,u=i.getComputedStyle(s),p=i.getComputedStyle(c);n={left:-s.offsetLeft+(0,je.int)(p.paddingLeft)+(0,je.int)(u.marginLeft),top:-s.offsetTop+(0,je.int)(p.paddingTop)+(0,je.int)(u.marginTop),right:(0,Je.innerWidth)(c)-(0,Je.outerWidth)(s)-s.offsetLeft+(0,je.int)(p.paddingRight)-(0,je.int)(u.marginRight),bottom:(0,Je.innerHeight)(c)-(0,Je.outerHeight)(s)-s.offsetTop+(0,je.int)(p.paddingBottom)-(0,je.int)(u.marginBottom)}}return(0,je.isNum)(n.right)&&(e=Math.min(e,n.right)),(0,je.isNum)(n.bottom)&&(t=Math.min(t,n.bottom)),(0,je.isNum)(n.left)&&(e=Math.max(e,n.left)),(0,je.isNum)(n.top)&&(t=Math.max(t,n.top)),[e,t]}function fl(r,e,t){const n=Math.round(e/r[0])*r[0],s=Math.round(t/r[1])*r[1];return[n,s]}function hl(r){return r.props.axis==="both"||r.props.axis==="x"}function pl(r){return r.props.axis==="both"||r.props.axis==="y"}function ml(r,e,t){const n=typeof e=="number"?(0,Je.getTouch)(r,e):null;if(typeof e=="number"&&!n)return null;const s=Fr(t),a=t.props.offsetParent||s.offsetParent||s.ownerDocument.body;return(0,Je.offsetXYFromParent)(n||r,a,t.props.scale)}function gl(r,e,t){const n=!(0,je.isNum)(r.lastX),s=Fr(r);return n?{node:s,deltaX:0,deltaY:0,lastX:e,lastY:t,x:e,y:t}:{node:s,deltaX:e-r.lastX,deltaY:t-r.lastY,lastX:r.lastX,lastY:r.lastY,x:e,y:t}}function yl(r,e){const t=r.props.scale;return{node:e.node,x:r.state.x+e.deltaX/t,y:r.state.y+e.deltaY/t,deltaX:e.deltaX/t,deltaY:e.deltaY/t,lastX:r.state.x,lastY:r.state.y}}function bl(r){return{left:r.left,top:r.top,right:r.right,bottom:r.bottom}}function Fr(r){const e=r.findDOMNode();if(!e)throw new Error("<DraggableCore>: Unmounted during event!");return e}var qt={},Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.default=vl;function vl(){}Object.defineProperty(qt,"__esModule",{value:!0});qt.default=void 0;var sr=vs(d),be=Gr(qe),xl=Gr(Ct),me=ce,Te=Ie,or=Oe,rt=Gr(Wt);function Gr(r){return r&&r.__esModule?r:{default:r}}function vs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(vs=function(s,a){if(!a&&s&&s.__esModule)return s;var i,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(i=a?n:t){if(i.has(s))return i.get(s);i.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?i(c,u,l):c[u]=s[u]);return c})(r,e)}function ve(r,e,t){return(e=wl(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function wl(r){var e=_l(r,"string");return typeof e=="symbol"?e:e+""}function _l(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const De={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let Ae=De.mouse,Bt=class extends sr.Component{constructor(){super(...arguments),ve(this,"dragging",!1),ve(this,"lastX",NaN),ve(this,"lastY",NaN),ve(this,"touchIdentifier",null),ve(this,"mounted",!1),ve(this,"handleDragStart",e=>{if(this.props.onMouseDown(e),!this.props.allowAnyClick&&typeof e.button=="number"&&e.button!==0)return!1;const t=this.findDOMNode();if(!t||!t.ownerDocument||!t.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:n}=t;if(this.props.disabled||!(e.target instanceof n.defaultView.Node)||this.props.handle&&!(0,me.matchesSelectorAndParentsTo)(e.target,this.props.handle,t)||this.props.cancel&&(0,me.matchesSelectorAndParentsTo)(e.target,this.props.cancel,t))return;e.type==="touchstart"&&!this.props.allowMobileScroll&&e.preventDefault();const s=(0,me.getTouchIdentifier)(e);this.touchIdentifier=s;const a=(0,Te.getControlPosition)(e,s,this);if(a==null)return;const{x:i,y:l}=a,c=(0,Te.createCoreData)(this,i,l);(0,rt.default)("DraggableCore: handleDragStart: %j",c),(0,rt.default)("calling",this.props.onStart),!(this.props.onStart(e,c)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,me.addUserSelectStyles)(n),this.dragging=!0,this.lastX=i,this.lastY=l,(0,me.addEvent)(n,Ae.move,this.handleDrag),(0,me.addEvent)(n,Ae.stop,this.handleDragStop))}),ve(this,"handleDrag",e=>{const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let l=n-this.lastX,c=s-this.lastY;if([l,c]=(0,Te.snapToGrid)(this.props.grid,l,c),!l&&!c)return;n=this.lastX+l,s=this.lastY+c}const a=(0,Te.createCoreData)(this,n,s);if((0,rt.default)("DraggableCore: handleDrag: %j",a),this.props.onDrag(e,a)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const c=document.createEvent("MouseEvents");c.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(c)}return}this.lastX=n,this.lastY=s}),ve(this,"handleDragStop",e=>{if(!this.dragging)return;const t=(0,Te.getControlPosition)(e,this.touchIdentifier,this);if(t==null)return;let{x:n,y:s}=t;if(Array.isArray(this.props.grid)){let c=n-this.lastX||0,u=s-this.lastY||0;[c,u]=(0,Te.snapToGrid)(this.props.grid,c,u),n=this.lastX+c,s=this.lastY+u}const a=(0,Te.createCoreData)(this,n,s);if(this.props.onStop(e,a)===!1||this.mounted===!1)return!1;const l=this.findDOMNode();l&&this.props.enableUserSelectHack&&(0,me.scheduleRemoveUserSelectStyles)(l.ownerDocument),(0,rt.default)("DraggableCore: handleDragStop: %j",a),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,l&&((0,rt.default)("DraggableCore: Removing handlers"),(0,me.removeEvent)(l.ownerDocument,Ae.move,this.handleDrag),(0,me.removeEvent)(l.ownerDocument,Ae.stop,this.handleDragStop))}),ve(this,"onMouseDown",e=>(Ae=De.mouse,this.handleDragStart(e))),ve(this,"onMouseUp",e=>(Ae=De.mouse,this.handleDragStop(e))),ve(this,"onTouchStart",e=>(Ae=De.touch,this.handleDragStart(e))),ve(this,"onTouchEnd",e=>(Ae=De.touch,this.handleDragStop(e)))}componentDidMount(){this.mounted=!0;const e=this.findDOMNode();e&&(0,me.addEvent)(e,De.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const e=this.findDOMNode();if(e){const{ownerDocument:t}=e;(0,me.removeEvent)(t,De.mouse.move,this.handleDrag),(0,me.removeEvent)(t,De.touch.move,this.handleDrag),(0,me.removeEvent)(t,De.mouse.stop,this.handleDragStop),(0,me.removeEvent)(t,De.touch.stop,this.handleDragStop),(0,me.removeEvent)(e,De.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,me.scheduleRemoveUserSelectStyles)(t)}}findDOMNode(){return this.props?.nodeRef?this.props?.nodeRef?.current:xl.default.findDOMNode(this)}render(){return sr.cloneElement(sr.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};qt.default=Bt;ve(Bt,"displayName","DraggableCore");ve(Bt,"propTypes",{allowAnyClick:be.default.bool,allowMobileScroll:be.default.bool,children:be.default.node.isRequired,disabled:be.default.bool,enableUserSelectHack:be.default.bool,offsetParent:function(r,e){if(r[e]&&r[e].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:be.default.arrayOf(be.default.number),handle:be.default.string,cancel:be.default.string,nodeRef:be.default.object,onStart:be.default.func,onDrag:be.default.func,onStop:be.default.func,onMouseDown:be.default.func,scale:be.default.number,className:or.dontSetMe,style:or.dontSetMe,transform:or.dontSetMe});ve(Bt,"defaultProps",{allowAnyClick:!1,allowMobileScroll:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DraggableCore",{enumerable:!0,get:function(){return c.default}}),r.default=void 0;var e=g(d),t=p(qe),n=p(Ct),s=Et,a=ce,i=Ie,l=Oe,c=p(qt),u=p(Wt);function p(w){return w&&w.__esModule?w:{default:w}}function g(w,D){if(typeof WeakMap=="function")var v=new WeakMap,m=new WeakMap;return(g=function(h,b){if(!b&&h&&h.__esModule)return h;var _,x,R={__proto__:null,default:h};if(h===null||typeof h!="object"&&typeof h!="function")return R;if(_=b?m:v){if(_.has(h))return _.get(h);_.set(h,R)}for(const z in h)z!=="default"&&{}.hasOwnProperty.call(h,z)&&((x=(_=Object.defineProperty)&&Object.getOwnPropertyDescriptor(h,z))&&(x.get||x.set)?_(R,z,x):R[z]=h[z]);return R})(w,D)}function y(){return y=Object.assign?Object.assign.bind():function(w){for(var D=1;D<arguments.length;D++){var v=arguments[D];for(var m in v)({}).hasOwnProperty.call(v,m)&&(w[m]=v[m])}return w},y.apply(null,arguments)}function S(w,D,v){return(D=k(D))in w?Object.defineProperty(w,D,{value:v,enumerable:!0,configurable:!0,writable:!0}):w[D]=v,w}function k(w){var D=P(w,"string");return typeof D=="symbol"?D:D+""}function P(w,D){if(typeof w!="object"||!w)return w;var v=w[Symbol.toPrimitive];if(v!==void 0){var m=v.call(w,D);if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(D==="string"?String:Number)(w)}class C extends e.Component{static getDerivedStateFromProps(D,v){let{position:m}=D,{prevPropsPosition:h}=v;return m&&(!h||m.x!==h.x||m.y!==h.y)?((0,u.default)("Draggable: getDerivedStateFromProps %j",{position:m,prevPropsPosition:h}),{x:m.x,y:m.y,prevPropsPosition:{...m}}):null}constructor(D){super(D),S(this,"onDragStart",(v,m)=>{if((0,u.default)("Draggable: onDragStart: %j",m),this.props.onStart(v,(0,i.createDraggableData)(this,m))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),S(this,"onDrag",(v,m)=>{if(!this.state.dragging)return!1;(0,u.default)("Draggable: onDrag: %j",m);const h=(0,i.createDraggableData)(this,m),b={x:h.x,y:h.y,slackX:0,slackY:0};if(this.props.bounds){const{x,y:R}=b;b.x+=this.state.slackX,b.y+=this.state.slackY;const[z,A]=(0,i.getBoundPosition)(this,b.x,b.y);b.x=z,b.y=A,b.slackX=this.state.slackX+(x-b.x),b.slackY=this.state.slackY+(R-b.y),h.x=b.x,h.y=b.y,h.deltaX=b.x-this.state.x,h.deltaY=b.y-this.state.y}if(this.props.onDrag(v,h)===!1)return!1;this.setState(b)}),S(this,"onDragStop",(v,m)=>{if(!this.state.dragging||this.props.onStop(v,(0,i.createDraggableData)(this,m))===!1)return!1;(0,u.default)("Draggable: onDragStop: %j",m);const b={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x,y:R}=this.props.position;b.x=x,b.y=R}this.setState(b)}),this.state={dragging:!1,dragged:!1,x:D.position?D.position.x:D.defaultPosition.x,y:D.position?D.position.y:D.defaultPosition.y,prevPropsPosition:{...D.position},slackX:0,slackY:0,isElementSVG:!1},D.position&&(D.onDrag||D.onStop)}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.state.dragging&&this.setState({dragging:!1})}findDOMNode(){return this.props?.nodeRef?.current??n.default.findDOMNode(this)}render(){const{axis:D,bounds:v,children:m,defaultPosition:h,defaultClassName:b,defaultClassNameDragging:_,defaultClassNameDragged:x,position:R,positionOffset:z,scale:A,...N}=this.props;let Z={},he=null;const O=!!!R||this.state.dragging,K=R||h,ye={x:(0,i.canDragX)(this)&&O?this.state.x:K.x,y:(0,i.canDragY)(this)&&O?this.state.y:K.y};this.state.isElementSVG?he=(0,a.createSVGTransform)(ye,z):Z=(0,a.createCSSTransform)(ye,z);const de=(0,s.clsx)(m.props.className||"",b,{[_]:this.state.dragging,[x]:this.state.dragged});return e.createElement(c.default,y({},N,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),e.cloneElement(e.Children.only(m),{className:de,style:{...m.props.style,...Z},transform:he}))}}r.default=C,S(C,"displayName","Draggable"),S(C,"propTypes",{...c.default.propTypes,axis:t.default.oneOf(["both","x","y","none"]),bounds:t.default.oneOfType([t.default.shape({left:t.default.number,right:t.default.number,top:t.default.number,bottom:t.default.number}),t.default.string,t.default.oneOf([!1])]),defaultClassName:t.default.string,defaultClassNameDragging:t.default.string,defaultClassNameDragged:t.default.string,defaultPosition:t.default.shape({x:t.default.number,y:t.default.number}),positionOffset:t.default.shape({x:t.default.oneOfType([t.default.number,t.default.string]),y:t.default.oneOfType([t.default.number,t.default.string])}),position:t.default.shape({x:t.default.number,y:t.default.number}),className:l.dontSetMe,style:l.dontSetMe,transform:l.dontSetMe}),S(C,"defaultProps",{...c.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(fs);const{default:xs,DraggableCore:Sl}=fs;Lt.exports=xs;Lt.exports.default=xs;Lt.exports.DraggableCore=Sl;var ws=Lt.exports,$t={exports:{}},ct={},Vr={};Vr.__esModule=!0;Vr.cloneElement=Dl;var jl=Pl(d);function Pl(r){return r&&r.__esModule?r:{default:r}}function gn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function yn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gn(Object(t),!0).forEach(function(n){Rl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):gn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Rl(r,e,t){return e=Cl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Cl(r){var e=El(r,"string");return typeof e=="symbol"?e:String(e)}function El(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Dl(r,e){return e.style&&r.props.style&&(e.style=yn(yn({},r.props.style),e.style)),e.className&&r.props.className&&(e.className=r.props.className+" "+e.className),jl.default.cloneElement(r,e)}var ut={};ut.__esModule=!0;ut.resizableProps=void 0;var W=Ml(qe);function Ml(r){return r&&r.__esModule?r:{default:r}}var kl={axis:W.default.oneOf(["both","x","y","none"]),className:W.default.string,children:W.default.element.isRequired,draggableOpts:W.default.shape({allowAnyClick:W.default.bool,cancel:W.default.string,children:W.default.node,disabled:W.default.bool,enableUserSelectHack:W.default.bool,offsetParent:W.default.node,grid:W.default.arrayOf(W.default.number),handle:W.default.string,nodeRef:W.default.object,onStart:W.default.func,onDrag:W.default.func,onStop:W.default.func,onMouseDown:W.default.func,scale:W.default.number}),height:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="y"){var a;return(a=W.default.number).isRequired.apply(a,t)}return W.default.number.apply(W.default,t)},handle:W.default.oneOfType([W.default.node,W.default.func]),handleSize:W.default.arrayOf(W.default.number),lockAspectRatio:W.default.bool,maxConstraints:W.default.arrayOf(W.default.number),minConstraints:W.default.arrayOf(W.default.number),onResizeStop:W.default.func,onResizeStart:W.default.func,onResize:W.default.func,resizeHandles:W.default.arrayOf(W.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),transformScale:W.default.number,width:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=t[0];if(s.axis==="both"||s.axis==="x"){var a;return(a=W.default.number).isRequired.apply(a,t)}return W.default.number.apply(W.default,t)}};ut.resizableProps=kl;ct.__esModule=!0;ct.default=void 0;var nt=Tl(d),Ol=ws,Il=Vr,zl=ut,Nl=["children","className","draggableOpts","width","height","handle","handleSize","lockAspectRatio","axis","minConstraints","maxConstraints","onResize","onResizeStop","onResizeStart","resizeHandles","transformScale"];function _s(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(_s=function(s){return s?t:e})(r)}function Tl(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=_s(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var i=s?Object.getOwnPropertyDescriptor(r,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=r[a]}return n.default=r,t&&t.set(r,n),n}function _r(){return _r=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_r.apply(this,arguments)}function Al(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,a;for(a=0;a<n.length;a++)s=n[a],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function bn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function ar(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bn(Object(t),!0).forEach(function(n){Ll(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):bn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Ll(r,e,t){return e=ql(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ql(r){var e=Wl(r,"string");return typeof e=="symbol"?e:String(e)}function Wl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Bl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Sr(r,e)}function Sr(r,e){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Sr(r,e)}var Yr=function(r){Bl(e,r);function e(){for(var n,s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return n=r.call.apply(r,[this].concat(a))||this,n.handleRefs={},n.lastHandleRect=null,n.slack=null,n}var t=e.prototype;return t.componentWillUnmount=function(){this.resetData()},t.resetData=function(){this.lastHandleRect=this.slack=null},t.runConstraints=function(s,a){var i=this.props,l=i.minConstraints,c=i.maxConstraints,u=i.lockAspectRatio;if(!l&&!c&&!u)return[s,a];if(u){var p=this.props.width/this.props.height,g=s-this.props.width,y=a-this.props.height;Math.abs(g)>Math.abs(y*p)?a=s/p:s=a*p}var S=s,k=a,P=this.slack||[0,0],C=P[0],w=P[1];return s+=C,a+=w,l&&(s=Math.max(l[0],s),a=Math.max(l[1],a)),c&&(s=Math.min(c[0],s),a=Math.min(c[1],a)),this.slack=[C+(S-s),w+(k-a)],[s,a]},t.resizeHandler=function(s,a){var i=this;return function(l,c){var u=c.node,p=c.deltaX,g=c.deltaY;s==="onResizeStart"&&i.resetData();var y=(i.props.axis==="both"||i.props.axis==="x")&&a!=="n"&&a!=="s",S=(i.props.axis==="both"||i.props.axis==="y")&&a!=="e"&&a!=="w";if(!(!y&&!S)){var k=a[0],P=a[a.length-1],C=u.getBoundingClientRect();if(i.lastHandleRect!=null){if(P==="w"){var w=C.left-i.lastHandleRect.left;p+=w}if(k==="n"){var D=C.top-i.lastHandleRect.top;g+=D}}i.lastHandleRect=C,P==="w"&&(p=-p),k==="n"&&(g=-g);var v=i.props.width+(y?p/i.props.transformScale:0),m=i.props.height+(S?g/i.props.transformScale:0),h=i.runConstraints(v,m);v=h[0],m=h[1];var b=v!==i.props.width||m!==i.props.height,_=typeof i.props[s]=="function"?i.props[s]:null,x=s==="onResize"&&!b;_&&!x&&(l.persist==null||l.persist(),_(l,{node:u,size:{width:v,height:m},handle:a})),s==="onResizeStop"&&i.resetData()}}},t.renderResizeHandle=function(s,a){var i=this.props.handle;if(!i)return nt.createElement("span",{className:"react-resizable-handle react-resizable-handle-"+s,ref:a});if(typeof i=="function")return i(s,a);var l=typeof i.type=="string",c=ar({ref:a},l?{}:{handleAxis:s});return nt.cloneElement(i,c)},t.render=function(){var s=this,a=this.props,i=a.children,l=a.className,c=a.draggableOpts;a.width,a.height,a.handle,a.handleSize,a.lockAspectRatio,a.axis,a.minConstraints,a.maxConstraints,a.onResize,a.onResizeStop,a.onResizeStart;var u=a.resizeHandles;a.transformScale;var p=Al(a,Nl);return(0,Il.cloneElement)(i,ar(ar({},p),{},{className:(l?l+" ":"")+"react-resizable",children:[].concat(i.props.children,u.map(function(g){var y,S=(y=s.handleRefs[g])!=null?y:s.handleRefs[g]=nt.createRef();return nt.createElement(Ol.DraggableCore,_r({},c,{nodeRef:S,key:"resizableHandle-"+g,onStop:s.resizeHandler("onResizeStop",g),onStart:s.resizeHandler("onResizeStart",g),onDrag:s.resizeHandler("onResize",g)}),s.renderResizeHandle(g,S))}))}))},e}(nt.Component);ct.default=Yr;Yr.propTypes=zl.resizableProps;Yr.defaultProps={axis:"both",handleSize:[20,20],lockAspectRatio:!1,minConstraints:[20,20],maxConstraints:[1/0,1/0],resizeHandles:["se"],transformScale:1};var Ht={};Ht.__esModule=!0;Ht.default=void 0;var ir=Gl(d),$l=Ss(qe),Hl=Ss(ct),Ul=ut,Fl=["handle","handleSize","onResize","onResizeStart","onResizeStop","draggableOpts","minConstraints","maxConstraints","lockAspectRatio","axis","width","height","resizeHandles","style","transformScale"];function Ss(r){return r&&r.__esModule?r:{default:r}}function js(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,t=new WeakMap;return(js=function(s){return s?t:e})(r)}function Gl(r,e){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var t=js(e);if(t&&t.has(r))return t.get(r);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in r)if(a!=="default"&&Object.prototype.hasOwnProperty.call(r,a)){var i=s?Object.getOwnPropertyDescriptor(r,a):null;i&&(i.get||i.set)?Object.defineProperty(n,a,i):n[a]=r[a]}return n.default=r,t&&t.set(r,n),n}function jr(){return jr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},jr.apply(this,arguments)}function vn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function _t(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vn(Object(t),!0).forEach(function(n){Vl(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):vn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Vl(r,e,t){return e=Yl(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Yl(r){var e=Kl(r,"string");return typeof e=="symbol"?e:String(e)}function Kl(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Xl(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,a;for(a=0;a<n.length;a++)s=n[a],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Ql(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Pr(r,e)}function Pr(r,e){return Pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Pr(r,e)}var Ps=function(r){Ql(e,r);function e(){for(var n,s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return n=r.call.apply(r,[this].concat(a))||this,n.state={width:n.props.width,height:n.props.height,propsWidth:n.props.width,propsHeight:n.props.height},n.onResize=function(l,c){var u=c.size;n.props.onResize?(l.persist==null||l.persist(),n.setState(u,function(){return n.props.onResize&&n.props.onResize(l,c)})):n.setState(u)},n}e.getDerivedStateFromProps=function(s,a){return a.propsWidth!==s.width||a.propsHeight!==s.height?{width:s.width,height:s.height,propsWidth:s.width,propsHeight:s.height}:null};var t=e.prototype;return t.render=function(){var s=this.props,a=s.handle,i=s.handleSize;s.onResize;var l=s.onResizeStart,c=s.onResizeStop,u=s.draggableOpts,p=s.minConstraints,g=s.maxConstraints,y=s.lockAspectRatio,S=s.axis;s.width,s.height;var k=s.resizeHandles,P=s.style,C=s.transformScale,w=Xl(s,Fl);return ir.createElement(Hl.default,{axis:S,draggableOpts:u,handle:a,handleSize:i,height:this.state.height,lockAspectRatio:y,maxConstraints:g,minConstraints:p,onResizeStart:l,onResize:this.onResize,onResizeStop:c,resizeHandles:k,transformScale:C,width:this.state.width},ir.createElement("div",jr({},w,{style:_t(_t({},P),{},{width:this.state.width+"px",height:this.state.height+"px"})})))},e}(ir.Component);Ht.default=Ps;Ps.propTypes=_t(_t({},Ul.resizableProps),{},{children:$l.default.element});$t.exports=function(){throw new Error("Don't instantiate Resizable directly! Use require('react-resizable').Resizable")};$t.exports.Resizable=ct.default;$t.exports.ResizableBox=Ht.default;var Jl=$t.exports,Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.resizeHandleType=Ne.resizeHandleAxesType=Ne.default=void 0;var B=Rs(qe),Zl=Rs(d);function Rs(r){return r&&r.__esModule?r:{default:r}}const ec=Ne.resizeHandleAxesType=B.default.arrayOf(B.default.oneOf(["s","w","e","n","sw","nw","se","ne"])),tc=Ne.resizeHandleType=B.default.oneOfType([B.default.node,B.default.func]);Ne.default={className:B.default.string,style:B.default.object,width:B.default.number,autoSize:B.default.bool,cols:B.default.number,draggableCancel:B.default.string,draggableHandle:B.default.string,verticalCompact:function(r){r.verticalCompact},compactType:B.default.oneOf(["vertical","horizontal"]),layout:function(r){var e=r.layout;e!==void 0&&G.validateLayout(e,"layout")},margin:B.default.arrayOf(B.default.number),containerPadding:B.default.arrayOf(B.default.number),rowHeight:B.default.number,maxRows:B.default.number,isBounded:B.default.bool,isDraggable:B.default.bool,isResizable:B.default.bool,allowOverlap:B.default.bool,preventCollision:B.default.bool,useCSSTransforms:B.default.bool,transformScale:B.default.number,isDroppable:B.default.bool,resizeHandles:ec,resizeHandle:tc,onLayoutChange:B.default.func,onDragStart:B.default.func,onDrag:B.default.func,onDragStop:B.default.func,onResizeStart:B.default.func,onResize:B.default.func,onResizeStop:B.default.func,onDrop:B.default.func,droppingItem:B.default.shape({i:B.default.string.isRequired,w:B.default.number.isRequired,h:B.default.number.isRequired}),children:function(r,e){const t=r[e],n={};Zl.default.Children.forEach(t,function(s){if(s?.key!=null){if(n[s.key])throw new Error('Duplicate child key "'+s.key+'" found! This will cause problems in ReactGridLayout.');n[s.key]=!0}})},innerRef:B.default.any};Object.defineProperty(At,"__esModule",{value:!0});At.default=void 0;var Ke=Kr(d),xn=Ct,X=Kr(qe),rc=ws,nc=Jl,Xe=G,fe=ke,wn=Ne,sc=Kr(Et);function Kr(r){return r&&r.__esModule?r:{default:r}}function Me(r,e,t){return(e=oc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function oc(r){var e=ac(r,"string");return typeof e=="symbol"?e:e+""}function ac(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}class Xr extends Ke.default.Component{constructor(){super(...arguments),Me(this,"state",{resizing:null,dragging:null,className:""}),Me(this,"elementRef",Ke.default.createRef()),Me(this,"onDragStart",(e,t)=>{let{node:n}=t;const{onDragStart:s,transformScale:a}=this.props;if(!s)return;const i={top:0,left:0},{offsetParent:l}=n;if(!l)return;const c=l.getBoundingClientRect(),u=n.getBoundingClientRect(),p=u.left/a,g=c.left/a,y=u.top/a,S=c.top/a;i.left=p-g+l.scrollLeft,i.top=y-S+l.scrollTop,this.setState({dragging:i});const{x:k,y:P}=(0,fe.calcXY)(this.getPositionParams(),i.top,i.left,this.props.w,this.props.h);return s.call(this,this.props.i,k,P,{e,node:n,newPosition:i})}),Me(this,"onDrag",(e,t,n)=>{let{node:s,deltaX:a,deltaY:i}=t;const{onDrag:l}=this.props;if(!l)return;if(!this.state.dragging)throw new Error("onDrag called before onDragStart.");let c=this.state.dragging.top+i,u=this.state.dragging.left+a;const{isBounded:p,i:g,w:y,h:S,containerWidth:k}=this.props,P=this.getPositionParams();if(p){const{offsetParent:v}=s;if(v){const{margin:m,rowHeight:h}=this.props,b=v.clientHeight-(0,fe.calcGridItemWHPx)(S,h,m[1]);c=(0,fe.clamp)(c,0,b);const _=(0,fe.calcGridColWidth)(P),x=k-(0,fe.calcGridItemWHPx)(y,_,m[0]);u=(0,fe.clamp)(u,0,x)}}const C={top:c,left:u};n?this.setState({dragging:C}):(0,xn.flushSync)(()=>{this.setState({dragging:C})});const{x:w,y:D}=(0,fe.calcXY)(P,c,u,y,S);return l.call(this,g,w,D,{e,node:s,newPosition:C})}),Me(this,"onDragStop",(e,t)=>{let{node:n}=t;const{onDragStop:s}=this.props;if(!s)return;if(!this.state.dragging)throw new Error("onDragEnd called before onDragStart.");const{w:a,h:i,i:l}=this.props,{left:c,top:u}=this.state.dragging,p={top:u,left:c};this.setState({dragging:null});const{x:g,y}=(0,fe.calcXY)(this.getPositionParams(),u,c,a,i);return s.call(this,l,g,y,{e,node:n,newPosition:p})}),Me(this,"onResizeStop",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStop")),Me(this,"onResizeStart",(e,t,n)=>this.onResizeHandler(e,t,n,"onResizeStart")),Me(this,"onResize",(e,t,n)=>this.onResizeHandler(e,t,n,"onResize"))}shouldComponentUpdate(e,t){if(this.props.children!==e.children||this.props.droppingPosition!==e.droppingPosition)return!0;const n=(0,fe.calcGridItemPosition)(this.getPositionParams(this.props),this.props.x,this.props.y,this.props.w,this.props.h,this.state),s=(0,fe.calcGridItemPosition)(this.getPositionParams(e),e.x,e.y,e.w,e.h,t);return!(0,Xe.fastPositionEqual)(n,s)||this.props.useCSSTransforms!==e.useCSSTransforms}componentDidMount(){this.moveDroppingItem({})}componentDidUpdate(e){this.moveDroppingItem(e)}moveDroppingItem(e){const{droppingPosition:t}=this.props;if(!t)return;const n=this.elementRef.current;if(!n)return;const s=e.droppingPosition||{left:0,top:0},{dragging:a}=this.state,i=a&&t.left!==s.left||t.top!==s.top;if(!a)this.onDragStart(t.e,{node:n,deltaX:t.left,deltaY:t.top});else if(i){const l=t.left-a.left,c=t.top-a.top;this.onDrag(t.e,{node:n,deltaX:l,deltaY:c},!0)}}getPositionParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props;return{cols:e.cols,containerPadding:e.containerPadding,containerWidth:e.containerWidth,margin:e.margin,maxRows:e.maxRows,rowHeight:e.rowHeight}}createStyle(e){const{usePercentages:t,containerWidth:n,useCSSTransforms:s}=this.props;let a;return s?a=(0,Xe.setTransform)(e):(a=(0,Xe.setTopLeft)(e),t&&(a.left=(0,Xe.perc)(e.left/n),a.width=(0,Xe.perc)(e.width/n))),a}mixinDraggable(e,t){return Ke.default.createElement(rc.DraggableCore,{disabled:!t,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,handle:this.props.handle,cancel:".react-resizable-handle"+(this.props.cancel?","+this.props.cancel:""),scale:this.props.transformScale,nodeRef:this.elementRef},e)}curryResizeHandler(e,t){return(n,s)=>t(n,s,e)}mixinResizable(e,t,n){const{cols:s,minW:a,minH:i,maxW:l,maxH:c,transformScale:u,resizeHandles:p,resizeHandle:g}=this.props,y=this.getPositionParams(),S=(0,fe.calcGridItemPosition)(y,0,0,s,0).width,k=(0,fe.calcGridItemPosition)(y,0,0,a,i),P=(0,fe.calcGridItemPosition)(y,0,0,l,c),C=[k.width,k.height],w=[Math.min(P.width,S),Math.min(P.height,1/0)];return Ke.default.createElement(nc.Resizable,{draggableOpts:{disabled:!n},className:n?void 0:"react-resizable-hide",width:t.width,height:t.height,minConstraints:C,maxConstraints:w,onResizeStop:this.curryResizeHandler(t,this.onResizeStop),onResizeStart:this.curryResizeHandler(t,this.onResizeStart),onResize:this.curryResizeHandler(t,this.onResize),transformScale:u,resizeHandles:p,handle:g},e)}onResizeHandler(e,t,n,s){let{node:a,size:i,handle:l}=t;const c=this.props[s];if(!c)return;const{x:u,y:p,i:g,maxH:y,minH:S,containerWidth:k}=this.props,{minW:P,maxW:C}=this.props;let w=i;a&&(w=(0,Xe.resizeItemInDirection)(l,n,i,k),(0,xn.flushSync)(()=>{this.setState({resizing:s==="onResizeStop"?null:w})}));let{w:D,h:v}=(0,fe.calcWH)(this.getPositionParams(),w.width,w.height,u,p,l);D=(0,fe.clamp)(D,Math.max(P,1),C),v=(0,fe.clamp)(v,S,y),c.call(this,g,D,v,{e,node:a,size:w,handle:l})}render(){const{x:e,y:t,w:n,h:s,isDraggable:a,isResizable:i,droppingPosition:l,useCSSTransforms:c}=this.props,u=(0,fe.calcGridItemPosition)(this.getPositionParams(),e,t,n,s,this.state),p=Ke.default.Children.only(this.props.children);let g=Ke.default.cloneElement(p,{ref:this.elementRef,className:(0,sc.default)("react-grid-item",p.props.className,this.props.className,{static:this.props.static,resizing:!!this.state.resizing,"react-draggable":a,"react-draggable-dragging":!!this.state.dragging,dropping:!!l,cssTransforms:c}),style:{...this.props.style,...p.props.style,...this.createStyle(u)}});return g=this.mixinResizable(g,u,i),g=this.mixinDraggable(g,a),g}}At.default=Xr;Me(Xr,"propTypes",{children:X.default.element,cols:X.default.number.isRequired,containerWidth:X.default.number.isRequired,rowHeight:X.default.number.isRequired,margin:X.default.array.isRequired,maxRows:X.default.number.isRequired,containerPadding:X.default.array.isRequired,x:X.default.number.isRequired,y:X.default.number.isRequired,w:X.default.number.isRequired,h:X.default.number.isRequired,minW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minWidth not Number");if(t>r.w||t>r.maxW)return new Error("minWidth larger than item width/maxWidth")},maxW:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxWidth not Number");if(t<r.w||t<r.minW)return new Error("maxWidth smaller than item width/minWidth")},minH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("minHeight not Number");if(t>r.h||t>r.maxH)return new Error("minHeight larger than item height/maxHeight")},maxH:function(r,e){const t=r[e];if(typeof t!="number")return new Error("maxHeight not Number");if(t<r.h||t<r.minH)return new Error("maxHeight smaller than item height/minHeight")},i:X.default.string.isRequired,resizeHandles:wn.resizeHandleAxesType,resizeHandle:wn.resizeHandleType,onDragStop:X.default.func,onDragStart:X.default.func,onDrag:X.default.func,onResizeStop:X.default.func,onResizeStart:X.default.func,onResize:X.default.func,isDraggable:X.default.bool.isRequired,isResizable:X.default.bool.isRequired,isBounded:X.default.bool.isRequired,static:X.default.bool,useCSSTransforms:X.default.bool.isRequired,transformScale:X.default.number,className:X.default.string,handle:X.default.string,cancel:X.default.string,droppingPosition:X.default.shape({e:X.default.object.isRequired,left:X.default.number.isRequired,top:X.default.number.isRequired})});Me(Xr,"defaultProps",{className:"",cancel:"",handle:"",minH:1,minW:1,maxH:1/0,maxW:1/0,transformScale:1});Object.defineProperty(lt,"__esModule",{value:!0});lt.default=void 0;var We=Cs(d),lr=zr,ic=Qr(Et),T=G,lc=ke,_n=Qr(At),cc=Qr(Ne);function Qr(r){return r&&r.__esModule?r:{default:r}}function Cs(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Cs=function(s,a){if(!a&&s&&s.__esModule)return s;var i,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(i=a?n:t){if(i.has(s))return i.get(s);i.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?i(c,u,l):c[u]=s[u]);return c})(r,e)}function ge(r,e,t){return(e=uc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function uc(r){var e=dc(r,"string");return typeof e=="symbol"?e:e+""}function dc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Sn="react-grid-layout";let Es=!1;try{Es=/firefox/i.test(navigator.userAgent)}catch{}class Ut extends We.Component{constructor(){super(...arguments),ge(this,"state",{activeDrag:null,layout:(0,T.synchronizeLayoutWithChildren)(this.props.layout,this.props.children,this.props.cols,(0,T.compactType)(this.props),this.props.allowOverlap),mounted:!1,oldDragItem:null,oldLayout:null,oldResizeItem:null,resizing:!1,droppingDOMNode:null,children:[]}),ge(this,"dragEnterCounter",0),ge(this,"onDragStart",(e,t,n,s)=>{let{e:a,node:i}=s;const{layout:l}=this.state,c=(0,T.getLayoutItem)(l,e);if(!c)return;const u={w:c.w,h:c.h,x:c.x,y:c.y,placeholder:!0,i:e};return this.setState({oldDragItem:(0,T.cloneLayoutItem)(c),oldLayout:l,activeDrag:u}),this.props.onDragStart(l,c,c,null,a,i)}),ge(this,"onDrag",(e,t,n,s)=>{let{e:a,node:i}=s;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,allowOverlap:p,preventCollision:g}=this.props,y=(0,T.getLayoutItem)(c,e);if(!y)return;const S={w:y.w,h:y.h,x:y.x,y:y.y,placeholder:!0,i:e};c=(0,T.moveElement)(c,y,t,n,!0,g,(0,T.compactType)(this.props),u,p),this.props.onDrag(c,l,y,S,a,i),this.setState({layout:p?c:(0,T.compact)(c,(0,T.compactType)(this.props),u),activeDrag:S})}),ge(this,"onDragStop",(e,t,n,s)=>{let{e:a,node:i}=s;if(!this.state.activeDrag)return;const{oldDragItem:l}=this.state;let{layout:c}=this.state;const{cols:u,preventCollision:p,allowOverlap:g}=this.props,y=(0,T.getLayoutItem)(c,e);if(!y)return;c=(0,T.moveElement)(c,y,t,n,!0,p,(0,T.compactType)(this.props),u,g);const k=g?c:(0,T.compact)(c,(0,T.compactType)(this.props),u);this.props.onDragStop(k,l,y,null,a,i);const{oldLayout:P}=this.state;this.setState({activeDrag:null,layout:k,oldDragItem:null,oldLayout:null}),this.onLayoutMaybeChanged(k,P)}),ge(this,"onResizeStart",(e,t,n,s)=>{let{e:a,node:i}=s;const{layout:l}=this.state,c=(0,T.getLayoutItem)(l,e);c&&(this.setState({oldResizeItem:(0,T.cloneLayoutItem)(c),oldLayout:this.state.layout,resizing:!0}),this.props.onResizeStart(l,c,c,null,a,i))}),ge(this,"onResize",(e,t,n,s)=>{let{e:a,node:i,size:l,handle:c}=s;const{oldResizeItem:u}=this.state,{layout:p}=this.state,{cols:g,preventCollision:y,allowOverlap:S}=this.props;let k=!1,P,C,w;const[D,v]=(0,T.withLayoutItem)(p,e,h=>{let b;return C=h.x,w=h.y,["sw","w","nw","n","ne"].indexOf(c)!==-1&&(["sw","nw","w"].indexOf(c)!==-1&&(C=h.x+(h.w-t),t=h.x!==C&&C<0?h.w:t,C=C<0?0:C),["ne","n","nw"].indexOf(c)!==-1&&(w=h.y+(h.h-n),n=h.y!==w&&w<0?h.h:n,w=w<0?0:w),k=!0),y&&!S&&(b=(0,T.getAllCollisions)(p,{...h,w:t,h:n,x:C,y:w}).filter(x=>x.i!==h.i).length>0,b&&(w=h.y,n=h.h,C=h.x,t=h.w,k=!1)),h.w=t,h.h=n,h});if(!v)return;P=D,k&&(P=(0,T.moveElement)(D,v,C,w,!0,this.props.preventCollision,(0,T.compactType)(this.props),g,S));const m={w:v.w,h:v.h,x:v.x,y:v.y,static:!0,i:e};this.props.onResize(P,u,v,m,a,i),this.setState({layout:S?P:(0,T.compact)(P,(0,T.compactType)(this.props),g),activeDrag:m})}),ge(this,"onResizeStop",(e,t,n,s)=>{let{e:a,node:i}=s;const{layout:l,oldResizeItem:c}=this.state,{cols:u,allowOverlap:p}=this.props,g=(0,T.getLayoutItem)(l,e),y=p?l:(0,T.compact)(l,(0,T.compactType)(this.props),u);this.props.onResizeStop(y,c,g,null,a,i);const{oldLayout:S}=this.state;this.setState({activeDrag:null,layout:y,oldResizeItem:null,oldLayout:null,resizing:!1}),this.onLayoutMaybeChanged(y,S)}),ge(this,"onDragOver",e=>{if(e.preventDefault(),e.stopPropagation(),Es&&!e.nativeEvent.target?.classList.contains(Sn))return!1;const{droppingItem:t,onDropDragOver:n,margin:s,cols:a,rowHeight:i,maxRows:l,width:c,containerPadding:u,transformScale:p}=this.props,g=n?.(e);if(g===!1)return this.state.droppingDOMNode&&this.removeDroppingPlaceholder(),!1;const y={...t,...g},{layout:S}=this.state,k=e.currentTarget.getBoundingClientRect(),P=e.clientX-k.left,C=e.clientY-k.top,w={left:P/p,top:C/p,e};if(this.state.droppingDOMNode){if(this.state.droppingPosition){const{left:D,top:v}=this.state.droppingPosition;(D!=P||v!=C)&&this.setState({droppingPosition:w})}}else{const D={cols:a,margin:s,maxRows:l,rowHeight:i,containerWidth:c,containerPadding:u||s},v=(0,lc.calcXY)(D,C,P,y.w,y.h);this.setState({droppingDOMNode:We.createElement("div",{key:y.i}),droppingPosition:w,layout:[...S,{...y,x:v.x,y:v.y,static:!1,isDraggable:!0}]})}}),ge(this,"removeDroppingPlaceholder",()=>{const{droppingItem:e,cols:t}=this.props,{layout:n}=this.state,s=(0,T.compact)(n.filter(a=>a.i!==e.i),(0,T.compactType)(this.props),t,this.props.allowOverlap);this.setState({layout:s,droppingDOMNode:null,activeDrag:null,droppingPosition:void 0})}),ge(this,"onDragLeave",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter--,this.dragEnterCounter===0&&this.removeDroppingPlaceholder()}),ge(this,"onDragEnter",e=>{e.preventDefault(),e.stopPropagation(),this.dragEnterCounter++}),ge(this,"onDrop",e=>{e.preventDefault(),e.stopPropagation();const{droppingItem:t}=this.props,{layout:n}=this.state,s=n.find(a=>a.i===t.i);this.dragEnterCounter=0,this.removeDroppingPlaceholder(),this.props.onDrop(n,s,e)})}componentDidMount(){this.setState({mounted:!0}),this.onLayoutMaybeChanged(this.state.layout,this.props.layout)}static getDerivedStateFromProps(e,t){let n;return t.activeDrag?null:(!(0,lr.deepEqual)(e.layout,t.propsLayout)||e.compactType!==t.compactType?n=e.layout:(0,T.childrenEqual)(e.children,t.children)||(n=t.layout),n?{layout:(0,T.synchronizeLayoutWithChildren)(n,e.children,e.cols,(0,T.compactType)(e),e.allowOverlap),compactType:e.compactType,children:e.children,propsLayout:e.layout}:null)}shouldComponentUpdate(e,t){return this.props.children!==e.children||!(0,T.fastRGLPropsEqual)(this.props,e,lr.deepEqual)||this.state.activeDrag!==t.activeDrag||this.state.mounted!==t.mounted||this.state.droppingPosition!==t.droppingPosition}componentDidUpdate(e,t){if(!this.state.activeDrag){const n=this.state.layout,s=t.layout;this.onLayoutMaybeChanged(n,s)}}containerHeight(){if(!this.props.autoSize)return;const e=(0,T.bottom)(this.state.layout),t=this.props.containerPadding?this.props.containerPadding[1]:this.props.margin[1];return e*this.props.rowHeight+(e-1)*this.props.margin[1]+t*2+"px"}onLayoutMaybeChanged(e,t){t||(t=this.state.layout),(0,lr.deepEqual)(t,e)||this.props.onLayoutChange(e)}placeholder(){const{activeDrag:e}=this.state;if(!e)return null;const{width:t,cols:n,margin:s,containerPadding:a,rowHeight:i,maxRows:l,useCSSTransforms:c,transformScale:u}=this.props;return We.createElement(_n.default,{w:e.w,h:e.h,x:e.x,y:e.y,i:e.i,className:`react-grid-placeholder ${this.state.resizing?"placeholder-resizing":""}`,containerWidth:t,cols:n,margin:s,containerPadding:a||s,maxRows:l,rowHeight:i,isDraggable:!1,isResizable:!1,isBounded:!1,useCSSTransforms:c,transformScale:u},We.createElement("div",null))}processGridItem(e,t){if(!e||!e.key)return;const n=(0,T.getLayoutItem)(this.state.layout,String(e.key));if(!n)return null;const{width:s,cols:a,margin:i,containerPadding:l,rowHeight:c,maxRows:u,isDraggable:p,isResizable:g,isBounded:y,useCSSTransforms:S,transformScale:k,draggableCancel:P,draggableHandle:C,resizeHandles:w,resizeHandle:D}=this.props,{mounted:v,droppingPosition:m}=this.state,h=typeof n.isDraggable=="boolean"?n.isDraggable:!n.static&&p,b=typeof n.isResizable=="boolean"?n.isResizable:!n.static&&g,_=n.resizeHandles||w,x=h&&y&&n.isBounded!==!1;return We.createElement(_n.default,{containerWidth:s,cols:a,margin:i,containerPadding:l||i,maxRows:u,rowHeight:c,cancel:P,handle:C,onDragStop:this.onDragStop,onDragStart:this.onDragStart,onDrag:this.onDrag,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,isDraggable:h,isResizable:b,isBounded:x,useCSSTransforms:S&&v,usePercentages:!v,transformScale:k,w:n.w,h:n.h,x:n.x,y:n.y,i:n.i,minH:n.minH,minW:n.minW,maxH:n.maxH,maxW:n.maxW,static:n.static,droppingPosition:t?m:void 0,resizeHandles:_,resizeHandle:D},e)}render(){const{className:e,style:t,isDroppable:n,innerRef:s}=this.props,a=(0,ic.default)(Sn,e),i={height:this.containerHeight(),...t};return We.createElement("div",{ref:s,className:a,style:i,onDrop:n?this.onDrop:T.noop,onDragLeave:n?this.onDragLeave:T.noop,onDragEnter:n?this.onDragEnter:T.noop,onDragOver:n?this.onDragOver:T.noop},We.Children.map(this.props.children,l=>this.processGridItem(l)),n&&this.state.droppingDOMNode&&this.processGridItem(this.state.droppingDOMNode,!0),this.placeholder())}}lt.default=Ut;ge(Ut,"displayName","ReactGridLayout");ge(Ut,"propTypes",cc.default);ge(Ut,"defaultProps",{autoSize:!0,cols:12,className:"",style:{},draggableHandle:"",draggableCancel:"",containerPadding:null,rowHeight:150,maxRows:1/0,layout:[],margin:[10,10],isBounded:!1,isDraggable:!0,isResizable:!0,allowOverlap:!1,isDroppable:!1,useCSSTransforms:!0,transformScale:1,verticalCompact:!0,compactType:"vertical",preventCollision:!1,droppingItem:{i:"__dropping-elem__",h:1,w:1},resizeHandles:["se"],onLayoutChange:T.noop,onDragStart:T.noop,onDrag:T.noop,onDragStop:T.noop,onResizeStart:T.noop,onResize:T.noop,onResizeStop:T.noop,onDrop:T.noop,onDropDragOver:T.noop});var Ft={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.findOrGenerateResponsiveLayout=pc;Ve.getBreakpointFromWidth=fc;Ve.getColsFromBreakpoint=hc;Ve.sortBreakpoints=Jr;var pt=G;function fc(r,e){const t=Jr(r);let n=t[0];for(let s=1,a=t.length;s<a;s++){const i=t[s];e>r[i]&&(n=i)}return n}function hc(r,e){if(!e[r])throw new Error("ResponsiveReactGridLayout: `cols` entry for breakpoint "+r+" is missing!");return e[r]}function pc(r,e,t,n,s,a){if(r[t])return(0,pt.cloneLayout)(r[t]);let i=r[n];const l=Jr(e),c=l.slice(l.indexOf(t));for(let u=0,p=c.length;u<p;u++){const g=c[u];if(r[g]){i=r[g];break}}return i=(0,pt.cloneLayout)(i||[]),(0,pt.compact)((0,pt.correctBounds)(i,{cols:s}),a,s)}function Jr(r){return Object.keys(r).sort(function(t,n){return r[t]-r[n]})}Object.defineProperty(Ft,"__esModule",{value:!0});Ft.default=void 0;var jn=Ms(d),we=Ds(qe),cr=zr,Ze=G,Be=Ve,mc=Ds(lt);function Ds(r){return r&&r.__esModule?r:{default:r}}function Ms(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Ms=function(s,a){if(!a&&s&&s.__esModule)return s;var i,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(i=a?n:t){if(i.has(s))return i.get(s);i.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?i(c,u,l):c[u]=s[u]);return c})(r,e)}function Rr(){return Rr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Rr.apply(null,arguments)}function St(r,e,t){return(e=gc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function gc(r){var e=yc(r,"string");return typeof e=="symbol"?e:e+""}function yc(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Pn=r=>Object.prototype.toString.call(r);function mt(r,e){return r==null?null:Array.isArray(r)?r:r[e]}class Zr extends jn.Component{constructor(){super(...arguments),St(this,"state",this.generateInitialState()),St(this,"onLayoutChange",e=>{this.props.onLayoutChange(e,{...this.props.layouts,[this.state.breakpoint]:e})})}generateInitialState(){const{width:e,breakpoints:t,layouts:n,cols:s}=this.props,a=(0,Be.getBreakpointFromWidth)(t,e),i=(0,Be.getColsFromBreakpoint)(a,s),l=this.props.verticalCompact===!1?null:this.props.compactType;return{layout:(0,Be.findOrGenerateResponsiveLayout)(n,t,a,a,i,l),breakpoint:a,cols:i}}static getDerivedStateFromProps(e,t){if(!(0,cr.deepEqual)(e.layouts,t.layouts)){const{breakpoint:n,cols:s}=t;return{layout:(0,Be.findOrGenerateResponsiveLayout)(e.layouts,e.breakpoints,n,n,s,e.compactType),layouts:e.layouts}}return null}componentDidUpdate(e){(this.props.width!=e.width||this.props.breakpoint!==e.breakpoint||!(0,cr.deepEqual)(this.props.breakpoints,e.breakpoints)||!(0,cr.deepEqual)(this.props.cols,e.cols))&&this.onWidthChange(e)}onWidthChange(e){const{breakpoints:t,cols:n,layouts:s,compactType:a}=this.props,i=this.props.breakpoint||(0,Be.getBreakpointFromWidth)(this.props.breakpoints,this.props.width),l=this.state.breakpoint,c=(0,Be.getColsFromBreakpoint)(i,n),u={...s};if(l!==i||e.breakpoints!==t||e.cols!==n){l in u||(u[l]=(0,Ze.cloneLayout)(this.state.layout));let y=(0,Be.findOrGenerateResponsiveLayout)(u,t,i,l,c,a);y=(0,Ze.synchronizeLayoutWithChildren)(y,this.props.children,c,a,this.props.allowOverlap),u[i]=y,this.props.onBreakpointChange(i,c),this.props.onLayoutChange(y,u),this.setState({breakpoint:i,layout:y,cols:c})}const p=mt(this.props.margin,i),g=mt(this.props.containerPadding,i);this.props.onWidthChange(this.props.width,p,c,g)}render(){const{breakpoint:e,breakpoints:t,cols:n,layouts:s,margin:a,containerPadding:i,onBreakpointChange:l,onLayoutChange:c,onWidthChange:u,...p}=this.props;return jn.createElement(mc.default,Rr({},p,{margin:mt(a,this.state.breakpoint),containerPadding:mt(i,this.state.breakpoint),onLayoutChange:this.onLayoutChange,layout:this.state.layout,cols:this.state.cols}))}}Ft.default=Zr;St(Zr,"propTypes",{breakpoint:we.default.string,breakpoints:we.default.object,allowOverlap:we.default.bool,cols:we.default.object,margin:we.default.oneOfType([we.default.array,we.default.object]),containerPadding:we.default.oneOfType([we.default.array,we.default.object]),layouts(r,e){if(Pn(r[e])!=="[object Object]")throw new Error("Layout property must be an object. Received: "+Pn(r[e]));Object.keys(r[e]).forEach(t=>{if(!(t in r.breakpoints))throw new Error("Each key in layouts must align with a key in breakpoints.");(0,Ze.validateLayout)(r.layouts[t],"layouts."+t)})},width:we.default.number.isRequired,onBreakpointChange:we.default.func,onLayoutChange:we.default.func,onWidthChange:we.default.func});St(Zr,"defaultProps",{breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},containerPadding:{lg:null,md:null,sm:null,xs:null,xxs:null},layouts:{},margin:[10,10],allowOverlap:!1,onBreakpointChange:Ze.noop,onLayoutChange:Ze.noop,onWidthChange:Ze.noop});var en={},ks=function(){if(typeof Map<"u")return Map;function r(e,t){var n=-1;return e.some(function(s,a){return s[0]===t?(n=a,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var n=r(this.__entries__,t),s=this.__entries__[n];return s&&s[1]},e.prototype.set=function(t,n){var s=r(this.__entries__,t);~s?this.__entries__[s][1]=n:this.__entries__.push([t,n])},e.prototype.delete=function(t){var n=this.__entries__,s=r(n,t);~s&&n.splice(s,1)},e.prototype.has=function(t){return!!~r(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,n){n===void 0&&(n=null);for(var s=0,a=this.__entries__;s<a.length;s++){var i=a[s];t.call(n,i[1],i[0])}},e}()}(),Cr=typeof window<"u"&&typeof document<"u"&&window.document===document,jt=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),bc=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(jt):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)}}(),vc=2;function xc(r,e){var t=!1,n=!1,s=0;function a(){t&&(t=!1,r()),n&&l()}function i(){bc(a)}function l(){var c=Date.now();if(t){if(c-s<vc)return;n=!0}else t=!0,n=!1,setTimeout(i,e);s=c}return l}var wc=20,_c=["top","right","bottom","left","width","height","size","weight"],Sc=typeof MutationObserver<"u",jc=function(){function r(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=xc(this.refresh.bind(this),wc)}return r.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},r.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},r.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},r.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},r.prototype.connect_=function(){!Cr||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Sc?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},r.prototype.disconnect_=function(){!Cr||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},r.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=t===void 0?"":t,s=_c.some(function(a){return!!~n.indexOf(a)});s&&this.refresh()},r.getInstance=function(){return this.instance_||(this.instance_=new r),this.instance_},r.instance_=null,r}(),Os=function(r,e){for(var t=0,n=Object.keys(e);t<n.length;t++){var s=n[t];Object.defineProperty(r,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return r},et=function(r){var e=r&&r.ownerDocument&&r.ownerDocument.defaultView;return e||jt},Is=Gt(0,0,0,0);function Pt(r){return parseFloat(r)||0}function Rn(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(n,s){var a=r["border-"+s+"-width"];return n+Pt(a)},0)}function Pc(r){for(var e=["top","right","bottom","left"],t={},n=0,s=e;n<s.length;n++){var a=s[n],i=r["padding-"+a];t[a]=Pt(i)}return t}function Rc(r){var e=r.getBBox();return Gt(0,0,e.width,e.height)}function Cc(r){var e=r.clientWidth,t=r.clientHeight;if(!e&&!t)return Is;var n=et(r).getComputedStyle(r),s=Pc(n),a=s.left+s.right,i=s.top+s.bottom,l=Pt(n.width),c=Pt(n.height);if(n.boxSizing==="border-box"&&(Math.round(l+a)!==e&&(l-=Rn(n,"left","right")+a),Math.round(c+i)!==t&&(c-=Rn(n,"top","bottom")+i)),!Dc(r)){var u=Math.round(l+a)-e,p=Math.round(c+i)-t;Math.abs(u)!==1&&(l-=u),Math.abs(p)!==1&&(c-=p)}return Gt(s.left,s.top,l,c)}var Ec=function(){return typeof SVGGraphicsElement<"u"?function(r){return r instanceof et(r).SVGGraphicsElement}:function(r){return r instanceof et(r).SVGElement&&typeof r.getBBox=="function"}}();function Dc(r){return r===et(r).document.documentElement}function Mc(r){return Cr?Ec(r)?Rc(r):Cc(r):Is}function kc(r){var e=r.x,t=r.y,n=r.width,s=r.height,a=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,i=Object.create(a.prototype);return Os(i,{x:e,y:t,width:n,height:s,top:t,right:e+n,bottom:s+t,left:e}),i}function Gt(r,e,t,n){return{x:r,y:e,width:t,height:n}}var Oc=function(){function r(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Gt(0,0,0,0),this.target=e}return r.prototype.isActive=function(){var e=Mc(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},r.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},r}(),Ic=function(){function r(e,t){var n=kc(t);Os(this,{target:e,contentRect:n})}return r}(),zc=function(){function r(e,t,n){if(this.activeObservations_=[],this.observations_=new ks,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return r.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Oc(e)),this.controller_.addObserver(this),this.controller_.refresh())}},r.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},r.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},r.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},r.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new Ic(n.target,n.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},r.prototype.clearActive=function(){this.activeObservations_.splice(0)},r.prototype.hasActive=function(){return this.activeObservations_.length>0},r}(),zs=typeof WeakMap<"u"?new WeakMap:new ks,Ns=function(){function r(e){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=jc.getInstance(),n=new zc(e,t,this);zs.set(this,n)}return r}();["observe","unobserve","disconnect"].forEach(function(r){Ns.prototype[r]=function(){var e;return(e=zs.get(this))[r].apply(e,arguments)}});var Nc=function(){return typeof jt.ResizeObserver<"u"?jt.ResizeObserver:Ns}();const Tc=Object.freeze(Object.defineProperty({__proto__:null,default:Nc},Symbol.toStringTag,{value:"Module"})),Ac=no(Tc);Object.defineProperty(en,"__esModule",{value:!0});en.default=Uc;var gt=Ts(d),Lc=tn(qe),qc=tn(Ac),Wc=tn(Et);function tn(r){return r&&r.__esModule?r:{default:r}}function Ts(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(Ts=function(s,a){if(!a&&s&&s.__esModule)return s;var i,l,c={__proto__:null,default:s};if(s===null||typeof s!="object"&&typeof s!="function")return c;if(i=a?n:t){if(i.has(s))return i.get(s);i.set(s,c)}for(const u in s)u!=="default"&&{}.hasOwnProperty.call(s,u)&&((l=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(s,u))&&(l.get||l.set)?i(c,u,l):c[u]=s[u]);return c})(r,e)}function Er(){return Er=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Er.apply(null,arguments)}function Qe(r,e,t){return(e=Bc(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Bc(r){var e=$c(r,"string");return typeof e=="symbol"?e:e+""}function $c(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}const Hc="react-grid-layout";function Uc(r){var e;return e=class extends gt.Component{constructor(){super(...arguments),Qe(this,"state",{width:1280}),Qe(this,"elementRef",gt.createRef()),Qe(this,"mounted",!1),Qe(this,"resizeObserver",void 0)}componentDidMount(){this.mounted=!0,this.resizeObserver=new qc.default(s=>{if(this.elementRef.current instanceof HTMLElement){const i=s[0].contentRect.width;this.setState({width:i})}});const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.observe(n)}componentWillUnmount(){this.mounted=!1;const n=this.elementRef.current;n instanceof HTMLElement&&this.resizeObserver.unobserve(n),this.resizeObserver.disconnect()}render(){const{measureBeforeMount:n,...s}=this.props;return n&&!this.mounted?gt.createElement("div",{className:(0,Wc.default)(this.props.className,Hc),style:this.props.style,ref:this.elementRef}):gt.createElement(r,Er({innerRef:this.elementRef},s,this.state))}},Qe(e,"defaultProps",{measureBeforeMount:!1}),Qe(e,"propTypes",{measureBeforeMount:Lc.default.bool}),e}(function(r){r.exports=lt.default,r.exports.utils=G,r.exports.calculateUtils=ke,r.exports.Responsive=Ft.default,r.exports.Responsive.utils=Ve,r.exports.WidthProvider=en.default})(es);var Cn=es.exports;const Fc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Gc(r){return r==null?"":typeof r!="string"?String(r):r.replace(/[&<>"'`=\/]/g,e=>Fc[e])}function rn(r,e={}){const{maxLength:t=1e4,trim:n=!0,normalizeWhitespace:s=!0}=e;if(r==null)return"";typeof r!="string"&&(r=String(r));let a=r;return a=a.replace(/\0/g,""),a=a.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n&&(a=a.trim()),s&&(a=a.replace(/[ \t]+/g," ")),a.length>t&&(a=a.substring(0,t)),a}function Rt(r,e=255){return r==null?"":(typeof r!="string"&&(r=String(r)),rn(r,{maxLength:e}).replace(/[\r\n]/g," ").replace(/\s+/g," ").trim())}function As(r,e=1e4){return r==null?"":(typeof r!="string"&&(r=String(r)),rn(r,{maxLength:e,normalizeWhitespace:!1}).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`).trim())}function Ls(r){return r?Rt(r,254).toLowerCase():""}function Vt(r,e={}){const{min:t=-1/0,max:n=1/0,decimals:s=2}=e;if(r==null||r==="")return null;let a=String(r).replace(/[^0-9.\-]/g,""),i=parseFloat(a);return isNaN(i)?null:(i=Math.max(t,Math.min(n,i)),i=Math.round(i*Math.pow(10,s))/Math.pow(10,s),i)}function Vc(r){const e=Vt(r,{min:0,decimals:2});return e!==null?Math.round(e*100)/100:null}function Yc(r){const e=Vt(r,{min:0,max:24,decimals:1});return e===null?null:Math.round(e*2)/2}function Kc(r){return Vt(r,{min:0,max:100,decimals:1})}function Xc(r){if(!r)return null;const e=String(r).trim();return/^(javascript|data|vbscript):/i.test(e)?null:/^(https?:\/\/|\/|#)/i.test(e)?e:`https://${e}`}function Qc(r,e={}){if(!r||typeof r!="object")return r;const t={...r};for(const[n,s]of Object.entries(e)){if(t[n]===void 0)continue;const{type:a="text",maxLength:i}=s;switch(a){case"singleLine":t[n]=Rt(t[n],i);break;case"multiLine":t[n]=As(t[n],i);break;case"email":t[n]=Ls(t[n]);break;case"number":t[n]=Vt(t[n],s);break;case"currency":t[n]=Vc(t[n]);break;case"hours":t[n]=Yc(t[n]);break;case"percentage":t[n]=Kc(t[n]);break;case"url":t[n]=Xc(t[n]);break;case"html":t[n]=Gc(t[n]);break;default:t[n]=rn(t[n],{maxLength:i})}}return t}const Jc={timesheet:{description:{type:"multiLine",maxLength:2e3},hours_worked:{type:"hours"}},expense:{reason:{type:"multiLine",maxLength:2e3},amount:{type:"currency"}},resource:{name:{type:"singleLine",maxLength:100},email:{type:"email"},role:{type:"singleLine",maxLength:100},notes:{type:"multiLine",maxLength:5e3}},partner:{name:{type:"singleLine",maxLength:200},contact_name:{type:"singleLine",maxLength:100},contact_email:{type:"email"},notes:{type:"multiLine",maxLength:5e3}},milestone:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},deliverable:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},kpi:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"number",decimals:2},actual_value:{type:"number",decimals:2}},qualityStandard:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"percentage"}}};function En(r,e){const t=Jc[r];return t?Qc(e,t):e}class ze{constructor(e,t={}){this.tableName=e,this.supportsSoftDelete=t.supportsSoftDelete!==!1,this.sanitizeConfig=t.sanitizeConfig||null}getSoftDeleteFilter(){return this.supportsSoftDelete?"is_deleted.is.null,is_deleted.eq.false":null}async getAll(e,t={}){try{let n=j.from(this.tableName).select(t.select||"*").eq("project_id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter())),t.filters&&Array.isArray(t.filters)&&t.filters.forEach(i=>{const{column:l,operator:c,value:u}=i;switch(c){case"eq":n=n.eq(l,u);break;case"neq":n=n.neq(l,u);break;case"gt":n=n.gt(l,u);break;case"gte":n=n.gte(l,u);break;case"lt":n=n.lt(l,u);break;case"lte":n=n.lte(l,u);break;case"like":n=n.like(l,u);break;case"ilike":n=n.ilike(l,u);break;case"in":n=n.in(l,u);break;case"is":n=n.is(l,u);break;default:n=n.eq(l,u)}}),t.orderBy&&(n=n.order(t.orderBy.column,{ascending:t.orderBy.ascending??!0}));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getDeleted(e){if(!this.supportsSoftDelete)return[];try{const{data:t,error:n}=await j.from(this.tableName).select("*").eq("project_id",e).eq("is_deleted",!0).order("deleted_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async getById(e,t={}){try{let n=j.from(this.tableName).select(t.select||"*").eq("id",e);this.supportsSoftDelete&&!t.includeDeleted&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:a}=await n.single();if(a){if(a.code==="PGRST116")return null;throw a}return s}catch(n){throw n}}async create(e){try{if(!e.project_id)throw new Error("project_id is required");let t=e;this.sanitizeConfig&&(t=En(this.sanitizeConfig,e)),this.supportsSoftDelete&&(delete t.is_deleted,delete t.deleted_at,delete t.deleted_by);const{data:n,error:s}=await j.from(this.tableName).insert(t).select().single();if(s)throw s;return n}catch(t){throw t}}async update(e,t){try{let n=t;this.sanitizeConfig&&(n=En(this.sanitizeConfig,t));const s={...n,updated_at:new Date().toISOString()};delete s.is_deleted,delete s.deleted_at,delete s.deleted_by;const{data:a,error:i}=await j.from(this.tableName).update(s).eq("id",e).select().single();if(i)throw i;return a}catch(n){throw n}}async delete(e,t=null){try{if(this.supportsSoftDelete){const{error:n}=await j.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e);if(n)throw n}else{const{error:n}=await j.from(this.tableName).delete().eq("id",e);if(n)throw n}return!0}catch(n){throw n}}async hardDelete(e){try{const{error:t}=await j.from(this.tableName).delete().eq("id",e);if(t)throw t;return!0}catch(t){throw t}}async restore(e){if(!this.supportsSoftDelete)throw new Error("This entity does not support soft delete");try{const{data:t,error:n}=await j.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}catch(t){throw t}}async exists(e){try{let t=j.from(this.tableName).select("id",{count:"exact",head:!0}).eq("id",e);this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{count:n,error:s}=await t;if(s)throw s;return n>0}catch(t){throw t}}async count(e,t=[]){try{let n=j.from(this.tableName).select("id",{count:"exact",head:!0}).eq("project_id",e);this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.forEach(i=>{const{column:l,operator:c,value:u}=i;c==="eq"?n=n.eq(l,u):c==="in"&&(n=n.in(l,u))});const{count:s,error:a}=await n;if(a)throw a;return s||0}catch(n){throw n}}}class Zc extends ze{constructor(){super("partners")}async getAll(e){return super.getAll(e,{orderBy:{column:"name",ascending:!0}})}async getActive(e){return super.getAll(e,{filters:[{column:"is_active",operator:"eq",value:!0}],orderBy:{column:"name",ascending:!0}})}async getWithResources(e){try{const{data:t,error:n}=await j.from("partners").select(`
          *,
          resources (
            id,
            name,
            daily_rate,
            cost_price,
            is_active
          )
        `).eq("id",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getSummary(e){try{const{data:t,error:n}=await j.from("partners").select(`
          id,
          name,
          contact_name,
          contact_email,
          payment_terms,
          is_active,
          created_at
        `).eq("project_id",e).order("name",{ascending:!0});if(n)throw n;return t||[]}catch(t){throw t}}async create(e){if(!e.name?.trim())throw new Error("Partner name is required");if(await this.findByName(e.project_id,e.name))throw new Error(`Partner "${e.name}" already exists`);return super.create({...e,name:e.name.trim(),is_active:e.is_active??!0,payment_terms:e.payment_terms||"Net 30"})}async findByName(e,t){try{const{data:n,error:s}=await j.from("partners").select("*").eq("project_id",e).ilike("name",t.trim()).single();if(s){if(s.code==="PGRST116")return null;throw s}return n}catch(n){if(n.code==="PGRST116")return null;throw n}}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Partner not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e,t=!0){return(t?await this.getActive(e):await this.getAll(e)).map(s=>({value:s.id,label:s.name}))}async getDependencyCounts(e){try{const{data:t,error:n}=await j.from("resources").select("id").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(n)throw n;const s=t?.map(u=>u.id)||[];let a=0,i=0;if(s.length>0){const{count:u,error:p}=await j.from("timesheets").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(p)throw p;a=u||0;const{count:g,error:y}=await j.from("expenses").select("*",{count:"exact",head:!0}).in("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(y)throw y;i=g||0}const{count:l,error:c}=await j.from("partner_invoices").select("*",{count:"exact",head:!0}).eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(c)throw c;return{resourceCount:t?.length||0,timesheetCount:a,expenseCount:i,invoiceCount:l||0,canDelete:!t?.length&&!l}}catch(t){throw t}}}const kd=new Zc;class eu extends ze{constructor(){super("resources",{sanitizeConfig:"resource",supportsSoftDelete:!0})}sanitizeData(e){const t={...e};return t.name&&(t.name=Rt(t.name,100)),t.role&&(t.role=Rt(t.role,100)),t.email&&(t.email=Ls(t.email)),t.notes&&(t.notes=As(t.notes,5e3)),t}async getAll(e,t={}){const{includePartner:n=!0,activeOnly:s=!1,showTestUsers:a=!0,includeDeleted:i=!1}=t;let l="*";n&&(l="*, partner:partners(id, name, is_active)");let c=j.from(this.tableName).select(l).eq("project_id",e).order("name");i||(c=c.or("is_deleted.is.null,is_deleted.eq.false")),s&&(c=c.eq("is_active",!0)),a||(c=c.or("is_test_content.is.null,is_test_content.eq.false"));const{data:u,error:p}=await c;if(p)throw p;return u||[]}async getAllFiltered(e,t=!0){return this.getAll(e,{showTestUsers:t,includePartner:!0})}async getById(e){const{data:t,error:n}=await j.from(this.tableName).select("*, partner:partners(id, name, contact_name, contact_email, is_active)").eq("id",e).or("is_deleted.is.null,is_deleted.eq.false").single();if(n)throw n;return t}async getByType(e,t){const{data:n,error:s}=await j.from(this.tableName).select("*, partner:partners(id, name)").eq("project_id",e).eq("resource_type",t).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(s)throw s;return n||[]}async getByPartner(e){const{data:t,error:n}=await j.from(this.tableName).select("*").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}async getWithTimesheetSummary(e){const t=await this.getById(e);if(!t)return null;const{data:n,error:s}=await j.from("timesheets").select("id, hours_worked, hours, status, was_rejected, date").eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false");let a=0,i=0,l=0;return n&&n.forEach(c=>{const u=parseFloat(c.hours_worked||c.hours||0);a+=u,c.status==="Approved"?i+=u:c.status==="Submitted"&&!c.was_rejected&&(l+=u)}),{...t,timesheetSummary:{totalEntries:n?.length||0,totalHours:a,approvedHours:i,pendingHours:l,daysWorked:a/8}}}async create(e){const t=this.sanitizeData(e);if(!t.name?.trim())throw new Error("Resource name is required");if(!t.project_id)throw new Error("Project ID is required");if(!t.email?.trim())throw new Error("Email is required");t.resource_type==="internal"&&(t.partner_id=null);const{data:n,error:s}=await j.from(this.tableName).insert([t]).select("*, partner:partners(id, name)").single();if(s)throw s;return n}async update(e,t){const n=this.sanitizeData(t);n.resource_type==="internal"&&(n.partner_id=null),n.updated_at=new Date().toISOString();const{data:s,error:a}=await j.from(this.tableName).update(n).eq("id",e).select("*, partner:partners(id, name)").single();if(a)throw a;return s}async delete(e,t=null){const{data:n,error:s}=await j.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",e).select().single();if(s)throw s;return n}async restore(e){const{data:t,error:n}=await j.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",e).select().single();if(n)throw n;return t}async linkToPartner(e,t){const n={partner_id:t,resource_type:t?"third_party":"internal",updated_at:new Date().toISOString()};return this.update(e,n)}async toggleActive(e){const t=await this.getById(e);if(!t)throw new Error("Resource not found");return this.update(e,{is_active:!t.is_active})}async getForSelect(e){const{data:t,error:n}=await j.from(this.tableName).select("id, name, resource_type, role").eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(n)throw n;return t||[]}calculateMargin(e,t){if(!e||e===0||!t)return{percent:null,amount:null,status:"unknown"};const n=(e-t)/e*100,s=e-t;let a="critical";return n>=25?a="good":n>=10&&(a="low"),{percent:n,amount:s,status:a}}async getUtilization(e){const t=await this.getWithTimesheetSummary(e);if(!t)return null;const n=t.days_allocated||0,s=t.timesheetSummary.daysWorked,a=Math.max(0,n-s),i=n>0?s/n*100:0;return{resourceId:e,resourceName:t.name,daysAllocated:n,daysUsed:s,remaining:a,utilizationPercent:i,totalValue:(t.daily_rate||0)*n,valueUsed:(t.daily_rate||0)*s}}async getSummary(e){const t=await this.getAll(e,{includePartner:!1});return{total:t.length,internal:t.filter(n=>n.resource_type==="internal").length,thirdParty:t.filter(n=>n.resource_type==="third_party").length,active:t.filter(n=>n.is_active).length,totalBudget:t.reduce((n,s)=>n+(s.daily_rate||0)*(s.days_allocated||0),0)}}async getProfileByEmail(e){try{const{data:t,error:n}=await this.supabase.from("profiles").select("id, email, full_name, role").eq("email",e).single();if(n){if(n.code==="PGRST116")return null;throw n}return t}catch(t){throw t}}async getAllWithTestFilter(e,t=[]){try{const n=await this.getAll(e,{orderBy:{column:"name",ascending:!0}});return t&&t.length>0?n.filter(s=>!s.user_id||!t.includes(s.user_id)):n}catch(n){throw n}}async getDependencyCounts(e){try{const[t,n]=await Promise.all([this.supabase.from("timesheets").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false"),this.supabase.from("expenses").select("id",{count:"exact",head:!0}).eq("resource_id",e).or("is_deleted.is.null,is_deleted.eq.false")]);return{timesheetCount:t.count||0,expenseCount:n.count||0,canDelete:(t.count||0)===0&&(n.count||0)===0}}catch(t){throw t}}}const Od=new eu;class tu extends ze{constructor(){super("timesheets",{supportsSoftDelete:!0,sanitizeConfig:"timesheet"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||`
      *,
      resources(id, name, email, daily_rate, cost_price),
      milestones(id, milestone_ref, name)
    `,orderBy:t.orderBy||{column:"date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=j.from(this.tableName).select(`
          *,
          resources(id, name, email, daily_rate, cost_price),
          milestones(id, milestone_ref, name)
        `).eq("project_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=j.from(this.tableName).select("*, milestones(id, milestone_ref, name)").eq("resource_id",e).order("date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("date",t.start)),t.end&&(n=n.lte("date",t.end)),t.status&&(n=n.eq("status",t.status));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await j.from("resources").select("id, name, cost_price").eq("partner_id",e).or("is_deleted.is.null,is_deleted.eq.false");if(!n||n.length===0)return[];const s=n.map(c=>c.id);let a=j.from(this.tableName).select("*, resources(id, name, cost_price), milestones(id, milestone_ref, name)").in("resource_id",s).order("date",{ascending:!1});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter())),t.start&&(a=a.gte("date",t.start)),t.end&&(a=a.lte("date",t.end)),t.status&&(a=a.eq("status",t.status));const{data:i,error:l}=await a;if(l)throw l;return i||[]}catch(n){throw n}}async getApprovedForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,status:"Approved"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={totalHours:0,totalDays:0,approvedHours:0,pendingHours:0,draftHours:0,rejectedHours:0,totalCost:0,approvedCost:0,byStatus:{Draft:{count:0,hours:0},Submitted:{count:0,hours:0},Approved:{count:0,hours:0},Rejected:{count:0,hours:0}},byMilestone:{},count:n.length};return n.forEach(a=>{const i=parseFloat(a.hours_worked||a.hours||0),l=a.resources?.cost_price||0,c=i/8*l;switch(s.totalHours+=i,s.totalCost+=c,s.byStatus[a.status]&&(s.byStatus[a.status].count++,s.byStatus[a.status].hours+=i),a.status){case"Approved":s.approvedHours+=i,s.approvedCost+=c;break;case"Submitted":a.was_rejected||(s.pendingHours+=i);break;case"Draft":s.draftHours+=i;break;case"Rejected":s.rejectedHours+=i;break}if(a.milestone_id){const u=a.milestones?.milestone_ref||"Unknown";s.byMilestone[a.milestone_id]||(s.byMilestone[a.milestone_id]={ref:u,name:a.milestones?.name||"Unknown",hours:0,cost:0}),s.byMilestone[a.milestone_id].hours+=i,s.byMilestone[a.milestone_id].cost+=c}}),s.totalDays=s.totalHours/8,s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.date)throw new Error("date is required");const t=parseFloat(e.hours_worked||e.hours||0);if(!t||t<=0)throw new Error("hours must be greater than 0");const n={...e,hours_worked:t,hours:t,date:e.date||e.work_date,work_date:e.work_date||e.date,description:e.description||e.comments||"",comments:e.comments||e.description||"",status:e.status||"Draft"};return super.create(n)}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected",was_rejected:!0};return t&&(n.rejection_reason=t),this.update(e,n)}calculateCost(e,t){return e/8*t}calculateBillable(e,t){return e/8*t}}const ru=new tu;class nu extends ze{constructor(){super("expenses",{supportsSoftDelete:!0,sanitizeConfig:"expense"})}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, expense_files(*)",orderBy:t.orderBy||{column:"expense_date",ascending:!1}})}async getAllFiltered(e,t=!1){try{let n=j.from(this.tableName).select("*, expense_files(*)").eq("project_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getByResource(e,t={}){try{let n=j.from(this.tableName).select("*, expense_files(*)").eq("resource_id",e).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter())),t.start&&(n=n.gte("expense_date",t.start)),t.end&&(n=n.lte("expense_date",t.end));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getByPartner(e,t={}){try{const{data:n}=await j.from("resources").select("id").eq("partner_id",e);if(!n||n.length===0)return[];const s=n.map(c=>c.id);let a=j.from(this.tableName).select("*, expense_files(*)").in("resource_id",s).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(a=a.or(this.getSoftDeleteFilter())),t.start&&(a=a.gte("expense_date",t.start)),t.end&&(a=a.lte("expense_date",t.end)),t.procurementMethod&&(a=a.eq("procurement_method",t.procurementMethod));const{data:i,error:l}=await a;if(l)throw l;return i||[]}catch(n){throw n}}async getPartnerProcuredForInvoice(e,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(e,{...t,procurementMethod:"partner"})}async getSummary(e,t={}){try{const n=await this.getAll(e,t),s={total:0,chargeable:0,nonChargeable:0,supplierProcured:0,partnerProcured:0,byCategory:{Travel:0,Accommodation:0,Sustenance:0},byStatus:{Draft:0,Submitted:0,Approved:0,Rejected:0,Paid:0},count:n.length};return n.forEach(a=>{const i=parseFloat(a.amount||0);s.total+=i,a.chargeable_to_customer!==!1?s.chargeable+=i:s.nonChargeable+=i,a.procurement_method==="partner"?s.partnerProcured+=i:s.supplierProcured+=i,s.byCategory[a.category]!==void 0&&(s.byCategory[a.category]+=i),s.byStatus[a.status]!==void 0&&(s.byStatus[a.status]+=i)}),s}catch(n){throw n}}async create(e){if(!e.resource_id)throw new Error("resource_id is required");if(!e.category)throw new Error("category is required");if(!e.amount||e.amount<=0)throw new Error("amount must be greater than 0");const t={...e,status:e.status||"Draft",chargeable_to_customer:e.chargeable_to_customer??!0,procurement_method:e.procurement_method||"supplier"};return super.create(t)}async createMany(e){if(!e||e.length===0)return[];try{const t=e.map(a=>{if(!a.resource_id)throw new Error("resource_id is required for all expenses");if(!a.category)throw new Error("category is required for all expenses");if(!a.amount||a.amount<=0)throw new Error("amount must be greater than 0 for all expenses");return{...a,status:a.status||"Draft",chargeable_to_customer:a.chargeable_to_customer??!0,procurement_method:a.procurement_method||"supplier"}}),{data:n,error:s}=await j.from(this.tableName).insert(t).select();if(s)throw s;return n||[]}catch(t){throw t}}async submit(e){return this.update(e,{status:"Submitted"})}async approve(e){return this.update(e,{status:"Approved"})}async reject(e,t=null){const n={status:"Rejected"};return t&&(n.rejection_reason=t),this.update(e,n)}async markPaid(e){return this.update(e,{status:"Paid"})}async uploadReceipt(e,t,n){try{const s=`${e}/${Date.now()}-${t.name}`,{error:a}=await j.storage.from("receipts").upload(s,t);if(a)throw a;const{data:i,error:l}=await j.from("expense_files").insert({expense_id:e,file_name:t.name,file_path:s,file_size:t.size,file_type:t.type,uploaded_by:n}).select().single();if(l)throw l;return i}catch(s){throw s}}async downloadReceipt(e){try{const{data:t,error:n}=await j.storage.from("receipts").download(e);if(n)throw n;return t}catch(t){throw t}}}const Id=new nu;class su extends ze{constructor(){super("partner_invoices")}async getAll(e,t={}){return super.getAll(e,{...t,select:t.select||"*, partners(name)",orderBy:t.orderBy||{column:"invoice_date",ascending:!1}})}async getByPartner(e,t={}){try{let n=j.from(this.tableName).select("*").eq("partner_id",e).order("invoice_date",{ascending:!1});t.status&&(n=n.eq("status",t.status));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async getWithLines(e){try{const{data:t,error:n}=await j.from(this.tableName).select("*, partners(name, contact_name, contact_email, payment_terms)").eq("id",e).single();if(n)throw n;if(!t)return null;const{data:s,error:a}=await j.from("partner_invoice_lines").select("*").eq("invoice_id",e).order("line_type",{ascending:!0}).order("resource_name",{ascending:!0}).order("line_date",{ascending:!0});if(a)throw a;const i={timesheets:(s||[]).filter(l=>l.line_type==="timesheet"),supplierExpenses:(s||[]).filter(l=>l.line_type==="supplier_expense"),partnerExpenses:(s||[]).filter(l=>l.line_type==="expense")};return{...t,lines:s||[],groupedLines:i}}catch(t){throw t}}async generateInvoiceNumber(e){try{const n=`INV-${new Date().getFullYear()}-`,{data:s,error:a}=await j.from(this.tableName).select("invoice_number").eq("project_id",e).like("invoice_number",`${n}%`).order("invoice_number",{ascending:!1}).limit(1);if(a)throw a;let i=1;if(s&&s.length>0){const l=s[0].invoice_number,c=parseInt(l.replace(n,""),10);isNaN(c)||(i=c+1)}return`${n}${String(i).padStart(3,"0")}`}catch(t){throw t}}async generateInvoice(e){const{projectId:t,partnerId:n,periodStart:s,periodEnd:a,createdBy:i,notes:l,includeSubmitted:c=!0}=e;try{const{data:u,error:p}=await j.from("resources").select("id, name, cost_price").eq("partner_id",n);if(p)throw p;if(!u||u.length===0)throw new Error("No resources linked to this partner");const g=u.map(M=>M.id),y={};u.forEach(M=>{y[M.id]=M});const S=c?["Approved","Submitted"]:["Approved"],{data:k,error:P}=await j.from("timesheets").select("id, date, hours_worked, hours, status, resource_id").in("resource_id",g).gte("date",s).lte("date",a).in("status",S);if(P)throw P;const{data:C,error:w}=await j.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, procurement_method, chargeable_to_customer, status").in("resource_id",g).gte("expense_date",s).lte("expense_date",a).in("status",["Approved","Submitted","Paid"]);if(w)throw w;const D=(C||[]).filter(M=>M.procurement_method==="partner"||!M.procurement_method),v=(C||[]).filter(M=>M.procurement_method==="supplier");let m=0,h=0;const b=[],_={};(k||[]).forEach(M=>{_[M.resource_id]||(_[M.resource_id]=[]),_[M.resource_id].push(M)}),Object.keys(_).forEach(M=>{const Q=y[M];_[M].forEach(q=>{const ae=parseFloat(q.hours_worked||q.hours||0),E=Q?.cost_price||0,I=ae/8,L=I*E;m+=L,h+=L,b.push({line_type:"timesheet",timesheet_id:q.id,expense_id:null,description:`${Q?.name||"Unknown"} - ${ae}h (${I.toFixed(2)} days)`,quantity:ae,unit_price:E,line_total:L,resource_name:Q?.name,line_date:q.date,hours:ae,cost_price:E,source_status:q.status,chargeable_to_customer:!0,procurement_method:null,expense_category:null})})});let x=0,R=0,z=0;const A=[];D.forEach(M=>{const Q=parseFloat(M.amount||0);x+=Q,M.chargeable_to_customer?R+=Q:z+=Q,A.push({line_type:"expense",timesheet_id:null,expense_id:M.id,description:`${M.resource_name} - ${M.category}: ${M.reason}`,quantity:1,unit_price:Q,line_total:Q,resource_name:M.resource_name,line_date:M.expense_date,hours:null,cost_price:null,source_status:M.status,chargeable_to_customer:M.chargeable_to_customer,procurement_method:"partner",expense_category:M.category})});let N=0,Z=0,he=0;const Ee=[];v.forEach(M=>{const Q=parseFloat(M.amount||0);N+=Q,M.chargeable_to_customer?Z+=Q:he+=Q,Ee.push({line_type:"supplier_expense",timesheet_id:null,expense_id:M.id,description:`${M.resource_name} - ${M.category}: ${M.reason}`,quantity:1,unit_price:Q,line_total:Q,resource_name:M.resource_name,line_date:M.expense_date,hours:null,cost_price:null,source_status:M.status,chargeable_to_customer:M.chargeable_to_customer,procurement_method:"supplier",expense_category:M.category})});const O=m+x,K=h+R+Z,ye=z+he,de=await this.generateInvoiceNumber(t),{data:re,error:ne}=await j.from(this.tableName).insert({project_id:t,partner_id:n,invoice_number:de,invoice_date:new Date().toISOString().split("T")[0],period_start:s,period_end:a,timesheet_total:m,expense_total:x,supplier_expense_total:N,invoice_total:O,chargeable_total:K,non_chargeable_total:ye,status:"Draft",notes:l||null,created_by:i}).select().single();if(ne)throw ne;const $=[...b,...A,...Ee].map(M=>({...M,invoice_id:re.id}));if($.length>0){const{error:M}=await j.from("partner_invoice_lines").insert($);if(M)throw M}return this.getWithLines(re.id)}catch(u){throw u}}async updateStatus(e,t){const n={status:t};return t==="Sent"?n.sent_at=new Date().toISOString():t==="Paid"&&(n.paid_at=new Date().toISOString()),this.update(e,n)}async markSent(e){return this.updateStatus(e,"Sent")}async markPaid(e){return this.updateStatus(e,"Paid")}async cancel(e){return this.updateStatus(e,"Cancelled")}async getPartnerStats(e){try{const{data:t,error:n}=await j.from(this.tableName).select("status, invoice_total").eq("partner_id",e);if(n)throw n;const s={total:0,draft:0,sent:0,paid:0,cancelled:0,count:t?.length||0};return(t||[]).forEach(a=>{const i=parseFloat(a.invoice_total||0);switch(s.total+=i,a.status){case"Draft":s.draft+=i;break;case"Sent":s.sent+=i;break;case"Paid":s.paid+=i;break;case"Cancelled":s.cancelled+=i;break}}),s}catch(t){throw t}}}const zd=new su;class ou extends ze{constructor(){super("milestones",{supportsSoftDelete:!0,sanitizeConfig:"milestone"})}async getAllWithStats(e){try{const t=await this.getAll(e,{orderBy:{column:"start_date",ascending:!0}}),{data:n}=await j.from("timesheets").select("milestone_id, hours_worked").eq("project_id",e).not("milestone_id","is",null).or("is_deleted.is.null,is_deleted.eq.false"),s={};return(n||[]).forEach(a=>{s[a.milestone_id]||(s[a.milestone_id]=0),s[a.milestone_id]+=parseFloat(a.hours_worked||0)}),t.map(a=>({...a,logged_hours:s[a.id]||0,logged_days:(s[a.id]||0)/8}))}catch(t){throw t}}async getWithDeliverables(e){try{const{data:t,error:n}=await j.from(this.tableName).select("*").eq("id",e).or(this.getSoftDeleteFilter()).single();if(n)throw n;const{data:s,error:a}=await j.from("deliverables").select("*").eq("milestone_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(a)throw a;return{...t,deliverables:s||[]}}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"start_date",ascending:!0}})}async getUpcoming(e,t=30){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const a=s.toISOString().split("T")[0];let i=j.from(this.tableName).select("*").eq("project_id",e).gte("end_date",n).lte("end_date",a).neq("status","Completed").order("end_date",{ascending:!0});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await i;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t){return this.update(e,{status:t})}async updateCompletion(e,t){const n={completion_percentage:t};return t>=100&&(n.status="Completed"),this.update(e,n)}async getSummary(e){try{const t=await this.getAll(e),n={total:t.length,completed:0,inProgress:0,notStarted:0,overdue:0,upcoming:0},s=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+7);const i=a.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Completed"?n.completed++:l.status==="In Progress"?(n.inProgress++,l.end_date<s&&n.overdue++):l.status==="Not Started"&&(n.notStarted++,l.start_date<=i&&n.upcoming++)}),n}catch(t){throw t}}async getCertificates(e){try{const{data:t,error:n}=await j.from("milestone_certificates").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(n)throw n;return t||[]}catch(t){throw t}}async createCertificate(e){try{const{data:t,error:n}=await j.from("milestone_certificates").insert([e]).select().single();if(n)throw n;return t}catch(t){throw t}}async updateCertificate(e,t){try{const{data:n,error:s}=await j.from("milestone_certificates").update(t).eq("id",e).select().single();if(s)throw s;return n}catch(n){throw n}}}const au=new ou;class iu extends ze{constructor(){super("deliverables",{supportsSoftDelete:!0,sanitizeConfig:"deliverable"})}async getAllWithMilestones(e){return this.getAll(e,{select:"*, milestones(name, milestone_ref)",orderBy:{column:"due_date",ascending:!0}})}async getByMilestone(e){try{let t=j.from(this.tableName).select("*").eq("milestone_id",e).order("due_date",{ascending:!0});this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{data:n,error:s}=await t;if(s)throw s;return n||[]}catch(t){throw t}}async getByStatus(e,t){return this.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"due_date",ascending:!0}})}async getOverdue(e){try{const t=new Date().toISOString().split("T")[0];let n=j.from(this.tableName).select("*, milestones(name)").eq("project_id",e).lt("due_date",t).not("status","in",'("Delivered","Cancelled")').order("due_date",{ascending:!0});this.supportsSoftDelete&&(n=n.or(this.getSoftDeleteFilter()));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(t){throw t}}async getUpcoming(e,t=14){try{const n=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()+t);const a=s.toISOString().split("T")[0];let i=j.from(this.tableName).select("*, milestones(name)").eq("project_id",e).gte("due_date",n).lte("due_date",a).not("status","eq","Delivered").order("due_date",{ascending:!0});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter()));const{data:l,error:c}=await i;if(c)throw c;return l||[]}catch(n){throw n}}async updateStatus(e,t,n){const s={status:t};return t==="Submitted"?(s.submitted_date=new Date().toISOString(),s.submitted_by=n):t==="Delivered"&&(s.delivered_date=new Date().toISOString(),s.delivered_by=n),this.update(e,s)}async submit(e,t){return this.updateStatus(e,"Submitted",t)}async markDelivered(e,t){return this.updateStatus(e,"Delivered",t)}async reject(e,t){return this.update(e,{status:"Rejected",rejection_reason:t})}async getSummary(e){try{const t=await this.getAll(e),n=new Date().toISOString().split("T")[0],s={total:t.length,delivered:0,inProgress:0,notStarted:0,overdue:0,dueThisWeek:0},a=new Date;a.setDate(a.getDate()+7);const i=a.toISOString().split("T")[0];return t.forEach(l=>{l.status==="Delivered"?s.delivered++:l.status==="In Progress"?(s.inProgress++,l.due_date<n?s.overdue++:l.due_date<=i&&s.dueThisWeek++):(l.status==="Not Started"||l.status==="Draft")&&(s.notStarted++,l.due_date<n&&s.overdue++)}),s}catch(t){throw t}}async getAllWithRelations(e,t=!1){try{let n=this.supabase.from("deliverables").select(`
          *,
          milestone:milestones(milestone_ref, name),
          assigned_user:profiles!deliverables_assigned_to_fkey(full_name),
          creator:profiles!deliverables_created_by_fkey(full_name)
        `).eq("project_id",e).or("is_deleted.is.null,is_deleted.eq.false").order("deliverable_ref");t||(n=n.or("is_test_content.is.null,is_test_content.eq.false"));const{data:s,error:a}=await n;if(a)throw a;return s||[]}catch(n){throw n}}async syncKPILinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_kpis").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(i=>({deliverable_id:e,kpi_id:i})),{error:a}=await this.supabase.from("deliverable_kpis").insert(s);if(a)throw a}return!0}catch(n){throw n}}async syncQSLinks(e,t=[]){try{const{error:n}=await this.supabase.from("deliverable_quality_standards").delete().eq("deliverable_id",e);if(n)throw n;if(t.length>0){const s=t.map(i=>({deliverable_id:e,quality_standard_id:i})),{error:a}=await this.supabase.from("deliverable_quality_standards").insert(s);if(a)throw a}return!0}catch(n){throw n}}async upsertKPIAssessments(e,t,n){try{const s=t.map(i=>({deliverable_id:e,kpi_id:i.kpiId,criteria_met:i.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:a}=await this.supabase.from("deliverable_kpi_assessments").upsert(s,{onConflict:"deliverable_id,kpi_id"});if(a)throw a;return!0}catch(s){throw s}}async upsertQSAssessments(e,t,n){try{const s=t.map(i=>({deliverable_id:e,quality_standard_id:i.qsId,criteria_met:i.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:n})),{error:a}=await this.supabase.from("deliverable_qs_assessments").upsert(s,{onConflict:"deliverable_id,quality_standard_id"});if(a)throw a;return!0}catch(s){throw s}}}const lu=new iu;class cu extends ze{constructor(){super("kpis")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,rag_status:this.calculateRAG(n)}))}catch(t){throw t}}calculateRAG(e){if(!e.target_value||e.actual_value===null||e.actual_value===void 0)return"Unknown";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value),s=parseFloat(e.threshold_amber||10);return e.trend==="higher_better"?t>=n?"Green":t>=n*(1-s/100)?"Amber":"Red":t<=n?"Green":t<=n*(1+s/100)?"Amber":"Red"}async getByRAGStatus(e,t){try{return(await this.getAllWithStatus(e)).filter(s=>s.rag_status===t)}catch(n){throw n}}async getNeedingAttention(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.rag_status==="Amber"||n.rag_status==="Red")}catch(t){throw t}}async updateActualValue(e,t){return this.update(e,{actual_value:t,last_updated:new Date().toISOString()})}async getHistory(e,t=12){try{const{data:n,error:s}=await j.from("kpi_history").select("*").eq("kpi_id",e).order("recorded_at",{ascending:!1}).limit(t);if(s)throw s;return n||[]}catch{return[]}}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,green:t.filter(n=>n.rag_status==="Green").length,amber:t.filter(n=>n.rag_status==="Amber").length,red:t.filter(n=>n.rag_status==="Red").length,unknown:t.filter(n=>n.rag_status==="Unknown").length}}catch(t){throw t}}async getAssessments(e){try{const{data:t,error:n}=await j.from("deliverable_kpi_assessments").select("kpi_id, criteria_met").eq("project_id",e);if(n)throw n;return t||[]}catch(t){throw t}}}const uu=new cu;class du extends ze{constructor(){super("quality_standards")}async getAllWithStatus(e){try{return(await this.getAll(e,{orderBy:{column:"name",ascending:!0}})).map(n=>({...n,compliance_status:this.calculateCompliance(n)}))}catch(t){throw t}}calculateCompliance(e){if(e.actual_value===null||e.actual_value===void 0)return"Not Measured";const t=parseFloat(e.actual_value),n=parseFloat(e.target_value||0);return t>=n?"Compliant":t>=n*.9?"Near Compliant":"Non-Compliant"}async getNonCompliant(e){try{return(await this.getAllWithStatus(e)).filter(n=>n.compliance_status==="Non-Compliant")}catch(t){throw t}}async updateMeasurement(e,t,n){return this.update(e,{actual_value:t,measurement_notes:n,last_measured:new Date().toISOString()})}async getSummary(e){try{const t=await this.getAllWithStatus(e);return{total:t.length,compliant:t.filter(n=>n.compliance_status==="Compliant").length,nearCompliant:t.filter(n=>n.compliance_status==="Near Compliant").length,nonCompliant:t.filter(n=>n.compliance_status==="Non-Compliant").length,notMeasured:t.filter(n=>n.compliance_status==="Not Measured").length}}catch(t){throw t}}}const fu=new du;class hu extends ze{constructor(){super("standards",{supportsSoftDelete:!1,sanitizeConfig:"standard"})}async getAll(e){return super.getAll(e,{orderBy:{column:"standard_ref",ascending:!0}})}async getByStatus(e,t){return super.getAll(e,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getByCategory(e,t){return super.getAll(e,{filters:[{column:"category",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getSummary(e){try{const t=await this.getAll(e);return{total:t.length,completed:t.filter(n=>n.status==="Completed").length,inProgress:t.filter(n=>n.status==="In Progress").length,notStarted:t.filter(n=>!n.status||n.status==="Not Started").length}}catch(t){throw t}}}new hu;const pu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},mu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!0,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!0,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:4,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:6,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:8,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:12,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:12,w:6,h:3,minW:4,minH:3,maxH:5}}},gu={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!0,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:6,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!0,x:0,y:10,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!0,x:6,y:10,w:6,h:3,minW:4,minH:3,maxH:5}}},qs={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!1,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:4,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:8,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:8,w:6,h:3,minW:4,minH:3,maxH:5}}},ur={...qs},Ws={"progress-hero":{id:"progress-hero",title:"Project Progress",description:"Overall project completion percentage",icon:"target",category:"overview"},"budget-summary":{id:"budget-summary",title:"Budget Overview",description:"Total budget and spend to date",icon:"dollar-sign",category:"financial"},"pmo-tracking":{id:"pmo-tracking",title:"PMO Cost Tracking",description:"PMO vs Non-PMO budget breakdown",icon:"briefcase",category:"financial"},"stats-grid":{id:"stats-grid",title:"Key Statistics",description:"Milestones, deliverables, resources, KPIs, and quality standards counts",icon:"bar-chart",category:"overview"},certificates:{id:"certificates",title:"Milestone Certificates",description:"Certificate signing status summary",icon:"file-check",category:"compliance"},"milestones-list":{id:"milestones-list",title:"Milestones",description:"Milestone status, progress, and spend by milestone",icon:"clock",category:"delivery"},"kpis-category":{id:"kpis-category",title:"KPIs by Category",description:"KPI performance grouped by category",icon:"trending-up",category:"performance"},"quality-standards":{id:"quality-standards",title:"Quality Standards",description:"Quality standard achievement summary",icon:"award",category:"compliance"}};function bt(r){if(!r)return ur;const e=r.toUpperCase();return e.includes("ADMIN")?pu:e.includes("SUPPLIER")&&e.includes("PM")?mu:e.includes("CUSTOMER")&&e.includes("PM")?gu:e.includes("CONTRIBUTOR")?qs:(e.includes("VIEWER"),ur)}const dr=bt;function yu(r){return Object.keys(Ws)}class bu{constructor(){this.tableName="dashboard_layouts"}async getLayout(e,t,n){try{const{data:s,error:a}=await j.from(this.tableName).select("layout_config").eq("user_id",e).eq("project_id",t).maybeSingle();if(a)throw a;return s?.layout_config?s.layout_config:dr(n)}catch{return dr(n)}}async saveLayout(e,t,n){try{const{data:s,error:a}=await j.from(this.tableName).upsert({user_id:e,project_id:t,layout_config:n,updated_at:new Date().toISOString()},{onConflict:"user_id,project_id"}).select().single();if(a)throw a;return s}catch(s){throw s}}async deleteLayout(e,t){try{const{error:n}=await j.from(this.tableName).delete().eq("user_id",e).eq("project_id",t);if(n)throw n}catch(n){throw n}}async resetToDefault(e,t,n){try{return await this.deleteLayout(e,t),dr(n)}catch(s){throw s}}}const fr=new bu;function vu(r,e,t){const[n,s]=d.useState(null),[a,i]=d.useState(!0),[l,c]=d.useState(!1),[u,p]=d.useState(null),g=d.useCallback(async()=>{if(!r||!e){i(!1);return}try{i(!0);const h=await fr.getLayout(r,e);if(h)s(h);else{const b=bt(t);s(b)}}catch{const b=bt(t);s(b)}finally{i(!1)}},[r,e,t]),y=d.useCallback(async h=>{if(!(!r||!e||!h))try{c(!0),await fr.saveLayout(r,e,h),s(h),p(new Date)}catch(b){throw b}finally{c(!1)}},[r,e]),S=d.useCallback((h,b)=>{s(_=>_&&{..._,widgets:{..._.widgets,[h]:{..._.widgets[h],visible:b}}})},[]),k=d.useCallback(async h=>{const b={...n,widgets:{...n.widgets,...Object.entries(h).reduce((_,[x,R])=>(_[x]={...n.widgets[x],visible:R},_),{})}};await y(b)},[n,y]),P=d.useCallback(h=>{if(!n)return;const b={...n.widgets};h.forEach(x=>{b[x.i]&&(b[x.i]={...b[x.i],x:x.x,y:x.y,w:x.w,h:x.h})});const _={...n,widgets:b};s(_)},[n]),C=d.useCallback(async h=>{if(!n)return;const b={...n.widgets};h.forEach(x=>{b[x.i]&&(b[x.i]={...b[x.i],x:x.x,y:x.y,w:x.w,h:x.h})});const _={...n,widgets:b};await y(_)},[n,y]),w=d.useCallback(async()=>{if(!(!r||!e))try{c(!0),await fr.deleteLayout(r,e);const h=bt(t);s(h),p(new Date)}catch(h){throw h}finally{c(!1)}},[r,e,t]),D=d.useCallback(h=>!n||!n.widgets?!0:n.widgets[h]?.visible!==!1,[n]),v=d.useCallback(()=>!n||!n.widgets?[]:Object.entries(n.widgets).filter(([h,b])=>b.visible!==!1).map(([h,b])=>({i:h,x:b.x||0,y:b.y||0,w:b.w||12,h:b.h||2,minW:b.minW,minH:b.minH,maxH:b.maxH})),[n]),m=d.useCallback(h=>!n||!n.widgets?null:n.widgets[h],[n]);return d.useEffect(()=>{g()},[g]),{layout:n,loading:a,saving:l,lastSaved:u,updateVisibility:S,bulkUpdateVisibility:k,updateLayoutPositions:P,saveLayoutPositions:C,resetToDefault:w,isWidgetVisible:D,getGridLayout:v,getWidgetConfig:m}}function xu({isOpen:r,onClose:e,layout:t,role:n,onUpdateVisibility:s,onReset:a,saving:i,lastSaved:l}){const[c,u]=d.useState({}),[p,g]=d.useState(!1),y=yu(),S=m=>c.hasOwnProperty(m)?c[m]:t?.widgets?.[m]?.visible!==!1,k=m=>{u(h=>({...h,[m]:!S(m)}))},P=async()=>{if(Object.keys(c).length===0){e();return}try{await s(c),u({}),e()}catch{}},C=()=>{u({}),e()},w=async()=>{try{await a(),u({}),g(!1)}catch{}};if(!r)return null;const D=y.filter(m=>S(m)).length,v=Object.keys(c).length>0;return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"dashboard-customize-backdrop",onClick:C,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,opacity:r?1:0,transition:"opacity 0.3s ease"}}),o.jsxs("div",{className:"dashboard-customize-panel",style:{position:"fixed",top:0,right:r?0:"-400px",bottom:0,width:"400px",maxWidth:"90vw",backgroundColor:"white",boxShadow:"-4px 0 20px rgba(0, 0, 0, 0.15)",zIndex:1e3,display:"flex",flexDirection:"column",transition:"right 0.3s ease"},children:[o.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:"600"},children:"Customize Dashboard"}),o.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.875rem",color:"#64748b"},children:[D," of ",y.length," widgets visible"]})]}),o.jsx("button",{onClick:C,style:{background:"none",border:"none",cursor:"pointer",padding:"0.5rem",color:"#64748b",borderRadius:"4px"},onMouseEnter:m=>m.target.style.backgroundColor="#f1f5f9",onMouseLeave:m=>m.target.style.backgroundColor="transparent",children:o.jsx(Ue,{size:20})})]}),o.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:o.jsxs("div",{style:{marginBottom:"1rem"},children:[o.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:"0.75rem"},children:"Available Widgets"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:y.map(m=>{const h=Ws[m],b=S(m),_=c.hasOwnProperty(m);return o.jsx("div",{onClick:()=>k(m),style:{padding:"1rem",border:"1px solid #e2e8f0",borderRadius:"8px",cursor:"pointer",backgroundColor:b?"#f0f9ff":"white",borderColor:b?"#3b82f6":"#e2e8f0",transition:"all 0.2s ease",position:"relative"},onMouseEnter:x=>{b||(x.target.style.backgroundColor="#f8fafc")},onMouseLeave:x=>{b||(x.target.style.backgroundColor="white")},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[o.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:b?"#3b82f6":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",color:b?"white":"#64748b",flexShrink:0},children:b?o.jsx(zo,{size:20}):o.jsx(No,{size:20})}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:"500",fontSize:"0.9375rem",marginBottom:"0.125rem",color:b?"#1e293b":"#64748b"},children:h.title}),o.jsx("div",{style:{fontSize:"0.8125rem",color:"#64748b"},children:h.description})]}),_&&o.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b"}})]})},m)})})]})}),o.jsxs("div",{style:{padding:"1rem 1.5rem",borderTop:"1px solid #e2e8f0",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[l&&!v&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8125rem",color:"#10b981"},children:[o.jsx(Mr,{size:16}),"Saved ",new Date(l).toLocaleTimeString()]}),o.jsx("div",{style:{display:"flex",gap:"0.75rem"},children:p?o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>g(!1),style:{flex:1,padding:"0.625rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",cursor:"pointer"},children:"Cancel"}),o.jsx("button",{onClick:w,disabled:i,style:{flex:1,padding:"0.625rem",border:"none",borderRadius:"6px",backgroundColor:"#ef4444",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:i?"not-allowed":"pointer",opacity:i?.6:1},children:i?"Resetting...":"Confirm Reset"})]}):o.jsxs("button",{onClick:()=>g(!0),style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},onMouseEnter:m=>{m.target.style.backgroundColor="#f8fafc",m.target.style.borderColor="#cbd5e1"},onMouseLeave:m=>{m.target.style.backgroundColor="white",m.target.style.borderColor="#e2e8f0"},children:[o.jsx(An,{size:16}),"Reset to Default"]})}),o.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[o.jsx("button",{onClick:C,style:{flex:1,padding:"0.625rem 1rem",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"white",color:"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},onMouseEnter:m=>{m.target.style.backgroundColor="#f8fafc"},onMouseLeave:m=>{m.target.style.backgroundColor="white"},children:"Cancel"}),o.jsx("button",{onClick:P,disabled:i||!v,style:{flex:1,padding:"0.625rem 1rem",border:"none",borderRadius:"6px",backgroundColor:v?"#3b82f6":"#94a3b8",color:"white",fontSize:"0.875rem",fontWeight:"500",cursor:i||!v?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:i?"Saving...":o.jsxs(o.Fragment,{children:[o.jsx(To,{size:16}),"Apply Changes"]})})]})]})]})]})}const wu=Cn.WidthProvider(Cn.Responsive);function Dn(r){if(!r)return!1;const e=r.toLowerCase();return e.includes("pmo")||e.includes("project manager")}function _u(){const{showTestUsers:r,testUserIds:e}=xa(),{projectId:t,projectName:n,projectRef:s}=Fn(),{user:a,role:i}=Mt(),{layout:l,loading:c,saving:u,lastSaved:p,bulkUpdateVisibility:g,saveLayoutPositions:y,resetToDefault:S,getGridLayout:k}=vu(a?.id,t,i),[P,C]=d.useState(!1),[w,D]=d.useState(!0),[v,m]=d.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[h,b]=d.useState({signed:0,pending:0,awaitingGeneration:0}),[_,x]=d.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0,pmoResources:[],nonPmoResources:[]}),[R,z]=d.useState([]),[A,N]=d.useState({}),[Z,he]=d.useState({}),[Ee,O]=d.useState([]),[K,ye]=d.useState(0),de=d.useRef(null),re=d.useCallback(async()=>{if(t){D(!0);try{const Y=await au.getAll(t,{orderBy:{column:"milestone_ref",ascending:!0}});z(Y);const q=await lu.getSummary(t),ae=await uu.getAll(t,{orderBy:{column:"kpi_ref",ascending:!0}}),E=await fu.getAll(t,{orderBy:{column:"qs_ref",ascending:!0}});O(E);const{data:I}=await j.from("resources").select("*"),L=await ru.getAllFiltered(t,r);let H=0,V=0;const se=[],ue=[];I&&I.forEach(U=>{const Se=(U.daily_rate||0)*(U.days_allocated||0);Dn(U.role)?(H+=Se,se.push({name:U.name,role:U.role,budget:Se})):(V+=Se,ue.push({name:U.name,role:U.role,budget:Se}))});const pe={};let oe=0,_e=0,J=0;L&&I&&L.forEach(U=>{if(!(U.status==="Approved"||U.status==="Submitted"&&!U.was_rejected))return;const Qs=parseFloat(U.hours_worked||U.hours||0),Kt=U.resources||I.find(Ye=>Ye.id===U.resource_id);if(Kt){const Ye=Qs/8*(Kt.daily_rate||0);U.milestone_id&&(pe[U.milestone_id]=(pe[U.milestone_id]||0)+Ye),oe+=Ye,Dn(Kt.role)?_e+=Ye:J+=Ye}}),N(pe),x({pmoBudget:H,pmoSpend:_e,nonPmoBudget:V,nonPmoSpend:J,pmoResources:se,nonPmoResources:ue});const ee={};ae.forEach(U=>{const Se=U.category||"Other";ee[Se]||(ee[Se]=[]),ee[Se].push(U)}),he(ee);const xe=Y.length,tt=Y.filter(U=>U.status==="Completed").length,dt=q.total,Re=q.delivered,Bs=I?.length||0,$s=ae.length,Hs=ae.filter(U=>(U.current_value||0)>=(U.target||90)).length,Us=E.length,Fs=E.filter(U=>(U.current_value||0)>=(U.target||100)).length,{data:Yt}=await j.from("milestone_certificates").select("*").eq("project_id",t),Gs=Yt?.filter(U=>U.status==="Signed").length||0,Vs=Yt?.filter(U=>U.status==="Pending Customer Signature"||U.status==="Pending Supplier Signature").length||0,Ys=Math.max(0,tt-(Yt?.length||0));b({signed:Gs,pending:Vs,awaitingGeneration:Ys});const Ks=Y.reduce((U,Se)=>U+(Se.budget||0),0),Xs=xe>0?Math.round(Y.reduce((U,Se)=>U+(Se.progress||0),0)/xe):0;ye(Xs),m({totalMilestones:xe,completedMilestones:tt,totalDeliverables:dt,deliveredCount:Re,totalResources:Bs,totalKPIs:$s,achievedKPIs:Hs,totalQS:Us,achievedQS:Fs,totalBudget:Ks,spendToDate:oe})}catch{}finally{D(!1)}}},[t,r]);d.useEffect(()=>{re()},[re]);function ne(Y){switch(Y){case"Time Performance":return"#3b82f6";case"Quality of Collaboration":return"#8b5cf6";case"Delivery Performance":return"#10b981";default:return"#64748b"}}const $=d.useCallback(Y=>{de.current&&clearTimeout(de.current),de.current=setTimeout(()=>{y(Y)},1e3)},[y]),M=Y=>{switch(Y){case"progress-hero":return o.jsx("div",{className:"card",style:{height:"100%",background:"linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%)",color:"white",display:"flex",alignItems:"center"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[o.jsxs("div",{children:[o.jsxs("h2",{style:{fontSize:"2.5rem",fontWeight:"700",margin:0},children:[K,"%"]}),o.jsx("p",{style:{opacity:.9,margin:0},children:"Overall Progress"})]}),o.jsx("div",{style:{width:"120px",height:"120px",position:"relative"},children:o.jsxs("svg",{viewBox:"0 0 100 100",style:{transform:"rotate(-90deg)"},children:[o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"10"}),o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"white",strokeWidth:"10",strokeDasharray:`${K*2.51} 251`,strokeLinecap:"round"})]})})]})});case"budget-summary":return o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",height:"100%"},children:[o.jsx("div",{className:"card",style:{borderLeft:"4px solid #3b82f6",height:"100%"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Total Budget"}),o.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#3b82f6"},children:["Â£",v.totalBudget.toLocaleString()]})]}),o.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px"},children:o.jsx(qo,{size:24,style:{color:"#3b82f6"}})})]})}),o.jsx("div",{className:"card",style:{borderLeft:"4px solid #10b981",height:"100%"},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.25rem"},children:"Spend to Date"}),o.jsxs("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#10b981"},children:["Â£",Math.round(v.spendToDate).toLocaleString()]}),o.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b"},children:[v.totalBudget>0?Math.round(v.spendToDate/v.totalBudget*100):0,"% of budget"]})]}),o.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px"},children:o.jsx(yt,{size:24,style:{color:"#10b981"}})})]})})]});case"pmo-tracking":return o.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[o.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(Lo,{size:20})," PMO Cost Tracking"]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.75rem",marginBottom:"1rem"},children:[o.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"8px",borderLeft:"4px solid #f59e0b"},children:[o.jsx("div",{style:{fontSize:"0.75rem",color:"#92400e",marginBottom:"0.25rem"},children:"PMO Budget"}),o.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#d97706"},children:["Â£",Math.round(_.pmoBudget/1e3),"k"]})]}),o.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#ffedd5",borderRadius:"8px",borderLeft:"4px solid #ea580c"},children:[o.jsx("div",{style:{fontSize:"0.75rem",color:"#9a3412",marginBottom:"0.25rem"},children:"PMO Spend"}),o.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#ea580c"},children:["Â£",Math.round(_.pmoSpend/1e3),"k"]})]}),o.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dbeafe",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[o.jsx("div",{style:{fontSize:"0.75rem",color:"#1e40af",marginBottom:"0.25rem"},children:"Non-PMO Budget"}),o.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#2563eb"},children:["Â£",Math.round(_.nonPmoBudget/1e3),"k"]})]}),o.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#dcfce7",borderRadius:"8px",borderLeft:"4px solid #16a34a"},children:[o.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Non-PMO Spend"}),o.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#16a34a"},children:["Â£",Math.round(_.nonPmoSpend/1e3),"k"]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[o.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"500"},children:"Spend Distribution"}),o.jsxs("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:["PMO: ",v.spendToDate>0?Math.round(_.pmoSpend/v.spendToDate*100):0,"% | Non-PMO: ",v.spendToDate>0?Math.round(_.nonPmoSpend/v.spendToDate*100):0,"%"]})]}),o.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#e2e8f0"},children:[o.jsx("div",{style:{width:`${v.spendToDate>0?_.pmoSpend/v.spendToDate*100:0}%`,backgroundColor:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:_.pmoSpend>0?"40px":"0"},children:_.pmoSpend>0&&"PMO"}),o.jsx("div",{style:{width:`${v.spendToDate>0?_.nonPmoSpend/v.spendToDate*100:0}%`,backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.75rem",fontWeight:"600",minWidth:_.nonPmoSpend>0?"60px":"0"},children:_.nonPmoSpend>0&&"Non-PMO"})]})]})]});case"stats-grid":return o.jsxs("div",{style:{height:"100%",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[o.jsx(ft,{icon:it,label:"Milestones",value:`${v.completedMilestones} / ${v.totalMilestones}`,subtext:`${v.totalMilestones>0?Math.round(v.completedMilestones/v.totalMilestones*100):0}% Complete`,color:"#3b82f6"}),o.jsx(ft,{icon:pr,label:"Deliverables",value:`${v.deliveredCount} / ${v.totalDeliverables}`,subtext:`${v.totalDeliverables>0?Math.round(v.deliveredCount/v.totalDeliverables*100):0}% Delivered`,color:"#10b981"}),o.jsx(ft,{icon:yt,label:"KPIs",value:`${v.achievedKPIs} / ${v.totalKPIs}`,subtext:`${v.totalKPIs>0?Math.round(v.achievedKPIs/v.totalKPIs*100):0}% Achieved`,color:"#3b82f6"}),o.jsx(ft,{icon:xt,label:"Quality Standards",value:`${v.achievedQS} / ${v.totalQS}`,subtext:`${v.totalQS>0?Math.round(v.achievedQS/v.totalQS*100):0}% Achieved`,color:"#8b5cf6"})]});case"certificates":return o.jsx("div",{className:"card",style:{height:"100%",backgroundColor:"#fefce8",borderLeft:"4px solid #eab308"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"1rem"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[o.jsx(Ao,{size:28,style:{color:"#ca8a04"}}),o.jsx("div",{children:o.jsx("h4",{style:{margin:0,color:"#854d0e"},children:"Milestone Certificates"})})]}),o.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#16a34a"},children:h.signed}),o.jsx("div",{style:{fontSize:"0.8rem",color:"#166534"},children:"Signed"})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#d97706"},children:h.pending}),o.jsx("div",{style:{fontSize:"0.8rem",color:"#92400e"},children:"Pending"})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:h.awaitingGeneration>0?"#dc2626":"#64748b"},children:h.awaitingGeneration}),o.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"Awaiting"})]})]}),o.jsx(Le,{to:"/milestones",style:{padding:"0.5rem 1rem",backgroundColor:"#ca8a04",color:"white",textDecoration:"none",borderRadius:"6px",fontWeight:"500"},children:"View â†’"})]})});case"milestones-list":return o.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[o.jsx("h3",{style:{marginBottom:"0.5rem"},children:"Billable vs Spend by Milestone"}),o.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"1rem"},children:[o.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem",marginRight:"1rem"},children:[o.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#3b82f6",borderRadius:"2px"}}),"Billable"]}),o.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.85rem"},children:[o.jsx("span",{style:{width:"12px",height:"12px",backgroundColor:"#10b981",borderRadius:"2px"}}),"Spend"]})]}),o.jsx("div",{style:{display:"flex",gap:"0.5rem",height:"calc(100% - 80px)",alignItems:"flex-end"},children:R.map(q=>{const ae=Math.max(...R.map(H=>H.budget||0)),E=A[q.id]||0,I=ae>0?(q.budget||0)/ae*100:0,L=ae>0?E/ae*100:0;return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[o.jsxs("div",{style:{display:"flex",gap:"2px",alignItems:"flex-end",height:"100%",width:"100%",justifyContent:"center"},children:[o.jsx("div",{style:{width:"45%",height:`${I}%`,backgroundColor:"#3b82f6",borderRadius:"4px 4px 0 0",minHeight:q.budget>0?"20px":"0",position:"relative"},title:`Billable: Â£${(q.budget||0).toLocaleString()}`,children:I>15&&o.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["Â£",Math.round((q.budget||0)/1e3),"k"]})}),o.jsx("div",{style:{width:"45%",height:`${L}%`,backgroundColor:"#10b981",borderRadius:"4px 4px 0 0",minHeight:E>0?"20px":"0",position:"relative"},title:`Spend: Â£${Math.round(E).toLocaleString()}`,children:L>15&&o.jsxs("span",{style:{position:"absolute",top:"4px",left:"50%",transform:"translateX(-50%)",fontSize:"0.65rem",fontWeight:"600",color:"white"},children:["Â£",Math.round(E/1e3),"k"]})})]}),o.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"600",color:"#64748b"},children:q.milestone_ref})]},q.id)})})]});case"kpis-category":return o.jsxs("div",{className:"card",style:{height:"100%"},children:[o.jsx("h3",{style:{marginBottom:"1rem"},children:"KPI Performance"}),o.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end",height:"calc(100% - 50px)"},children:Object.entries(Z).map(([q,ae])=>{const E=ae.length,I=ae.filter(H=>(H.current_value||0)>=(H.target||90)).length,L=E>0?I/E*100:0;return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.5rem",height:"100%"},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[o.jsx("div",{style:{height:`${100-L}%`,backgroundColor:"#e2e8f0",borderRadius:L>0?"4px 4px 0 0":"4px"}}),o.jsxs("div",{style:{height:`${L}%`,backgroundColor:ne(q),borderRadius:L<100?"0 0 4px 4px":"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"700"},children:[I,"/",E]})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontWeight:"600",fontSize:"0.75rem"},children:q.split(" ")[0]}),o.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[Math.round(L),"%"]})]})]},q)})})]});case"quality-standards":return o.jsxs("div",{className:"card",style:{height:"100%",overflowY:"auto"},children:[o.jsx("h3",{style:{marginBottom:"1rem"},children:"Quality Standards"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Ee.map(q=>{const ae=q.current_value||0,E=ae>=(q.target||100);return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[o.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600",minWidth:"45px",color:"#8b5cf6"},children:q.qs_ref}),o.jsx("div",{style:{flex:1},children:o.jsx("div",{style:{height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:o.jsx("div",{style:{width:`${ae}%`,height:"100%",backgroundColor:E?"#10b981":"#8b5cf6"}})})}),o.jsxs("span",{style:{fontSize:"0.85rem",fontWeight:"600",minWidth:"45px",color:E?"#10b981":"#64748b"},children:[ae,"%"]})]},q.id)})})]});default:return null}};if(w||c)return o.jsx(Or,{message:"Loading dashboard...",size:"large",fullPage:!0});const Q=k();return o.jsxs("div",{className:"page-container",children:[o.jsx(Oa,{icon:nn,title:`${s||"Project"} Dashboard`,subtitle:n||"Project Tracker",children:o.jsxs("button",{onClick:()=>C(!0),className:"btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1rem"},children:[o.jsx(Tn,{size:18}),"Customize"]})}),o.jsx(wu,{className:"layout",layouts:{lg:Q},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,onLayoutChange:$,draggableHandle:".drag-handle",margin:[16,16],containerPadding:[0,0],children:Q.map(Y=>o.jsxs("div",{style:{position:"relative"},children:[o.jsx("div",{className:"drag-handle",style:{position:"absolute",top:"8px",right:"8px",width:"24px",height:"24px",cursor:"move",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},title:"Drag to move",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[o.jsx("circle",{cx:"4",cy:"4",r:"1.5",fill:"#64748b"}),o.jsx("circle",{cx:"12",cy:"4",r:"1.5",fill:"#64748b"}),o.jsx("circle",{cx:"4",cy:"8",r:"1.5",fill:"#64748b"}),o.jsx("circle",{cx:"12",cy:"8",r:"1.5",fill:"#64748b"}),o.jsx("circle",{cx:"4",cy:"12",r:"1.5",fill:"#64748b"}),o.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"#64748b"})]})}),M(Y.i)]},Y.i))}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"1rem",marginTop:"2rem"},children:[o.jsxs(Le,{to:"/milestones",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[o.jsx(it,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),o.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Milestones"})]}),o.jsxs(Le,{to:"/deliverables",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[o.jsx(pr,{size:32,style:{color:"#10b981",marginBottom:"0.5rem"}}),o.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Deliverables"})]}),o.jsxs(Le,{to:"/kpis",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[o.jsx(yt,{size:32,style:{color:"#3b82f6",marginBottom:"0.5rem"}}),o.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"KPIs"})]}),o.jsxs(Le,{to:"/quality-standards",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[o.jsx(xt,{size:32,style:{color:"#8b5cf6",marginBottom:"0.5rem"}}),o.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Quality"})]}),o.jsxs(Le,{to:"/reports",className:"card",style:{textDecoration:"none",padding:"1.5rem",cursor:"pointer",border:"2px solid #e2e8f0"},children:[o.jsx(nn,{size:32,style:{color:"#f59e0b",marginBottom:"0.5rem"}}),o.jsx("h4",{style:{margin:"0 0 0.25rem 0",color:"#1e293b"},children:"Reports"})]})]}),o.jsx(xu,{isOpen:P,onClose:()=>C(!1),layout:l,role:i,onUpdateVisibility:g,onReset:S,saving:u,lastSaved:p})]})}const Su=d.lazy(()=>le(()=>import("./ResetPassword-y8uwQIoS.js"),__vite__mapDeps([0,1,2,3,4]))),ju=d.lazy(()=>le(()=>import("./Milestones-DOkAtZZe.js"),__vite__mapDeps([5,1,6,7,2,3,4]))),Pu=d.lazy(()=>le(()=>import("./MilestoneDetail-BW4yldQL.js"),__vite__mapDeps([8,1,2,3,4]))),Ru=d.lazy(()=>le(()=>import("./Gantt-CXSkyZYG.js"),__vite__mapDeps([9,1,6,2,3,4]))),Cu=d.lazy(()=>le(()=>import("./Deliverables-DuI1Wfis.js"),__vite__mapDeps([10,1,6,2,3,4]))),Eu=d.lazy(()=>le(()=>import("./Resources-DyWTfE1a.js"),__vite__mapDeps([11,1,6,7,2,3,4]))),Du=d.lazy(()=>le(()=>import("./ResourceDetail-CPmnSsmq.js"),__vite__mapDeps([12,1,6,2,3,4]))),Mu=d.lazy(()=>le(()=>import("./Partners-MbX4gSma.js"),__vite__mapDeps([13,1,6,7,2,3,4]))),ku=d.lazy(()=>le(()=>import("./PartnerDetail-Dx2ab1NI.js"),__vite__mapDeps([14,1,6,2,3,4]))),Ou=d.lazy(()=>le(()=>import("./Timesheets-DRUqyBKd.js"),__vite__mapDeps([15,1,6,7,2,3,4]))),Iu=d.lazy(()=>le(()=>import("./Expenses-DY8zI816.js"),__vite__mapDeps([16,1,6,7,2,3,4,17]))),zu=d.lazy(()=>le(()=>import("./KPIs-B4hcfLXk.js"),__vite__mapDeps([18,1,6,7,2,3,4]))),Nu=d.lazy(()=>le(()=>import("./KPIDetail-DCfXaouU.js"),__vite__mapDeps([19,1,6,2,3,4]))),Tu=d.lazy(()=>le(()=>import("./QualityStandards-C6RpVw_T.js"),__vite__mapDeps([20,1,6,7,2,3,4]))),Au=d.lazy(()=>le(()=>import("./QualityStandardDetail-DeeNNxJo.js"),__vite__mapDeps([21,1,2,3,4]))),Lu=d.lazy(()=>le(()=>import("./Reports-CzbpdvB7.js"),__vite__mapDeps([22,2,1,3,4]))),qu=d.lazy(()=>le(()=>import("./Users-BS2f_Gm7.js"),__vite__mapDeps([23,1,2,3,4]))),Wu=d.lazy(()=>le(()=>import("./Settings-DMC8pKjW.js"),__vite__mapDeps([24,1,6,2,3,4]))),Bu=d.lazy(()=>le(()=>import("./AccountSettings-Bgagd5S9.js"),__vite__mapDeps([25,1,2,3,4]))),$u=d.lazy(()=>le(()=>import("./WorkflowSummary-D4djoVTh.js"),__vite__mapDeps([26,1,2,3,4]))),Hu=d.lazy(()=>le(()=>import("./AuditLog-crVDeJkc.js"),__vite__mapDeps([27,1,2,3,4]))),Uu=d.lazy(()=>le(()=>import("./DeletedItems-Df3Z6e3F.js"),__vite__mapDeps([28,1,7,2,3,4])));function Fu(){return o.jsx("div",{className:"page-container",children:o.jsx(st,{type:"page"})})}function ie({children:r}){const{user:e,isLoading:t}=Mt();return t?o.jsx(Or,{message:"Loading...",size:"large",fullPage:!0}):e?o.jsx(xi,{children:o.jsx(d.Suspense,{fallback:o.jsx(Fu,{}),children:r||o.jsx(ao,{})})}):o.jsx(hr,{to:"/login",replace:!0})}function Gu(){return o.jsx(so,{children:o.jsx(Ea,{children:o.jsx(Ta,{children:o.jsx(ya,{children:o.jsx(ba,{children:o.jsx(va,{children:o.jsx(_a,{children:o.jsxs(Ra,{children:[o.jsxs(oo,{children:[o.jsx(te,{path:"/login",element:o.jsx(wi,{})}),o.jsx(te,{path:"/reset-password",element:o.jsx(d.Suspense,{fallback:o.jsx(Or,{fullPage:!0}),children:o.jsx(Su,{})})}),o.jsx(te,{path:"/",element:o.jsx(hr,{to:"/dashboard",replace:!0})}),o.jsx(te,{path:"/dashboard",element:o.jsx(ie,{children:o.jsx(_u,{})})}),o.jsx(te,{path:"/milestones",element:o.jsx(ie,{children:o.jsx(ju,{})})}),o.jsx(te,{path:"/milestones/:id",element:o.jsx(ie,{children:o.jsx(Pu,{})})}),o.jsx(te,{path:"/gantt",element:o.jsx(ie,{children:o.jsx(Ru,{})})}),o.jsx(te,{path:"/deliverables",element:o.jsx(ie,{children:o.jsx(Cu,{})})}),o.jsx(te,{path:"/resources",element:o.jsx(ie,{children:o.jsx(Eu,{})})}),o.jsx(te,{path:"/resources/:id",element:o.jsx(ie,{children:o.jsx(Du,{})})}),o.jsx(te,{path:"/partners",element:o.jsx(ie,{children:o.jsx(Mu,{})})}),o.jsx(te,{path:"/partners/:id",element:o.jsx(ie,{children:o.jsx(ku,{})})}),o.jsx(te,{path:"/timesheets",element:o.jsx(ie,{children:o.jsx(Ou,{})})}),o.jsx(te,{path:"/expenses",element:o.jsx(ie,{children:o.jsx(Iu,{})})}),o.jsx(te,{path:"/kpis",element:o.jsx(ie,{children:o.jsx(zu,{})})}),o.jsx(te,{path:"/kpis/:id",element:o.jsx(ie,{children:o.jsx(Nu,{})})}),o.jsx(te,{path:"/quality-standards",element:o.jsx(ie,{children:o.jsx(Tu,{})})}),o.jsx(te,{path:"/quality-standards/:id",element:o.jsx(ie,{children:o.jsx(Au,{})})}),o.jsx(te,{path:"/reports",element:o.jsx(ie,{children:o.jsx(Lu,{})})}),o.jsx(te,{path:"/users",element:o.jsx(ie,{children:o.jsx(qu,{})})}),o.jsx(te,{path:"/settings",element:o.jsx(ie,{children:o.jsx(Wu,{})})}),o.jsx(te,{path:"/account",element:o.jsx(ie,{children:o.jsx(Bu,{})})}),o.jsx(te,{path:"/workflow-summary",element:o.jsx(ie,{children:o.jsx($u,{})})}),o.jsx(te,{path:"/audit-log",element:o.jsx(ie,{children:o.jsx(Hu,{})})}),o.jsx(te,{path:"/deleted-items",element:o.jsx(ie,{children:o.jsx(Uu,{})})}),o.jsx(te,{path:"*",element:o.jsx(hr,{to:"/dashboard",replace:!0})})]}),o.jsx(La,{}),o.jsx(na,{}),o.jsx(fa,{})]})})})})})})})})}mr.createRoot(document.getElementById("root")).render(o.jsx(Mn.StrictMode,{children:o.jsx(Gu,{})}));export{Xa as $,ri as A,vd as B,bd as C,yd as D,It as E,ti as F,Jn as G,gd as H,ei as I,md as J,pd as K,Or as L,Ir as M,hd as N,fd as O,Oa as P,dd as Q,Ot as R,ft as S,ud as T,cd as U,ld as V,kt as W,id as X,Ja as Y,od as Z,Qa as _,Fn as a,Ka as a0,Va as a1,Ga as a2,Fa as a3,Ua as a4,Ha as a5,$a as a6,Ba as a7,Qn as a8,Xn as a9,F as aa,Cd as ab,f as ac,fi as ad,di as ae,Ed as af,Rd as ag,ui as ah,Pd as ai,ci as aj,ad as ak,sd as al,nd as am,rd as an,td as ao,ed as ap,Zu as aq,oi as ar,Za as as,Ya as at,Aa as b,xa as c,lu as d,Id as e,Ju as f,jd as g,Sd as h,zd as i,o as j,uu as k,li as l,au as m,ii as n,ai as o,kd as p,fu as q,Od as r,j as s,ru as t,Mt as u,_d as v,wd as w,si as x,xd as y,ni as z};
