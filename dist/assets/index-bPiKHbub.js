const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResetPassword-BohINNVE.js","assets/vendor-react-JFEV0ROX.js","assets/vendor-icons-CMdlt-Xc.js","assets/vendor-supabase-DgEUAXvv.js","assets/Milestones-DixJhz6P.js","assets/usePermissions-BUO-hVwM.js","assets/StatCard-Bgsld_cB.js","assets/PageHeader-BQvbuzw8.js","assets/ConfirmDialog-C1noKWmG.js","assets/MilestoneDetail-8diP__Kg.js","assets/Gantt-BbCEkQCo.js","assets/Deliverables-Bgd3bsw7.js","assets/Resources-Di8ymjYb.js","assets/ResourceDetail-CUkw1EdP.js","assets/Partners-oy3_e5gG.js","assets/PartnerDetail-CWsnIfZ-.js","assets/Timesheets-BUi2SNbd.js","assets/Expenses-BrVdOyMH.js","assets/Expenses-OWLTi329.css","assets/KPIs-D1uNKb3Y.js","assets/KPIDetail-Du1vU6mO.js","assets/QualityStandards-CTR9D-nf.js","assets/QualityStandardDetail-DgWZYysJ.js","assets/Reports-CEDriftX.js","assets/Users-C9QZ3js5.js","assets/Settings-DzYlMqQV.js","assets/AccountSettings-BHFfcmN6.js","assets/WorkflowSummary-Do4ybSaz.js","assets/AuditLog-BIXG8Zb1.js","assets/DeletedItems-DDwjvXfZ.js"])))=>i.map(i=>d[i]);
var Dt=Object.defineProperty;var At=(n,s,t)=>s in n?Dt(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var Se=(n,s,t)=>At(n,typeof s!="symbol"?s+"":s,t);import{r as l,a as Mt,R as et,u as ze,b as Tt,L as J,c as qt,B as Ot,d as Lt,e as z,N as De,O as zt}from"./vendor-react-JFEV0ROX.js";import{c as Bt}from"./vendor-supabase-DgEUAXvv.js";import{A as tt,R as fe,I as Ut,X as rt,C as $t,a as oe,M as Wt,S as Ft,B as Ne,D as Vt,T as Ht,U as Kt,b as Gt,c as st,d as Qt,L as Yt,e as Xt,f as Ae,g as Ce,h as Jt,i as pe,F as at,j as nt,k as me,l as Zt,H as er,m as tr,n as rr,o as sr,p as ar,q as Me,P as Te,r as nr,G as ir,s as or,t as lr,u as cr,v as dr,w as ur,x as mr,K as hr,y as ke,z as Ee,E as We,J as fr,N as pr,O as gr}from"./vendor-icons-CMdlt-Xc.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var it={exports:{}},xe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yr=l,xr=Symbol.for("react.element"),br=Symbol.for("react.fragment"),vr=Object.prototype.hasOwnProperty,_r=yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wr={key:!0,ref:!0,__self:!0,__source:!0};function ot(n,s,t){var r,a={},i=null,o=null;t!==void 0&&(i=""+t),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(o=s.ref);for(r in s)vr.call(s,r)&&!wr.hasOwnProperty(r)&&(a[r]=s[r]);if(n&&n.defaultProps)for(r in s=n.defaultProps,s)a[r]===void 0&&(a[r]=s[r]);return{$$typeof:xr,type:n,key:i,ref:o,props:a,_owner:_r.current}}xe.Fragment=br;xe.jsx=ot;xe.jsxs=ot;it.exports=xe;var e=it.exports,qe={},Fe=Mt;qe.createRoot=Fe.createRoot,qe.hydrateRoot=Fe.hydrateRoot;const jr="modulepreload",Sr=function(n){return"/"+n},Ve={},K=function(s,t,r){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),d=o?.nonce||o?.getAttribute("nonce");a=Promise.allSettled(t.map(c=>{if(c=Sr(c),c in Ve)return;Ve[c]=!0;const h=c.endsWith(".css"),x=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${x}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":jr,h||(b.as="script"),b.crossOrigin="",b.href=c,d&&b.setAttribute("nonce",d),document.head.appendChild(b),h)return new Promise((v,E)=>{b.addEventListener("load",v),b.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return a.then(o=>{for(const d of o||[])d.status==="rejected"&&i(d.reason);return s().catch(i)})};var He={},Nr="@vercel/analytics",Cr="1.6.0",kr=()=>{window.va||(window.va=function(...s){(window.vaq=window.vaq||[]).push(s)})};function lt(){return typeof window<"u"}function ct(){try{const n="production"}catch{}return"production"}function Er(n="auto"){if(n==="auto"){window.vam=ct();return}window.vam=n}function Rr(){return(lt()?window.vam:ct())||"production"}function Oe(){return Rr()==="development"}function Pr(n){return n.scriptSrc?n.scriptSrc:Oe()?"https://va.vercel-scripts.com/v1/script.debug.js":n.basePath?`${n.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function Ir(n={debug:!0}){var s;if(!lt())return;Er(n.mode),kr(),n.beforeSend&&((s=window.va)==null||s.call(window,"beforeSend",n.beforeSend));const t=Pr(n);if(document.head.querySelector(`script[src*="${t}"]`))return;const r=document.createElement("script");r.src=t,r.defer=!0,r.dataset.sdkn=Nr+(n.framework?`/${n.framework}`:""),r.dataset.sdkv=Cr,n.disableAutoTrack&&(r.dataset.disableAutoTrack="1"),n.endpoint?r.dataset.endpoint=n.endpoint:n.basePath&&(r.dataset.endpoint=`${n.basePath}/insights`),n.dsn&&(r.dataset.dsn=n.dsn),r.onerror=()=>{const a=Oe()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information."},Oe()&&n.debug===!1&&(r.dataset.debug="false"),document.head.appendChild(r)}function Dr({route:n,path:s}){var t;(t=window.va)==null||t.call(window,"pageview",{route:n,path:s})}function Ar(){if(!(typeof process>"u"||typeof He>"u"))return He.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Mr(n){return l.useEffect(()=>{var s;n.beforeSend&&((s=window.va)==null||s.call(window,"beforeSend",n.beforeSend))},[n.beforeSend]),l.useEffect(()=>{Ir({framework:n.framework||"react",basePath:n.basePath??Ar(),...n.route!==void 0&&{disableAutoTrack:!0},...n})},[]),l.useEffect(()=>{n.route&&n.path&&Dr({route:n.route,path:n.path})},[n.route,n.path]),null}var Ke={},Tr="@vercel/speed-insights",qr="1.2.0",Or=()=>{window.si||(window.si=function(...s){(window.siq=window.siq||[]).push(s)})};function Lr(){return typeof window<"u"}function zr(){try{const n="production"}catch{}return"production"}function dt(){return zr()==="development"}function Br(n){return n.scriptSrc?n.scriptSrc:dt()?"https://va.vercel-scripts.com/v1/speed-insights/script.debug.js":n.dsn?"https://va.vercel-scripts.com/v1/speed-insights/script.js":n.basePath?`${n.basePath}/speed-insights/script.js`:"/_vercel/speed-insights/script.js"}function Ur(n={}){var s;if(!Lr()||n.route===null)return null;Or();const t=Br(n);if(document.head.querySelector(`script[src*="${t}"]`))return null;n.beforeSend&&((s=window.si)==null||s.call(window,"beforeSend",n.beforeSend));const r=document.createElement("script");return r.src=t,r.defer=!0,r.dataset.sdkn=Tr+(n.framework?`/${n.framework}`:""),r.dataset.sdkv=qr,n.sampleRate&&(r.dataset.sampleRate=n.sampleRate.toString()),n.route&&(r.dataset.route=n.route),n.endpoint?r.dataset.endpoint=n.endpoint:n.basePath&&(r.dataset.endpoint=`${n.basePath}/speed-insights/vitals`),n.dsn&&(r.dataset.dsn=n.dsn),dt()&&n.debug===!1&&(r.dataset.debug="false"),r.onerror=()=>{},document.head.appendChild(r),{setRoute:a=>{r.dataset.route=a??void 0}}}function $r(){if(!(typeof process>"u"||typeof Ke>"u"))return Ke.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function Wr(n){l.useEffect(()=>{var t;n.beforeSend&&((t=window.si)==null||t.call(window,"beforeSend",n.beforeSend))},[n.beforeSend]);const s=l.useRef(null);return l.useEffect(()=>{if(s.current)n.route&&s.current(n.route);else{const t=Ur({framework:n.framework??"react",basePath:n.basePath??$r(),...n});t&&(s.current=t.setRoute)}},[n.route]),null}const Fr=void 0,Vr=void 0;throw new Error("Missing Supabase environment variables");const u=Bt(Fr,Vr),ut=l.createContext(null),Hr=60*1e3,Kr=5*60*1e3;function Gr({children:n}){const[s,t]=l.useState(null),[r,a]=l.useState(null),[i,o]=l.useState(null),[d,c]=l.useState(!0),[h,x]=l.useState(null),[b,v]=l.useState(!1),E=l.useRef(null),L=l.useRef(Date.now()),S=l.useCallback(()=>{L.current=Date.now()},[]);async function T(p){if(!p){a(null),o(null);return}try{const{data:g,error:I}=await u.from("profiles").select("*").eq("id",p.id).single();if(I){x(I);return}a(g);const{data:R}=await u.from("resources").select("*").eq("user_id",p.id).maybeSingle();o(R),x(null)}catch(g){x(g)}}const M=l.useCallback(async()=>{try{const{data:{session:p},error:g}=await u.auth.getSession();if(g)return;if(!p){await V();return}const I=p.expires_at*1e3,R=Date.now(),k=I-R;if(k<=0)await V();else if(k<=Kr){v(!0);const{data:C,error:$}=await u.auth.refreshSession();$||!C.session||v(!1)}else v(!1)}catch{}},[]);async function V(){t(null),a(null),o(null),v(!1),await u.auth.signOut();const p=window.location.pathname;p!=="/login"&&p!=="/register"&&(window.location.href="/login?expired=true")}const q=l.useCallback(()=>{E.current&&clearInterval(E.current),E.current=setInterval(()=>{M()},Hr);const p=()=>{document.visibilityState==="visible"&&M()};document.addEventListener("visibilitychange",p);const g=["mousedown","keydown","touchstart","scroll"];return g.forEach(I=>{document.addEventListener(I,S,{passive:!0})}),()=>{E.current&&clearInterval(E.current),document.removeEventListener("visibilitychange",p),g.forEach(I=>{document.removeEventListener(I,S)})}},[M,S]);l.useEffect(()=>{let p=!0,g=null;async function I(){try{const{data:{session:k},error:C}=await u.auth.getSession();C&&p&&x(C),p&&(t(k?.user??null),c(!1),k?.user&&(T(k.user),g=q()))}catch(k){p&&(x(k),c(!1))}}I();const{data:{subscription:R}}=u.auth.onAuthStateChange(async(k,C)=>{p&&(t(C?.user??null),c(!1),C?.user?(T(C.user),g&&g(),g=q()):(a(null),o(null),g&&(g(),g=null)),(k==="SIGNED_OUT"||k==="TOKEN_REFRESHED")&&v(!1))});return()=>{p=!1,R.unsubscribe(),g&&g()}},[q]);async function y(){try{await u.auth.signOut(),t(null),a(null),o(null),v(!1)}catch(p){x(p)}}async function _(){s&&await T(s)}async function N(){try{const{data:p,error:g}=await u.auth.refreshSession();return g?!1:p.session?(v(!1),!0):!1}catch{return!1}}const j={user:s,profile:r,role:r?.role||"viewer",linkedResource:i,isLoading:d,error:h,signOut:y,refreshUserData:_,refreshSession:N,isAuthenticated:!!s,sessionExpiring:b};return e.jsx(ut.Provider,{value:j,children:n})}function be(){const n=l.useContext(ut);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n}const mt=l.createContext(null);function Qr({children:n}){const[s,t]=l.useState(null),[r,a]=l.useState(!0),[i,o]=l.useState(null);l.useEffect(()=>{let x=!0;async function b(){try{const{data:v,error:E}=await u.from("projects").select("*").eq("reference","AMSF001").single();E?x&&o(E):x&&(t(v),o(null))}catch(v){x&&o(v)}finally{x&&a(!1)}}return b(),()=>{x=!1}},[]);async function d(x){a(!0),o(null);try{const{data:b,error:v}=await u.from("projects").select("*").eq("reference",x).single();v?o(v):t(b)}catch(b){o(b)}finally{a(!1)}}async function c(){if(s)try{const{data:x,error:b}=await u.from("projects").select("*").eq("id",s.id).single();b?o(b):t(x)}catch(x){o(x)}}const h={currentProject:s,projectId:s?.id||null,projectRef:s?.reference||null,projectName:s?.name||null,isLoading:r,error:i,switchProject:d,refreshProject:c};return e.jsx(mt.Provider,{value:h,children:n})}function ht(){const n=l.useContext(mt);if(!n)throw new Error("useProject must be used within a ProjectProvider");return n}const ft=l.createContext();function Yr({children:n}){const[s,t]=l.useState(!1),[r,a]=l.useState(null),[i,o]=l.useState([]);l.useEffect(()=>{d(),c()},[]);async function d(){const{data:{user:S}}=await u.auth.getUser();if(S){const{data:T}=await u.from("profiles").select("role").eq("id",S.id).single();T&&a(T.role)}}async function c(){const{data:S}=await u.from("profiles").select("id").eq("is_test_user",!0);S&&o(S.map(T=>T.id))}const h=r==="admin"||r==="supplier_pm";function x(){h&&t(S=>!S)}function b(S){return i.includes(S)}function v(S,T="user_id"){return!S||s?S:S.filter(M=>!i.includes(M[T]))}function E(S){return!S||s?S:S.filter(T=>!T.is_test_content)}const L={showTestUsers:s,setShowTestUsers:t,toggleTestUsers:x,canToggleTestUsers:h,testUserIds:i,isTestUser:b,filterTestContent:v,filterByTestFlag:E,userRole:r};return e.jsx(ft.Provider,{value:L,children:n})}function Xr(){const n=l.useContext(ft);if(!n)throw new Error("useTestUsers must be used within a TestUserProvider");return n}const pt=l.createContext();function Jr(){return l.useContext(pt)}function Zr({children:n}){const[s,t]=l.useState([]),[r,a]=l.useState(0),[i,o]=l.useState(0),[d,c]=l.useState(!0),[h,x]=l.useState(null),[b,v]=l.useState(null),E=_=>["admin","supplier_pm","customer_pm"].includes(_),L=l.useCallback(async(_,N)=>{try{let j=[];if(E(N)){const{data:p}=await u.from("timesheets").select("id, hours_worked, hours, work_date, date").eq("status","Submitted"),{data:g}=await u.from("expenses").select("id, amount, category, reason, resource_name, chargeable_to_customer").eq("status","Submitted"),{data:I}=await u.from("deliverables").select("id, name, deliverable_ref").eq("status","Submitted"),{data:R}=await u.from("milestone_certificates").select("id, milestone_id").eq("status","Submitted");p&&p.forEach(k=>{j.push({id:`ts-${k.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Timesheet (${k.hours_worked||k.hours||0}h) pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),g&&g.forEach(k=>{const C=k.chargeable_to_customer!==!1;j.push({id:`exp-${k.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`${k.resource_name||"Unknown"} expense (Â£${parseFloat(k.amount||0).toFixed(2)}) pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1,isChargeable:C})}),I&&I.forEach(k=>{j.push({id:`del-${k.id}`,type:"deliverable",notification_type:"action",title:"Deliverable Submitted",message:`${k.deliverable_ref}: ${k.name} pending review`,action_url:"/deliverables",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),R&&R.forEach(k=>{j.push({id:`cert-${k.id}`,type:"certificate",notification_type:"action",title:"Certificate Submitted",message:"Milestone certificate pending approval",action_url:"/milestones",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}else{const{data:p}=await u.from("timesheets").select("id, hours_worked, hours, work_date, date, resource_id").eq("status","Submitted").eq("user_id",_),{data:g}=await u.from("expenses").select("id, amount, category, reason, resource_name").eq("status","Submitted").eq("created_by",_);p&&p.forEach(I=>{j.push({id:`ts-${I.id}`,type:"timesheet",notification_type:"action",title:"Timesheet Submitted",message:`Your timesheet for ${I.hours_worked||I.hours||0}h is pending approval`,action_url:"/timesheets",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})}),g&&g.forEach(I=>{j.push({id:`exp-${I.id}`,type:"expense",notification_type:"action",title:"Expense Submitted",message:`Your expense (Â£${parseFloat(I.amount||0).toFixed(2)}) is pending validation`,action_url:"/expenses",created_at:new Date().toISOString(),is_read:!1,is_actioned:!1})})}return{count:j.length,items:j}}catch{return{count:0,items:[]}}},[]),S=l.useCallback(async()=>{try{const{data:{user:_}}=await u.auth.getUser();if(!_){t([]),a(0),o(0),c(!1);return}x(_.id);const{data:N}=await u.from("profiles").select("role").eq("id",_.id).single(),j=N?.role||"viewer";v(j);const{count:p,items:g}=await L(_.id,j);t(g),a(p),o(p)}catch{}finally{c(!1)}},[L]),T=l.useCallback(async _=>{t(N=>N.map(j=>j.id===_?{...j,is_read:!0}:j)),a(N=>Math.max(0,N-1))},[]),M=l.useCallback(async _=>{t(N=>N.map(j=>j.id===_?{...j,is_actioned:!0,is_read:!0}:j)),a(N=>Math.max(0,N-1)),o(N=>Math.max(0,N-1))},[]),V=l.useCallback(async()=>{t(_=>_.map(N=>({...N,is_read:!0}))),a(0)},[]),q=l.useCallback(async _=>{const N=s.find(j=>j.id===_);N&&(t(j=>j.filter(p=>p.id!==_)),N.is_read||a(j=>Math.max(0,j-1)),N.notification_type==="action"&&!N.is_actioned&&o(j=>Math.max(0,j-1)))},[s]);l.useEffect(()=>{S();const _=setInterval(()=>{S()},3e4);return()=>clearInterval(_)},[S]),l.useEffect(()=>{const{data:{subscription:_}}=u.auth.onAuthStateChange((N,j)=>{N==="SIGNED_IN"?S():N==="SIGNED_OUT"&&(t([]),a(0),o(0),x(null),v(null))});return()=>_.unsubscribe()},[S]);const y={notifications:s,unreadCount:r,actionCount:i,loading:d,fetchNotifications:S,markAsRead:T,markAsActioned:M,markAllAsRead:V,dismissNotification:q};return e.jsx(pt.Provider,{value:y,children:n})}const gt=l.createContext(null),Be="amsf-chat-history",es=50,Re={maxRetries:2,baseDelayMs:1e3,retryableCodes:[429,503,504]};function ts(){try{const n=localStorage.getItem(Be);if(n){const s=JSON.parse(n);return{messages:s.messages||[],tokenUsage:s.tokenUsage||{input:0,output:0,requests:0}}}}catch{}return{messages:[],tokenUsage:{input:0,output:0,requests:0}}}function rs(n,s){try{const t=n.slice(-es);localStorage.setItem(Be,JSON.stringify({messages:t,tokenUsage:s,savedAt:new Date().toISOString()}))}catch{}}function ss({children:n}){const{user:s,profile:t,linkedResource:r,role:a}=be(),{projectId:i,projectName:o,projectRef:d,currentProject:c}=ht(),h=ts(),[x,b]=l.useState(!1),[v,E]=l.useState(h.messages),[L,S]=l.useState(!1),[T,M]=l.useState(null),[V,q]=l.useState(0),[y,_]=l.useState(h.tokenUsage),N=l.useRef(null);l.useEffect(()=>{(v.length>0||y.requests>0)&&rs(v,y)},[v,y]);const j=l.useCallback(()=>c?{id:i,reference:d||c?.reference,name:o||c?.name,description:c?.description||null}:null,[c,i,d,o]),p=l.useCallback(()=>({name:t?.full_name||s?.email?.split("@")[0]||"User",email:s?.email,role:a||t?.role||"unknown",linkedResourceName:r?.name||null,linkedResourceId:r?.id||null,partnerId:r?.partner_id||null,partnerName:r?.partners?.name||null}),[s,t,r,a]),g=async(W,U=1)=>{N.current=new AbortController;try{const P=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W),signal:N.current.signal}),f=await P.json().catch(()=>({}));if(!P.ok){if(Re.retryableCodes.includes(P.status)&&U<=Re.maxRetries&&f.recoverable!==!1){const G=f.retryAfter?f.retryAfter*1e3:Re.baseDelayMs*Math.pow(2,U-1);return q(U),await new Promise(F=>setTimeout(F,G)),g(W,U+1)}throw new Error(f.error||`Request failed (${P.status})`)}return q(0),f}catch(P){throw P.name==="AbortError"?new Error("Request cancelled"):P}},I=l.useCallback(async W=>{if(!W.trim()||L)return;N.current&&N.current.abort();const U={role:"user",content:W.trim(),timestamp:new Date().toISOString()};E(P=>[...P,U]),S(!0),M(null),q(0);try{const P=j(),f=p(),B=[...v.slice(-9),U].map(F=>({role:F.role,content:F.content})),G=await g({messages:B,projectContext:P,userContext:f,projectId:i});G.usage&&_(F=>({input:F.input+(G.usage.input_tokens||0),output:F.output+(G.usage.output_tokens||0),requests:F.requests+1})),E(F=>[...F,{role:"assistant",content:G.message,toolsUsed:G.toolsUsed||!1,cached:G.cached||!1,timestamp:new Date().toISOString(),tokens:G.usage?{input:G.usage.input_tokens,output:G.usage.output_tokens}:null}])}catch(P){let f=P.message;P.message==="Request cancelled"?f=null:P.message.includes("Failed to fetch")&&(f="Unable to connect. Please check your internet connection."),f&&(M(f),E(B=>B.slice(0,-1)))}finally{S(!1),q(0)}},[v,L,j,p,i]),R=l.useCallback(()=>{N.current&&(N.current.abort(),S(!1),q(0))},[]),k=l.useCallback(()=>{R(),E([]),M(null),localStorage.removeItem(Be)},[R]),C=l.useCallback(()=>{k(),_({input:0,output:0,requests:0})},[k]),$=l.useCallback(()=>{b(W=>!W)},[]),Q=l.useCallback(()=>{M(null)},[]),w=l.useCallback(()=>{if(v.length===0)return null;const W=p(),U=j();let P=`# Chat Export

`;return P+=`**Exported:** ${new Date().toLocaleString("en-GB")}
`,P+=`**User:** ${W.name} (${W.role})
`,U&&(P+=`**Project:** ${U.name} (${U.reference})
`),P+=`**Messages:** ${v.length}
`,P+=`**Token Usage:** ${y.input.toLocaleString()} input / ${y.output.toLocaleString()} output

`,P+=`---

`,v.forEach((f,B)=>{const G=f.role==="user"?"ðŸ‘¤ You":"ðŸ¤– Assistant",F=f.timestamp?new Date(f.timestamp).toLocaleTimeString("en-GB"):"";P+=`### ${G}${F?` (${F})`:""}

`,P+=`${f.content}

`,f.toolsUsed&&(P+=`*ðŸ“Š Queried project data*

`),B<v.length-1&&(P+=`---

`)}),P},[v,y,p,j]),O=l.useCallback(()=>{const W=w();if(!W)return;const U=new Blob([W],{type:"text/markdown"}),P=URL.createObjectURL(U),f=document.createElement("a");f.href=P,f.download=`chat-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(P)},[w]),X=l.useCallback(async W=>{try{return await navigator.clipboard.writeText(W),!0}catch{return!1}},[]),Y={isOpen:x,setIsOpen:b,toggleChat:$,messages:v,isLoading:L,error:T,retryCount:V,tokenUsage:y,sendMessage:I,clearChat:k,resetAllStats:C,cancelRequest:R,dismissError:Q,exportChat:w,downloadChat:O,copyMessage:X};return e.jsx(gt.Provider,{value:Y,children:n})}function as(){const n=l.useContext(gt);if(!n)throw new Error("useChat must be used within a ChatProvider");return n}class ns extends et.Component{constructor(t){super(t);Se(this,"handleReload",()=>{window.location.reload()});Se(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){this.setState({errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",backgroundColor:"#fef2f2",borderRadius:"12px",margin:"1rem",border:"1px solid #fecaca"},children:[e.jsx(tt,{size:48,style:{color:"#dc2626",marginBottom:"1rem"}}),e.jsx("h2",{style:{color:"#991b1b",margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Something went wrong"}),e.jsx("p",{style:{color:"#64748b",margin:"0 0 1.5rem 0",textAlign:"center",maxWidth:"400px"},children:this.state.error?.message||"An unexpected error occurred. Please try again."}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsx("button",{onClick:this.handleReset,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"white",color:"#374151",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:"Try Again"}),e.jsxs("button",{onClick:this.handleReload,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.25rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},children:[e.jsx(fe,{size:16}),"Reload Page"]})]})]}):this.props.children}}function Ue({message:n,size:s="medium",fullPage:t=!1,className:r=""}){const a={small:"spinner-sm",medium:"",large:"spinner-lg"};return e.jsxs("div",{className:`loading-spinner ${r}`,style:t?{minHeight:"60vh"}:void 0,children:[e.jsx("div",{className:`spinner ${a[s]}`}),n&&e.jsx("p",{className:"loading-text",children:n})]})}const is={background:"linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"};function Z({width:n="100%",height:s="1rem",style:t={},className:r=""}){return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `}),e.jsx("div",{className:r,style:{width:n,height:s,borderRadius:"4px",...is,...t}})]})}function Le({width:n="100%",lines:s=1}){return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Array.from({length:s}).map((t,r)=>e.jsx(Z,{width:r===s-1&&s>1?"70%":n,height:"1rem"},r))})}function os(){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(Z,{width:"48px",height:"48px",style:{borderRadius:"12px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx(Z,{width:"60%",height:"0.875rem",style:{marginBottom:"0.5rem"}}),e.jsx(Z,{width:"40%",height:"1.5rem"})]})]})}function ls({columns:n=6}){return e.jsx("tr",{children:Array.from({length:n}).map((s,t)=>e.jsx("td",{style:{padding:"0.75rem 1rem"},children:e.jsx(Z,{width:t===0?"80%":t===n-1?"60px":"70%",height:"1rem"})},t))})}function Pe({hasHeader:n=!0}){return e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[n&&e.jsx(Z,{width:"40%",height:"1.5rem",style:{marginBottom:"1rem"}}),e.jsx(Le,{lines:3})]})}function ue({type:n="text",count:s=1,...t}){return(()=>{switch(n){case"text":return e.jsx(Le,{...t});case"stat-card":case"stats":return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:Array.from({length:s}).map((a,i)=>e.jsx(os,{},i))});case"table":return e.jsx("div",{className:"card",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:t.columns||6}).map((a,i)=>e.jsx("th",{style:{padding:"0.75rem 1rem"},children:e.jsx(Z,{width:"60%",height:"0.875rem"})},i))})}),e.jsx("tbody",{children:Array.from({length:t.rows||5}).map((a,i)=>e.jsx(ls,{columns:t.columns||6},i))})]})});case"card":return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Array.from({length:s}).map((a,i)=>e.jsx(Pe,{...t},i))});case"page":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Z,{width:"200px",height:"1.75rem",style:{marginBottom:"0.5rem"}}),e.jsx(Z,{width:"300px",height:"1rem"})]}),e.jsx(Z,{width:"120px",height:"40px",style:{borderRadius:"8px"}})]}),e.jsx(ue,{type:"stats",count:4}),e.jsx(ue,{type:"table",rows:8,columns:6})]});case"detail":return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(Z,{width:"80px",height:"36px",style:{borderRadius:"8px"}}),e.jsx(Z,{width:"250px",height:"1.75rem"})]}),e.jsx(ue,{type:"stats",count:4}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsx(Pe,{}),e.jsx(Pe,{})]}),e.jsx(ue,{type:"table",rows:5,columns:5})]});default:return e.jsx(Le,{...t})}})()}const Ge={success:{icon:$t,bgColor:"#dcfce7",borderColor:"#86efac",textColor:"#166534",iconColor:"#16a34a"},error:{icon:rt,bgColor:"#fee2e2",borderColor:"#fecaca",textColor:"#991b1b",iconColor:"#dc2626"},warning:{icon:tt,bgColor:"#fef3c7",borderColor:"#fde68a",textColor:"#92400e",iconColor:"#d97706"},info:{icon:Ut,bgColor:"#dbeafe",borderColor:"#93c5fd",textColor:"#1e40af",iconColor:"#3b82f6"}};function cs({id:n,message:s,type:t="info",duration:r=4e3,onClose:a}){const i=Ge[t]||Ge.info,o=i.icon;return l.useEffect(()=>{if(r>0){const d=setTimeout(()=>{a(n)},r);return()=>clearTimeout(d)}},[n,r,a]),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",backgroundColor:i.bgColor,border:`1px solid ${i.borderColor}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",minWidth:"300px",maxWidth:"450px",animation:"slideIn 0.3s ease-out"},children:[e.jsx(o,{size:20,style:{color:i.iconColor,flexShrink:0}}),e.jsx("span",{style:{color:i.textColor,fontSize:"0.875rem",fontWeight:"500",flex:1},children:s}),e.jsx("button",{onClick:()=>a(n),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",color:i.textColor,opacity:.7,borderRadius:"4px"},onMouseEnter:d=>d.target.style.opacity=1,onMouseLeave:d=>d.target.style.opacity=.7,children:e.jsx(oe,{size:16})})]})}function ds({toasts:n,removeToast:s}){return n.length===0?null:e.jsxs("div",{style:{position:"fixed",top:"1rem",right:"1rem",zIndex:9999,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `}),n.map(t=>e.jsx(cs,{id:t.id,message:t.message,type:t.type,duration:t.duration,onClose:s},t.id))]})}const yt=l.createContext(null),us=4e3;function ms({children:n}){const[s,t]=l.useState([]),r=l.useCallback(x=>{t(b=>b.filter(v=>v.id!==x))},[]),a=l.useCallback((x,b="info",v=us)=>{const E=Date.now()+Math.random(),L={id:E,message:x,type:b,duration:v};return t(S=>[...S,L]),E},[]),i=l.useCallback((x,b)=>a(x,"success",b),[a]),o=l.useCallback((x,b)=>a(x,"error",b||6e3),[a]),d=l.useCallback((x,b)=>a(x,"warning",b),[a]),c=l.useCallback((x,b)=>a(x,"info",b),[a]),h={showToast:a,showSuccess:i,showError:o,showWarning:d,showInfo:c,removeToast:r};return e.jsxs(yt.Provider,{value:h,children:[n,e.jsx(ds,{toasts:s,removeToast:r})]})}function hs(){const n=l.useContext(yt);if(!n)throw new Error("useToast must be used within a ToastProvider");return n}function fs(){const{isOpen:n,toggleChat:s,messages:t,isLoading:r,error:a,retryCount:i,tokenUsage:o,sendMessage:d,clearChat:c,cancelRequest:h,dismissError:x,downloadChat:b,copyMessage:v}=as(),[E,L]=l.useState(""),[S,T]=l.useState(null),[M,V]=l.useState(!1),q=l.useRef(null),y=l.useRef(null);l.useEffect(()=>{q.current?.scrollIntoView({behavior:"smooth"})},[t]),l.useEffect(()=>{n&&setTimeout(()=>y.current?.focus(),100)},[n]),l.useEffect(()=>{if(S!==null){const R=setTimeout(()=>T(null),2e3);return()=>clearTimeout(R)}},[S]);const _=R=>{R.preventDefault(),E.trim()&&!r&&(d(E),L(""))},N=R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),_(R))},j=async(R,k)=>{await v(R)&&T(k)},p={role:"assistant",content:`Hello! I'm your Project Assistant. I can query your project data and help you understand what's happening. Try asking:

â€¢ **"What do I need to do?"** - See your pending actions
â€¢ **"Show my timesheets this month"** - Query your time entries
â€¢ **"What milestones are at risk?"** - Check project progress
â€¢ **"What's the budget status?"** - View spend vs forecast
â€¢ **"What can my role do?"** - Understand your permissions

All data is scoped to your role, so just ask naturally!`},g=t.length===0?[p]:t,I=(o.input*.25/1e6+o.output*1.25/1e6).toFixed(4);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`chat-toggle-btn ${n?"chat-open":""}`,onClick:s,"aria-label":n?"Close chat":"Open AI assistant",children:n?e.jsx(oe,{size:24}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{size:24}),e.jsx(Ft,{className:"chat-sparkle",size:12})]})}),e.jsxs("div",{className:`chat-panel ${n?"chat-panel-open":""}`,children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"chat-header-title",children:[e.jsx(Ne,{size:20}),e.jsx("span",{children:"Project Assistant"})]}),e.jsxs("div",{className:"chat-header-actions",children:[t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"chat-action-btn",onClick:b,title:"Export chat as Markdown",children:e.jsx(Vt,{size:16})}),e.jsx("button",{className:"chat-action-btn",onClick:c,title:"Clear chat",children:e.jsx(Ht,{size:16})})]}),e.jsx("button",{className:"chat-close-btn",onClick:s,"aria-label":"Close chat",children:e.jsx(oe,{size:20})})]})]}),e.jsxs("div",{className:"chat-messages",children:[g.map((R,k)=>e.jsxs("div",{className:`chat-message ${R.role==="user"?"chat-message-user":"chat-message-assistant"}`,children:[e.jsx("div",{className:"chat-message-avatar",children:R.role==="user"?e.jsx(Kt,{size:16}):e.jsx(Ne,{size:16})}),e.jsxs("div",{className:"chat-message-content",children:[e.jsx(ps,{content:R.content}),e.jsxs("div",{className:"chat-message-actions",children:[R.toolsUsed&&e.jsx("span",{className:"chat-tools-indicator",title:"Queried project data",children:e.jsx(Gt,{size:12})}),e.jsx("button",{className:"chat-copy-btn",onClick:()=>j(R.content,k),title:S===k?"Copied!":"Copy message",children:S===k?e.jsx(st,{size:12,className:"chat-copy-success"}):e.jsx(Qt,{size:12})})]})]})]},k)),r&&e.jsxs("div",{className:"chat-message chat-message-assistant",children:[e.jsx("div",{className:"chat-message-avatar",children:e.jsx(Ne,{size:16})}),e.jsxs("div",{className:"chat-message-content chat-typing",children:[i>0?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"chat-typing-icon",size:16}),e.jsxs("span",{children:["Retrying (",i,"/2)..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"chat-typing-icon",size:16}),e.jsx("span",{children:"Querying data..."})]}),e.jsx("button",{className:"chat-cancel-btn",onClick:h,title:"Cancel request",children:e.jsx(rt,{size:14})})]})]}),a&&e.jsxs("div",{className:"chat-error",children:[e.jsx("span",{children:a}),e.jsx("button",{className:"chat-error-dismiss",onClick:x,title:"Dismiss",children:e.jsx(oe,{size:14})})]}),e.jsx("div",{ref:q})]}),e.jsxs("form",{className:"chat-input-form",onSubmit:_,children:[e.jsx("textarea",{ref:y,className:"chat-input",value:E,onChange:R=>L(R.target.value),onKeyDown:N,placeholder:"Ask me anything about the project...",rows:1,disabled:r}),e.jsx("button",{type:"submit",className:"chat-send-btn",disabled:!E.trim()||r,"aria-label":"Send message",children:e.jsx(Xt,{size:18})})]}),e.jsxs("div",{className:"chat-footer",children:[e.jsx("button",{className:"chat-stats-toggle",onClick:()=>V(!M),title:"Toggle usage stats",children:e.jsx(Ae,{size:12})}),M?e.jsxs("div",{className:"chat-stats",children:[e.jsxs("span",{title:"Total requests",children:[o.requests," req"]}),e.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),e.jsxs("span",{title:"Input tokens",children:[o.input.toLocaleString()," in"]}),e.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),e.jsxs("span",{title:"Output tokens",children:[o.output.toLocaleString()," out"]}),e.jsx("span",{className:"chat-stats-divider",children:"â€¢"}),e.jsxs("span",{title:"Estimated cost",children:["$",I]})]}):e.jsx("span",{children:"Powered by Claude AI"})]})]})]})}function ps({content:n}){const s=n.split(`
`);return e.jsx("div",{className:"chat-message-text",children:s.map((t,r)=>{if(t.startsWith("â€¢ ")||t.startsWith("- ")){const a=t.substring(2);return e.jsxs("div",{className:"chat-bullet",children:[e.jsx("span",{className:"chat-bullet-dot",children:"â€¢"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:Qe(a)}})]},r)}return t.trim()===""?e.jsx("div",{className:"chat-line-break"},r):e.jsx("p",{dangerouslySetInnerHTML:{__html:Qe(t)}},r)})})}function Qe(n){return n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}function gs(){const[n,s]=l.useState(!1),t=l.useRef(null),r=ze(),{notifications:a,unreadCount:i,actionCount:o,loading:d,markAsRead:c,markAsActioned:h,markAllAsRead:x,dismissNotification:b}=Jr();l.useEffect(()=>{function y(_){t.current&&!t.current.contains(_.target)&&s(!1)}return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]);const v=y=>{switch(y){case"timesheet":return e.jsx(me,{size:16});case"expense":return e.jsx(nt,{size:16});case"deliverable":return e.jsx(at,{size:16});case"certificate":return e.jsx(pe,{size:16});default:return e.jsx(Ce,{size:16})}},E=y=>y.notification_type==="action"?y.is_actioned?"#10b981":"#f59e0b":"#3b82f6",L=async y=>{y.is_read||await c(y.id),y.action_url&&(r(y.action_url),s(!1))},S=async(y,_)=>{y.stopPropagation(),await h(_.id),_.action_url&&(r(_.action_url),s(!1))},T=async(y,_)=>{y.stopPropagation(),await b(_.id)},M=y=>{const _=new Date(y),j=new Date-_,p=Math.floor(j/6e4),g=Math.floor(j/36e5),I=Math.floor(j/864e5);return p<1?"Just now":p<60?`${p}m ago`:g<24?`${g}h ago`:I<7?`${I}d ago`:_.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},V=a.slice(0,10),q=a.filter(y=>y.notification_type==="action"&&!y.is_actioned);return e.jsxs("div",{className:"notification-bell-container",ref:t,style:{position:"relative"},children:[e.jsxs("button",{onClick:()=>s(!n),style:{position:"relative",background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",backgroundColor:n?"#f1f5f9":"transparent"},onMouseEnter:y=>y.target.style.backgroundColor="#f1f5f9",onMouseLeave:y=>y.target.style.backgroundColor=n?"#f1f5f9":"transparent",title:`${o} actions pending`,children:[e.jsx(Ce,{size:22,color:"#64748b"}),(i>0||o>0)&&e.jsx("span",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:o>0?"#ef4444":"#3b82f6",color:"white",fontSize:"11px",fontWeight:"600",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:o>0?o:i})]}),n&&e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",width:"380px",maxHeight:"500px",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",border:"1px solid #e2e8f0",zIndex:1e3,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Notifications"}),o>0&&e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#f59e0b"},children:[o," action",o!==1?"s":""," required"]})]}),i>0&&e.jsx("button",{onClick:x,style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px"},children:"Mark all read"})]}),q.length>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fffbeb",borderBottom:"1px solid #fef3c7"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#f59e0b",animation:"pulse 2s infinite"}}),e.jsx("span",{style:{fontWeight:"600",fontSize:"13px",color:"#92400e"},children:"Actions Requiring Attention"})]}),e.jsxs("button",{onClick:()=>{r("/workflow-summary"),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:["View Workflow Summary",e.jsx(Jt,{size:16})]})]}),e.jsx("div",{style:{maxHeight:"350px",overflowY:"auto"},children:d?e.jsx("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:"Loading..."}):V.length===0?e.jsxs("div",{style:{padding:"32px",textAlign:"center",color:"#64748b"},children:[e.jsx(Ce,{size:32,style:{marginBottom:"8px",opacity:.5}}),e.jsx("p",{style:{margin:0},children:"No notifications"})]}):V.map(y=>e.jsx("div",{onClick:()=>L(y),style:{padding:"12px 16px",borderBottom:"1px solid #f1f5f9",cursor:"pointer",backgroundColor:y.is_read?"white":"#f8fafc",transition:"background-color 0.15s"},onMouseEnter:_=>_.currentTarget.style.backgroundColor="#f1f5f9",onMouseLeave:_=>_.currentTarget.style.backgroundColor=y.is_read?"white":"#f8fafc",children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:y.notification_type==="action"&&!y.is_actioned?"#fef3c7":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",color:E(y),flexShrink:0},children:v(y.category)}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"8px"},children:[e.jsx("span",{style:{fontWeight:y.is_read?"400":"600",fontSize:"14px",color:"#1e293b"},children:y.title}),e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",flexShrink:0},children:M(y.created_at)})]}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:"#64748b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y.message}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"8px"},children:[y.notification_type==="action"&&!y.is_actioned&&y.action_label&&e.jsx("button",{onClick:_=>S(_,y),style:{padding:"4px 12px",fontSize:"12px",fontWeight:"500",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:y.action_label}),y.notification_type==="info"&&e.jsxs("button",{onClick:_=>T(_,y),style:{padding:"4px 8px",fontSize:"12px",backgroundColor:"transparent",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(oe,{size:12}),"Dismiss"]}),y.is_actioned&&e.jsxs("span",{style:{padding:"4px 8px",fontSize:"12px",color:"#10b981",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(st,{size:12}),"Completed"]})]})]})]})},y.id))}),a.length>10&&e.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:e.jsx("button",{onClick:()=>{r("/workflow-summary"),s(!1)},style:{background:"none",border:"none",color:"#3b82f6",fontSize:"13px",fontWeight:"500",cursor:"pointer"},children:"View all notifications"})})]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})}const m={ADMIN:"admin",SUPPLIER_PM:"supplier_pm",CUSTOMER_PM:"customer_pm",CONTRIBUTOR:"contributor",VIEWER:"viewer"},ys=[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.CONTRIBUTOR,m.VIEWER],ae=ys,re=[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM],A=[m.ADMIN,m.SUPPLIER_PM],de=[m.ADMIN,m.CUSTOMER_PM],ne=[m.ADMIN,m.SUPPLIER_PM,m.CONTRIBUTOR],Ie=[m.ADMIN],xs={timesheets:{view:ae,create:ne,createForOthers:A,edit:ne,delete:A,submit:ne,approve:de},expenses:{view:ae,create:ne,createForOthers:A,edit:ne,delete:A,submit:ne,validateChargeable:de,validateNonChargeable:A},milestones:{view:ae,create:A,edit:A,delete:Ie,useGantt:A},deliverables:{view:ae,create:[...re,m.CONTRIBUTOR],edit:[...re,m.CONTRIBUTOR],delete:A,submit:ne,review:de,markDelivered:de},kpis:{view:ae,create:A,edit:A,delete:A,manage:A},qualityStandards:{view:ae,create:A,edit:A,delete:A,manage:A},resources:{view:ae,create:A,edit:A,delete:Ie,manage:A,seeCostPrice:A,seeResourceType:A,seeMargins:A},partners:{view:A,create:A,edit:A,delete:A,manage:A},certificates:{view:re,create:re,signAsSupplier:A,signAsCustomer:de},invoices:{view:re,generateCustomer:re,generateThirdParty:A,viewMargins:A},settings:{access:A,edit:A},users:{view:A,manage:Ie},reports:{access:re,viewWorkflowSummary:re}};function Ea(n,s,t){const r=xs[s];if(!r)return!1;const a=r[t];return a?a.includes(n):!1}const bs={[m.ADMIN]:{label:"Admin",color:"#7c3aed",bg:"#f3e8ff"},[m.SUPPLIER_PM]:{label:"Supplier PM",color:"#059669",bg:"#d1fae5"},[m.CUSTOMER_PM]:{label:"Customer PM",color:"#d97706",bg:"#fef3c7"},[m.CONTRIBUTOR]:{label:"Contributor",color:"#2563eb",bg:"#dbeafe"},[m.VIEWER]:{label:"Viewer",color:"#64748b",bg:"#f1f5f9"}},Ra=Object.entries(bs).map(([n,s])=>({value:n,...s})),ve={workflowSummary:{id:"workflowSummary",path:"/workflow-summary",icon:lr,label:"Workflow Summary",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.CONTRIBUTOR],readOnlyRoles:[]},dashboard:{id:"dashboard",path:"/dashboard",icon:or,label:"Dashboard",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.VIEWER],readOnlyRoles:[m.VIEWER]},reports:{id:"reports",path:"/reports",icon:at,label:"Reports",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM],readOnlyRoles:[]},gantt:{id:"gantt",path:"/gantt",icon:ir,label:"Gantt Chart",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.VIEWER],readOnlyRoles:[m.VIEWER,m.CUSTOMER_PM]},milestones:{id:"milestones",path:"/milestones",icon:nr,label:"Milestones",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.VIEWER],readOnlyRoles:[m.VIEWER]},deliverables:{id:"deliverables",path:"/deliverables",icon:Te,label:"Deliverables",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.CONTRIBUTOR,m.VIEWER],readOnlyRoles:[m.VIEWER]},kpis:{id:"kpis",path:"/kpis",icon:Me,label:"KPIs",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.VIEWER],readOnlyRoles:[m.VIEWER,m.CUSTOMER_PM]},qualityStandards:{id:"qualityStandards",path:"/quality-standards",icon:pe,label:"Quality Standards",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.VIEWER],readOnlyRoles:[m.VIEWER,m.CUSTOMER_PM]},resources:{id:"resources",path:"/resources",icon:ar,label:"Resources",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[]},timesheets:{id:"timesheets",path:"/timesheets",icon:me,label:"Timesheets",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.CONTRIBUTOR],readOnlyRoles:[]},expenses:{id:"expenses",path:"/expenses",icon:nt,label:"Expenses",allowedRoles:[m.ADMIN,m.SUPPLIER_PM,m.CUSTOMER_PM,m.CONTRIBUTOR],readOnlyRoles:[]},partners:{id:"partners",path:"/partners",icon:sr,label:"Partners",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[]},users:{id:"users",path:"/users",icon:rr,label:"Users",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[m.SUPPLIER_PM]},settings:{id:"settings",path:"/settings",icon:tr,label:"Settings",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[]},auditLog:{id:"auditLog",path:"/audit-log",icon:er,label:"Audit Log",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[]},deletedItems:{id:"deletedItems",path:"/deleted-items",icon:Zt,label:"Deleted Items",allowedRoles:[m.ADMIN,m.SUPPLIER_PM],readOnlyRoles:[]}},ge={[m.ADMIN]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[m.SUPPLIER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","resources","timesheets","expenses","partners","users","settings","auditLog","deletedItems"],[m.CUSTOMER_PM]:["workflowSummary","dashboard","reports","gantt","milestones","deliverables","kpis","qualityStandards","timesheets","expenses"],[m.CONTRIBUTOR]:["workflowSummary","timesheets","expenses","deliverables"],[m.VIEWER]:["dashboard","gantt","milestones","deliverables","kpis","qualityStandards"]};function vs(n){return(ge[n]||ge[m.VIEWER]).map(t=>ve[t]?.path).filter(Boolean)}function xt(n){return(ge[n]||ge[m.VIEWER]).map(t=>ve[t]).filter(t=>t&&t.allowedRoles.includes(n))}function Ye(n,s){const t=ve[s];return t?t.readOnlyRoles?.includes(n)||!1:!0}function _s(n){return n!==m.VIEWER}function ws(n){return Object.values(ve).find(s=>s.path===n)||null}function js(n){return ws(n)?.id||null}function Ss(n,s){const t=xt(n);if(!s||!Array.isArray(s)||s.length===0)return t;const r={};t.forEach(i=>{r[i.path]=i});const a=[];return s.forEach(i=>{r[i]&&(a.push(r[i]),delete r[i])}),Object.values(r).forEach(i=>{a.push(i)}),a}function Ns(n,s){if(!s||s.length===0)return!0;const t=vs(n);return s.length!==t.length?!1:s.every((r,a)=>r===t[a])}const Xe={[m.ADMIN]:{label:"Administrator",shortLabel:"Admin",color:"#7c3aed",bg:"#f3e8ff",description:"Full system access"},[m.SUPPLIER_PM]:{label:"Supplier PM",shortLabel:"Supplier PM",color:"#059669",bg:"#d1fae5",description:"Manage resources, partners, and invoices"},[m.CUSTOMER_PM]:{label:"Customer PM",shortLabel:"Customer PM",color:"#d97706",bg:"#fef3c7",description:"Approve timesheets and validate expenses"},[m.CONTRIBUTOR]:{label:"Contributor",shortLabel:"Contributor",color:"#2563eb",bg:"#dbeafe",description:"Submit timesheets and expenses"},[m.VIEWER]:{label:"Viewer",shortLabel:"Viewer",color:"#64748b",bg:"#f1f5f9",description:"Read-only access to reports"}};function Cs(n){return Xe[n]||Xe[m.VIEWER]}function ks({children:n}){const s=Tt(),t=ze(),{showSuccess:r,showError:a}=hs(),{user:i,profile:o,role:d,signOut:c}=be(),[h,x]=l.useState(!0),[b,v]=l.useState(null),[E,L]=l.useState(null),[S,T]=l.useState(null),M=l.useRef(null),V=l.useMemo(()=>Cs(d),[d]),q=l.useMemo(()=>o&&(o.full_name||o.email||i?.email)||"User",[o,i]),y=l.useMemo(()=>{if(!o)return"U";if(o.full_name){const w=o.full_name.split(" ");return w.length>=2?w[0][0]+w[w.length-1][0]:o.full_name[0].toUpperCase()}return q[0].toUpperCase()},[o,q]);l.useEffect(()=>{o?.nav_order&&Array.isArray(o.nav_order)&&v(o.nav_order)},[o]);async function _(){await c(),t("/login")}const N=l.useMemo(()=>_s(d),[d]),j=l.useMemo(()=>b&&!Ns(d,b),[d,b]),p=l.useMemo(()=>{const w=xt(d);return b&&b.length>0?Ss(d,b):w},[d,b]),g=l.useMemo(()=>{const w=js(s.pathname);return w?Ye(d,w):!1},[d,s.pathname]);function I(w,O){N&&(M.current=w.target,L(O),setTimeout(()=>{M.current&&(M.current.style.opacity="0.5")},0))}function R(w,O){N&&O!==E&&T(O)}function k(w){N&&w.preventDefault()}function C(){if(N){if(M.current&&(M.current.style.opacity="1"),E!==null&&S!==null&&E!==S){const w=[...p],O=w[E];w.splice(E,1),w.splice(S,0,O);const X=w.map(Y=>Y.path);v(X),$(X)}L(null),T(null),M.current=null}}async function $(w){if(i)try{const{error:O}=await u.from("profiles").update({nav_order:w}).eq("id",i.id);O&&a("Failed to save menu order")}catch{a("Failed to save menu order")}}async function Q(){if(i)try{const{error:w}=await u.from("profiles").update({nav_order:null}).eq("id",i.id);if(w){a("Failed to reset menu order");return}v(null),r("Menu order reset to default")}catch{a("Failed to reset menu order")}}return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",backgroundColor:"#f8fafc"},children:[e.jsxs("aside",{style:{width:h?"260px":"70px",backgroundColor:"white",borderRight:"1px solid #e2e8f0",transition:"width 0.3s ease",display:"flex",flexDirection:"column",position:"fixed",height:"100vh",zIndex:50},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[h&&e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.125rem",fontWeight:"700",color:"#0f172a"},children:"AMSF001"}),e.jsx("span",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Project Tracker"})]}),e.jsx("button",{onClick:()=>x(!h),style:{padding:"0.5rem",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:h?e.jsx(oe,{size:20}):e.jsx(cr,{size:20})})]}),e.jsx("nav",{style:{flex:1,padding:"0.5rem",overflowY:"auto"},children:p.map((w,O)=>{const X=w.icon,Y=s.pathname===w.path||w.path!=="/dashboard"&&s.pathname.startsWith(w.path),W=E===O,U=S===O,P=Ye(d,w.id);return e.jsx("div",{draggable:N,onDragStart:f=>I(f,O),onDragEnter:f=>R(f,O),onDragOver:k,onDragEnd:C,style:{position:"relative",marginBottom:"0.25rem",borderTop:U&&E>O?"2px solid #10b981":"2px solid transparent",borderBottom:U&&E<O?"2px solid #10b981":"2px solid transparent",transition:"border-color 0.15s ease"},children:e.jsxs(J,{to:w.path,style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:h?"0.75rem 1rem":"0.75rem",borderRadius:"8px",textDecoration:"none",color:Y?"#10b981":"#64748b",backgroundColor:Y?"#f0fdf4":W?"#f1f5f9":"transparent",fontWeight:Y?"600":"500",justifyContent:h?"flex-start":"center",transition:"all 0.15s ease",cursor:N?"grab":"pointer"},children:[h&&N&&e.jsx(dr,{size:14,style:{color:"#cbd5e1",marginRight:"-0.25rem",flexShrink:0}}),e.jsx(X,{size:20}),h&&e.jsx("span",{style:{flex:1},children:w.label}),h&&P&&e.jsx("span",{style:{fontSize:"0.6rem",padding:"0.125rem 0.375rem",backgroundColor:"#f1f5f9",color:"#64748b",borderRadius:"4px",fontWeight:"500"},children:"VIEW"})]})},w.path)})}),h&&N&&j&&e.jsx("div",{style:{padding:"0.5rem 1rem",borderTop:"1px solid #e2e8f0"},children:e.jsxs("button",{onClick:Q,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",fontSize:"0.75rem",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:w=>{w.currentTarget.style.backgroundColor="#f1f5f9",w.currentTarget.style.color="#475569"},onMouseLeave:w=>{w.currentTarget.style.backgroundColor="#f8fafc",w.currentTarget.style.color="#64748b"},children:[e.jsx(ur,{size:14}),"Reset Menu Order"]})}),e.jsx("div",{style:{padding:"1rem",borderTop:"1px solid #e2e8f0",backgroundColor:"#f8fafc"},children:e.jsxs("button",{onClick:_,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:h?"flex-start":"center",gap:"0.75rem",padding:"0.75rem",backgroundColor:"#fef2f2",color:"#ef4444",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:[e.jsx(mr,{size:20}),h&&e.jsx("span",{children:"Logout"})]})})]}),e.jsxs("main",{style:{flex:1,marginLeft:h?"260px":"70px",transition:"margin-left 0.3s ease",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{style:{padding:"0.75rem 1.5rem",backgroundColor:"white",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"1rem",position:"sticky",top:0,zIndex:40},children:[e.jsxs(J,{to:"/account",style:{display:"flex",alignItems:"center",gap:"0.75rem",paddingRight:"1rem",borderRight:"1px solid #e2e8f0",textDecoration:"none",cursor:"pointer",borderRadius:"8px",padding:"0.5rem 1rem 0.5rem 0.75rem",marginRight:"0",transition:"background-color 0.15s ease"},onMouseEnter:w=>w.currentTarget.style.backgroundColor="#f8fafc",onMouseLeave:w=>w.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#1e293b"},children:q}),e.jsx("span",{style:{display:"inline-block",padding:"0.125rem 0.5rem",backgroundColor:V.bg,color:V.color,borderRadius:"4px",fontSize:"0.65rem",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.025em"},children:V.shortLabel})]}),e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:V.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"0.8rem"},children:y})]}),e.jsx(gs,{})]}),g&&e.jsxs("div",{style:{padding:"0.5rem 1.5rem",backgroundColor:"#f1f5f9",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e.jsx("span",{children:"You have read-only access to this page"})]}),e.jsx("div",{style:{flex:1},children:n})]})]})}function Es(){const n=ze(),[s]=qt(),[t,r]=l.useState(!1),[a,i]=l.useState(""),[o,d]=l.useState(""),[c,h]=l.useState(null),[x,b]=l.useState(null),[v,E]=l.useState(!1),[L,S]=l.useState(!1),[T,M]=l.useState(!1),[V,q]=l.useState(!1);l.useEffect(()=>{s.get("expired")==="true"&&(q(!0),window.history.replaceState({},document.title,"/login")),u.auth.getSession().then(({data:{session:g}})=>{g&&n("/dashboard",{replace:!0})});const{data:{subscription:p}}=u.auth.onAuthStateChange((g,I)=>{g==="SIGNED_IN"&&I&&n("/dashboard",{replace:!0})});return()=>p.unsubscribe()},[n,s]);const y=async p=>{p.preventDefault(),r(!0),h(null),b(null),q(!1);try{if(v){const{error:g}=await u.auth.signUp({email:a,password:o,options:{data:{full_name:a.split("@")[0]}}});if(g)throw g;b("Check your email for confirmation link!")}else{const{error:g}=await u.auth.signInWithPassword({email:a,password:o});if(g)throw g}}catch(g){h(g.message)}finally{r(!1)}},_=async p=>{if(p.preventDefault(),!a){h("Please enter your email address");return}r(!0),h(null),b(null);try{const{error:g}=await u.auth.resetPasswordForEmail(a,{redirectTo:`${window.location.origin}/reset-password`});if(g)throw g;b("Password reset email sent! Check your inbox.")}catch(g){h(g.message)}finally{r(!1)}},N=async p=>{if(p.preventDefault(),!a){h("Please enter your email address");return}r(!0),h(null),b(null);try{const{error:g}=await u.auth.resend({type:"signup",email:a});if(g)throw g;b("Verification email resent! Check your inbox.")}catch(g){h(g.message)}finally{r(!1)}},j=()=>{S(!1),M(!1),h(null),b(null),q(!1)};return L?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(hr,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Reset Password"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to receive a reset link"})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:p=>i(p.target.value),required:!0})]}),c&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(ke,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),x&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:x})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Send Reset Link"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"â† Back to Sign In"})})]})}):T?e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx(fe,{size:40,style:{color:"var(--primary)",marginBottom:"0.5rem"}}),e.jsx("h1",{className:"auth-title",children:"Resend Verification"}),e.jsx("p",{className:"auth-subtitle",children:"Enter your email to resend the verification link"})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:p=>i(p.target.value),required:!0})]}),c&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(ke,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),x&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:x})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Sending...":"Resend Verification Email"})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{onClick:j,style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:"â† Back to Sign In"})})]})}):e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-box",children:[e.jsxs("div",{className:"auth-logo",children:[e.jsx("h1",{className:"auth-title",children:"AMSF001 Tracker"}),e.jsx("p",{className:"auth-subtitle",children:"Network Architecture Services Project"})]}),V&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fef3c7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",border:"1px solid #fcd34d"},children:[e.jsx(me,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:"Your session has expired. Please sign in again."})]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",className:"form-input",type:"email",placeholder:"you@example.com",value:a,onChange:p=>i(p.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",className:"form-input",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:o,onChange:p=>d(p.target.value),required:!0})]}),c&&e.jsxs("div",{style:{padding:"0.75rem",background:"#fee2e2",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#991b1b"},children:[e.jsx(ke,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:c})]}),x&&e.jsxs("div",{style:{padding:"0.75rem",background:"#dcfce7",borderRadius:"0.5rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#166534"},children:[e.jsx(Ee,{size:20}),e.jsx("span",{style:{fontSize:"0.875rem"},children:x})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t,style:{width:"100%",justifyContent:"center"},children:t?"Loading...":v?"Sign Up":"Sign In"})]}),!v&&e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{S(!0),h(null),b(null),q(!1)},style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.85rem",textDecoration:"underline"},children:"Forgot your password?"})}),e.jsx("div",{style:{marginTop:"1rem",textAlign:"center"},children:e.jsx("button",{onClick:()=>{E(!v),h(null),b(null),q(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.875rem"},children:v?"Already have an account? Sign In":"Don't have an account? Sign Up"})}),e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:"Haven't received your verification email?"}),e.jsxs("button",{onClick:()=>{M(!0),h(null),b(null),q(!1)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"0.85rem",display:"inline-flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(fe,{size:14})," Resend Verification Email"]})]})]})})}const Rs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ps(n){return n==null?"":typeof n!="string"?String(n):n.replace(/[&<>"'`=\/]/g,s=>Rs[s])}function $e(n,s={}){const{maxLength:t=1e4,trim:r=!0,normalizeWhitespace:a=!0}=s;if(n==null)return"";typeof n!="string"&&(n=String(n));let i=n;return i=i.replace(/\0/g,""),i=i.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),r&&(i=i.trim()),a&&(i=i.replace(/[ \t]+/g," ")),i.length>t&&(i=i.substring(0,t)),i}function ye(n,s=255){return n==null?"":(typeof n!="string"&&(n=String(n)),$e(n,{maxLength:s}).replace(/[\r\n]/g," ").replace(/\s+/g," ").trim())}function bt(n,s=1e4){return n==null?"":(typeof n!="string"&&(n=String(n)),$e(n,{maxLength:s,normalizeWhitespace:!1}).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`).trim())}function vt(n){return n?ye(n,254).toLowerCase():""}function _e(n,s={}){const{min:t=-1/0,max:r=1/0,decimals:a=2}=s;if(n==null||n==="")return null;let i=String(n).replace(/[^0-9.\-]/g,""),o=parseFloat(i);return isNaN(o)?null:(o=Math.max(t,Math.min(r,o)),o=Math.round(o*Math.pow(10,a))/Math.pow(10,a),o)}function Is(n){const s=_e(n,{min:0,decimals:2});return s!==null?Math.round(s*100)/100:null}function Ds(n){const s=_e(n,{min:0,max:24,decimals:1});return s===null?null:Math.round(s*2)/2}function As(n){return _e(n,{min:0,max:100,decimals:1})}function Ms(n){if(!n)return null;const s=String(n).trim();return/^(javascript|data|vbscript):/i.test(s)?null:/^(https?:\/\/|\/|#)/i.test(s)?s:`https://${s}`}function Ts(n,s={}){if(!n||typeof n!="object")return n;const t={...n};for(const[r,a]of Object.entries(s)){if(t[r]===void 0)continue;const{type:i="text",maxLength:o}=a;switch(i){case"singleLine":t[r]=ye(t[r],o);break;case"multiLine":t[r]=bt(t[r],o);break;case"email":t[r]=vt(t[r]);break;case"number":t[r]=_e(t[r],a);break;case"currency":t[r]=Is(t[r]);break;case"hours":t[r]=Ds(t[r]);break;case"percentage":t[r]=As(t[r]);break;case"url":t[r]=Ms(t[r]);break;case"html":t[r]=Ps(t[r]);break;default:t[r]=$e(t[r],{maxLength:o})}}return t}const qs={timesheet:{description:{type:"multiLine",maxLength:2e3},hours_worked:{type:"hours"}},expense:{reason:{type:"multiLine",maxLength:2e3},amount:{type:"currency"}},resource:{name:{type:"singleLine",maxLength:100},email:{type:"email"},role:{type:"singleLine",maxLength:100},notes:{type:"multiLine",maxLength:5e3}},partner:{name:{type:"singleLine",maxLength:200},contact_name:{type:"singleLine",maxLength:100},contact_email:{type:"email"},notes:{type:"multiLine",maxLength:5e3}},milestone:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},deliverable:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3}},kpi:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"number",decimals:2},actual_value:{type:"number",decimals:2}},qualityStandard:{name:{type:"singleLine",maxLength:200},description:{type:"multiLine",maxLength:5e3},target_value:{type:"percentage"}}};function Je(n,s){const t=qs[n];return t?Ts(s,t):s}class te{constructor(s,t={}){this.tableName=s,this.supportsSoftDelete=t.supportsSoftDelete!==!1,this.sanitizeConfig=t.sanitizeConfig||null}getSoftDeleteFilter(){return this.supportsSoftDelete?"is_deleted.is.null,is_deleted.eq.false":null}async getAll(s,t={}){try{let r=u.from(this.tableName).select(t.select||"*").eq("project_id",s);this.supportsSoftDelete&&!t.includeDeleted&&(r=r.or(this.getSoftDeleteFilter())),t.filters&&Array.isArray(t.filters)&&t.filters.forEach(o=>{const{column:d,operator:c,value:h}=o;switch(c){case"eq":r=r.eq(d,h);break;case"neq":r=r.neq(d,h);break;case"gt":r=r.gt(d,h);break;case"gte":r=r.gte(d,h);break;case"lt":r=r.lt(d,h);break;case"lte":r=r.lte(d,h);break;case"like":r=r.like(d,h);break;case"ilike":r=r.ilike(d,h);break;case"in":r=r.in(d,h);break;case"is":r=r.is(d,h);break;default:r=r.eq(d,h)}}),t.orderBy&&(r=r.order(t.orderBy.column,{ascending:t.orderBy.ascending??!0}));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getDeleted(s){if(!this.supportsSoftDelete)return[];try{const{data:t,error:r}=await u.from(this.tableName).select("*").eq("project_id",s).eq("is_deleted",!0).order("deleted_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){throw t}}async getById(s,t={}){try{let r=u.from(this.tableName).select(t.select||"*").eq("id",s);this.supportsSoftDelete&&!t.includeDeleted&&(r=r.or(this.getSoftDeleteFilter()));const{data:a,error:i}=await r.limit(1);if(i)throw i;return a&&a.length>0?a[0]:null}catch(r){throw r}}async create(s){try{if(!s.project_id)throw new Error("project_id is required");let t=s;this.sanitizeConfig&&(t=Je(this.sanitizeConfig,s)),this.supportsSoftDelete&&(delete t.is_deleted,delete t.deleted_at,delete t.deleted_by);const{data:r,error:a}=await u.from(this.tableName).insert(t).select();if(a)throw a;if(!r||r.length===0)throw new Error("Failed to create record - no data returned");return r[0]}catch(t){throw t}}async update(s,t){try{let r=t;this.sanitizeConfig&&(r=Je(this.sanitizeConfig,t));const a={...r,updated_at:new Date().toISOString()};delete a.is_deleted,delete a.deleted_at,delete a.deleted_by;const{data:i,error:o}=await u.from(this.tableName).update(a).eq("id",s).select();if(o)throw o;if(!i||i.length===0)throw new Error(`No record found with id: ${s}`);return i[0]}catch(r){throw r}}async delete(s,t=null){try{if(this.supportsSoftDelete){const{error:r}=await u.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",s);if(r)throw r}else{const{error:r}=await u.from(this.tableName).delete().eq("id",s);if(r)throw r}return!0}catch(r){throw r}}async hardDelete(s){try{const{error:t}=await u.from(this.tableName).delete().eq("id",s);if(t)throw t;return!0}catch(t){throw t}}async restore(s){if(!this.supportsSoftDelete)throw new Error("This entity does not support soft delete");try{const{data:t,error:r}=await u.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",s).select();if(r)throw r;if(!t||t.length===0)throw new Error(`No record found with id: ${s}`);return t[0]}catch(t){throw t}}async exists(s){try{let t=u.from(this.tableName).select("id",{count:"exact",head:!0}).eq("id",s);this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{count:r,error:a}=await t;if(a)throw a;return r>0}catch(t){throw t}}async count(s,t=[]){try{let r=u.from(this.tableName).select("id",{count:"exact",head:!0}).eq("project_id",s);this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter())),t.forEach(o=>{const{column:d,operator:c,value:h}=o;c==="eq"?r=r.eq(d,h):c==="in"&&(r=r.in(d,h))});const{count:a,error:i}=await r;if(i)throw i;return a||0}catch(r){throw r}}}class Os extends te{constructor(){super("partners")}async getAll(s){return super.getAll(s,{orderBy:{column:"name",ascending:!0}})}async getActive(s){return super.getAll(s,{filters:[{column:"is_active",operator:"eq",value:!0}],orderBy:{column:"name",ascending:!0}})}async getWithResources(s){try{const{data:t,error:r}=await u.from("partners").select(`
          *,
          resources (
            id,
            name,
            daily_rate,
            cost_price,
            is_active
          )
        `).eq("id",s).limit(1);if(r)throw r;return t?.[0]||null}catch(t){throw t}}async getSummary(s){try{const{data:t,error:r}=await u.from("partners").select(`
          id,
          name,
          contact_name,
          contact_email,
          payment_terms,
          is_active,
          created_at
        `).eq("project_id",s).order("name",{ascending:!0});if(r)throw r;return t||[]}catch(t){throw t}}async create(s){if(!s.name?.trim())throw new Error("Partner name is required");if(await this.findByName(s.project_id,s.name))throw new Error(`Partner "${s.name}" already exists`);return super.create({...s,name:s.name.trim(),is_active:s.is_active??!0,payment_terms:s.payment_terms||"Net 30"})}async findByName(s,t){try{const{data:r,error:a}=await u.from("partners").select("*").eq("project_id",s).ilike("name",t.trim()).limit(1);if(a)throw a;return r?.[0]||null}catch(r){throw r}}async toggleActive(s){const t=await this.getById(s);if(!t)throw new Error("Partner not found");return this.update(s,{is_active:!t.is_active})}async getForSelect(s,t=!0){return(t?await this.getActive(s):await this.getAll(s)).map(a=>({value:a.id,label:a.name}))}async getDependencyCounts(s){try{const{data:t,error:r}=await u.from("resources").select("id").eq("partner_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(r)throw r;const a=t?.map(h=>h.id)||[];let i=0,o=0;if(a.length>0){const{count:h,error:x}=await u.from("timesheets").select("*",{count:"exact",head:!0}).in("resource_id",a).or("is_deleted.is.null,is_deleted.eq.false");if(x)throw x;i=h||0;const{count:b,error:v}=await u.from("expenses").select("*",{count:"exact",head:!0}).in("resource_id",a).or("is_deleted.is.null,is_deleted.eq.false");if(v)throw v;o=b||0}const{count:d,error:c}=await u.from("partner_invoices").select("*",{count:"exact",head:!0}).eq("partner_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(c)throw c;return{resourceCount:t?.length||0,timesheetCount:i,expenseCount:o,invoiceCount:d||0,canDelete:!t?.length&&!d}}catch(t){throw t}}}const Pa=new Os;class Ls extends te{constructor(){super("resources",{sanitizeConfig:"resource",supportsSoftDelete:!0})}sanitizeData(s){const t={...s};return t.name&&(t.name=ye(t.name,100)),t.role&&(t.role=ye(t.role,100)),t.email&&(t.email=vt(t.email)),t.notes&&(t.notes=bt(t.notes,5e3)),t}async getAll(s,t={}){const{includePartner:r=!0,activeOnly:a=!1,showTestUsers:i=!0,includeDeleted:o=!1}=t;let d="*";r&&(d="*, partner:partners(id, name, is_active)");let c=u.from(this.tableName).select(d).eq("project_id",s).order("name");o||(c=c.or("is_deleted.is.null,is_deleted.eq.false")),a&&(c=c.eq("is_active",!0)),i||(c=c.or("is_test_content.is.null,is_test_content.eq.false"));const{data:h,error:x}=await c;if(x)throw x;return h||[]}async getAllFiltered(s,t=!0){return this.getAll(s,{showTestUsers:t,includePartner:!0})}async getById(s){const{data:t,error:r}=await u.from(this.tableName).select("*, partner:partners(id, name, contact_name, contact_email, is_active)").eq("id",s).or("is_deleted.is.null,is_deleted.eq.false").single();if(r)throw r;return t}async getByType(s,t){const{data:r,error:a}=await u.from(this.tableName).select("*, partner:partners(id, name)").eq("project_id",s).eq("resource_type",t).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(a)throw a;return r||[]}async getByPartner(s){const{data:t,error:r}=await u.from(this.tableName).select("*").eq("partner_id",s).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(r)throw r;return t||[]}async getWithTimesheetSummary(s){const t=await this.getById(s);if(!t)return null;const{data:r,error:a}=await u.from("timesheets").select("id, hours_worked, hours, status, was_rejected, date").eq("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false");let i=0,o=0,d=0;return r&&r.forEach(c=>{const h=parseFloat(c.hours_worked||c.hours||0);i+=h,c.status==="Approved"?o+=h:c.status==="Submitted"&&!c.was_rejected&&(d+=h)}),{...t,timesheetSummary:{totalEntries:r?.length||0,totalHours:i,approvedHours:o,pendingHours:d,daysWorked:i/8}}}async create(s){const t=this.sanitizeData(s);if(!t.name?.trim())throw new Error("Resource name is required");if(!t.project_id)throw new Error("Project ID is required");if(!t.email?.trim())throw new Error("Email is required");t.resource_type==="internal"&&(t.partner_id=null);const{data:r,error:a}=await u.from(this.tableName).insert([t]).select("*, partner:partners(id, name)").single();if(a)throw a;return r}async update(s,t){const r=this.sanitizeData(t);r.resource_type==="internal"&&(r.partner_id=null),r.updated_at=new Date().toISOString();const{data:a,error:i}=await u.from(this.tableName).update(r).eq("id",s).select("*, partner:partners(id, name)").single();if(i)throw i;return a}async delete(s,t=null){const{data:r,error:a}=await u.from(this.tableName).update({is_deleted:!0,deleted_at:new Date().toISOString(),deleted_by:t}).eq("id",s).select().single();if(a)throw a;return r}async restore(s){const{data:t,error:r}=await u.from(this.tableName).update({is_deleted:!1,deleted_at:null,deleted_by:null}).eq("id",s).select().single();if(r)throw r;return t}async linkToPartner(s,t){const r={partner_id:t,resource_type:t?"third_party":"internal",updated_at:new Date().toISOString()};return this.update(s,r)}async toggleActive(s){const t=await this.getById(s);if(!t)throw new Error("Resource not found");return this.update(s,{is_active:!t.is_active})}async getForSelect(s){const{data:t,error:r}=await u.from(this.tableName).select("id, name, resource_type, role").eq("project_id",s).or("is_deleted.is.null,is_deleted.eq.false").order("name");if(r)throw r;return t||[]}calculateMargin(s,t){if(!s||s===0||!t)return{percent:null,amount:null,status:"unknown"};const r=(s-t)/s*100,a=s-t;let i="critical";return r>=25?i="good":r>=10&&(i="low"),{percent:r,amount:a,status:i}}async getUtilization(s){const t=await this.getWithTimesheetSummary(s);if(!t)return null;const r=t.days_allocated||0,a=t.timesheetSummary.daysWorked,i=Math.max(0,r-a),o=r>0?a/r*100:0;return{resourceId:s,resourceName:t.name,daysAllocated:r,daysUsed:a,remaining:i,utilizationPercent:o,totalValue:(t.daily_rate||0)*r,valueUsed:(t.daily_rate||0)*a}}async getSummary(s){const t=await this.getAll(s,{includePartner:!1});return{total:t.length,internal:t.filter(r=>r.resource_type==="internal").length,thirdParty:t.filter(r=>r.resource_type==="third_party").length,active:t.filter(r=>r.is_active).length,totalBudget:t.reduce((r,a)=>r+(a.daily_rate||0)*(a.days_allocated||0),0)}}async getProfileByEmail(s){try{const{data:t,error:r}=await this.supabase.from("profiles").select("id, email, full_name, role").eq("email",s).single();if(r){if(r.code==="PGRST116")return null;throw r}return t}catch(t){throw t}}async getAllWithTestFilter(s,t=[]){try{const r=await this.getAll(s,{orderBy:{column:"name",ascending:!0}});return t&&t.length>0?r.filter(a=>!a.user_id||!t.includes(a.user_id)):r}catch(r){throw r}}async getDependencyCounts(s){try{const[t,r]=await Promise.all([this.supabase.from("timesheets").select("id",{count:"exact",head:!0}).eq("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false"),this.supabase.from("expenses").select("id",{count:"exact",head:!0}).eq("resource_id",s).or("is_deleted.is.null,is_deleted.eq.false")]);return{timesheetCount:t.count||0,expenseCount:r.count||0,canDelete:(t.count||0)===0&&(r.count||0)===0}}catch(t){throw t}}}const Ia=new Ls;class zs extends te{constructor(){super("timesheets",{supportsSoftDelete:!0,sanitizeConfig:"timesheet"})}async getAll(s,t={}){return super.getAll(s,{...t,select:t.select||`
      *,
      resources(id, name, email, daily_rate, cost_price),
      milestones(id, milestone_ref, name)
    `,orderBy:t.orderBy||{column:"date",ascending:!1}})}async getAllFiltered(s,t=!1){try{let r=u.from(this.tableName).select(`
          *,
          resources(id, name, email, daily_rate, cost_price),
          milestones(id, milestone_ref, name)
        `).eq("project_id",s).order("date",{ascending:!1});this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter())),t||(r=r.or("is_test_content.is.null,is_test_content.eq.false"));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getByResource(s,t={}){try{let r=u.from(this.tableName).select("*, milestones(id, milestone_ref, name)").eq("resource_id",s).order("date",{ascending:!1});this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter())),t.start&&(r=r.gte("date",t.start)),t.end&&(r=r.lte("date",t.end)),t.status&&(r=r.eq("status",t.status));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getByPartner(s,t={}){try{const{data:r}=await u.from("resources").select("id, name, cost_price").eq("partner_id",s).or("is_deleted.is.null,is_deleted.eq.false");if(!r||r.length===0)return[];const a=r.map(c=>c.id);let i=u.from(this.tableName).select("*, resources(id, name, cost_price), milestones(id, milestone_ref, name)").in("resource_id",a).order("date",{ascending:!1});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter())),t.start&&(i=i.gte("date",t.start)),t.end&&(i=i.lte("date",t.end)),t.status&&(i=i.eq("status",t.status));const{data:o,error:d}=await i;if(d)throw d;return o||[]}catch(r){throw r}}async getApprovedForInvoice(s,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(s,{...t,status:"Approved"})}async getSummary(s,t={}){try{const r=await this.getAll(s,t),a={totalHours:0,totalDays:0,approvedHours:0,pendingHours:0,draftHours:0,rejectedHours:0,totalCost:0,approvedCost:0,byStatus:{Draft:{count:0,hours:0},Submitted:{count:0,hours:0},Approved:{count:0,hours:0},Rejected:{count:0,hours:0}},byMilestone:{},count:r.length};return r.forEach(i=>{const o=parseFloat(i.hours_worked||i.hours||0),d=i.resources?.cost_price||0,c=o/8*d;switch(a.totalHours+=o,a.totalCost+=c,a.byStatus[i.status]&&(a.byStatus[i.status].count++,a.byStatus[i.status].hours+=o),i.status){case"Approved":a.approvedHours+=o,a.approvedCost+=c;break;case"Submitted":i.was_rejected||(a.pendingHours+=o);break;case"Draft":a.draftHours+=o;break;case"Rejected":a.rejectedHours+=o;break}if(i.milestone_id){const h=i.milestones?.milestone_ref||"Unknown";a.byMilestone[i.milestone_id]||(a.byMilestone[i.milestone_id]={ref:h,name:i.milestones?.name||"Unknown",hours:0,cost:0}),a.byMilestone[i.milestone_id].hours+=o,a.byMilestone[i.milestone_id].cost+=c}}),a.totalDays=a.totalHours/8,a}catch(r){throw r}}async create(s){if(!s.resource_id)throw new Error("resource_id is required");if(!s.date)throw new Error("date is required");const t=parseFloat(s.hours_worked||s.hours||0);if(!t||t<=0)throw new Error("hours must be greater than 0");const r={...s,hours_worked:t,hours:t,date:s.date||s.work_date,work_date:s.work_date||s.date,description:s.description||s.comments||"",comments:s.comments||s.description||"",status:s.status||"Draft"};return super.create(r)}async submit(s){return this.update(s,{status:"Submitted"})}async validate(s){return this.update(s,{status:"Approved"})}async approve(s){return this.validate(s)}async reject(s,t=null){const r={status:"Rejected",was_rejected:!0};return t&&(r.rejection_reason=t),this.update(s,r)}calculateCost(s,t){return s/8*t}calculateBillable(s,t){return s/8*t}}const Bs=new zs;class Us extends te{constructor(){super("expenses",{supportsSoftDelete:!0,sanitizeConfig:"expense"})}async getAll(s,t={}){return super.getAll(s,{...t,select:t.select||"*, expense_files(*)",orderBy:t.orderBy||{column:"expense_date",ascending:!1}})}async getAllFiltered(s,t=!1){try{let r=u.from(this.tableName).select("*, expense_files(*)").eq("project_id",s).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter())),t||(r=r.or("is_test_content.is.null,is_test_content.eq.false"));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getByResource(s,t={}){try{let r=u.from(this.tableName).select("*, expense_files(*)").eq("resource_id",s).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter())),t.start&&(r=r.gte("expense_date",t.start)),t.end&&(r=r.lte("expense_date",t.end));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getByPartner(s,t={}){try{const{data:r}=await u.from("resources").select("id").eq("partner_id",s);if(!r||r.length===0)return[];const a=r.map(c=>c.id);let i=u.from(this.tableName).select("*, expense_files(*)").in("resource_id",a).order("expense_date",{ascending:!1});this.supportsSoftDelete&&(i=i.or(this.getSoftDeleteFilter())),t.start&&(i=i.gte("expense_date",t.start)),t.end&&(i=i.lte("expense_date",t.end)),t.procurementMethod&&(i=i.eq("procurement_method",t.procurementMethod));const{data:o,error:d}=await i;if(d)throw d;return o||[]}catch(r){throw r}}async getPartnerProcuredForInvoice(s,t){if(!t.start||!t.end)throw new Error("Date range (start and end) is required for invoice queries");return this.getByPartner(s,{...t,procurementMethod:"partner"})}async getSummary(s,t={}){try{const r=await this.getAll(s,t),a={total:0,chargeable:0,nonChargeable:0,supplierProcured:0,partnerProcured:0,byCategory:{Travel:0,Accommodation:0,Sustenance:0},byStatus:{Draft:0,Submitted:0,Approved:0,Rejected:0,Paid:0},count:r.length};return r.forEach(i=>{const o=parseFloat(i.amount||0);a.total+=o,i.chargeable_to_customer!==!1?a.chargeable+=o:a.nonChargeable+=o,i.procurement_method==="partner"?a.partnerProcured+=o:a.supplierProcured+=o,a.byCategory[i.category]!==void 0&&(a.byCategory[i.category]+=o),a.byStatus[i.status]!==void 0&&(a.byStatus[i.status]+=o)}),a}catch(r){throw r}}async create(s){if(!s.resource_id)throw new Error("resource_id is required");if(!s.category)throw new Error("category is required");if(!s.amount||s.amount<=0)throw new Error("amount must be greater than 0");const t={...s,status:s.status||"Draft",chargeable_to_customer:s.chargeable_to_customer??!0,procurement_method:s.procurement_method||"supplier"};return super.create(t)}async createMany(s){if(!s||s.length===0)return[];try{const t=s.map(i=>{if(!i.resource_id)throw new Error("resource_id is required for all expenses");if(!i.category)throw new Error("category is required for all expenses");if(!i.amount||i.amount<=0)throw new Error("amount must be greater than 0 for all expenses");return{...i,status:i.status||"Draft",chargeable_to_customer:i.chargeable_to_customer??!0,procurement_method:i.procurement_method||"supplier"}}),{data:r,error:a}=await u.from(this.tableName).insert(t).select();if(a)throw a;return r||[]}catch(t){throw t}}async submit(s){return this.update(s,{status:"Submitted"})}async validate(s){return this.update(s,{status:"Approved"})}async approve(s){return this.validate(s)}async reject(s,t=null){const r={status:"Rejected"};return t&&(r.rejection_reason=t),this.update(s,r)}async markPaid(s){return this.update(s,{status:"Paid"})}async uploadReceipt(s,t,r){try{const a=`${s}/${Date.now()}-${t.name}`,{error:i}=await u.storage.from("receipts").upload(a,t);if(i)throw i;const{data:o,error:d}=await u.from("expense_files").insert({expense_id:s,file_name:t.name,file_path:a,file_size:t.size,file_type:t.type,uploaded_by:r}).select();if(d)throw d;return o?.[0]}catch(a){throw a}}async downloadReceipt(s){try{const{data:t,error:r}=await u.storage.from("receipts").download(s);if(r)throw r;return t}catch(t){throw t}}}const Da=new Us;class $s extends te{constructor(){super("partner_invoices")}async getAll(s,t={}){return super.getAll(s,{...t,select:t.select||"*, partners(name)",orderBy:t.orderBy||{column:"invoice_date",ascending:!1}})}async getByPartner(s,t={}){try{let r=u.from(this.tableName).select("*").eq("partner_id",s).order("invoice_date",{ascending:!1});t.status&&(r=r.eq("status",t.status));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async getWithLines(s){try{const{data:t,error:r}=await u.from(this.tableName).select("*, partners(name, contact_name, contact_email, payment_terms)").eq("id",s).limit(1);if(r)throw r;const a=t?.[0];if(!a)return null;const{data:i,error:o}=await u.from("partner_invoice_lines").select("*").eq("invoice_id",s).order("line_type",{ascending:!0}).order("resource_name",{ascending:!0}).order("line_date",{ascending:!0});if(o)throw o;const d={timesheets:(i||[]).filter(c=>c.line_type==="timesheet"),supplierExpenses:(i||[]).filter(c=>c.line_type==="supplier_expense"),partnerExpenses:(i||[]).filter(c=>c.line_type==="expense")};return{...a,lines:i||[],groupedLines:d}}catch(t){throw t}}async generateInvoiceNumber(s){try{const r=`INV-${new Date().getFullYear()}-`,{data:a,error:i}=await u.from(this.tableName).select("invoice_number").eq("project_id",s).like("invoice_number",`${r}%`).order("invoice_number",{ascending:!1}).limit(1);if(i)throw i;let o=1;if(a&&a.length>0){const d=a[0].invoice_number,c=parseInt(d.replace(r,""),10);isNaN(c)||(o=c+1)}return`${r}${String(o).padStart(3,"0")}`}catch(t){throw t}}async generateInvoice(s){const{projectId:t,partnerId:r,periodStart:a,periodEnd:i,createdBy:o,notes:d,includeSubmitted:c=!0}=s;try{const{data:h,error:x}=await u.from("resources").select("id, name, cost_price").eq("partner_id",r);if(x)throw x;if(!h||h.length===0)throw new Error("No resources linked to this partner");const b=h.map(f=>f.id),v={};h.forEach(f=>{v[f.id]=f});const E=c?["Approved","Submitted"]:["Approved"],{data:L,error:S}=await u.from("timesheets").select("id, date, hours_worked, hours, status, resource_id").in("resource_id",b).gte("date",a).lte("date",i).in("status",E);if(S)throw S;const{data:T,error:M}=await u.from("expenses").select("id, expense_date, category, reason, amount, resource_id, resource_name, procurement_method, chargeable_to_customer, status").in("resource_id",b).gte("expense_date",a).lte("expense_date",i).in("status",["Approved","Submitted","Paid"]);if(M)throw M;const V=(T||[]).filter(f=>f.procurement_method==="partner"||!f.procurement_method),q=(T||[]).filter(f=>f.procurement_method==="supplier");let y=0,_=0;const N=[],j={};(L||[]).forEach(f=>{j[f.resource_id]||(j[f.resource_id]=[]),j[f.resource_id].push(f)}),Object.keys(j).forEach(f=>{const B=v[f];j[f].forEach(F=>{const se=parseFloat(F.hours_worked||F.hours||0),le=B?.cost_price||0,he=se/8,ce=he*le;y+=ce,_+=ce,N.push({line_type:"timesheet",timesheet_id:F.id,expense_id:null,description:`${B?.name||"Unknown"} - ${se}h (${he.toFixed(2)} days)`,quantity:se,unit_price:le,line_total:ce,resource_name:B?.name,line_date:F.date,hours:se,cost_price:le,source_status:F.status,chargeable_to_customer:!0,procurement_method:null,expense_category:null})})});let p=0,g=0,I=0;const R=[];V.forEach(f=>{const B=parseFloat(f.amount||0);p+=B,f.chargeable_to_customer?g+=B:I+=B,R.push({line_type:"expense",timesheet_id:null,expense_id:f.id,description:`${f.resource_name} - ${f.category}: ${f.reason}`,quantity:1,unit_price:B,line_total:B,resource_name:f.resource_name,line_date:f.expense_date,hours:null,cost_price:null,source_status:f.status,chargeable_to_customer:f.chargeable_to_customer,procurement_method:"partner",expense_category:f.category})});let k=0,C=0,$=0;const Q=[];q.forEach(f=>{const B=parseFloat(f.amount||0);k+=B,f.chargeable_to_customer?C+=B:$+=B,Q.push({line_type:"supplier_expense",timesheet_id:null,expense_id:f.id,description:`${f.resource_name} - ${f.category}: ${f.reason}`,quantity:1,unit_price:B,line_total:B,resource_name:f.resource_name,line_date:f.expense_date,hours:null,cost_price:null,source_status:f.status,chargeable_to_customer:f.chargeable_to_customer,procurement_method:"supplier",expense_category:f.category})});const w=y+p,O=_+g+C,X=I+$,Y=await this.generateInvoiceNumber(t),{data:W,error:U}=await u.from(this.tableName).insert({project_id:t,partner_id:r,invoice_number:Y,invoice_date:new Date().toISOString().split("T")[0],period_start:a,period_end:i,timesheet_total:y,expense_total:p,supplier_expense_total:k,invoice_total:w,chargeable_total:O,non_chargeable_total:X,status:"Draft",notes:d||null,created_by:o}).select().single();if(U)throw U;const P=[...N,...R,...Q].map(f=>({...f,invoice_id:W.id}));if(P.length>0){const{error:f}=await u.from("partner_invoice_lines").insert(P);if(f)throw f}return this.getWithLines(W.id)}catch(h){throw h}}async updateStatus(s,t){const r={status:t};return t==="Sent"?r.sent_at=new Date().toISOString():t==="Paid"&&(r.paid_at=new Date().toISOString()),this.update(s,r)}async markSent(s){return this.updateStatus(s,"Sent")}async markPaid(s){return this.updateStatus(s,"Paid")}async cancel(s){return this.updateStatus(s,"Cancelled")}async getPartnerStats(s){try{const{data:t,error:r}=await u.from(this.tableName).select("status, invoice_total").eq("partner_id",s);if(r)throw r;const a={total:0,draft:0,sent:0,paid:0,cancelled:0,count:t?.length||0};return(t||[]).forEach(i=>{const o=parseFloat(i.invoice_total||0);switch(a.total+=o,i.status){case"Draft":a.draft+=o;break;case"Sent":a.sent+=o;break;case"Paid":a.paid+=o;break;case"Cancelled":a.cancelled+=o;break}}),a}catch(t){throw t}}}const Aa=new $s;class Ws extends te{constructor(){super("milestones",{supportsSoftDelete:!0,sanitizeConfig:"milestone"})}async getAllWithStats(s){try{const t=await this.getAll(s,{orderBy:{column:"start_date",ascending:!0}}),{data:r}=await u.from("timesheets").select("milestone_id, hours_worked").eq("project_id",s).not("milestone_id","is",null).or("is_deleted.is.null,is_deleted.eq.false"),a={};return(r||[]).forEach(i=>{a[i.milestone_id]||(a[i.milestone_id]=0),a[i.milestone_id]+=parseFloat(i.hours_worked||0)}),t.map(i=>({...i,logged_hours:a[i.id]||0,logged_days:(a[i.id]||0)/8}))}catch(t){throw t}}async getWithDeliverables(s){try{const{data:t,error:r}=await u.from(this.tableName).select("*").eq("id",s).or(this.getSoftDeleteFilter()).limit(1);if(r)throw r;const a=t?.[0],{data:i,error:o}=await u.from("deliverables").select("*").eq("milestone_id",s).or("is_deleted.is.null,is_deleted.eq.false").order("due_date",{ascending:!0});if(o)throw o;return{...a,deliverables:i||[]}}catch(t){throw t}}async getByStatus(s,t){return this.getAll(s,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"start_date",ascending:!0}})}async getUpcoming(s,t=30){try{const r=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+t);const i=a.toISOString().split("T")[0];let o=u.from(this.tableName).select("*").eq("project_id",s).gte("end_date",r).lte("end_date",i).neq("status","Completed").order("end_date",{ascending:!0});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter()));const{data:d,error:c}=await o;if(c)throw c;return d||[]}catch(r){throw r}}async updateStatus(s,t){return this.update(s,{status:t})}async updateCompletion(s,t){const r={completion_percentage:t};return t>=100&&(r.status="Completed"),this.update(s,r)}async getSummary(s){try{const t=await this.getAll(s),r={total:t.length,completed:0,inProgress:0,notStarted:0,overdue:0,upcoming:0},a=new Date().toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()+7);const o=i.toISOString().split("T")[0];return t.forEach(d=>{d.status==="Completed"?r.completed++:d.status==="In Progress"?(r.inProgress++,d.end_date<a&&r.overdue++):d.status==="Not Started"&&(r.notStarted++,d.start_date<=o&&r.upcoming++)}),r}catch(t){throw t}}async getCertificates(s){try{const{data:t,error:r}=await u.from("milestone_certificates").select("*").eq("project_id",s).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){throw t}}async createCertificate(s){try{const{data:t,error:r}=await u.from("milestone_certificates").insert([s]).select();if(r)throw r;return t?.[0]}catch(t){throw t}}async updateCertificate(s,t){try{const{data:r,error:a}=await u.from("milestone_certificates").update(t).eq("id",s).select();if(a)throw a;return r?.[0]}catch(r){throw r}}}const Fs=new Ws;class Vs extends te{constructor(){super("deliverables",{supportsSoftDelete:!0,sanitizeConfig:"deliverable"})}async getAllWithMilestones(s){return this.getAll(s,{select:"*, milestones(name, milestone_ref)",orderBy:{column:"due_date",ascending:!0}})}async getByMilestone(s){try{let t=u.from(this.tableName).select("*").eq("milestone_id",s).order("due_date",{ascending:!0});this.supportsSoftDelete&&(t=t.or(this.getSoftDeleteFilter()));const{data:r,error:a}=await t;if(a)throw a;return r||[]}catch(t){throw t}}async getByStatus(s,t){return this.getAll(s,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"due_date",ascending:!0}})}async getOverdue(s){try{const t=new Date().toISOString().split("T")[0];let r=u.from(this.tableName).select("*, milestones(name)").eq("project_id",s).lt("due_date",t).not("status","in",'("Delivered","Cancelled")').order("due_date",{ascending:!0});this.supportsSoftDelete&&(r=r.or(this.getSoftDeleteFilter()));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(t){throw t}}async getUpcoming(s,t=14){try{const r=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()+t);const i=a.toISOString().split("T")[0];let o=u.from(this.tableName).select("*, milestones(name)").eq("project_id",s).gte("due_date",r).lte("due_date",i).not("status","eq","Delivered").order("due_date",{ascending:!0});this.supportsSoftDelete&&(o=o.or(this.getSoftDeleteFilter()));const{data:d,error:c}=await o;if(c)throw c;return d||[]}catch(r){throw r}}async updateStatus(s,t,r){const a={status:t};return t==="Submitted"?(a.submitted_date=new Date().toISOString(),a.submitted_by=r):t==="Delivered"&&(a.delivered_date=new Date().toISOString(),a.delivered_by=r),this.update(s,a)}async submit(s,t){return this.updateStatus(s,"Submitted",t)}async markDelivered(s,t){return this.updateStatus(s,"Delivered",t)}async reject(s,t){return this.update(s,{status:"Rejected",rejection_reason:t})}async getSummary(s){try{const t=await this.getAll(s),r=new Date().toISOString().split("T")[0],a={total:t.length,delivered:0,inProgress:0,notStarted:0,overdue:0,dueThisWeek:0},i=new Date;i.setDate(i.getDate()+7);const o=i.toISOString().split("T")[0];return t.forEach(d=>{d.status==="Delivered"?a.delivered++:d.status==="In Progress"?(a.inProgress++,d.due_date<r?a.overdue++:d.due_date<=o&&a.dueThisWeek++):(d.status==="Not Started"||d.status==="Draft")&&(a.notStarted++,d.due_date<r&&a.overdue++)}),a}catch(t){throw t}}async getAllWithRelations(s,t=!1){try{let r=u.from("deliverables").select(`
          *,
          milestones(milestone_ref, name),
          deliverable_kpis(kpi_id, kpis(kpi_ref, name)),
          deliverable_quality_standards(quality_standard_id, quality_standards(qs_ref, name))
        `).eq("project_id",s).or("is_deleted.is.null,is_deleted.eq.false").order("deliverable_ref");t||(r=r.or("is_test_content.is.null,is_test_content.eq.false"));const{data:a,error:i}=await r;if(i)throw i;return a||[]}catch(r){throw r}}async syncKPILinks(s,t=[]){try{const{error:r}=await u.from("deliverable_kpis").delete().eq("deliverable_id",s);if(r)throw r;if(t.length>0){const a=t.map(o=>({deliverable_id:s,kpi_id:o})),{error:i}=await u.from("deliverable_kpis").insert(a);if(i)throw i}return!0}catch(r){throw r}}async syncQSLinks(s,t=[]){try{const{error:r}=await u.from("deliverable_quality_standards").delete().eq("deliverable_id",s);if(r)throw r;if(t.length>0){const a=t.map(o=>({deliverable_id:s,quality_standard_id:o})),{error:i}=await u.from("deliverable_quality_standards").insert(a);if(i)throw i}return!0}catch(r){throw r}}async upsertKPIAssessments(s,t,r){try{const a=t.map(o=>({deliverable_id:s,kpi_id:o.kpiId,criteria_met:o.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:r})),{error:i}=await u.from("deliverable_kpi_assessments").upsert(a,{onConflict:"deliverable_id,kpi_id"});if(i)throw i;return!0}catch(a){throw a}}async upsertQSAssessments(s,t,r){try{const a=t.map(o=>({deliverable_id:s,quality_standard_id:o.qsId,criteria_met:o.criteriaMet,assessed_at:new Date().toISOString(),assessed_by:r})),{error:i}=await u.from("deliverable_qs_assessments").upsert(a,{onConflict:"deliverable_id,quality_standard_id"});if(i)throw i;return!0}catch(a){throw a}}}const Hs=new Vs;class Ks extends te{constructor(){super("kpis")}async getAllWithStatus(s){try{return(await this.getAll(s,{orderBy:{column:"name",ascending:!0}})).map(r=>({...r,rag_status:this.calculateRAG(r)}))}catch(t){throw t}}calculateRAG(s){if(!s.target_value||s.actual_value===null||s.actual_value===void 0)return"Unknown";const t=parseFloat(s.actual_value),r=parseFloat(s.target_value),a=parseFloat(s.threshold_amber||10);return s.trend==="higher_better"?t>=r?"Green":t>=r*(1-a/100)?"Amber":"Red":t<=r?"Green":t<=r*(1+a/100)?"Amber":"Red"}async getByRAGStatus(s,t){try{return(await this.getAllWithStatus(s)).filter(a=>a.rag_status===t)}catch(r){throw r}}async getNeedingAttention(s){try{return(await this.getAllWithStatus(s)).filter(r=>r.rag_status==="Amber"||r.rag_status==="Red")}catch(t){throw t}}async updateActualValue(s,t){return this.update(s,{actual_value:t,last_updated:new Date().toISOString()})}async getHistory(s,t=12){try{const{data:r,error:a}=await u.from("kpi_history").select("*").eq("kpi_id",s).order("recorded_at",{ascending:!1}).limit(t);if(a)throw a;return r||[]}catch{return[]}}async getSummary(s){try{const t=await this.getAllWithStatus(s);return{total:t.length,green:t.filter(r=>r.rag_status==="Green").length,amber:t.filter(r=>r.rag_status==="Amber").length,red:t.filter(r=>r.rag_status==="Red").length,unknown:t.filter(r=>r.rag_status==="Unknown").length}}catch(t){throw t}}async getAssessments(s){try{const{data:t,error:r}=await u.from("deliverable_kpi_assessments").select("kpi_id, criteria_met").eq("project_id",s);if(r)throw r;return t||[]}catch(t){throw t}}}const Gs=new Ks;class Qs extends te{constructor(){super("quality_standards")}async getAllWithStatus(s){try{return(await this.getAll(s,{orderBy:{column:"name",ascending:!0}})).map(r=>({...r,compliance_status:this.calculateCompliance(r)}))}catch(t){throw t}}calculateCompliance(s){if(s.actual_value===null||s.actual_value===void 0)return"Not Measured";const t=parseFloat(s.actual_value),r=parseFloat(s.target_value||0);return t>=r?"Compliant":t>=r*.9?"Near Compliant":"Non-Compliant"}async getNonCompliant(s){try{return(await this.getAllWithStatus(s)).filter(r=>r.compliance_status==="Non-Compliant")}catch(t){throw t}}async updateMeasurement(s,t,r){return this.update(s,{actual_value:t,measurement_notes:r,last_measured:new Date().toISOString()})}async getSummary(s){try{const t=await this.getAllWithStatus(s);return{total:t.length,compliant:t.filter(r=>r.compliance_status==="Compliant").length,nearCompliant:t.filter(r=>r.compliance_status==="Near Compliant").length,nonCompliant:t.filter(r=>r.compliance_status==="Non-Compliant").length,notMeasured:t.filter(r=>r.compliance_status==="Not Measured").length}}catch(t){throw t}}}const Ys=new Qs;class Xs extends te{constructor(){super("standards",{supportsSoftDelete:!1,sanitizeConfig:"standard"})}async getAll(s){return super.getAll(s,{orderBy:{column:"standard_ref",ascending:!0}})}async getByStatus(s,t){return super.getAll(s,{filters:[{column:"status",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getByCategory(s,t){return super.getAll(s,{filters:[{column:"category",operator:"eq",value:t}],orderBy:{column:"standard_ref",ascending:!0}})}async getSummary(s){try{const t=await this.getAll(s);return{total:t.length,completed:t.filter(r=>r.status==="Completed").length,inProgress:t.filter(r=>r.status==="In Progress").length,notStarted:t.filter(r=>!r.status||r.status==="Not Started").length}}catch(t){throw t}}}new Xs;const Js={version:"2.0",widgets:{"progress-hero":{visible:!0,x:0,y:0,w:12,h:2,minW:6,minH:2,maxH:3},"budget-summary":{visible:!1,x:0,y:2,w:6,h:2,minW:4,minH:2,maxH:3},"pmo-tracking":{visible:!1,x:6,y:2,w:6,h:2,minW:6,minH:2,maxH:4},"stats-grid":{visible:!0,x:0,y:2,w:12,h:2,minW:8,minH:2,maxH:3},certificates:{visible:!1,x:0,y:4,w:12,h:2,minW:6,minH:2,maxH:3},"milestones-list":{visible:!0,x:0,y:4,w:12,h:4,minW:8,minH:3,maxH:6},"kpis-category":{visible:!1,x:0,y:8,w:6,h:3,minW:4,minH:3,maxH:5},"quality-standards":{visible:!1,x:6,y:8,w:6,h:3,minW:4,minH:3,maxH:5}}};({...Js});function Ze(n){if(!n)return!1;const s=n.toLowerCase();return s.includes("pmo")||s.includes("project manager")}function Zs(){const{showTestUsers:n}=Xr(),{projectId:s,projectName:t,projectRef:r}=ht(),{user:a,role:i}=be(),[o,d]=l.useState(!0),[c,h]=l.useState({totalMilestones:0,completedMilestones:0,totalDeliverables:0,deliveredCount:0,inProgressDeliverables:0,totalResources:0,totalKPIs:0,achievedKPIs:0,totalQS:0,achievedQS:0,totalBudget:0,spendToDate:0}),[x,b]=l.useState({signed:0,pending:0,awaitingGeneration:0}),[v,E]=l.useState({pmoBudget:0,pmoSpend:0,nonPmoBudget:0,nonPmoSpend:0}),[L,S]=l.useState([]),[T,M]=l.useState({}),[V,q]=l.useState({}),[y,_]=l.useState([]),[N,j]=l.useState(0),p=l.useCallback(async()=>{if(s){d(!0);try{const C=await Fs.getAll(s,{orderBy:{column:"milestone_ref",ascending:!0}});S(C);const $=await Hs.getSummary(s),Q=await Gs.getAll(s,{orderBy:{column:"kpi_ref",ascending:!0}}),w=await Ys.getAll(s,{orderBy:{column:"qs_ref",ascending:!0}});_(w);const{data:O}=await u.from("resources").select("*"),X=await Bs.getAllFiltered(s,n);let Y=0,W=0;O&&O.forEach(D=>{const ee=(D.daily_rate||0)*(D.days_allocated||0);Ze(D.role)?Y+=ee:W+=ee});const U={};let P=0,f=0,B=0;X&&O&&X.forEach(D=>{if(!(D.status==="Approved"||D.status==="Submitted"&&!D.was_rejected))return;const It=parseFloat(D.hours_worked||D.hours||0),je=D.resources||O.find(ie=>ie.id===D.resource_id);if(je){const ie=It/8*(je.daily_rate||0);D.milestone_id&&(U[D.milestone_id]=(U[D.milestone_id]||0)+ie),P+=ie,Ze(je.role)?f+=ie:B+=ie}}),M(U),E({pmoBudget:Y,pmoSpend:f,nonPmoBudget:W,nonPmoSpend:B});const G={};Q.forEach(D=>{const ee=D.category||"Other";G[ee]||(G[ee]=[]),G[ee].push(D)}),q(G);const F=C.length,se=C.filter(D=>D.status==="Completed").length,le=$.total,he=$.delivered,ce=$.inProgress||0,_t=O?.length||0,wt=Q.length,jt=Q.filter(D=>(D.current_value||0)>=(D.target||90)).length,St=w.length,Nt=w.filter(D=>(D.current_value||0)>=(D.target||100)).length,{data:we}=await u.from("milestone_certificates").select("*").eq("project_id",s),Ct=we?.filter(D=>D.status==="Signed").length||0,kt=we?.filter(D=>D.status==="Pending Customer Signature"||D.status==="Pending Supplier Signature").length||0,Et=Math.max(0,se-(we?.length||0));b({signed:Ct,pending:kt,awaitingGeneration:Et});const Rt=C.reduce((D,ee)=>D+(ee.budget||0),0),Pt=F>0?Math.round(C.reduce((D,ee)=>D+(ee.progress||0),0)/F):0;j(Pt),h({totalMilestones:F,completedMilestones:se,totalDeliverables:le,deliveredCount:he,inProgressDeliverables:ce,totalResources:_t,totalKPIs:wt,achievedKPIs:jt,totalQS:St,achievedQS:Nt,totalBudget:Rt,spendToDate:P})}catch{}finally{d(!1)}}},[s,n]);l.useEffect(()=>{p()},[p]);const g=C=>C>=1e6?`Â£${(C/1e6).toFixed(1)}M`:C>=1e3?`Â£${Math.round(C/1e3)}k`:`Â£${Math.round(C)}`,I=()=>{const C=new Date().getHours();return C<12?"Good morning":C<18?"Good afternoon":"Good evening"};if(o)return e.jsx(Ue,{message:"Loading dashboard...",size:"large",fullPage:!0});const R=c.totalBudget>0?Math.round(c.spendToDate/c.totalBudget*100):0,k=Math.max(...L.map(C=>C.budget||0),1);return e.jsxs("div",{className:"dashboard",children:[e.jsx("div",{className:"dashboard-header",children:e.jsx("div",{className:"dashboard-header-content",children:e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title",children:I()}),e.jsxs("p",{className:"dashboard-subtitle",children:[r," â€¢ ",t]})]})})}),e.jsxs("div",{className:"dashboard-content",children:[e.jsxs("div",{className:"progress-ring-container",children:[e.jsxs("div",{className:"progress-ring-info",children:[e.jsxs("h2",{children:[N,"%"]}),e.jsx("p",{children:"Overall Project Progress"}),e.jsxs("p",{className:"detail",children:[c.completedMilestones," of ",c.totalMilestones," milestones complete"]})]}),e.jsxs("div",{className:"progress-ring",children:[e.jsxs("svg",{width:"140",height:"140",viewBox:"0 0 140 140",children:[e.jsx("circle",{className:"progress-ring-bg",cx:"70",cy:"70",r:"58"}),e.jsx("circle",{className:"progress-ring-fill",cx:"70",cy:"70",r:"58",strokeDasharray:`${N*3.64} 364`})]}),e.jsxs("span",{className:"progress-ring-text",children:[N,"%"]})]})]}),e.jsxs("div",{className:"hero-metrics",children:[e.jsxs("div",{className:"hero-metric",children:[e.jsx("div",{className:"hero-metric-icon teal",children:e.jsx(me,{size:20})}),e.jsx("div",{className:"hero-metric-label",children:"Milestones"}),e.jsxs("div",{className:"hero-metric-value teal",children:[c.completedMilestones,"/",c.totalMilestones]}),e.jsxs("div",{className:"hero-metric-subtext",children:[e.jsx(We,{size:14}),c.totalMilestones>0?Math.round(c.completedMilestones/c.totalMilestones*100):0,"% complete"]})]}),e.jsxs("div",{className:"hero-metric",children:[e.jsx("div",{className:"hero-metric-icon success",children:e.jsx(Te,{size:20})}),e.jsx("div",{className:"hero-metric-label",children:"Deliverables"}),e.jsxs("div",{className:"hero-metric-value success",children:[c.deliveredCount,"/",c.totalDeliverables]}),e.jsxs("div",{className:"hero-metric-subtext",children:[e.jsx(Me,{size:14}),c.totalDeliverables>0?Math.round(c.deliveredCount/c.totalDeliverables*100):0,"% delivered"]})]}),e.jsxs("div",{className:"hero-metric",children:[e.jsx("div",{className:"hero-metric-icon accent",children:e.jsx(fr,{size:20})}),e.jsx("div",{className:"hero-metric-label",children:"KPIs Achieved"}),e.jsxs("div",{className:"hero-metric-value accent",children:[c.achievedKPIs,"/",c.totalKPIs]}),e.jsxs("div",{className:"hero-metric-subtext",children:[e.jsx(Ae,{size:14}),c.totalKPIs>0?Math.round(c.achievedKPIs/c.totalKPIs*100):0,"% on target"]})]}),e.jsxs("div",{className:"hero-metric",children:[e.jsx("div",{className:"hero-metric-icon purple",style:{background:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6"},children:e.jsx(pe,{size:20})}),e.jsx("div",{className:"hero-metric-label",children:"Quality Standards"}),e.jsxs("div",{className:"hero-metric-value",style:{color:"#8b5cf6"},children:[c.achievedQS,"/",c.totalQS]}),e.jsxs("div",{className:"hero-metric-subtext",children:[e.jsx(We,{size:14}),c.totalQS>0?Math.round(c.achievedQS/c.totalQS*100):0,"% achieved"]})]})]}),(x.pending>0||x.awaitingGeneration>0)&&e.jsxs("div",{className:"certificates-banner",children:[e.jsxs("div",{className:"certificates-info",children:[e.jsx("div",{className:"certificates-icon",children:e.jsx(pr,{size:24})}),e.jsxs("div",{className:"certificates-text",children:[e.jsx("h4",{children:"Milestone Certificates"}),e.jsx("p",{children:"Track completion certificates for billing milestones"})]})]}),e.jsxs("div",{className:"certificates-stats",children:[e.jsxs("div",{className:"cert-stat",children:[e.jsx("div",{className:"cert-stat-value signed",children:x.signed}),e.jsx("div",{className:"cert-stat-label",children:"Signed"})]}),e.jsxs("div",{className:"cert-stat",children:[e.jsx("div",{className:"cert-stat-value pending",children:x.pending}),e.jsx("div",{className:"cert-stat-label",children:"Pending"})]}),e.jsxs("div",{className:"cert-stat",children:[e.jsx("div",{className:"cert-stat-value awaiting",children:x.awaitingGeneration}),e.jsx("div",{className:"cert-stat-label",children:"Awaiting"})]})]}),e.jsxs(J,{to:"/milestones",className:"certificates-action",children:["View Certificates ",e.jsx(gr,{size:14,style:{marginLeft:4,verticalAlign:"middle"}})]})]}),e.jsxs("div",{className:"card-grid",children:[e.jsx("div",{className:"card-span-6",children:e.jsxs("div",{className:"ds-card",children:[e.jsxs("div",{className:"ds-card-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"Budget Overview"}),e.jsxs("p",{className:"ds-card-subtitle",children:[R,"% of budget utilized"]})]}),e.jsx(J,{to:"/reports",className:"ds-card-action",children:"View Reports â†’"})]}),e.jsxs("div",{className:"ds-card-body",children:[e.jsxs("div",{className:"budget-display",children:[e.jsxs("div",{className:"budget-item",children:[e.jsx("div",{className:"budget-item-label",children:"Total Budget"}),e.jsx("div",{className:"budget-item-value budget",children:g(c.totalBudget)})]}),e.jsxs("div",{className:"budget-item",children:[e.jsx("div",{className:"budget-item-label",children:"Spend to Date"}),e.jsx("div",{className:"budget-item-value spend",children:g(c.spendToDate)}),e.jsxs("div",{className:"budget-item-percent",children:[R,"% utilized"]})]})]}),e.jsx("div",{style:{marginTop:24},children:e.jsx("div",{className:"progress-bar",style:{height:8},children:e.jsx("div",{className:"progress-bar-fill teal",style:{width:`${Math.min(R,100)}%`}})})})]})]})}),e.jsx("div",{className:"card-span-6",children:e.jsxs("div",{className:"ds-card",children:[e.jsx("div",{className:"ds-card-header",children:e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"PMO Cost Tracking"}),e.jsx("p",{className:"ds-card-subtitle",children:"Management vs delivery costs"})]})}),e.jsx("div",{className:"ds-card-body",children:e.jsxs("div",{className:"stat-tiles",children:[e.jsxs("div",{className:"stat-tile",children:[e.jsx("div",{className:"stat-tile-value",style:{color:"#f59e0b"},children:g(v.pmoBudget)}),e.jsx("div",{className:"stat-tile-label",children:"PMO Budget"})]}),e.jsxs("div",{className:"stat-tile",children:[e.jsx("div",{className:"stat-tile-value",style:{color:"#ea580c"},children:g(v.pmoSpend)}),e.jsx("div",{className:"stat-tile-label",children:"PMO Spend"})]}),e.jsxs("div",{className:"stat-tile",children:[e.jsx("div",{className:"stat-tile-value",style:{color:"var(--ds-accent)"},children:g(v.nonPmoBudget)}),e.jsx("div",{className:"stat-tile-label",children:"Delivery Budget"})]}),e.jsxs("div",{className:"stat-tile",children:[e.jsx("div",{className:"stat-tile-value",style:{color:"var(--ds-teal)"},children:g(v.nonPmoSpend)}),e.jsx("div",{className:"stat-tile-label",children:"Delivery Spend"})]})]})})]})}),e.jsx("div",{className:"card-span-8",children:e.jsxs("div",{className:"ds-card",children:[e.jsxs("div",{className:"ds-card-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"Milestone Budget vs Spend"}),e.jsx("p",{className:"ds-card-subtitle",children:"Comparing billable amounts to actual costs"})]}),e.jsx(J,{to:"/milestones",className:"ds-card-action",children:"View All â†’"})]}),e.jsxs("div",{className:"ds-card-body",children:[e.jsxs("div",{className:"milestone-legend",children:[e.jsxs("div",{className:"milestone-legend-item",children:[e.jsx("div",{className:"milestone-legend-dot budget"}),e.jsx("span",{children:"Budget"})]}),e.jsxs("div",{className:"milestone-legend-item",children:[e.jsx("div",{className:"milestone-legend-dot spend"}),e.jsx("span",{children:"Spend"})]})]}),e.jsx("div",{className:"milestone-chart",children:L.map(C=>{const $=T[C.id]||0,Q=k>0?(C.budget||0)/k*100:0,w=k>0?$/k*100:0;return e.jsxs("div",{className:"milestone-bar-group",children:[e.jsxs("div",{className:"milestone-bars",children:[e.jsx("div",{className:"milestone-bar budget",style:{height:`${Math.max(Q,5)}%`},title:`Budget: ${g(C.budget||0)}`}),e.jsx("div",{className:"milestone-bar spend",style:{height:`${Math.max(w,$>0?5:0)}%`},title:`Spend: ${g($)}`})]}),e.jsx("span",{className:"milestone-label",children:C.milestone_ref})]},C.id)})})]})]})}),e.jsx("div",{className:"card-span-4",children:e.jsxs("div",{className:"ds-card",children:[e.jsxs("div",{className:"ds-card-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"KPI Performance"}),e.jsx("p",{className:"ds-card-subtitle",children:"By category"})]}),e.jsx(J,{to:"/kpis",className:"ds-card-action",children:"View All â†’"})]}),e.jsx("div",{className:"ds-card-body",children:e.jsx("div",{className:"kpi-categories",children:Object.entries(V).map(([C,$])=>{const Q=$.length,w=$.filter(Y=>(Y.current_value||0)>=(Y.target||90)).length,O=Q>0?w/Q*100:0,X=C.includes("Time")?"time":C.includes("Quality")?"quality":"delivery";return e.jsxs("div",{className:"kpi-category",children:[e.jsx("div",{className:"kpi-category-bar-container",children:e.jsxs("div",{className:`kpi-category-bar ${X}`,style:{height:`${Math.max(O,15)}%`},children:[w,"/",Q]})}),e.jsx("div",{className:"kpi-category-label",children:C.split(" ")[0]})]},C)})})})]})}),e.jsx("div",{className:"card-span-6",children:e.jsxs("div",{className:"ds-card",children:[e.jsxs("div",{className:"ds-card-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"Quality Standards"}),e.jsxs("p",{className:"ds-card-subtitle",children:[c.achievedQS," of ",c.totalQS," standards achieved"]})]}),e.jsx(J,{to:"/quality-standards",className:"ds-card-action",children:"View All â†’"})]}),e.jsx("div",{className:"ds-card-body",children:e.jsx("div",{className:"progress-list",children:y.slice(0,5).map(C=>{const $=C.current_value||0,Q=$>=(C.target||100);return e.jsxs("div",{className:"progress-item",children:[e.jsxs("div",{className:"progress-item-header",children:[e.jsxs("span",{className:"progress-item-label",children:[C.qs_ref," - ",C.name]}),e.jsxs("span",{className:"progress-item-value",children:[$,"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-bar-fill ${Q?"success":"purple"}`,style:{width:`${$}%`}})})]},C.id)})})})]})}),e.jsx("div",{className:"card-span-6",children:e.jsxs("div",{className:"ds-card",children:[e.jsx("div",{className:"ds-card-header",children:e.jsxs("div",{children:[e.jsx("h3",{className:"ds-card-title",children:"Project Summary"}),e.jsx("p",{className:"ds-card-subtitle",children:"Key metrics at a glance"})]})}),e.jsx("div",{className:"ds-card-body",children:e.jsxs("div",{className:"progress-list",children:[e.jsxs("div",{className:"progress-item",children:[e.jsxs("div",{className:"progress-item-header",children:[e.jsx("span",{className:"progress-item-label",children:"Milestone Completion"}),e.jsxs("span",{className:"progress-item-value",children:[c.completedMilestones,"/",c.totalMilestones]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill teal",style:{width:`${c.totalMilestones>0?c.completedMilestones/c.totalMilestones*100:0}%`}})})]}),e.jsxs("div",{className:"progress-item",children:[e.jsxs("div",{className:"progress-item-header",children:[e.jsx("span",{className:"progress-item-label",children:"Deliverables Completed"}),e.jsxs("span",{className:"progress-item-value",children:[c.deliveredCount,"/",c.totalDeliverables]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill success",style:{width:`${c.totalDeliverables>0?c.deliveredCount/c.totalDeliverables*100:0}%`}})})]}),e.jsxs("div",{className:"progress-item",children:[e.jsxs("div",{className:"progress-item-header",children:[e.jsx("span",{className:"progress-item-label",children:"Budget Utilization"}),e.jsxs("span",{className:"progress-item-value",children:[R,"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill accent",style:{width:`${Math.min(R,100)}%`}})})]}),e.jsxs("div",{className:"progress-item",children:[e.jsxs("div",{className:"progress-item-header",children:[e.jsx("span",{className:"progress-item-label",children:"KPI Achievement"}),e.jsxs("span",{className:"progress-item-value",children:[c.achievedKPIs,"/",c.totalKPIs]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar-fill warning",style:{width:`${c.totalKPIs>0?c.achievedKPIs/c.totalKPIs*100:0}%`}})})]})]})})]})})]}),e.jsxs("div",{className:"quick-links",children:[e.jsxs(J,{to:"/milestones",className:"quick-link",children:[e.jsx("div",{className:"quick-link-icon teal",children:e.jsx(me,{size:24})}),e.jsx("div",{className:"quick-link-title",children:"Milestones"})]}),e.jsxs(J,{to:"/deliverables",className:"quick-link",children:[e.jsx("div",{className:"quick-link-icon success",children:e.jsx(Te,{size:24})}),e.jsx("div",{className:"quick-link-title",children:"Deliverables"})]}),e.jsxs(J,{to:"/kpis",className:"quick-link",children:[e.jsx("div",{className:"quick-link-icon accent",children:e.jsx(Me,{size:24})}),e.jsx("div",{className:"quick-link-title",children:"KPIs"})]}),e.jsxs(J,{to:"/quality-standards",className:"quick-link",children:[e.jsx("div",{className:"quick-link-icon purple",children:e.jsx(pe,{size:24})}),e.jsx("div",{className:"quick-link-title",children:"Quality"})]}),e.jsxs(J,{to:"/reports",className:"quick-link",children:[e.jsx("div",{className:"quick-link-icon warning",children:e.jsx(Ae,{size:24})}),e.jsx("div",{className:"quick-link-title",children:"Reports"})]})]})]})]})}const ea=l.lazy(()=>K(()=>import("./ResetPassword-BohINNVE.js"),__vite__mapDeps([0,1,2,3]))),ta=l.lazy(()=>K(()=>import("./Milestones-DixJhz6P.js"),__vite__mapDeps([4,1,5,6,7,8,2,3]))),ra=l.lazy(()=>K(()=>import("./MilestoneDetail-8diP__Kg.js"),__vite__mapDeps([9,1,2,3]))),sa=l.lazy(()=>K(()=>import("./Gantt-BbCEkQCo.js"),__vite__mapDeps([10,1,5,2,3]))),aa=l.lazy(()=>K(()=>import("./Deliverables-Bgd3bsw7.js"),__vite__mapDeps([11,1,5,7,2,3]))),na=l.lazy(()=>K(()=>import("./Resources-Di8ymjYb.js"),__vite__mapDeps([12,1,5,6,7,8,2,3]))),ia=l.lazy(()=>K(()=>import("./ResourceDetail-CUkw1EdP.js"),__vite__mapDeps([13,1,5,6,2,3]))),oa=l.lazy(()=>K(()=>import("./Partners-oy3_e5gG.js"),__vite__mapDeps([14,1,5,6,7,8,2,3]))),la=l.lazy(()=>K(()=>import("./PartnerDetail-CWsnIfZ-.js"),__vite__mapDeps([15,1,5,6,2,3]))),ca=l.lazy(()=>K(()=>import("./Timesheets-BUi2SNbd.js"),__vite__mapDeps([16,1,5,6,7,8,2,3]))),da=l.lazy(()=>K(()=>import("./Expenses-BrVdOyMH.js"),__vite__mapDeps([17,1,5,6,7,8,2,3,18]))),ua=l.lazy(()=>K(()=>import("./KPIs-D1uNKb3Y.js"),__vite__mapDeps([19,1,5,6,7,8,2,3]))),ma=l.lazy(()=>K(()=>import("./KPIDetail-Du1vU6mO.js"),__vite__mapDeps([20,1,5,2,3]))),ha=l.lazy(()=>K(()=>import("./QualityStandards-CTR9D-nf.js"),__vite__mapDeps([21,1,5,6,7,8,2,3]))),fa=l.lazy(()=>K(()=>import("./QualityStandardDetail-DgWZYysJ.js"),__vite__mapDeps([22,1,2,3]))),pa=l.lazy(()=>K(()=>import("./Reports-CEDriftX.js"),__vite__mapDeps([23,2,1,3]))),ga=l.lazy(()=>K(()=>import("./Users-C9QZ3js5.js"),__vite__mapDeps([24,1,2,3]))),ya=l.lazy(()=>K(()=>import("./Settings-DzYlMqQV.js"),__vite__mapDeps([25,1,5,7,2,3]))),xa=l.lazy(()=>K(()=>import("./AccountSettings-BHFfcmN6.js"),__vite__mapDeps([26,1,7,2,3]))),ba=l.lazy(()=>K(()=>import("./WorkflowSummary-Do4ybSaz.js"),__vite__mapDeps([27,1,6,7,2,3]))),va=l.lazy(()=>K(()=>import("./AuditLog-BIXG8Zb1.js"),__vite__mapDeps([28,1,7,2,3]))),_a=l.lazy(()=>K(()=>import("./DeletedItems-DDwjvXfZ.js"),__vite__mapDeps([29,1,7,8,2,3])));function wa(){return e.jsx("div",{className:"page-container",children:e.jsx(ue,{type:"page"})})}function H({children:n}){const{user:s,isLoading:t}=be();return t?e.jsx(Ue,{message:"Loading...",size:"large",fullPage:!0}):s?e.jsx(ks,{children:e.jsx(l.Suspense,{fallback:e.jsx(wa,{}),children:n||e.jsx(zt,{})})}):e.jsx(De,{to:"/login",replace:!0})}function ja(){return e.jsx(Ot,{children:e.jsx(ns,{children:e.jsx(ms,{children:e.jsx(Gr,{children:e.jsx(Qr,{children:e.jsx(Yr,{children:e.jsx(Zr,{children:e.jsxs(ss,{children:[e.jsxs(Lt,{children:[e.jsx(z,{path:"/login",element:e.jsx(Es,{})}),e.jsx(z,{path:"/reset-password",element:e.jsx(l.Suspense,{fallback:e.jsx(Ue,{fullPage:!0}),children:e.jsx(ea,{})})}),e.jsx(z,{path:"/",element:e.jsx(De,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"/dashboard",element:e.jsx(H,{children:e.jsx(Zs,{})})}),e.jsx(z,{path:"/milestones",element:e.jsx(H,{children:e.jsx(ta,{})})}),e.jsx(z,{path:"/milestones/:id",element:e.jsx(H,{children:e.jsx(ra,{})})}),e.jsx(z,{path:"/gantt",element:e.jsx(H,{children:e.jsx(sa,{})})}),e.jsx(z,{path:"/deliverables",element:e.jsx(H,{children:e.jsx(aa,{})})}),e.jsx(z,{path:"/resources",element:e.jsx(H,{children:e.jsx(na,{})})}),e.jsx(z,{path:"/resources/:id",element:e.jsx(H,{children:e.jsx(ia,{})})}),e.jsx(z,{path:"/partners",element:e.jsx(H,{children:e.jsx(oa,{})})}),e.jsx(z,{path:"/partners/:id",element:e.jsx(H,{children:e.jsx(la,{})})}),e.jsx(z,{path:"/timesheets",element:e.jsx(H,{children:e.jsx(ca,{})})}),e.jsx(z,{path:"/expenses",element:e.jsx(H,{children:e.jsx(da,{})})}),e.jsx(z,{path:"/kpis",element:e.jsx(H,{children:e.jsx(ua,{})})}),e.jsx(z,{path:"/kpis/:id",element:e.jsx(H,{children:e.jsx(ma,{})})}),e.jsx(z,{path:"/quality-standards",element:e.jsx(H,{children:e.jsx(ha,{})})}),e.jsx(z,{path:"/quality-standards/:id",element:e.jsx(H,{children:e.jsx(fa,{})})}),e.jsx(z,{path:"/reports",element:e.jsx(H,{children:e.jsx(pa,{})})}),e.jsx(z,{path:"/users",element:e.jsx(H,{children:e.jsx(ga,{})})}),e.jsx(z,{path:"/settings",element:e.jsx(H,{children:e.jsx(ya,{})})}),e.jsx(z,{path:"/account",element:e.jsx(H,{children:e.jsx(xa,{})})}),e.jsx(z,{path:"/workflow-summary",element:e.jsx(H,{children:e.jsx(ba,{})})}),e.jsx(z,{path:"/audit-log",element:e.jsx(H,{children:e.jsx(va,{})})}),e.jsx(z,{path:"/deleted-items",element:e.jsx(H,{children:e.jsx(_a,{})})}),e.jsx(z,{path:"*",element:e.jsx(De,{to:"/dashboard",replace:!0})})]}),e.jsx(fs,{}),e.jsx(Mr,{}),e.jsx(Wr,{})]})})})})})})})})}qe.createRoot(document.getElementById("root")).render(e.jsx(et.StrictMode,{children:e.jsx(ja,{})}));export{Ue as L,xs as P,bs as R,ht as a,hs as b,Xr as c,Hs as d,Da as e,m as f,Ra as g,Ea as h,Aa as i,e as j,Gs as k,Fs as m,Pa as p,Ys as q,Ia as r,u as s,Bs as t,be as u};
